# Comparing `tmp/hydromt_wflow-0.2.1.tar.gz` & `tmp/hydromt_wflow-0.3.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "hydromt_wflow-0.2.1.tar", last modified: Tue Nov 22 03:08:24 2022, max compression
+gzip compressed data, was "hydromt_wflow-0.3.0.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
```

## Comparing `hydromt_wflow-0.2.1.tar` & `hydromt_wflow-0.3.0.tar`

### file list

```diff
@@ -1,34 +1,37 @@
--rw-r--r--   0        0        0     1674 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/.gitignore
--rw-r--r--   0        0        0      775 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/.zenodo.json
--rw-r--r--   0        0        0    35148 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/LICENSE
--rw-r--r--   0        0        0     4167 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/README.rst
--rw-r--r--   0        0        0     2835 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/_archive/README.rst
--rw-r--r--   0        0        0     4891 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/_archive/api.rst
--rw-r--r--   0        0        0     7925 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/_archive/sediment.rst
--rw-r--r--   0        0        0     6757 2022-11-22 03:08:09.711035 hydromt_wflow-0.2.1/_archive/wflow.rst
--rw-r--r--   0        0        0      590 2022-11-22 03:08:09.715035 hydromt_wflow-0.2.1/environment.yml
--rw-r--r--   0        0        0      334 2022-11-22 03:08:09.751037 hydromt_wflow-0.2.1/hydromt_wflow/__init__.py
--rw-r--r--   0        0        0      197 2022-11-22 03:08:09.751037 hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/README
--rw-r--r--   0        0        0     3181 2022-11-22 03:08:09.751037 hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/corine_mapping.csv
--rw-r--r--   0        0        0      753 2022-11-22 03:08:09.751037 hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/esa_worldcover_mapping.csv
--rw-r--r--   0        0        0     2658 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/globcover_mapping.csv
--rw-r--r--   0        0        0     1799 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/vito_mapping.csv
--rw-r--r--   0        0        0      297 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/rivwth/koppen_geiger.csv
--rw-r--r--   0        0        0      433 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/rivwth/regr_chelsa.csv
--rw-r--r--   0        0        0       92 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/wflow/N_river_mapping.csv
--rw-r--r--   0        0        0     3447 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/wflow/wflow_sbm.toml
--rw-r--r--   0        0        0      321 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/wflow_sediment/riverbedsed_mapping.csv
--rw-r--r--   0        0        0     3559 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/data/wflow_sediment/wflow_sediment.toml
--rw-r--r--   0        0        0     7534 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/utils.py
--rw-r--r--   0        0        0   103227 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/wflow.py
--rw-r--r--   0        0        0    16278 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/wflow_sediment.py
--rw-r--r--   0        0        0      175 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/__init__.py
--rw-r--r--   0        0        0    12387 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/basemaps.py
--rw-r--r--   0        0        0     6824 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/glaciers.py
--rw-r--r--   0        0        0     3604 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/landuse.py
--rw-r--r--   0        0        0    12436 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/ptf.py
--rw-r--r--   0        0        0    20261 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/river.py
--rw-r--r--   0        0        0    22722 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/soilgrids.py
--rw-r--r--   0        0        0    16326 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/hydromt_wflow/workflows/waterbodies.py
--rw-r--r--   0        0        0     1811 2022-11-22 03:08:09.755037 hydromt_wflow-0.2.1/pyproject.toml
--rw-r--r--   0        0        0     5631 1970-01-01 00:00:00.000000 hydromt_wflow-0.2.1/PKG-INFO
+-rw-r--r--   0        0        0     1744 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/.gitignore
+-rw-r--r--   0        0        0      775 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/.zenodo.json
+-rw-r--r--   0        0        0    35148 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/LICENSE
+-rw-r--r--   0        0        0     4167 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/README.rst
+-rw-r--r--   0        0        0     2835 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/_archive/README.rst
+-rw-r--r--   0        0        0     4891 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/_archive/api.rst
+-rw-r--r--   0        0        0     7925 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/_archive/sediment.rst
+-rw-r--r--   0        0        0     6757 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/_archive/wflow.rst
+-rw-r--r--   0        0        0      406 2023-07-27 10:04:57.398212 hydromt_wflow-0.3.0/environment.yml
+-rw-r--r--   0        0        0      334 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/__init__.py
+-rw-r--r--   0        0        0      197 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/README
+-rw-r--r--   0        0        0     3181 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/corine_mapping.csv
+-rw-r--r--   0        0        0      753 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/esa_worldcover_mapping.csv
+-rw-r--r--   0        0        0     2658 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/globcover_mapping.csv
+-rw-r--r--   0        0        0     1799 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/vito_mapping.csv
+-rw-r--r--   0        0        0     3310 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/parameters_data.yml
+-rw-r--r--   0        0        0      297 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/rivwth/koppen_geiger.csv
+-rw-r--r--   0        0        0      433 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/rivwth/regr_chelsa.csv
+-rw-r--r--   0        0        0       92 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/wflow/N_river_mapping.csv
+-rw-r--r--   0        0        0     3014 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/wflow/wflow_sbm.toml
+-rw-r--r--   0        0        0      321 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/wflow_sediment/riverbedsed_mapping.csv
+-rw-r--r--   0        0        0     3441 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/data/wflow_sediment/wflow_sediment.toml
+-rw-r--r--   0        0        0     7534 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/utils.py
+-rw-r--r--   0        0        0   141119 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/wflow.py
+-rw-r--r--   0        0        0    19630 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/wflow_sediment.py
+-rw-r--r--   0        0        0      225 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/__init__.py
+-rw-r--r--   0        0        0    12428 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/basemaps.py
+-rw-r--r--   0        0        0     2974 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/gauges.py
+-rw-r--r--   0        0        0     6814 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/glaciers.py
+-rw-r--r--   0        0        0     3281 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/landuse.py
+-rw-r--r--   0        0        0    12431 2023-07-27 10:04:57.430212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/ptf.py
+-rw-r--r--   0        0        0    23944 2023-07-27 10:04:57.434212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/river.py
+-rw-r--r--   0        0        0    37135 2023-07-27 10:04:57.434212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/rootzoneclim.py
+-rw-r--r--   0        0        0    22456 2023-07-27 10:04:57.434212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/soilgrids.py
+-rw-r--r--   0        0        0    25797 2023-07-27 10:04:57.434212 hydromt_wflow-0.3.0/hydromt_wflow/workflows/waterbodies.py
+-rw-r--r--   0        0        0     1905 2023-07-27 10:04:57.434212 hydromt_wflow-0.3.0/pyproject.toml
+-rw-r--r--   0        0        0     5612 1970-01-01 00:00:00.000000 hydromt_wflow-0.3.0/PKG-INFO
```

### Comparing `hydromt_wflow-0.2.1/.gitignore` & `hydromt_wflow-0.3.0/.gitignore`

 * *Files 10% similar despite different names*

```diff
@@ -1,9 +1,12 @@
 # file based on github/gitignore
 
+# ignore all files in this directory
+sandbox
+
 # Byte-compiled / optimized / DLL files
 __pycache__/
 *.py[cod]
 *$py.class
 
 # C extensions
 *.so
@@ -83,14 +86,15 @@
 examples/wflow_test_full
 examples/wflow_test_clip
 examples/wflow_piave_corine
 examples/wflow_piave_forcing
 examples/wflow_piave_gauges
 examples/wflow_test_sediment
 examples/wflow_test_extend_sediment
+examples/elevation_data
 
 # pyenv
 .python-version
 
 # celery beat schedule file
 celerybeat-schedule
```

### Comparing `hydromt_wflow-0.2.1/.zenodo.json` & `hydromt_wflow-0.3.0/.zenodo.json`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/LICENSE` & `hydromt_wflow-0.3.0/LICENSE`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/README.rst` & `hydromt_wflow-0.3.0/README.rst`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/_archive/README.rst` & `hydromt_wflow-0.3.0/_archive/README.rst`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/_archive/api.rst` & `hydromt_wflow-0.3.0/_archive/api.rst`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/_archive/sediment.rst` & `hydromt_wflow-0.3.0/_archive/sediment.rst`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/_archive/wflow.rst` & `hydromt_wflow-0.3.0/_archive/wflow.rst`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/corine_mapping.csv` & `hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/corine_mapping.csv`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/esa_worldcover_mapping.csv` & `hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/esa_worldcover_mapping.csv`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/globcover_mapping.csv` & `hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/globcover_mapping.csv`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/data/lulc/vito_mapping.csv` & `hydromt_wflow-0.3.0/hydromt_wflow/data/lulc/vito_mapping.csv`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/data/wflow/wflow_sbm.toml` & `hydromt_wflow-0.3.0/hydromt_wflow/data/wflow/wflow_sbm.toml`

 * *Files 17% similar despite different names*

```diff
@@ -2,23 +2,24 @@
 # features, and can also be used to work towards an example of what we want the
 # configuration file to look like.
 # Relative file paths are interpreted as being relative to this TOML file.
 # TOML documentation: https://github.com/toml-lang/toml
 
 casename = "wflow_sbm"
 
-calendar = "proleptic_gregorian" 
-starttime = 2010-02-01T00:00:00 
+calendar = "proleptic_gregorian"
+starttime = 2010-02-01T00:00:00
 endtime = 2010-02-10T00:00:00
-time_units = "days since 1900-01-01 00:00:00" 
-timestepsecs = 86400 
+time_units = "days since 1900-01-01 00:00:00"
+timestepsecs = 86400
+dir_output = "run_default"
 
 [state]
-path_input = "instate/instates.nc" 
-path_output = "run_default/outstate/outstates.nc"
+path_input = "instate/instates.nc"
+path_output = "outstate/outstates.nc"
 
 # if listed, the variable must be present in the NetCDF or error
 # if not listed, the variable can get a default value if it has one
 
 [state.vertical]
 satwaterdepth = "satwaterdepth"
 snow = "snow"
@@ -41,15 +42,14 @@
 h_av = "h_av_land"
 
 [input]
 path_forcing = "inmaps.nc"
 path_static = "staticmaps.nc"
 
 # these are not directly part of the model
-gauges = "wflow_gauges"
 ldd = "wflow_ldd"
 river_location = "wflow_river"
 subcatchment = "wflow_subcatch"
 
 # specify the internal IDs of the parameters which vary over time
 # the external name mapping needs to be below together with the other mappings
 forcing = [
@@ -57,57 +57,57 @@
   "vertical.temperature",
   "vertical.potential_evaporation",
 ]
 
 cyclic = ["vertical.leaf_area_index"]
 
 [input.vertical]
-altitude = "wflow_dem" 
-c = "c" 
-cf_soil = "cf_soil" 
-cfmax = "Cfmax" 
-e_r = "EoverR" 
+altitude = "wflow_dem"
+c = "c"
+cf_soil = "cf_soil"
+cfmax = "Cfmax"
+e_r = "EoverR"
 f = "f"
-infiltcappath = "InfiltCapPath" 
-infiltcapsoil = "InfiltCapSoil" 
-kext = "Kext" 
-"kv₀" = "KsatVer" 
+infiltcappath = "InfiltCapPath"
+infiltcapsoil = "InfiltCapSoil"
+kext = "Kext"
+kv_0 = "KsatVer"
 leaf_area_index = "LAI" # TODO support cyclic
-m = "M_" 
-maxleakage = "MaxLeakage" 
-pathfrac = "PathFrac" 
+m = "M_"
+maxleakage = "MaxLeakage"
+pathfrac = "PathFrac"
 potential_evaporation = "pet" # forcing
 precipitation = "precip" # forcing
-rootdistpar = "rootdistpar" 
-rootingdepth = "RootingDepth" 
-soilminthickness = "SoilMinThickness" 
-soilthickness = "SoilThickness" 
-specific_leaf = "Sl" 
-storage_wood = "Swood" 
+rootdistpar = "rootdistpar"
+rootingdepth = "RootingDepth"
+soilminthickness = "SoilMinThickness"
+soilthickness = "SoilThickness"
+specific_leaf = "Sl"
+storage_wood = "Swood"
 temperature = "temp" # forcing
-tt = "TT" 
-tti = "TTI" 
-ttm = "TTM" 
-water_holding_capacity = "WHC" 
-waterfrac = "WaterFrac" 
-"θᵣ" = "thetaR" 
-"θₛ" = "thetaS"
+tt = "TT"
+tti = "TTI"
+ttm = "TTM"
+water_holding_capacity = "WHC"
+waterfrac = "WaterFrac"
+theta_s = "thetaS"
+theta_r = "thetaR"
 
 [input.lateral.river]
 length = "wflow_riverlength"
 n = "N_River"
 slope = "RiverSlope"
 width = "wflow_riverwidth"
 
 [input.lateral.subsurface]
 ksathorfrac = "KsatHorFrac"
 
 [input.lateral.land]
 n = "N"
-slope = "Slope" 
+slope = "Slope"
 
 [model]
 type = "sbm"
 masswasting = true
 snow = true
 reinit = true
 reservoirs = false
@@ -120,35 +120,14 @@
 kw_river_tstep = 900
 # Fixed sub-timestep for iterations of overland flow (land cells)
 kw_land_tstep = 3600
 
 thicknesslayers = [100, 300, 800]
 
 [output]
-path = "run_default/output.nc"
-
-#[output.vertical]
-#satwaterdepth = "satwaterdepth"
-#snow = "snow"
-#tsoil = "tsoil"
-#ustorelayerdepth = "ustorelayerdepth"
-#snowwater = "snowwater"
-#canopystorage = "canopystorage"
+path = "output.nc"
 
 [output.lateral.river]
 q_av = "q_river"
-#h = "h_river"
-
-#[output.lateral.subsurface]
-#ssf = "ssf"
-
-[output.lateral.land]
-q = "q_land"
-h = "h_land"
 
 [csv]
-path = "run_default/output.csv"
-
-[[csv.column]]
-header = "Q"
-map = "gauges"
-parameter = "lateral.river.q_av"
+path = "output.csv"
```

#### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/data/wflow_sediment/wflow_sediment.toml` & `hydromt_wflow-0.3.0/hydromt_wflow/data/wflow_sediment/wflow_sediment.toml`

 * *Files 7% similar despite different names*

```diff
@@ -2,23 +2,24 @@
 # features, and can also be used to work towards an example of what we want the
 # configuration file to look like.
 # Relative file paths are interpreted as being relative to this TOML file.
 # TOML documentation: https://github.com/toml-lang/toml
 
 casename = "wflow_sediment"
 
-calendar = "proleptic_gregorian" 
-starttime = 2010-02-01T00:00:00 
+calendar = "proleptic_gregorian"
+starttime = 2010-02-01T00:00:00
 endtime = 2010-02-10T00:00:00
-time_units = "days since 1900-01-01 00:00:00" 
-timestepsecs = 86400 
+time_units = "days since 1900-01-01 00:00:00"
+timestepsecs = 86400
+dir_output = "run_default"
 
 [state]
 path_input = "instate/instates.nc" 
-path_output = "run_default/outstate/outstates.nc"
+path_output = "outstate/outstates.nc"
 
 # if listed, the variable must be present in the NetCDF or error
 # if not listed, the variable can get a default value if it has one
 
 [state.lateral.river]
 clayload = "clayload"
 siltload = "siltload"
@@ -40,15 +41,14 @@
 outgrav = "outgrav"
 
 [input]
 path_forcing = "inmaps.nc"
 path_static = "staticmaps.nc"
 
 # these are not directly part of the model
-gauges = "wflow_gauges"
 ldd = "wflow_ldd"
 river_location = "wflow_river"
 subcatchment = "wflow_subcatch"
 
 # specify the internal IDs of the parameters which vary over time
 # the external name mapping needs to be below together with the other mappings
 forcing = [
@@ -122,22 +122,17 @@
 doreservoir = false
 dolake = false
 rainerosmethod = "answers" # Rainfall erosion equation: ["answers", "eurosem"]
 landtransportmethod = "yalinpart" # Overland flow transport capacity method: ["yalinpart", "govers", "yalin"]
 rivtransportmethod = "bagnold" # River flow transport capacity method: ["bagnold", "engelund", "yang", "kodatie", "molinas"]
 
 [output]
-path = "run_default/output.nc"
+path = "output.nc"
 
 [output.vertical]
 soilloss = "soilloss"
 
 [output.lateral.river]
 SSconc = "SSconc"
 
 [csv]
-path = "run_default/output.csv"
-
-[[csv.column]]
-header = "TSS"
-map = "gauges"
-parameter = "lateral.river.SSconc"
+path = "output.csv"
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/utils.py` & `hydromt_wflow-0.3.0/hydromt_wflow/utils.py`

 * *Files identical despite different names*

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/wflow.py` & `hydromt_wflow-0.3.0/hydromt_wflow/wflow.py`

 * *Files 15% similar despite different names*

```diff
@@ -3,6450 +3,8818 @@
 00000020: 220a 2320 496d 706c 656d 656e 7420 6d6f  ".# Implement mo
 00000030: 6465 6c20 636c 6173 7320 666f 6c6c 6f77  del class follow
 00000040: 696e 6720 6d6f 6465 6c20 4150 490a 0a69  ing model API..i
 00000050: 6d70 6f72 7420 6f73 0a66 726f 6d20 6f73  mport os.from os
 00000060: 2e70 6174 6820 696d 706f 7274 206a 6f69  .path import joi
 00000070: 6e2c 2064 6972 6e61 6d65 2c20 6261 7365  n, dirname, base
 00000080: 6e61 6d65 2c20 6973 6669 6c65 2c20 6973  name, isfile, is
-00000090: 6469 720a 6672 6f6d 2074 7970 696e 6720  dir.from typing 
-000000a0: 696d 706f 7274 2055 6e69 6f6e 2c20 4f70  import Union, Op
-000000b0: 7469 6f6e 616c 2c20 4c69 7374 0a69 6d70  tional, List.imp
-000000c0: 6f72 7420 676c 6f62 0a69 6d70 6f72 7420  ort glob.import 
-000000d0: 6e75 6d70 7920 6173 206e 700a 696d 706f  numpy as np.impo
-000000e0: 7274 2070 616e 6461 7320 6173 2070 640a  rt pandas as pd.
-000000f0: 696d 706f 7274 2067 656f 7061 6e64 6173  import geopandas
-00000100: 2061 7320 6770 640a 696d 706f 7274 2078   as gpd.import x
-00000110: 6172 7261 7920 6173 2078 720a 6672 6f6d  array as xr.from
-00000120: 2073 6861 7065 6c79 2e67 656f 6d65 7472   shapely.geometr
-00000130: 7920 696d 706f 7274 2062 6f78 0a69 6d70  y import box.imp
-00000140: 6f72 7420 7079 7072 6f6a 0a69 6d70 6f72  ort pyproj.impor
-00000150: 7420 746f 6d6c 0a69 6d70 6f72 7420 636f  t toml.import co
-00000160: 6465 6373 0a66 726f 6d20 7079 666c 7764  decs.from pyflwd
-00000170: 6972 2069 6d70 6f72 7420 636f 7265 5f64  ir import core_d
-00000180: 382c 2063 6f72 655f 6c64 642c 2063 6f72  8, core_ldd, cor
-00000190: 655f 636f 6e76 6572 7369 6f6e 0a66 726f  e_conversion.fro
-000001a0: 6d20 6461 736b 2e64 6961 676e 6f73 7469  m dask.diagnosti
-000001b0: 6373 2069 6d70 6f72 7420 5072 6f67 7265  cs import Progre
-000001c0: 7373 4261 720a 696d 706f 7274 206c 6f67  ssBar.import log
-000001d0: 6769 6e67 0a69 6d70 6f72 7420 7269 6f78  ging.import riox
-000001e0: 6172 7261 7920 2023 2072 6571 7569 7265  array  # require
-000001f0: 6420 666f 7220 7269 6f20 6163 6365 7373  d for rio access
-00000200: 6f72 0a0a 2320 6672 6f6d 2064 6173 6b2e  or..# from dask.
-00000210: 6469 7374 7269 6275 7465 6420 696d 706f  distributed impo
-00000220: 7274 204c 6f63 616c 436c 7573 7465 722c  rt LocalCluster,
-00000230: 2043 6c69 656e 742c 2070 6572 666f 726d   Client, perform
-00000240: 616e 6365 5f72 6570 6f72 740a 696d 706f  ance_report.impo
-00000250: 7274 2068 7964 726f 6d74 0a66 726f 6d20  rt hydromt.from 
-00000260: 6879 6472 6f6d 742e 6d6f 6465 6c73 2e6d  hydromt.models.m
-00000270: 6f64 656c 5f61 7069 2069 6d70 6f72 7420  odel_api import 
-00000280: 4d6f 6465 6c0a 6672 6f6d 2068 7964 726f  Model.from hydro
-00000290: 6d74 2069 6d70 6f72 7420 666c 770a 6672  mt import flw.fr
-000002a0: 6f6d 2068 7964 726f 6d74 2e69 6f20 696d  om hydromt.io im
-000002b0: 706f 7274 206f 7065 6e5f 6d66 7261 7374  port open_mfrast
-000002c0: 6572 0a0a 6672 6f6d 202e 2069 6d70 6f72  er..from . impor
-000002d0: 7420 7574 696c 732c 2077 6f72 6b66 6c6f  t utils, workflo
-000002e0: 7773 2c20 4441 5441 4449 520a 0a0a 5f5f  ws, DATADIR...__
-000002f0: 616c 6c5f 5f20 3d20 5b22 5766 6c6f 774d  all__ = ["WflowM
-00000300: 6f64 656c 225d 0a0a 6c6f 6767 6572 203d  odel"]..logger =
-00000310: 206c 6f67 6769 6e67 2e67 6574 4c6f 6767   logging.getLogg
-00000320: 6572 285f 5f6e 616d 655f 5f29 0a0a 2320  er(__name__)..# 
-00000330: 7370 6563 6966 7920 7063 7261 7374 6572  specify pcraster
-00000340: 206d 6170 2074 7970 6573 0a23 204e 4f54   map types.# NOT
-00000350: 4520 6e6f 6e20 7363 616c 6172 2028 666c  E non scalar (fl
-00000360: 6f61 7429 2064 6174 6120 7479 7065 7320  oat) data types 
-00000370: 6f6e 6c79 0a50 4352 5f56 535f 4d41 5020  only.PCR_VS_MAP 
-00000380: 3d20 7b0a 2020 2020 2277 666c 6f77 5f6c  = {.    "wflow_l
-00000390: 6464 223a 2022 6c64 6422 2c0a 2020 2020  dd": "ldd",.    
-000003a0: 2277 666c 6f77 5f72 6976 6572 223a 2022  "wflow_river": "
-000003b0: 626f 6f6c 222c 0a20 2020 2022 7766 6c6f  bool",.    "wflo
-000003c0: 775f 7374 7265 616d 6f72 6465 7222 3a20  w_streamorder": 
-000003d0: 226f 7264 696e 616c 222c 0a20 2020 2022  "ordinal",.    "
-000003e0: 7766 6c6f 775f 6761 7567 6573 223a 2022  wflow_gauges": "
-000003f0: 6e6f 6d69 6e61 6c22 2c20 2023 2074 6f20  nominal",  # to 
-00000400: 6176 6f69 6420 6c61 7267 6520 6d65 6d6f  avoid large memo
-00000410: 7279 2075 7361 6765 2069 6e20 7063 7261  ry usage in pcra
-00000420: 7374 6572 2e61 6775 696c 610a 2020 2020  ster.aguila.    
-00000430: 2277 666c 6f77 5f73 7562 6361 7463 6822  "wflow_subcatch"
-00000440: 3a20 226e 6f6d 696e 616c 222c 2020 2320  : "nominal",  # 
-00000450: 6964 656d 2e0a 2020 2020 2277 666c 6f77  idem..    "wflow
-00000460: 5f6c 616e 6475 7365 223a 2022 6e6f 6d69  _landuse": "nomi
-00000470: 6e61 6c22 2c0a 2020 2020 2277 666c 6f77  nal",.    "wflow
-00000480: 5f73 6f69 6c22 3a20 226e 6f6d 696e 616c  _soil": "nominal
-00000490: 222c 0a20 2020 2022 7766 6c6f 775f 7265  ",.    "wflow_re
-000004a0: 7365 7276 6f69 7261 7265 6173 223a 2022  servoirareas": "
-000004b0: 6e6f 6d69 6e61 6c22 2c0a 2020 2020 2277  nominal",.    "w
-000004c0: 666c 6f77 5f72 6573 6572 766f 6972 6c6f  flow_reservoirlo
-000004d0: 6373 223a 2022 6e6f 6d69 6e61 6c22 2c0a  cs": "nominal",.
-000004e0: 2020 2020 2277 666c 6f77 5f6c 616b 6561      "wflow_lakea
-000004f0: 7265 6173 223a 2022 6e6f 6d69 6e61 6c22  reas": "nominal"
-00000500: 2c0a 2020 2020 2277 666c 6f77 5f6c 616b  ,.    "wflow_lak
-00000510: 656c 6f63 7322 3a20 226e 6f6d 696e 616c  elocs": "nominal
-00000520: 222c 0a20 2020 2022 7766 6c6f 775f 676c  ",.    "wflow_gl
-00000530: 6163 6965 7261 7265 6173 223a 2022 6e6f  acierareas": "no
-00000540: 6d69 6e61 6c22 2c0a 7d0a 0a0a 636c 6173  minal",.}...clas
-00000550: 7320 5766 6c6f 774d 6f64 656c 284d 6f64  s WflowModel(Mod
-00000560: 656c 293a 0a20 2020 2022 2222 5468 6973  el):.    """This
-00000570: 2069 7320 7468 6520 7766 6c6f 7720 6d6f   is the wflow mo
-00000580: 6465 6c20 636c 6173 7322 2222 0a0a 2020  del class"""..  
-00000590: 2020 5f4e 414d 4520 3d20 2277 666c 6f77    _NAME = "wflow
-000005a0: 220a 2020 2020 5f43 4f4e 4620 3d20 2277  ".    _CONF = "w
-000005b0: 666c 6f77 5f73 626d 2e74 6f6d 6c22 0a20  flow_sbm.toml". 
-000005c0: 2020 205f 4441 5441 4449 5220 3d20 4441     _DATADIR = DA
-000005d0: 5441 4449 520a 2020 2020 5f47 454f 4d53  TADIR.    _GEOMS
-000005e0: 203d 207b 7d0a 2020 2020 5f4d 4150 5320   = {}.    _MAPS 
-000005f0: 3d20 7b0a 2020 2020 2020 2020 2266 6c77  = {.        "flw
-00000600: 6469 7222 3a20 2277 666c 6f77 5f6c 6464  dir": "wflow_ldd
-00000610: 222c 0a20 2020 2020 2020 2022 656c 6576  ",.        "elev
-00000620: 746e 223a 2022 7766 6c6f 775f 6465 6d22  tn": "wflow_dem"
-00000630: 2c0a 2020 2020 2020 2020 2273 7562 656c  ,.        "subel
-00000640: 7622 3a20 2264 656d 5f73 7562 6772 6964  v": "dem_subgrid
-00000650: 222c 0a20 2020 2020 2020 2022 7570 6172  ",.        "upar
-00000660: 6561 223a 2022 7766 6c6f 775f 7570 6172  ea": "wflow_upar
-00000670: 6561 222c 0a20 2020 2020 2020 2022 7374  ea",.        "st
-00000680: 726f 7264 223a 2022 7766 6c6f 775f 7374  rord": "wflow_st
-00000690: 7265 616d 6f72 6465 7222 2c0a 2020 2020  reamorder",.    
-000006a0: 2020 2020 2262 6173 696e 7322 3a20 2277      "basins": "w
-000006b0: 666c 6f77 5f73 7562 6361 7463 6822 2c0a  flow_subcatch",.
-000006c0: 2020 2020 2020 2020 2272 6976 6c65 6e22          "rivlen"
-000006d0: 3a20 2277 666c 6f77 5f72 6976 6572 6c65  : "wflow_riverle
-000006e0: 6e67 7468 222c 0a20 2020 2020 2020 2022  ngth",.        "
-000006f0: 7269 766d 736b 223a 2022 7766 6c6f 775f  rivmsk": "wflow_
-00000700: 7269 7665 7222 2c0a 2020 2020 2020 2020  river",.        
-00000710: 2272 6976 7774 6822 3a20 2277 666c 6f77  "rivwth": "wflow
-00000720: 5f72 6976 6572 7769 6474 6822 2c0a 2020  _riverwidth",.  
-00000730: 2020 2020 2020 226c 6e64 736c 7022 3a20        "lndslp": 
-00000740: 2253 6c6f 7065 222c 0a20 2020 2020 2020  "Slope",.       
-00000750: 2022 7269 7673 6c70 223a 2022 5269 7665   "rivslp": "Rive
-00000760: 7253 6c6f 7065 222c 0a20 2020 2020 2020  rSlope",.       
-00000770: 2022 7269 7664 7068 223a 2022 5269 7665   "rivdph": "Rive
-00000780: 7244 6570 7468 222c 0a20 2020 2020 2020  rDepth",.       
-00000790: 2022 7269 766d 616e 223a 2022 4e5f 5269   "rivman": "N_Ri
-000007a0: 7665 7222 2c0a 2020 2020 2020 2020 2267  ver",.        "g
-000007b0: 6175 6765 7322 3a20 2277 666c 6f77 5f67  auges": "wflow_g
-000007c0: 6175 6765 7322 2c0a 2020 2020 2020 2020  auges",.        
-000007d0: 226c 616e 6475 7365 223a 2022 7766 6c6f  "landuse": "wflo
-000007e0: 775f 6c61 6e64 7573 6522 2c0a 2020 2020  w_landuse",.    
-000007f0: 2020 2020 2272 6573 6172 6561 7322 3a20      "resareas": 
-00000800: 2277 666c 6f77 5f72 6573 6572 766f 6972  "wflow_reservoir
-00000810: 6172 6561 7322 2c0a 2020 2020 2020 2020  areas",.        
-00000820: 2272 6573 6c6f 6373 223a 2022 7766 6c6f  "reslocs": "wflo
-00000830: 775f 7265 7365 7276 6f69 726c 6f63 7322  w_reservoirlocs"
-00000840: 2c0a 2020 2020 2020 2020 226c 616b 6561  ,.        "lakea
-00000850: 7265 6173 223a 2022 7766 6c6f 775f 6c61  reas": "wflow_la
-00000860: 6b65 6172 6561 7322 2c0a 2020 2020 2020  keareas",.      
-00000870: 2020 226c 616b 656c 6f63 7322 3a20 2277    "lakelocs": "w
-00000880: 666c 6f77 5f6c 616b 656c 6f63 7322 2c0a  flow_lakelocs",.
-00000890: 2020 2020 2020 2020 2267 6c61 6361 7265          "glacare
-000008a0: 6173 223a 2022 7766 6c6f 775f 676c 6163  as": "wflow_glac
-000008b0: 6965 7261 7265 6173 222c 0a20 2020 2020  ierareas",.     
-000008c0: 2020 2022 676c 6163 6672 6163 7322 3a20     "glacfracs": 
-000008d0: 2277 666c 6f77 5f67 6c61 6369 6572 6672  "wflow_glacierfr
-000008e0: 6163 222c 0a20 2020 2020 2020 2022 676c  ac",.        "gl
-000008f0: 6163 7374 6f72 6522 3a20 2277 666c 6f77  acstore": "wflow
-00000900: 5f67 6c61 6369 6572 7374 6f72 6522 2c0a  _glacierstore",.
-00000910: 2020 2020 7d0a 2020 2020 5f46 4f4c 4445      }.    _FOLDE
-00000920: 5253 203d 205b 0a20 2020 2020 2020 2022  RS = [.        "
-00000930: 7374 6174 6963 6765 6f6d 7322 2c0a 2020  staticgeoms",.  
-00000940: 2020 2020 2020 2269 6e73 7461 7465 222c        "instate",
-00000950: 0a20 2020 2020 2020 2022 7275 6e5f 6465  .        "run_de
-00000960: 6661 756c 7422 2c0a 2020 2020 5d0a 0a20  fault",.    ].. 
-00000970: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00000980: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00000990: 2020 2020 2020 2072 6f6f 743d 4e6f 6e65         root=None
-000009a0: 2c0a 2020 2020 2020 2020 6d6f 6465 3d22  ,.        mode="
-000009b0: 7722 2c0a 2020 2020 2020 2020 636f 6e66  w",.        conf
-000009c0: 6967 5f66 6e3d 4e6f 6e65 2c0a 2020 2020  ig_fn=None,.    
-000009d0: 2020 2020 6461 7461 5f6c 6962 733d 4e6f      data_libs=No
-000009e0: 6e65 2c0a 2020 2020 2020 2020 6465 6c74  ne,.        delt
-000009f0: 6172 6573 5f64 6174 613d 4661 6c73 652c  ares_data=False,
-00000a00: 0a20 2020 2020 2020 206c 6f67 6765 723d  .        logger=
-00000a10: 6c6f 6767 6572 2c0a 2020 2020 293a 0a20  logger,.    ):. 
-00000a20: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00000a30: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
-00000a40: 2020 2020 2072 6f6f 743d 726f 6f74 2c0a       root=root,.
-00000a50: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00000a60: 3d6d 6f64 652c 0a20 2020 2020 2020 2020  =mode,.         
-00000a70: 2020 2063 6f6e 6669 675f 666e 3d63 6f6e     config_fn=con
-00000a80: 6669 675f 666e 2c0a 2020 2020 2020 2020  fig_fn,.        
-00000a90: 2020 2020 6461 7461 5f6c 6962 733d 6461      data_libs=da
-00000aa0: 7461 5f6c 6962 732c 0a20 2020 2020 2020  ta_libs,.       
-00000ab0: 2020 2020 2064 656c 7461 7265 735f 6461       deltares_da
-00000ac0: 7461 3d64 656c 7461 7265 735f 6461 7461  ta=deltares_data
-00000ad0: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
-00000ae0: 6767 6572 3d6c 6f67 6765 722c 0a20 2020  gger=logger,.   
-00000af0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00000b00: 2320 7766 6c6f 7720 7370 6563 6966 6963  # wflow specific
-00000b10: 0a20 2020 2020 2020 2073 656c 662e 5f69  .        self._i
-00000b20: 6e74 626c 203d 2064 6963 7428 290a 2020  ntbl = dict().  
-00000b30: 2020 2020 2020 7365 6c66 2e5f 666c 7764        self._flwd
-00000b40: 6972 203d 204e 6f6e 650a 0a20 2020 2023  ir = None..    #
-00000b50: 2043 4f4d 504f 4e45 4e54 530a 2020 2020   COMPONENTS.    
-00000b60: 6465 6620 7365 7475 705f 6261 7365 6d61  def setup_basema
-00000b70: 7073 280a 2020 2020 2020 2020 7365 6c66  ps(.        self
-00000b80: 2c0a 2020 2020 2020 2020 7265 6769 6f6e  ,.        region
-00000b90: 2c0a 2020 2020 2020 2020 7265 733d 3120  ,.        res=1 
-00000ba0: 2f20 3132 302e 302c 0a20 2020 2020 2020  / 120.0,.       
-00000bb0: 2068 7964 726f 6772 6170 6879 5f66 6e3d   hydrography_fn=
-00000bc0: 226d 6572 6974 5f68 7964 726f 222c 0a20  "merit_hydro",. 
-00000bd0: 2020 2020 2020 2062 6173 696e 5f69 6e64         basin_ind
-00000be0: 6578 5f66 6e3d 226d 6572 6974 5f68 7964  ex_fn="merit_hyd
-00000bf0: 726f 5f69 6e64 6578 222c 0a20 2020 2020  ro_index",.     
-00000c00: 2020 2075 7073 6361 6c65 5f6d 6574 686f     upscale_metho
-00000c10: 643d 2269 6875 222c 0a20 2020 2029 3a0a  d="ihu",.    ):.
-00000c20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00000c30: 2020 2020 5468 6973 2063 6f6d 706f 6e65      This compone
-00000c40: 6e74 2073 6574 7320 7468 6520 6060 7265  nt sets the ``re
-00000c50: 6769 6f6e 6060 206f 6620 696e 7465 7265  gion`` of intere
-00000c60: 7374 2061 6e64 2060 6072 6573 6060 2028  st and ``res`` (
-00000c70: 7265 736f 6c75 7469 6f6e 2069 6e20 6465  resolution in de
-00000c80: 6772 6565 7329 206f 6620 7468 650a 2020  grees) of the.  
-00000c90: 2020 2020 2020 6d6f 6465 6c2e 2041 6c6c        model. All
-00000ca0: 2044 454d 2061 6e64 2066 6c6f 7720 6469   DEM and flow di
-00000cb0: 7265 6374 696f 6e20 7265 6c61 7465 6420  rection related 
-00000cc0: 6d61 7073 2061 7265 2074 6865 6e20 6275  maps are then bu
-00000cd0: 696c 642e 0a0a 2020 2020 2020 2020 4966  ild...        If
-00000ce0: 2074 6865 206d 6f64 656c 2072 6573 6f6c   the model resol
-00000cf0: 7574 696f 6e20 6973 206c 6172 6765 7220  ution is larger 
-00000d00: 7468 616e 2074 6865 2073 6f75 7263 6520  than the source 
-00000d10: 6461 7461 2072 6573 6f6c 7574 696f 6e2c  data resolution,
-00000d20: 0a20 2020 2020 2020 2074 6865 2066 6c6f  .        the flo
-00000d30: 7720 6469 7265 6374 696f 6e20 6973 2075  w direction is u
-00000d40: 7073 6361 6c65 6420 7573 696e 6720 7468  pscaled using th
-00000d50: 6520 6060 7570 7363 616c 655f 6d65 7468  e ``upscale_meth
-00000d60: 6f64 6060 2c20 6279 2064 6566 6175 6c74  od``, by default
-00000d70: 2074 6865 0a20 2020 2020 2020 2049 7465   the.        Ite
-00000d80: 7261 7469 7665 2048 7964 726f 6772 6170  rative Hydrograp
-00000d90: 6879 2055 7073 6361 6c69 6e67 2028 4948  hy Upscaling (IH
-00000da0: 5529 2e0a 2020 2020 2020 2020 5468 6520  U)..        The 
-00000db0: 6465 6661 756c 7420 6060 6879 6472 6f67  default ``hydrog
-00000dc0: 7261 7068 795f 666e 6060 2069 7320 226d  raphy_fn`` is "m
-00000dd0: 6572 6974 5f68 7964 726f 2220 2860 4d45  erit_hydro" (`ME
-00000de0: 5249 5420 6879 6472 6f20 3c68 7474 703a  RIT hydro <http:
-00000df0: 2f2f 6879 6472 6f2e 6969 732e 752d 746f  //hydro.iis.u-to
-00000e00: 6b79 6f2e 6163 2e6a 702f 7e79 616d 6164  kyo.ac.jp/~yamad
-00000e10: 6169 2f4d 4552 4954 5f48 7964 726f 2f69  ai/MERIT_Hydro/i
-00000e20: 6e64 6578 2e68 746d 6c3e 605f 0a20 2020  ndex.html>`_.   
-00000e30: 2020 2020 2061 7420 3320 6172 6373 6563       at 3 arcsec
-00000e40: 2072 6573 6f6c 7574 696f 6e29 2041 6c74   resolution) Alt
-00000e50: 6572 6e61 7469 7665 2073 6f75 7263 6573  ernative sources
-00000e60: 2069 6e63 6c75 6465 2022 6d65 7269 745f   include "merit_
-00000e70: 6879 6472 6f5f 316b 2220 6174 2033 3020  hydro_1k" at 30 
-00000e80: 6172 6373 6563 2072 6573 6f6c 7574 696f  arcsec resolutio
-00000e90: 6e2e 0a20 2020 2020 2020 2055 7365 7273  n..        Users
-00000ea0: 2063 616e 2061 6c73 6f20 7375 7070 6c79   can also supply
-00000eb0: 2074 6865 6972 206f 776e 2065 6c65 7661   their own eleva
-00000ec0: 7469 6f6e 2061 6e64 2066 6c6f 7720 6469  tion and flow di
-00000ed0: 7265 6374 696f 6e20 6461 7461 2e20 4e6f  rection data. No
-00000ee0: 7465 2074 6861 7420 6f6e 6c79 2045 5053  te that only EPS
-00000ef0: 473a 3433 3236 2062 6173 6520 6461 7461  G:4326 base data
-00000f00: 2073 7570 706f 7274 6564 2e0a 0a20 2020   supported...   
-00000f10: 2020 2020 2041 6464 7320 6d6f 6465 6c20       Adds model 
-00000f20: 6c61 7965 7273 3a0a 0a20 2020 2020 2020  layers:..       
-00000f30: 202a 202a 2a77 666c 6f77 5f6c 6464 2a2a   * **wflow_ldd**
-00000f40: 206d 6170 3a20 666c 6f77 2064 6972 6563   map: flow direc
-00000f50: 7469 6f6e 2069 6e20 4c44 4420 666f 726d  tion in LDD form
-00000f60: 6174 205b 2d5d 0a20 2020 2020 2020 202a  at [-].        *
-00000f70: 202a 2a77 666c 6f77 5f73 7562 6361 7463   **wflow_subcatc
-00000f80: 682a 2a20 6d61 703a 2062 6173 696e 2049  h** map: basin I
-00000f90: 4420 6d61 7020 5b2d 5d0a 2020 2020 2020  D map [-].      
-00000fa0: 2020 2a20 2a2a 7766 6c6f 775f 7570 6172    * **wflow_upar
-00000fb0: 6561 2a2a 206d 6170 3a20 7570 7374 7265  ea** map: upstre
-00000fc0: 616d 2061 7265 6120 5b6b 6d32 5d0a 2020  am area [km2].  
-00000fd0: 2020 2020 2020 2a20 2a2a 7766 6c6f 775f        * **wflow_
-00000fe0: 7374 7265 616d 6f72 6465 722a 2a20 6d61  streamorder** ma
-00000ff0: 703a 2053 7472 6168 6c65 7220 7374 7265  p: Strahler stre
-00001000: 616d 206f 7264 6572 205b 2d5d 0a20 2020  am order [-].   
-00001010: 2020 2020 202a 202a 2a77 666c 6f77 5f64       * **wflow_d
-00001020: 656d 2a2a 206d 6170 3a20 6176 6572 6167  em** map: averag
-00001030: 6520 656c 6576 6174 696f 6e20 5b6d 2b52  e elevation [m+R
-00001040: 4546 5d0a 2020 2020 2020 2020 2a20 2a2a  EF].        * **
-00001050: 6465 6d5f 7375 6267 7269 642a 2a20 6d61  dem_subgrid** ma
-00001060: 703a 2073 7562 6772 6964 206f 7574 6c65  p: subgrid outle
-00001070: 7420 656c 6576 6174 696f 6e20 5b6d 2b52  t elevation [m+R
-00001080: 4546 5d0a 2020 2020 2020 2020 2a20 2a2a  EF].        * **
-00001090: 536c 6f70 652a 2a20 6d61 703a 2061 7665  Slope** map: ave
-000010a0: 7261 6765 206c 616e 6420 7375 7266 6163  rage land surfac
-000010b0: 6520 736c 6f70 6520 5b6d 2f6d 5d0a 2020  e slope [m/m].  
-000010c0: 2020 2020 2020 2a20 2a2a 6261 7369 6e73        * **basins
-000010d0: 2a2a 2067 656f 6d3a 2062 6173 696e 7320  ** geom: basins 
-000010e0: 626f 756e 6461 7279 2076 6563 746f 720a  boundary vector.
-000010f0: 2020 2020 2020 2020 2a20 2a2a 7265 6769          * **regi
-00001100: 6f6e 2a2a 2067 656f 6d3a 2072 6567 696f  on** geom: regio
-00001110: 6e20 626f 756e 6461 7279 2076 6563 746f  n boundary vecto
-00001120: 720a 0a20 2020 2020 2020 2050 6172 616d  r..        Param
-00001130: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00001140: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00001150: 2068 7964 726f 6772 6170 6879 5f66 6e20   hydrography_fn 
-00001160: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
-00001170: 2020 4e61 6d65 206f 6620 6461 7461 2073    Name of data s
-00001180: 6f75 7263 6520 666f 7220 6261 7365 6d61  ource for basema
-00001190: 7020 7061 7261 6d65 7465 7273 2e0a 0a20  p parameters... 
-000011a0: 2020 2020 2020 2020 2020 202a 2052 6571             * Req
-000011b0: 7569 7265 6420 7661 7269 6162 6c65 733a  uired variables:
-000011c0: 205b 2766 6c77 6469 7227 2c20 2775 7061   ['flwdir', 'upa
-000011d0: 7265 6127 2c20 2762 6173 696e 7327 2c20  rea', 'basins', 
-000011e0: 2773 7472 6f72 6427 2c20 2765 6c65 7674  'strord', 'elevt
-000011f0: 6e27 5d0a 0a20 2020 2020 2020 2020 2020  n']..           
-00001200: 202a 204f 7074 696f 6e61 6c20 7661 7269   * Optional vari
-00001210: 6162 6c65 733a 205b 276c 6e64 736c 7027  ables: ['lndslp'
-00001220: 2c20 276d 6173 6b27 5d0a 2020 2020 2020  , 'mask'].      
-00001230: 2020 6261 7369 6e5f 696e 6465 785f 666e    basin_index_fn
-00001240: 203a 2073 7472 0a20 2020 2020 2020 2020   : str.         
-00001250: 2020 204e 616d 6520 6f66 2064 6174 6120     Name of data 
-00001260: 736f 7572 6365 2066 6f72 2062 6173 696e  source for basin
-00001270: 5f69 6e64 6578 2064 6174 6120 6c69 6e6b  _index data link
-00001280: 6564 2074 6f20 6879 6472 6f67 7261 7068  ed to hydrograph
-00001290: 795f 666e 2e0a 2020 2020 2020 2020 7265  y_fn..        re
-000012a0: 6769 6f6e 203a 2064 6963 740a 2020 2020  gion : dict.    
-000012b0: 2020 2020 2020 2020 4469 6374 696f 6e61          Dictiona
-000012c0: 7279 2064 6573 6372 6962 696e 6720 7265  ry describing re
-000012d0: 6769 6f6e 206f 6620 696e 7465 7265 7374  gion of interest
-000012e0: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
-000012f0: 6520 3a70 793a 6675 6e63 7469 6f6e 3a7e  e :py:function:~
-00001300: 6261 7369 6e5f 6d61 736b 2e70 6172 7365  basin_mask.parse
-00001310: 5f72 6567 696f 6e20 666f 7220 616c 6c20  _region for all 
-00001320: 6f70 7469 6f6e 730a 2020 2020 2020 2020  options.        
-00001330: 7265 7320 3a20 666c 6f61 740a 2020 2020  res : float.    
-00001340: 2020 2020 2020 2020 4f75 7470 7574 206d          Output m
-00001350: 6f64 656c 2072 6573 6f6c 7574 696f 6e0a  odel resolution.
-00001360: 2020 2020 2020 2020 7570 7363 616c 655f          upscale_
-00001370: 6d65 7468 6f64 203a 207b 2769 6875 272c  method : {'ihu',
-00001380: 2027 6561 6d27 2c20 2764 6d6d 277d 0a20   'eam', 'dmm'}. 
-00001390: 2020 2020 2020 2020 2020 2055 7073 6361             Upsca
-000013a0: 6c69 6e67 206d 6574 686f 6420 666f 7220  ling method for 
-000013b0: 666c 6f77 2064 6972 6563 7469 6f6e 2064  flow direction d
-000013c0: 6174 612c 2062 7920 6465 6661 756c 7420  ata, by default 
-000013d0: 2769 6875 272e 0a0a 2020 2020 2020 2020  'ihu'...        
-000013e0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-000013f0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00001400: 2020 6879 6472 6f6d 742e 776f 726b 666c    hydromt.workfl
-00001410: 6f77 732e 7061 7273 655f 7265 6769 6f6e  ows.parse_region
-00001420: 0a20 2020 2020 2020 2068 7964 726f 6d74  .        hydromt
-00001430: 2e77 6f72 6b66 6c6f 7773 2e67 6574 5f62  .workflows.get_b
-00001440: 6173 696e 5f67 656f 6d65 7472 790a 2020  asin_geometry.  
-00001450: 2020 2020 2020 776f 726b 666c 6f77 732e        workflows.
-00001460: 6879 6472 6f67 7261 7068 790a 2020 2020  hydrography.    
-00001470: 2020 2020 776f 726b 666c 6f77 732e 746f      workflows.to
-00001480: 706f 6772 6170 6879 0a20 2020 2020 2020  pography.       
-00001490: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-000014a0: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
-000014b0: 5072 6570 6172 696e 6720 6261 7365 2068  Preparing base h
-000014c0: 7964 726f 6772 6170 6879 2062 6173 656d  ydrography basem
-000014d0: 6170 732e 2229 0a20 2020 2020 2020 2023  aps.").        #
-000014e0: 2072 6574 7269 6576 6520 676c 6f62 616c   retrieve global
-000014f0: 2064 6174 6120 286c 617a 7921 290a 2020   data (lazy!).  
-00001500: 2020 2020 2020 6473 5f6f 7267 203d 2073        ds_org = s
-00001510: 656c 662e 6461 7461 5f63 6174 616c 6f67  elf.data_catalog
-00001520: 2e67 6574 5f72 6173 7465 7264 6174 6173  .get_rasterdatas
-00001530: 6574 2868 7964 726f 6772 6170 6879 5f66  et(hydrography_f
-00001540: 6e29 0a20 2020 2020 2020 2023 2054 4f44  n).        # TOD
-00001550: 4f20 7375 7070 6f72 7420 616e 6420 7465  O support and te
-00001560: 7374 2028 7573 6572 2920 6461 7461 2066  st (user) data f
-00001570: 726f 6d20 6f74 6865 7220 736f 7572 6365  rom other source
-00001580: 7320 7769 7468 206f 7468 6572 2063 7273  s with other crs
-00001590: 210a 2020 2020 2020 2020 6966 2064 735f  !.        if ds_
-000015a0: 6f72 672e 7261 7374 6572 2e63 7273 2069  org.raster.crs i
-000015b0: 7320 4e6f 6e65 206f 7220 6473 5f6f 7267  s None or ds_org
-000015c0: 2e72 6173 7465 722e 6372 732e 746f 5f65  .raster.crs.to_e
-000015d0: 7073 6728 2920 213d 2034 3332 363a 0a20  psg() != 4326:. 
-000015e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000015f0: 2056 616c 7565 4572 726f 7228 224f 6e6c   ValueError("Onl
-00001600: 7920 4550 5347 3a34 3332 3620 6261 7365  y EPSG:4326 base
-00001610: 2064 6174 6120 7375 7070 6f72 7465 642e   data supported.
-00001620: 2229 0a20 2020 2020 2020 2023 2067 6574  ").        # get
-00001630: 2062 6173 696e 2067 656f 6d65 7472 7920   basin geometry 
-00001640: 616e 6420 636c 6970 2064 6174 610a 2020  and clip data.  
-00001650: 2020 2020 2020 6b69 6e64 2c20 7265 6769        kind, regi
-00001660: 6f6e 203d 2068 7964 726f 6d74 2e77 6f72  on = hydromt.wor
-00001670: 6b66 6c6f 7773 2e70 6172 7365 5f72 6567  kflows.parse_reg
-00001680: 696f 6e28 7265 6769 6f6e 2c20 6c6f 6767  ion(region, logg
-00001690: 6572 3d73 656c 662e 6c6f 6767 6572 290a  er=self.logger).
-000016a0: 2020 2020 2020 2020 7879 203d 204e 6f6e          xy = Non
-000016b0: 650a 2020 2020 2020 2020 6966 206b 696e  e.        if kin
-000016c0: 6420 696e 205b 2262 6173 696e 222c 2022  d in ["basin", "
-000016d0: 7375 6262 6173 696e 222c 2022 6f75 746c  subbasin", "outl
-000016e0: 6574 225d 3a0a 2020 2020 2020 2020 2020  et"]:.          
-000016f0: 2020 6261 735f 696e 6465 7820 3d20 7365    bas_index = se
-00001700: 6c66 2e64 6174 615f 6361 7461 6c6f 675b  lf.data_catalog[
-00001710: 6261 7369 6e5f 696e 6465 785f 666e 5d0a  basin_index_fn].
-00001720: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-00001730: 2c20 7879 203d 2068 7964 726f 6d74 2e77  , xy = hydromt.w
-00001740: 6f72 6b66 6c6f 7773 2e67 6574 5f62 6173  orkflows.get_bas
-00001750: 696e 5f67 656f 6d65 7472 7928 0a20 2020  in_geometry(.   
-00001760: 2020 2020 2020 2020 2020 2020 2064 733d               ds=
-00001770: 6473 5f6f 7267 2c0a 2020 2020 2020 2020  ds_org,.        
-00001780: 2020 2020 2020 2020 6b69 6e64 3d6b 696e          kind=kin
-00001790: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000017a0: 2020 2062 6173 696e 5f69 6e64 6578 3d62     basin_index=b
-000017b0: 6173 5f69 6e64 6578 2c0a 2020 2020 2020  as_index,.      
-000017c0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-000017d0: 3d73 656c 662e 6c6f 6767 6572 2c0a 2020  =self.logger,.  
-000017e0: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-000017f0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
-00001800: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-00001810: 6966 2022 6262 6f78 2220 696e 2072 6567  if "bbox" in reg
-00001820: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00001830: 2062 626f 7820 3d20 7265 6769 6f6e 2e67   bbox = region.g
-00001840: 6574 2822 6262 6f78 2229 0a20 2020 2020  et("bbox").     
-00001850: 2020 2020 2020 2067 656f 6d20 3d20 6770         geom = gp
-00001860: 642e 4765 6f44 6174 6146 7261 6d65 2867  d.GeoDataFrame(g
-00001870: 656f 6d65 7472 793d 5b62 6f78 282a 6262  eometry=[box(*bb
-00001880: 6f78 295d 2c20 6372 733d 3433 3236 290a  ox)], crs=4326).
-00001890: 2020 2020 2020 2020 656c 6966 2022 6765          elif "ge
-000018a0: 6f6d 2220 696e 2072 6567 696f 6e3a 0a20  om" in region:. 
-000018b0: 2020 2020 2020 2020 2020 2067 656f 6d20             geom 
-000018c0: 3d20 7265 6769 6f6e 2e67 6574 2822 6765  = region.get("ge
-000018d0: 6f6d 2229 0a20 2020 2020 2020 2065 6c73  om").        els
-000018e0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000018f0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00001900: 6622 7766 6c6f 7720 7265 6769 6f6e 2061  f"wflow region a
-00001910: 7267 756d 656e 7420 6e6f 7420 756e 6465  rgument not unde
-00001920: 7273 746f 6f64 3a20 7b72 6567 696f 6e7d  rstood: {region}
-00001930: 2229 0a20 2020 2020 2020 2069 6620 6765  ").        if ge
-00001940: 6f6d 2069 7320 6e6f 7420 4e6f 6e65 2061  om is not None a
-00001950: 6e64 2067 656f 6d2e 6372 7320 6973 204e  nd geom.crs is N
-00001960: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00001970: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00001980: 7228 2277 666c 6f77 2072 6567 696f 6e20  r("wflow region 
-00001990: 6765 6f6d 6574 7279 2068 6173 206e 6f20  geometry has no 
-000019a0: 4352 5322 290a 2020 2020 2020 2020 6473  CRS").        ds
-000019b0: 5f6f 7267 203d 2064 735f 6f72 672e 7261  _org = ds_org.ra
-000019c0: 7374 6572 2e63 6c69 705f 6765 6f6d 2867  ster.clip_geom(g
-000019d0: 656f 6d2c 2061 6c69 676e 3d72 6573 2c20  eom, align=res, 
-000019e0: 6275 6666 6572 3d31 3029 0a20 2020 2020  buffer=10).     
-000019f0: 2020 2073 656c 662e 6c6f 6767 6572 2e64     self.logger.d
-00001a00: 6562 7567 2866 2241 6464 696e 6720 6261  ebug(f"Adding ba
-00001a10: 7369 6e73 2076 6563 746f 7220 746f 2073  sins vector to s
-00001a20: 7461 7469 6367 656f 6d73 2e22 290a 2020  taticgeoms.").  
-00001a30: 2020 2020 2020 7365 6c66 2e73 6574 5f73        self.set_s
-00001a40: 7461 7469 6367 656f 6d73 2867 656f 6d2c  taticgeoms(geom,
-00001a50: 206e 616d 653d 2262 6173 696e 7322 290a   name="basins").
-00001a60: 0a20 2020 2020 2020 2023 2073 6574 7570  .        # setup
-00001a70: 2068 7964 726f 6772 6170 6879 206d 6170   hydrography map
-00001a80: 7320 616e 6420 7365 7420 7374 6174 6963  s and set static
-00001a90: 6d61 7020 6174 7472 6962 7574 6520 7769  map attribute wi
-00001aa0: 7468 2072 656e 616d 6564 206d 6170 730a  th renamed maps.
-00001ab0: 2020 2020 2020 2020 6473 5f62 6173 652c          ds_base,
-00001ac0: 205f 203d 2077 6f72 6b66 6c6f 7773 2e68   _ = workflows.h
-00001ad0: 7964 726f 6772 6170 6879 280a 2020 2020  ydrography(.    
-00001ae0: 2020 2020 2020 2020 6473 3d64 735f 6f72          ds=ds_or
-00001af0: 672c 0a20 2020 2020 2020 2020 2020 2072  g,.            r
-00001b00: 6573 3d72 6573 2c0a 2020 2020 2020 2020  es=res,.        
-00001b10: 2020 2020 7879 3d78 792c 0a20 2020 2020      xy=xy,.     
-00001b20: 2020 2020 2020 2075 7073 6361 6c65 5f6d         upscale_m
-00001b30: 6574 686f 643d 7570 7363 616c 655f 6d65  ethod=upscale_me
-00001b40: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-00001b50: 2020 6c6f 6767 6572 3d73 656c 662e 6c6f    logger=self.lo
-00001b60: 6767 6572 2c0a 2020 2020 2020 2020 290a  gger,.        ).
-00001b70: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
-00001b80: 7420 666c 6f77 2064 6972 6563 7469 6f6e  t flow direction
-00001b90: 2066 726f 6d20 6438 2074 6f20 6c64 6420   from d8 to ldd 
-00001ba0: 666f 726d 6174 0a20 2020 2020 2020 2066  format.        f
-00001bb0: 6c77 6469 725f 6461 7461 203d 2064 735f  lwdir_data = ds_
-00001bc0: 6261 7365 5b22 666c 7764 6972 225d 2e76  base["flwdir"].v
-00001bd0: 616c 7565 732e 6173 7479 7065 286e 702e  alues.astype(np.
-00001be0: 7569 6e74 3829 2020 2320 666f 7263 6520  uint8)  # force 
-00001bf0: 6474 7970 650a 2020 2020 2020 2020 2320  dtype.        # 
-00001c00: 6966 2064 3820 636f 6e76 6572 7420 746f  if d8 convert to
-00001c10: 206c 6464 0a20 2020 2020 2020 2069 6620   ldd.        if 
-00001c20: 636f 7265 5f64 382e 6973 7661 6c69 6428  core_d8.isvalid(
-00001c30: 666c 7764 6972 5f64 6174 6129 3a0a 2020  flwdir_data):.  
-00001c40: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-00001c50: 2063 6f72 655f 636f 6e76 6572 7369 6f6e   core_conversion
-00001c60: 2e64 385f 746f 5f6c 6464 2866 6c77 6469  .d8_to_ldd(flwdi
-00001c70: 725f 6461 7461 290a 2020 2020 2020 2020  r_data).        
-00001c80: 2020 2020 6461 5f66 6c77 6469 7220 3d20      da_flwdir = 
-00001c90: 7872 2e44 6174 6141 7272 6179 280a 2020  xr.DataArray(.  
-00001ca0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00001cb0: 6d65 3d22 666c 7764 6972 222c 0a20 2020  me="flwdir",.   
-00001cc0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00001cd0: 613d 6461 7461 2c0a 2020 2020 2020 2020  a=data,.        
-00001ce0: 2020 2020 2020 2020 636f 6f72 6473 3d64          coords=d
-00001cf0: 735f 6261 7365 2e72 6173 7465 722e 636f  s_base.raster.co
-00001d00: 6f72 6473 2c0a 2020 2020 2020 2020 2020  ords,.          
-00001d10: 2020 2020 2020 6469 6d73 3d64 735f 6261        dims=ds_ba
-00001d20: 7365 2e72 6173 7465 722e 6469 6d73 2c0a  se.raster.dims,.
-00001d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d40: 6174 7472 733d 6469 6374 280a 2020 2020  attrs=dict(.    
-00001d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d60: 6c6f 6e67 5f6e 616d 653d 226c 6464 2066  long_name="ldd f
-00001d70: 6c6f 7720 6469 7265 6374 696f 6e22 2c0a  low direction",.
-00001d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d90: 2020 2020 5f46 696c 6c56 616c 7565 3d63      _FillValue=c
-00001da0: 6f72 655f 6c64 642e 5f6d 762c 0a20 2020  ore_ldd._mv,.   
-00001db0: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-00001dc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00001dd0: 2020 2020 2020 2020 2020 6473 5f62 6173            ds_bas
-00001de0: 655b 2266 6c77 6469 7222 5d20 3d20 6461  e["flwdir"] = da
-00001df0: 5f66 6c77 6469 720a 2020 2020 2020 2020  _flwdir.        
-00001e00: 2320 5265 6e61 6d65 2061 6e64 2061 6464  # Rename and add
-00001e10: 2074 6f20 7374 6174 6963 6d61 7073 0a20   to staticmaps. 
-00001e20: 2020 2020 2020 2072 6d64 6963 7420 3d20         rmdict = 
-00001e30: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
-00001e40: 6e20 7365 6c66 2e5f 4d41 5053 2e69 7465  n self._MAPS.ite
-00001e50: 6d73 2829 2069 6620 6b20 696e 2064 735f  ms() if k in ds_
-00001e60: 6261 7365 2e64 6174 615f 7661 7273 7d0a  base.data_vars}.
-00001e70: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00001e80: 5f73 7461 7469 636d 6170 7328 6473 5f62  _staticmaps(ds_b
-00001e90: 6173 652e 7265 6e61 6d65 2872 6d64 6963  ase.rename(rmdic
-00001ea0: 7429 290a 0a20 2020 2020 2020 2023 2073  t))..        # s
-00001eb0: 6574 7570 2074 6f70 6f67 7261 7068 7920  etup topography 
-00001ec0: 6d61 7073 0a20 2020 2020 2020 2064 735f  maps.        ds_
-00001ed0: 746f 706f 203d 2077 6f72 6b66 6c6f 7773  topo = workflows
-00001ee0: 2e74 6f70 6f67 7261 7068 7928 0a20 2020  .topography(.   
-00001ef0: 2020 2020 2020 2020 2064 733d 6473 5f6f           ds=ds_o
-00001f00: 7267 2c20 6473 5f6c 696b 653d 7365 6c66  rg, ds_like=self
-00001f10: 2e73 7461 7469 636d 6170 732c 206d 6574  .staticmaps, met
-00001f20: 686f 643d 2261 7665 7261 6765 222c 206c  hod="average", l
-00001f30: 6f67 6765 723d 7365 6c66 2e6c 6f67 6765  ogger=self.logge
-00001f40: 720a 2020 2020 2020 2020 290a 2020 2020  r.        ).    
-00001f50: 2020 2020 6473 5f74 6f70 6f5b 226c 6e64      ds_topo["lnd
-00001f60: 736c 7022 5d20 3d20 6e70 2e6d 6178 696d  slp"] = np.maxim
-00001f70: 756d 2864 735f 746f 706f 5b22 6c6e 6473  um(ds_topo["lnds
-00001f80: 6c70 225d 2c20 302e 3029 0a20 2020 2020  lp"], 0.0).     
-00001f90: 2020 2072 6d64 6963 7420 3d20 7b6b 3a20     rmdict = {k: 
-00001fa0: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
-00001fb0: 6c66 2e5f 4d41 5053 2e69 7465 6d73 2829  lf._MAPS.items()
-00001fc0: 2069 6620 6b20 696e 2064 735f 746f 706f   if k in ds_topo
-00001fd0: 2e64 6174 615f 7661 7273 7d0a 2020 2020  .data_vars}.    
-00001fe0: 2020 2020 7365 6c66 2e73 6574 5f73 7461      self.set_sta
-00001ff0: 7469 636d 6170 7328 6473 5f74 6f70 6f2e  ticmaps(ds_topo.
-00002000: 7265 6e61 6d65 2872 6d64 6963 7429 290a  rename(rmdict)).
-00002010: 2020 2020 2020 2020 2320 7365 7420 6261          # set ba
-00002020: 7369 6e20 6765 6f6d 6574 7279 0a20 2020  sin geometry.   
-00002030: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00002040: 2e64 6562 7567 2866 2241 6464 696e 6720  .debug(f"Adding 
-00002050: 7265 6769 6f6e 2076 6563 746f 7220 746f  region vector to
-00002060: 2073 7461 7469 6367 656f 6d73 2e22 290a   staticgeoms.").
-00002070: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00002080: 5f73 7461 7469 6367 656f 6d73 2873 656c  _staticgeoms(sel
-00002090: 662e 7265 6769 6f6e 2c20 6e61 6d65 3d22  f.region, name="
-000020a0: 7265 6769 6f6e 2229 0a0a 2020 2020 6465  region")..    de
-000020b0: 6620 7365 7475 705f 7269 7665 7273 280a  f setup_rivers(.
-000020c0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000020d0: 2020 2020 2020 6879 6472 6f67 7261 7068        hydrograph
-000020e0: 795f 666e 2c0a 2020 2020 2020 2020 7269  y_fn,.        ri
-000020f0: 7665 725f 6765 6f6d 5f66 6e3d 4e6f 6e65  ver_geom_fn=None
-00002100: 2c0a 2020 2020 2020 2020 7269 7665 725f  ,.        river_
-00002110: 7570 613d 3330 2c0a 2020 2020 2020 2020  upa=30,.        
-00002120: 7269 7664 7068 5f6d 6574 686f 643d 2270  rivdph_method="p
-00002130: 6f77 6c61 7722 2c0a 2020 2020 2020 2020  owlaw",.        
-00002140: 736c 6f70 655f 6c65 6e3d 3265 332c 0a20  slope_len=2e3,. 
-00002150: 2020 2020 2020 206d 696e 5f72 6976 6c65         min_rivle
-00002160: 6e5f 7261 7469 6f3d 302e 302c 0a20 2020  n_ratio=0.0,.   
-00002170: 2020 2020 206d 696e 5f72 6976 6470 683d       min_rivdph=
-00002180: 312c 0a20 2020 2020 2020 206d 696e 5f72  1,.        min_r
-00002190: 6976 7774 683d 3330 2c0a 2020 2020 2020  ivwth=30,.      
-000021a0: 2020 736d 6f6f 7468 5f6c 656e 3d35 6533    smooth_len=5e3
-000021b0: 2c0a 2020 2020 2020 2020 7269 766d 616e  ,.        rivman
-000021c0: 5f6d 6170 7069 6e67 5f66 6e3d 6a6f 696e  _mapping_fn=join
-000021d0: 2844 4154 4144 4952 2c20 2277 666c 6f77  (DATADIR, "wflow
-000021e0: 222c 2022 4e5f 7269 7665 725f 6d61 7070  ", "N_river_mapp
-000021f0: 696e 672e 6373 7622 292c 0a20 2020 2020  ing.csv"),.     
-00002200: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-00002210: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
-00002220: 2020 2020 2020 2020 5468 6973 2063 6f6d          This com
-00002230: 706f 6e65 6e74 2073 6574 7320 7468 6520  ponent sets the 
-00002240: 616c 6c20 7269 7665 7220 7061 7261 6d65  all river parame
-00002250: 7465 7220 6d61 7073 2e0a 0a20 2020 2020  ter maps...     
-00002260: 2020 2054 6865 2072 6976 6572 206d 6173     The river mas
-00002270: 6b20 6973 2064 6566 696e 6564 2062 7920  k is defined by 
-00002280: 616c 6c20 6365 6c6c 7320 7769 7468 2061  all cells with a
-00002290: 206d 696d 696d 756d 2075 7073 7472 6561   mimimum upstrea
-000022a0: 6d20 6172 6561 2074 6872 6573 686f 6c64  m area threshold
-000022b0: 0a20 2020 2020 2020 2060 7269 7665 725f  .        `river_
-000022c0: 7570 6160 205b 6b6d 325d 2e0a 0a20 2020  upa` [km2]...   
-000022d0: 2020 2020 2054 6865 2072 6976 6572 206c       The river l
-000022e0: 656e 6774 6820 6973 2064 6566 696e 6564  ength is defined
-000022f0: 2061 7320 7468 6520 6469 7374 616e 6365   as the distance
-00002300: 2066 726f 6d20 7468 6520 7375 6267 7269   from the subgri
-00002310: 6420 6f75 746c 6574 2070 6978 656c 2074  d outlet pixel t
-00002320: 6f0a 2020 2020 2020 2020 7468 6520 6e65  o.        the ne
-00002330: 7874 2075 7073 7472 6561 6d20 7375 6267  xt upstream subg
-00002340: 7269 6420 6f75 746c 6574 2070 6978 656c  rid outlet pixel
-00002350: 2e20 5468 6520 606d 696e 5f72 6976 6c65  . The `min_rivle
-00002360: 6e5f 7261 7469 6f60 2069 7320 7468 6520  n_ratio` is the 
-00002370: 6d69 6e69 6d75 6d0a 2020 2020 2020 2020  minimum.        
-00002380: 676c 6f62 616c 2072 6976 6572 206c 656e  global river len
-00002390: 6774 6820 746f 2061 7667 2e20 6365 6c6c  gth to avg. cell
-000023a0: 2072 6573 6f6c 7574 696f 6e20 7261 7469   resolution rati
-000023b0: 6f20 616e 6420 6973 2075 7365 6420 6173  o and is used as
-000023c0: 2061 2074 6872 6573 686f 6c64 2069 6e0a   a threshold in.
-000023d0: 2020 2020 2020 2020 7769 6e64 6f77 2062          window b
-000023e0: 6173 6564 2073 6d6f 6f74 6869 6e67 206f  ased smoothing o
-000023f0: 6620 7269 7665 7220 6c65 6e67 7468 2e0a  f river length..
-00002400: 0a20 2020 2020 2020 2054 6865 2072 6976  .        The riv
-00002410: 6572 2073 6c6f 7065 2069 7320 6465 7269  er slope is deri
-00002420: 7665 6420 6672 6f6d 2074 6865 2073 7562  ved from the sub
-00002430: 6772 6964 2065 6c65 7661 7469 6f6e 2064  grid elevation d
-00002440: 6966 6665 7265 6e63 6520 6265 7477 6565  ifference betwee
-00002450: 6e20 7069 7865 6c73 2061 7420 610a 2020  n pixels at a.  
-00002460: 2020 2020 2020 6861 6c66 2064 6973 7461        half dista
-00002470: 6e63 6520 6073 6c6f 7065 5f6c 656e 6020  nce `slope_len` 
-00002480: 5b6d 5d20 7570 2d20 616e 6420 646f 776e  [m] up- and down
-00002490: 7374 7265 616d 2066 726f 6d20 7468 6520  stream from the 
-000024a0: 7375 6267 7269 6420 6f75 746c 6574 2070  subgrid outlet p
-000024b0: 6978 656c 2e0a 0a20 2020 2020 2020 2054  ixel...        T
-000024c0: 6865 2072 6976 6572 206d 616e 6e69 6e67  he river manning
-000024d0: 2072 6f75 6768 6e65 7373 2063 6f65 6666   roughness coeff
-000024e0: 6963 6965 6e74 2069 7320 6465 7269 7665  icient is derive
-000024f0: 6420 6261 7365 6420 6f6e 2072 6563 6c61  d based on recla
-00002500: 7373 6966 6963 6174 696f 6e0a 2020 2020  ssification.    
-00002510: 2020 2020 6f66 2074 6865 2073 7472 6561      of the strea
-00002520: 6d6f 7264 6572 206d 6170 2075 7369 6e67  morder map using
-00002530: 2061 206c 6f6f 6b75 7020 7461 626c 6520   a lookup table 
-00002540: 6072 6976 6d61 6e5f 6d61 7070 696e 675f  `rivman_mapping_
-00002550: 666e 602e 0a0a 2020 2020 2020 2020 5468  fn`...        Th
-00002560: 6520 7269 7665 7220 7769 6474 6820 6973  e river width is
-00002570: 2064 6572 6976 6564 2066 726f 6d20 7468   derived from th
-00002580: 6520 6e65 6172 6573 7420 7269 7665 7220  e nearest river 
-00002590: 7365 676d 656e 7420 696e 2060 7269 7665  segment in `rive
-000025a0: 725f 6765 6f6d 5f66 6e60 2e0a 2020 2020  r_geom_fn`..    
-000025b0: 2020 2020 4461 7461 2067 6170 7320 6172      Data gaps ar
-000025c0: 6520 6669 6c6c 6564 2062 7920 7468 6520  e filled by the 
-000025d0: 6e65 6172 6573 7420 7661 6c69 6420 7570  nearest valid up
-000025e0: 7374 7265 616d 2076 616c 7565 2061 6e64  stream value and
-000025f0: 2061 7665 7261 6765 6420 616c 6f6e 670a   averaged along.
-00002600: 2020 2020 2020 2020 7468 6520 666c 6f77          the flow
-00002610: 2064 6972 6563 7469 6f6e 7320 6f76 6572   directions over
-00002620: 2061 206c 656e 6774 6820 6073 6d6f 6f74   a length `smoot
-00002630: 685f 6c65 6e60 205b 6d5d 0a0a 2020 2020  h_len` [m]..    
-00002640: 2020 2020 5468 6520 7269 7665 7220 6465      The river de
-00002650: 7074 6820 6973 2063 616c 6375 6c61 7465  pth is calculate
-00002660: 6420 7573 696e 6720 7468 6520 6072 6976  d using the `riv
-00002670: 6470 685f 6d65 7468 6f64 602c 2062 7920  dph_method`, by 
-00002680: 6465 6661 756c 7420 706f 776c 6177 3a0a  default powlaw:.
-00002690: 2020 2020 2020 2020 6820 3d20 6863 2a51          h = hc*Q
-000026a0: 6266 2a2a 6870 2c20 7768 6963 6820 6973  bf**hp, which is
-000026b0: 2062 6173 6564 206f 6e20 7162 616e 6b66   based on qbankf
-000026c0: 756c 6c20 6469 7363 6861 7267 6520 6672  ull discharge fr
-000026d0: 6f6d 2074 6865 206e 6561 7265 7374 2072  om the nearest r
-000026e0: 6976 6572 0a20 2020 2020 2020 2073 6567  iver.        seg
-000026f0: 6d65 6e74 2069 6e20 6072 6976 6572 5f67  ment in `river_g
-00002700: 656f 6d5f 666e 6020 616e 6420 7461 6b65  eom_fn` and take
-00002710: 7320 6f70 7469 6f6e 616c 2061 7267 756d  s optional argum
-00002720: 656e 7473 2066 6f72 2074 6865 2068 630a  ents for the hc.
-00002730: 2020 2020 2020 2020 2864 6566 6175 6c74          (default
-00002740: 203d 2030 2e32 3729 2061 6e64 2068 7020   = 0.27) and hp 
-00002750: 2864 6566 6175 6c74 203d 2030 2e33 3029  (default = 0.30)
-00002760: 2070 6172 616d 6574 6572 732e 2046 6f72   parameters. For
-00002770: 206f 7468 6572 206d 6574 686f 6473 2073   other methods s
-00002780: 6565 0a20 2020 2020 2020 203a 7079 3a6d  ee.        :py:m
-00002790: 6574 683a 6068 7964 726f 6d74 2e77 6f72  eth:`hydromt.wor
-000027a0: 6b66 6c6f 7773 2e72 6976 6572 5f64 6570  kflows.river_dep
-000027b0: 7468 602e 0a0a 2020 2020 2020 2020 4164  th`...        Ad
-000027c0: 6473 206d 6f64 656c 206c 6179 6572 733a  ds model layers:
-000027d0: 0a0a 2020 2020 2020 2020 2a20 2a2a 7766  ..        * **wf
-000027e0: 6c6f 775f 7269 7665 722a 2a20 6d61 703a  low_river** map:
-000027f0: 2072 6976 6572 206d 6173 6b20 5b2d 5d0a   river mask [-].
-00002800: 2020 2020 2020 2020 2a20 2a2a 7766 6c6f          * **wflo
-00002810: 775f 7269 7665 726c 656e 6774 682a 2a20  w_riverlength** 
-00002820: 6d61 703a 2072 6976 6572 206c 656e 6774  map: river lengt
-00002830: 6820 5b6d 5d0a 2020 2020 2020 2020 2a20  h [m].        * 
-00002840: 2a2a 7766 6c6f 775f 7269 7665 7277 6964  **wflow_riverwid
-00002850: 7468 2a2a 206d 6170 3a20 7269 7665 7220  th** map: river 
-00002860: 7769 6474 6820 5b6d 5d0a 2020 2020 2020  width [m].      
-00002870: 2020 2a20 2a2a 5269 7665 7244 6570 7468    * **RiverDepth
-00002880: 2a2a 206d 6170 3a20 6261 6e6b 6675 6c6c  ** map: bankfull
-00002890: 2072 6976 6572 2064 6570 7468 205b 6d5d   river depth [m]
-000028a0: 0a20 2020 2020 2020 202a 202a 2a52 6976  .        * **Riv
-000028b0: 6572 536c 6f70 652a 2a20 6d61 703a 2072  erSlope** map: r
-000028c0: 6976 6572 2073 6c6f 7065 205b 6d2f 6d5d  iver slope [m/m]
-000028d0: 0a20 2020 2020 2020 202a 202a 2a4e 5f52  .        * **N_R
-000028e0: 6976 6572 2a2a 206d 6170 3a20 4d61 6e6e  iver** map: Mann
-000028f0: 696e 6720 636f 6566 6669 6369 656e 7420  ing coefficient 
-00002900: 666f 7220 7269 7665 7220 6365 6c6c 7320  for river cells 
-00002910: 5b73 2e6d 5e31 2f33 5d0a 2020 2020 2020  [s.m^1/3].      
-00002920: 2020 2a20 2a2a 7269 7665 7273 2a2a 2067    * **rivers** g
-00002930: 656f 6d3a 2072 6976 6572 2076 6563 746f  eom: river vecto
-00002940: 7220 6261 7365 6420 6f6e 2077 666c 6f77  r based on wflow
-00002950: 5f72 6976 6572 206d 6173 6b0a 0a20 2020  _river mask..   
-00002960: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00002970: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00002980: 2d2d 0a20 2020 2020 2020 2068 7964 726f  --.        hydro
-00002990: 6772 6170 6879 5f66 6e20 3a20 7374 722c  graphy_fn : str,
-000029a0: 2050 6174 680a 2020 2020 2020 2020 2020   Path.          
-000029b0: 2020 4e61 6d65 206f 6620 6461 7461 2073    Name of data s
-000029c0: 6f75 7263 6520 666f 7220 6879 6472 6f67  ource for hydrog
-000029d0: 7261 7068 7920 6461 7461 2e0a 2020 2020  raphy data..    
-000029e0: 2020 2020 2020 2020 4d75 7374 2062 6520          Must be 
-000029f0: 7361 6d65 2061 7320 7365 7475 705f 6261  same as setup_ba
-00002a00: 7365 6d61 7073 2066 6f72 2063 6f6e 7369  semaps for consi
-00002a10: 7374 656e 7420 7265 7375 6c74 732e 0a0a  stent results...
-00002a20: 2020 2020 2020 2020 2020 2020 2a20 5265              * Re
-00002a30: 7175 6972 6564 2076 6172 6961 626c 6573  quired variables
-00002a40: 3a20 5b27 666c 7764 6972 272c 2027 7570  : ['flwdir', 'up
-00002a50: 6172 6561 272c 2027 656c 6576 746e 275d  area', 'elevtn']
-00002a60: 0a20 2020 2020 2020 2020 2020 202a 204f  .            * O
-00002a70: 7074 696f 6e61 6c20 7661 7269 6162 6c65  ptional variable
-00002a80: 733a 205b 2772 6976 7774 6827 2c20 2771  s: ['rivwth', 'q
-00002a90: 6261 6e6b 6675 6c6c 275d 0a20 2020 2020  bankfull'].     
-00002aa0: 2020 2072 6976 6572 5f67 656f 6d5f 666e     river_geom_fn
-00002ab0: 203a 2073 7472 2c20 5061 7468 2c20 6f70   : str, Path, op
-00002ac0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00002ad0: 2020 204e 616d 6520 6f66 2064 6174 6120     Name of data 
-00002ae0: 736f 7572 6365 2066 6f72 2072 6976 6572  source for river
-00002af0: 2064 6174 612e 0a0a 2020 2020 2020 2020   data...        
-00002b00: 2020 2020 2a20 5265 7175 6972 6564 2076      * Required v
-00002b10: 6172 6961 626c 6573 3a20 5b27 7269 7677  ariables: ['rivw
-00002b20: 7468 272c 2027 7162 616e 6b66 756c 6c27  th', 'qbankfull'
-00002b30: 5d0a 2020 2020 2020 2020 7269 7665 725f  ].        river_
-00002b40: 7570 6120 3a20 666c 6f61 740a 2020 2020  upa : float.    
-00002b50: 2020 2020 2020 2020 6d69 6e69 6d75 6d20          minimum 
-00002b60: 7570 7374 7265 616d 2061 7265 6120 7468  upstream area th
-00002b70: 7265 7368 6f6c 6420 666f 7220 7468 6520  reshold for the 
-00002b80: 7269 7665 7220 6d61 7020 5b6b 6d32 5d0a  river map [km2].
-00002b90: 2020 2020 2020 2020 736c 6f70 655f 6c65          slope_le
-00002ba0: 6e20 3a20 666c 6f61 740a 2020 2020 2020  n : float.      
-00002bb0: 2020 2020 2020 6c65 6e67 7468 206f 7665        length ove
-00002bc0: 7220 7768 6963 6820 7468 6520 7269 7665  r which the rive
-00002bd0: 7220 736c 6f70 6520 6973 2063 616c 6375  r slope is calcu
-00002be0: 6c61 7465 6420 5b6b 6d5d 0a20 2020 2020  lated [km].     
-00002bf0: 2020 206d 696e 5f72 6976 6c65 6e5f 7261     min_rivlen_ra
-00002c00: 7469 6f3a 2066 6c6f 6174 0a20 2020 2020  tio: float.     
-00002c10: 2020 2020 2020 2052 6174 696f 206f 6620         Ratio of 
-00002c20: 6365 6c6c 2072 6573 6f6c 7574 696f 6e20  cell resolution 
-00002c30: 7573 6564 206d 696e 696d 756d 206c 656e  used minimum len
-00002c40: 6774 6820 7468 7265 7368 6f6c 6420 696e  gth threshold in
-00002c50: 2061 206d 6f76 696e 670a 2020 2020 2020   a moving.      
-00002c60: 2020 2020 2020 7769 6e64 6f77 2062 6173        window bas
-00002c70: 6564 2073 6d6f 6f74 6869 6e67 206f 6620  ed smoothing of 
-00002c80: 7269 7665 7220 6c65 6e67 7468 2c20 6279  river length, by
-00002c90: 2064 6566 6175 6c74 2030 2e30 0a20 2020   default 0.0.   
-00002ca0: 2020 2020 2020 2020 2054 6865 2072 6976           The riv
-00002cb0: 6572 206c 656e 6774 6820 736d 6f6f 7468  er length smooth
-00002cc0: 696e 6720 6973 2073 6b69 7070 6564 2069  ing is skipped i
-00002cd0: 6620 6d69 6e5f 7269 7665 726c 656e 5f72  f min_riverlen_r
-00002ce0: 6174 696f 203d 2030 2e0a 2020 2020 2020  atio = 0..      
-00002cf0: 2020 2020 2020 466f 7220 6465 7461 696c        For detail
-00002d00: 7320 6162 6f75 7420 7468 6520 7269 7665  s about the rive
-00002d10: 7220 6c65 6e67 7468 2073 6d6f 6f74 6869  r length smoothi
-00002d20: 6e67 2c20 7365 6520 3a70 793a 6d65 7468  ng, see :py:meth
-00002d30: 3a60 7079 666c 7764 6972 2e46 6c77 6469  :`pyflwdir.Flwdi
-00002d40: 7252 6173 7465 722e 736d 6f6f 7468 5f72  rRaster.smooth_r
-00002d50: 6976 6c65 6e60 0a20 2020 2020 2020 2072  ivlen`.        r
-00002d60: 6976 6470 685f 6d65 7468 6f64 203a 207b  ivdph_method : {
-00002d70: 2767 7666 272c 2027 6d61 6e6e 696e 6727  'gvf', 'manning'
-00002d80: 2c20 2770 6f77 6c61 7727 7d0a 2020 2020  , 'powlaw'}.    
-00002d90: 2020 2020 2020 2020 7365 6520 7079 3a6d          see py:m
-00002da0: 6574 683a 6068 7964 726f 6d74 2e77 6f72  eth:`hydromt.wor
-00002db0: 6b66 6c6f 7773 2e72 6976 6572 5f64 6570  kflows.river_dep
-00002dc0: 7468 6020 666f 7220 6465 7461 696c 732c  th` for details,
-00002dd0: 2062 7920 6465 6661 756c 7420 2270 6f77   by default "pow
-00002de0: 6c61 7722 0a20 2020 2020 2020 2073 6d6f  law".        smo
-00002df0: 6f74 685f 6c65 6e20 3a20 666c 6f61 742c  oth_len : float,
-00002e00: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00002e10: 2020 2020 2020 4c65 6e67 7468 205b 6d5d        Length [m]
-00002e20: 206f 7665 7220 7768 6963 6820 746f 2073   over which to s
-00002e30: 6d6f 6f74 6820 7468 6520 6f75 7470 7574  mooth the output
-00002e40: 2072 6976 6572 2077 6964 7468 2061 6e64   river width and
-00002e50: 2064 6570 7468 2c20 6279 2064 6566 6175   depth, by defau
-00002e60: 6c74 2035 6533 0a20 2020 2020 2020 206d  lt 5e3.        m
-00002e70: 696e 5f72 6976 6470 6820 3a20 666c 6f61  in_rivdph : floa
-00002e80: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
-00002e90: 2020 2020 2020 2020 4d69 6e69 6d75 6d20          Minimum 
-00002ea0: 7269 7665 7220 6465 7074 6820 5b6d 5d2c  river depth [m],
-00002eb0: 2062 7920 6465 6661 756c 7420 312e 300a   by default 1.0.
-00002ec0: 2020 2020 2020 2020 6d69 6e5f 7269 7677          min_rivw
-00002ed0: 7468 203a 2066 6c6f 6174 2c20 6f70 7469  th : float, opti
-00002ee0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00002ef0: 204d 696e 696d 756d 2072 6976 6572 2077   Minimum river w
-00002f00: 6964 7468 205b 6d5d 2c20 6279 2064 6566  idth [m], by def
-00002f10: 6175 6c74 2033 302e 300a 0a20 2020 2020  ault 30.0..     
-00002f20: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-00002f30: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00002f40: 2020 2020 2077 6f72 6b66 6c6f 7773 2e72       workflows.r
-00002f50: 6976 6572 5f62 6174 6879 6d65 7472 790a  iver_bathymetry.
-00002f60: 2020 2020 2020 2020 6879 6472 6f6d 742e          hydromt.
-00002f70: 776f 726b 666c 6f77 732e 7269 7665 725f  workflows.river_
-00002f80: 6465 7074 680a 2020 2020 2020 2020 7079  depth.        py
-00002f90: 666c 7764 6972 2e46 6c77 6469 7252 6173  flwdir.FlwdirRas
-00002fa0: 7465 722e 7269 7665 725f 6465 7074 680a  ter.river_depth.
-00002fb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00002fc0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-00002fd0: 696e 666f 2866 2250 7265 7061 7269 6e67  info(f"Preparing
-00002fe0: 2072 6976 6572 206d 6170 732e 2229 0a0a   river maps.")..
-00002ff0: 2020 2020 2020 2020 2320 7265 6164 2064          # read d
-00003000: 6174 610a 2020 2020 2020 2020 6473 5f68  ata.        ds_h
-00003010: 7964 726f 203d 2073 656c 662e 6461 7461  ydro = self.data
-00003020: 5f63 6174 616c 6f67 2e67 6574 5f72 6173  _catalog.get_ras
-00003030: 7465 7264 6174 6173 6574 280a 2020 2020  terdataset(.    
-00003040: 2020 2020 2020 2020 6879 6472 6f67 7261          hydrogra
-00003050: 7068 795f 666e 2c20 6765 6f6d 3d73 656c  phy_fn, geom=sel
-00003060: 662e 7265 6769 6f6e 2c20 6275 6666 6572  f.region, buffer
-00003070: 3d31 300a 2020 2020 2020 2020 290a 0a20  =10.        ).. 
-00003080: 2020 2020 2020 2023 2067 6574 2072 6976         # get riv
-00003090: 6d73 6b2c 2072 6976 6c65 6e2c 2072 6976  msk, rivlen, riv
-000030a0: 736c 700a 2020 2020 2020 2020 2320 7265  slp.        # re
-000030b0: 6164 206d 6f64 656c 206d 6170 7320 616e  ad model maps an
-000030c0: 6420 7265 7665 7274 2077 666c 6f77 2074  d revert wflow t
-000030d0: 6f20 6879 6472 6f6d 7420 6d61 7020 6e61  o hydromt map na
-000030e0: 6d65 730a 2020 2020 2020 2020 696e 765f  mes.        inv_
-000030f0: 7265 6e61 6d65 203d 207b 763a 206b 2066  rename = {v: k f
-00003100: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
-00003110: 5f4d 4150 532e 6974 656d 7328 2920 6966  _MAPS.items() if
-00003120: 2076 2069 6e20 7365 6c66 2e73 7461 7469   v in self.stati
-00003130: 636d 6170 737d 0a20 2020 2020 2020 2064  cmaps}.        d
-00003140: 735f 7269 7620 3d20 776f 726b 666c 6f77  s_riv = workflow
-00003150: 732e 7269 7665 7228 0a20 2020 2020 2020  s.river(.       
-00003160: 2020 2020 2064 733d 6473 5f68 7964 726f       ds=ds_hydro
-00003170: 2c0a 2020 2020 2020 2020 2020 2020 6473  ,.            ds
-00003180: 5f6d 6f64 656c 3d73 656c 662e 7374 6174  _model=self.stat
-00003190: 6963 6d61 7073 2e72 656e 616d 6528 696e  icmaps.rename(in
-000031a0: 765f 7265 6e61 6d65 292c 0a20 2020 2020  v_rename),.     
-000031b0: 2020 2020 2020 2072 6976 6572 5f75 7061         river_upa
-000031c0: 3d72 6976 6572 5f75 7061 2c0a 2020 2020  =river_upa,.    
-000031d0: 2020 2020 2020 2020 736c 6f70 655f 6c65          slope_le
-000031e0: 6e3d 736c 6f70 655f 6c65 6e2c 0a20 2020  n=slope_len,.   
-000031f0: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
-00003200: 5f64 6972 3d22 7570 222c 0a20 2020 2020  _dir="up",.     
-00003210: 2020 2020 2020 206d 696e 5f72 6976 6c65         min_rivle
-00003220: 6e5f 7261 7469 6f3d 6d69 6e5f 7269 766c  n_ratio=min_rivl
-00003230: 656e 5f72 6174 696f 2c0a 2020 2020 2020  en_ratio,.      
-00003240: 2020 2020 2020 6c6f 6767 6572 3d73 656c        logger=sel
-00003250: 662e 6c6f 6767 6572 2c0a 2020 2020 2020  f.logger,.      
-00003260: 2020 295b 305d 0a20 2020 2020 2020 2064    )[0].        d
-00003270: 7661 7273 203d 205b 2272 6976 6d73 6b22  vars = ["rivmsk"
-00003280: 2c20 2272 6976 6c65 6e22 2c20 2272 6976  , "rivlen", "riv
-00003290: 736c 7022 5d0a 2020 2020 2020 2020 726d  slp"].        rm
-000032a0: 6469 6374 203d 207b 6b3a 2073 656c 662e  dict = {k: self.
-000032b0: 5f4d 4150 532e 6765 7428 6b2c 206b 2920  _MAPS.get(k, k) 
-000032c0: 666f 7220 6b20 696e 2064 7661 7273 7d0a  for k in dvars}.
-000032d0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-000032e0: 5f73 7461 7469 636d 6170 7328 6473 5f72  _staticmaps(ds_r
-000032f0: 6976 5b64 7661 7273 5d2e 7265 6e61 6d65  iv[dvars].rename
-00003300: 2872 6d64 6963 7429 290a 0a20 2020 2020  (rmdict))..     
-00003310: 2020 2023 2054 4f44 4f20 6d61 6b65 2073     # TODO make s
-00003320: 6570 6172 6174 6520 776f 726b 666c 6f77  eparate workflow
-00003330: 732e 7269 7665 725f 6d61 6e6e 696e 6720  s.river_manning 
-00003340: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
-00003350: 2320 4d61 6b65 204e 5f52 6976 6572 206d  # Make N_River m
-00003360: 6170 2066 726f 6d20 6373 7620 6669 6c65  ap from csv file
-00003370: 2077 6974 6820 6d61 7070 696e 6720 6265   with mapping be
-00003380: 7477 6565 6e20 7374 7265 616d 6f72 6465  tween streamorde
-00003390: 7220 616e 6420 4e5f 5269 7665 7220 7661  r and N_River va
-000033a0: 6c75 650a 2020 2020 2020 2020 7374 726f  lue.        stro
-000033b0: 7264 203d 2073 656c 662e 7374 6174 6963  rd = self.static
-000033c0: 6d61 7073 5b73 656c 662e 5f4d 4150 535b  maps[self._MAPS[
-000033d0: 2273 7472 6f72 6422 5d5d 2e63 6f70 7928  "strord"]].copy(
-000033e0: 290a 2020 2020 2020 2020 6466 203d 2070  ).        df = p
-000033f0: 642e 7265 6164 5f63 7376 2872 6976 6d61  d.read_csv(rivma
-00003400: 6e5f 6d61 7070 696e 675f 666e 2c20 696e  n_mapping_fn, in
-00003410: 6465 785f 636f 6c3d 302c 2073 6570 3d22  dex_col=0, sep="
-00003420: 2c7c 3b22 2c20 656e 6769 6e65 3d22 7079  ,|;", engine="py
-00003430: 7468 6f6e 2229 0a20 2020 2020 2020 2023  thon").        #
-00003440: 206d 6178 2073 7472 6561 6d6f 7264 6572   max streamorder
-00003450: 2076 616c 7565 2061 626f 7665 2077 6869   value above whi
-00003460: 6368 2076 616c 7565 7320 6765 7420 7468  ch values get th
-00003470: 6520 7361 6d65 204e 5f52 6976 6572 2076  e same N_River v
-00003480: 616c 7565 0a20 2020 2020 2020 206d 6178  alue.        max
-00003490: 5f73 7472 203d 2064 662e 696e 6465 785b  _str = df.index[
-000034a0: 2d32 5d0a 2020 2020 2020 2020 2320 6966  -2].        # if
-000034b0: 2073 7472 6561 6d6f 7264 6572 2076 616c   streamorder val
-000034c0: 7565 206c 6172 6765 7220 7468 616e 206d  ue larger than m
-000034d0: 6178 5f73 7472 2c20 6173 7369 676e 206c  ax_str, assign l
-000034e0: 6173 7420 7661 6c75 650a 2020 2020 2020  ast value.      
-000034f0: 2020 7374 726f 7264 203d 2073 7472 6f72    strord = stror
-00003500: 642e 7768 6572 6528 7374 726f 7264 203c  d.where(strord <
-00003510: 3d20 6d61 785f 7374 722c 206d 6178 5f73  = max_str, max_s
-00003520: 7472 290a 2020 2020 2020 2020 2320 6861  tr).        # ha
-00003530: 6e64 6c65 206d 6973 7369 6e67 2076 616c  ndle missing val
-00003540: 7565 2028 6c61 7374 2072 6f77 206f 6620  ue (last row of 
-00003550: 6373 7620 6973 206d 6170 7069 6e67 206f  csv is mapping o
-00003560: 6620 6d69 7373 696e 6720 7661 6c75 6573  f missing values
-00003570: 290a 2020 2020 2020 2020 7374 726f 7264  ).        strord
-00003580: 203d 2073 7472 6f72 642e 7768 6572 6528   = strord.where(
-00003590: 7374 726f 7264 2021 3d20 7374 726f 7264  strord != strord
-000035a0: 2e72 6173 7465 722e 6e6f 6461 7461 2c20  .raster.nodata, 
-000035b0: 2d39 3939 290a 2020 2020 2020 2020 7374  -999).        st
-000035c0: 726f 7264 2e72 6173 7465 722e 7365 745f  rord.raster.set_
-000035d0: 6e6f 6461 7461 282d 3939 3929 0a20 2020  nodata(-999).   
-000035e0: 2020 2020 2064 735f 6e72 6976 6572 203d       ds_nriver =
-000035f0: 2077 6f72 6b66 6c6f 7773 2e6c 616e 6475   workflows.landu
-00003600: 7365 280a 2020 2020 2020 2020 2020 2020  se(.            
-00003610: 6461 3d73 7472 6f72 642c 0a20 2020 2020  da=strord,.     
-00003620: 2020 2020 2020 2064 735f 6c69 6b65 3d73         ds_like=s
-00003630: 656c 662e 7374 6174 6963 6d61 7073 2c0a  elf.staticmaps,.
-00003640: 2020 2020 2020 2020 2020 2020 666e 5f6d              fn_m
-00003650: 6170 3d72 6976 6d61 6e5f 6d61 7070 696e  ap=rivman_mappin
-00003660: 675f 666e 2c0a 2020 2020 2020 2020 2020  g_fn,.          
-00003670: 2020 6c6f 6767 6572 3d73 656c 662e 6c6f    logger=self.lo
-00003680: 6767 6572 2c0a 2020 2020 2020 2020 290a  gger,.        ).
-00003690: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-000036a0: 5f73 7461 7469 636d 6170 7328 6473 5f6e  _staticmaps(ds_n
-000036b0: 7269 7665 7229 0a0a 2020 2020 2020 2020  river)..        
-000036c0: 2320 6765 7420 7269 7664 7068 2c20 7269  # get rivdph, ri
-000036d0: 7677 7468 0a20 2020 2020 2020 2023 2077  vwth.        # w
-000036e0: 6869 6c65 2077 6520 7374 696c 6c20 6861  hile we still ha
-000036f0: 7665 2073 6574 7570 5f72 6976 6572 7769  ve setup_riverwi
-00003700: 6474 6820 6f6e 6520 6361 6e20 736b 6970  dth one can skip
-00003710: 2072 6976 6572 5f62 6174 6879 6d65 7472   river_bathymetr
-00003720: 7920 6865 7265 0a20 2020 2020 2020 2023  y here.        #
-00003730: 2054 4f44 4f20 6d61 6b65 2072 6976 6572   TODO make river
-00003740: 5f67 656f 6d5f 666e 2072 6571 7569 7265  _geom_fn require
-00003750: 6420 6166 7465 7220 7265 6d6f 7669 6e67  d after removing
-00003760: 2073 6574 7570 5f72 6976 6572 7769 6474   setup_riverwidt
-00003770: 680a 2020 2020 2020 2020 6966 2072 6976  h.        if riv
-00003780: 6572 5f67 656f 6d5f 666e 2069 7320 6e6f  er_geom_fn is no
-00003790: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000037a0: 2020 2020 6764 665f 7269 7620 3d20 7365      gdf_riv = se
-000037b0: 6c66 2e64 6174 615f 6361 7461 6c6f 672e  lf.data_catalog.
-000037c0: 6765 745f 6765 6f64 6174 6166 7261 6d65  get_geodataframe
-000037d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000037e0: 2020 7269 7665 725f 6765 6f6d 5f66 6e2c    river_geom_fn,
-000037f0: 2067 656f 6d3d 7365 6c66 2e72 6567 696f   geom=self.regio
-00003800: 6e0a 2020 2020 2020 2020 2020 2020 290a  n.            ).
-00003810: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-00003820: 7265 6164 206d 6f64 656c 2064 6174 6120  read model data 
-00003830: 746f 2067 6574 2072 6976 6572 206d 6170  to get river map
-00003840: 730a 2020 2020 2020 2020 2020 2020 696e  s.            in
-00003850: 765f 7265 6e61 6d65 203d 207b 763a 206b  v_rename = {v: k
-00003860: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-00003870: 662e 5f4d 4150 532e 6974 656d 7328 2920  f._MAPS.items() 
-00003880: 6966 2076 2069 6e20 7365 6c66 2e73 7461  if v in self.sta
-00003890: 7469 636d 6170 737d 0a20 2020 2020 2020  ticmaps}.       
-000038a0: 2020 2020 2064 735f 7269 7631 203d 2077       ds_riv1 = w
-000038b0: 6f72 6b66 6c6f 7773 2e72 6976 6572 5f62  orkflows.river_b
-000038c0: 6174 6879 6d65 7472 7928 0a20 2020 2020  athymetry(.     
-000038d0: 2020 2020 2020 2020 2020 2064 735f 6d6f             ds_mo
-000038e0: 6465 6c3d 7365 6c66 2e73 7461 7469 636d  del=self.staticm
-000038f0: 6170 732e 7265 6e61 6d65 2869 6e76 5f72  aps.rename(inv_r
-00003900: 656e 616d 6529 2c0a 2020 2020 2020 2020  ename),.        
-00003910: 2020 2020 2020 2020 6764 665f 7269 763d          gdf_riv=
-00003920: 6764 665f 7269 762c 0a20 2020 2020 2020  gdf_riv,.       
-00003930: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-00003940: 7269 7664 7068 5f6d 6574 686f 642c 0a20  rivdph_method,. 
-00003950: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003960: 6d6f 6f74 685f 6c65 6e3d 736d 6f6f 7468  mooth_len=smooth
-00003970: 5f6c 656e 2c0a 2020 2020 2020 2020 2020  _len,.          
-00003980: 2020 2020 2020 6d69 6e5f 7269 7664 7068        min_rivdph
-00003990: 3d6d 696e 5f72 6976 6470 682c 0a20 2020  =min_rivdph,.   
-000039a0: 2020 2020 2020 2020 2020 2020 206d 696e               min
-000039b0: 5f72 6976 7774 683d 6d69 6e5f 7269 7677  _rivwth=min_rivw
-000039c0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-000039d0: 2020 2020 6c6f 6767 6572 3d73 656c 662e      logger=self.
-000039e0: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
-000039f0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00003a00: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00003a10: 2020 2020 2020 2020 2020 2020 726d 6469              rmdi
-00003a20: 6374 203d 207b 6b3a 2076 2066 6f72 206b  ct = {k: v for k
-00003a30: 2c20 7620 696e 2073 656c 662e 5f4d 4150  , v in self._MAP
-00003a40: 532e 6974 656d 7328 2920 6966 206b 2069  S.items() if k i
-00003a50: 6e20 6473 5f72 6976 312e 6461 7461 5f76  n ds_riv1.data_v
-00003a60: 6172 737d 0a20 2020 2020 2020 2020 2020  ars}.           
-00003a70: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
-00003a80: 6d61 7073 2864 735f 7269 7631 2e72 656e  maps(ds_riv1.ren
-00003a90: 616d 6528 726d 6469 6374 2929 0a20 2020  ame(rmdict)).   
-00003aa0: 2020 2020 2020 2020 2023 2075 7064 6174           # updat
-00003ab0: 6520 636f 6e66 6967 0a20 2020 2020 2020  e config.       
-00003ac0: 2020 2020 2073 656c 662e 7365 745f 636f       self.set_co
-00003ad0: 6e66 6967 2822 696e 7075 742e 6c61 7465  nfig("input.late
-00003ae0: 7261 6c2e 7269 7665 722e 6261 6e6b 6675  ral.river.bankfu
-00003af0: 6c6c 5f64 6570 7468 222c 2073 656c 662e  ll_depth", self.
-00003b00: 5f4d 4150 535b 2272 6976 6470 6822 5d29  _MAPS["rivdph"])
-00003b10: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-00003b20: 6f67 6765 722e 6465 6275 6728 6622 4164  ogger.debug(f"Ad
-00003b30: 6469 6e67 2072 6976 6572 7320 7665 6374  ding rivers vect
-00003b40: 6f72 2074 6f20 7374 6174 6963 6765 6f6d  or to staticgeom
-00003b50: 732e 2229 0a20 2020 2020 2020 2073 656c  s.").        sel
-00003b60: 662e 7374 6174 6963 6765 6f6d 732e 706f  f.staticgeoms.po
-00003b70: 7028 2272 6976 6572 7322 2c20 4e6f 6e65  p("rivers", None
-00003b80: 2920 2023 2072 656d 6f76 6520 6f6c 6420  )  # remove old 
-00003b90: 7269 7665 7273 2069 6620 696e 2073 7461  rivers if in sta
-00003ba0: 7469 6367 656f 6d73 0a20 2020 2020 2020  ticgeoms.       
-00003bb0: 2073 656c 662e 7269 7665 7273 2020 2320   self.rivers  # 
-00003bc0: 6164 6420 6e65 7720 7269 7665 7273 2074  add new rivers t
-00003bd0: 6f20 7374 6174 6963 6765 6f6d 730a 0a20  o staticgeoms.. 
-00003be0: 2020 2064 6566 2073 6574 7570 5f68 7964     def setup_hyd
-00003bf0: 726f 6465 6d28 0a20 2020 2020 2020 2073  rodem(.        s
-00003c00: 656c 662c 0a20 2020 2020 2020 2065 6c65  elf,.        ele
-00003c10: 7674 6e5f 6d61 703d 2277 666c 6f77 5f64  vtn_map="wflow_d
-00003c20: 656d 222c 0a20 2020 2020 2020 2072 6976  em",.        riv
-00003c30: 6572 5f72 6f75 7469 6e67 3d22 6c6f 6361  er_routing="loca
-00003c40: 6c2d 696e 6572 7469 616c 222c 0a20 2020  l-inertial",.   
-00003c50: 2020 2020 206c 616e 645f 726f 7574 696e       land_routin
-00003c60: 673d 226b 696e 656d 6174 6963 2d77 6176  g="kinematic-wav
-00003c70: 6522 2c0a 2020 2020 293a 0a20 2020 2020  e",.    ):.     
-00003c80: 2020 2022 2222 5468 6973 2063 6f6d 706f     """This compo
-00003c90: 6e65 6e74 2061 6464 7320 6120 6879 6472  nent adds a hydr
-00003ca0: 6f6c 6f67 6963 616c 6c79 2063 6f6e 6469  ologically condi
-00003cb0: 7469 6f6e 6564 2065 6c65 7661 7469 6f6e  tioned elevation
-00003cc0: 2028 6879 6472 6f64 656d 2920 6d61 7020   (hydrodem) map 
-00003cd0: 666f 720a 2020 2020 2020 2020 7269 7665  for.        rive
-00003ce0: 7220 616e 642f 6f72 206c 616e 6420 6c6f  r and/or land lo
-00003cf0: 6361 6c2d 696e 6572 7469 616c 2072 6f75  cal-inertial rou
-00003d00: 7469 6e67 2e0a 0a20 2020 2020 2020 2052  ting...        R
-00003d10: 6976 6572 2063 656c 6c73 2061 7265 2061  iver cells are a
-00003d20: 6c77 6179 7320 636f 6e64 6974 696f 6e65  lways conditione
-00003d30: 6420 746f 2044 3820 666c 6f77 2064 6972  d to D8 flow dir
-00003d40: 6563 7469 6f6e 732e 2020 4c61 6e64 2063  ections.  Land c
-00003d50: 656c 6c73 2061 7265 2063 6f6e 6469 7469  ells are conditi
-00003d60: 6f6e 6564 0a20 2020 2020 2020 2074 6f20  oned.        to 
-00003d70: 4434 2066 6c6f 7720 6469 7265 6374 696f  D4 flow directio
-00003d80: 6e73 2069 6620 6c61 6e64 5f72 6f75 7469  ns if land_routi
-00003d90: 6e67 3d22 6c6f 6361 6c2d 696e 6572 7469  ng="local-inerti
-00003da0: 616c 222c 2065 6c73 6520 746f 2044 382e  al", else to D8.
-00003db0: 2049 6620 6c6f 6361 6c20 696e 6572 7469   If local inerti
-00003dc0: 616c 0a20 2020 2020 2020 2069 7320 7365  al.        is se
-00003dd0: 6c65 6374 6564 2066 6f72 206c 616e 6420  lected for land 
-00003de0: 726f 7574 696e 672c 2069 7420 6973 2072  routing, it is r
-00003df0: 6571 7569 7265 6420 746f 2068 6176 6520  equired to have 
-00003e00: 6120 4434 2063 6f6e 6469 7469 6f6e 696e  a D4 conditionin
-00003e10: 672c 206f 7468 6572 7769 7365 2070 6974  g, otherwise pit
-00003e20: 730a 2020 2020 2020 2020 6d61 7920 7265  s.        may re
-00003e30: 6d61 696e 2069 6e20 7468 6520 6c61 6e64  main in the land
-00003e40: 2063 656c 6c73 2e0a 0a20 2020 2020 2020   cells...       
-00003e50: 2054 6865 2063 6f6e 6469 7469 6f6e 6564   The conditioned
-00003e60: 2065 6c65 7661 7469 6f6e 2063 616e 2062   elevation can b
-00003e70: 6520 6261 7365 6420 6f6e 2074 6865 2061  e based on the a
-00003e80: 7665 7261 6765 2063 656c 6c20 656c 6576  verage cell elev
-00003e90: 6174 696f 6e20 2822 7766 6c6f 775f 6465  ation ("wflow_de
-00003ea0: 6d22 290a 2020 2020 2020 2020 6f72 2073  m").        or s
-00003eb0: 7562 6772 6964 206f 7574 6c65 7420 7069  ubgrid outlet pi
-00003ec0: 7865 6c20 656c 6576 6174 696f 6e20 2822  xel elevation ("
-00003ed0: 6465 6d5f 7375 6267 7269 6422 292e 2046  dem_subgrid"). F
-00003ee0: 6f72 206c 6f63 616c 2d69 6e65 7274 6961  or local-inertia
-00003ef0: 6c20 7269 7665 720a 2020 2020 2020 2020  l river.        
-00003f00: 726f 7574 696e 6720 7468 6520 7375 6267  routing the subg
-00003f10: 7269 6420 656c 6576 6174 696f 6e20 6d69  rid elevation mi
-00003f20: 6768 7420 7072 6f76 6964 6520 6120 6265  ght provide a be
-00003f30: 7474 6572 2072 6570 7265 7365 6e74 6174  tter representat
-00003f40: 696f 6e20 6f66 2074 6865 2072 6976 6572  ion of the river
-00003f50: 0a20 2020 2020 2020 2065 6c65 7661 7469  .        elevati
-00003f60: 6f6e 2070 726f 6669 6c65 2c20 686f 7765  on profile, howe
-00003f70: 7665 7220 696e 2063 6f6d 6269 6e61 7469  ver in combinati
-00003f80: 6f6e 2077 6974 6820 6c6f 6361 6c2d 696e  on with local-in
-00003f90: 6572 7469 616c 206c 616e 6420 726f 7574  ertial land rout
-00003fa0: 696e 6720 7468 650a 2020 2020 2020 2020  ing the.        
-00003fb0: 7375 6267 7269 6420 656c 6576 6174 696f  subgrid elevatio
-00003fc0: 6e20 7769 6c6c 206c 696b 656c 7920 6f76  n will likely ov
-00003fd0: 6572 6573 7469 6d61 7465 2074 6865 2066  erestimate the f
-00003fe0: 6c6f 6f64 706c 6169 6e20 7374 6f72 6167  loodplain storag
-00003ff0: 6520 6361 7061 6369 7479 2e0a 0a20 2020  e capacity...   
-00004000: 2020 2020 204e 6f74 6520 7468 6174 2074       Note that t
-00004010: 6865 2073 616d 6520 696e 7075 7420 656c  he same input el
-00004020: 6576 6174 696f 6e20 6d61 7020 7368 6f75  evation map shou
-00004030: 6c64 2062 6520 7573 6564 2066 6f72 2072  ld be used for r
-00004040: 6976 6572 2062 616e 6b66 756c 6c20 656c  iver bankfull el
-00004050: 6576 6174 696f 6e0a 2020 2020 2020 2020  evation.        
-00004060: 616e 6420 6c61 6e64 2065 6c65 7661 7469  and land elevati
-00004070: 6f6e 2077 6865 6e20 7573 696e 6720 6c6f  on when using lo
-00004080: 6361 6c2d 696e 6572 7469 616c 206c 616e  cal-inertial lan
-00004090: 6420 726f 7574 696e 672e 0a0a 2020 2020  d routing...    
-000040a0: 2020 2020 4164 6473 206d 6f64 656c 206c      Adds model l
-000040b0: 6179 6572 733a 0a0a 2020 2020 2020 2020  ayers:..        
-000040c0: 2a20 2a2a 6879 6472 6f64 656d 2a2a 206d  * **hydrodem** m
-000040d0: 6170 3a20 6879 6472 6f6c 6f67 6963 616c  ap: hydrological
-000040e0: 6c79 2063 6f6e 6469 7469 6f6e 6564 2065  ly conditioned e
-000040f0: 6c65 7661 7469 6f6e 205b 6d2b 5245 465d  levation [m+REF]
-00004100: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00004110: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00004120: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00004130: 2065 6c65 7674 6e5f 6d61 703a 207b 2277   elevtn_map: {"w
-00004140: 666c 6f77 5f64 656d 222c 2022 6465 6d5f  flow_dem", "dem_
-00004150: 7375 6267 7269 6422 7d0a 2020 2020 2020  subgrid"}.      
-00004160: 2020 2020 2020 4e61 6d65 206f 6620 7374        Name of st
-00004170: 6174 6963 6d61 7020 746f 2068 7964 726f  aticmap to hydro
-00004180: 6c6f 6769 6361 6c6c 7920 636f 6e64 6974  logically condit
-00004190: 696f 6e2c 2062 7920 6465 6661 756c 7420  ion, by default 
-000041a0: 2277 666c 6f77 5f64 656d 222e 0a20 2020  "wflow_dem"..   
-000041b0: 2020 2020 2072 6976 6572 5f72 6f75 7469       river_routi
-000041c0: 6e67 2c20 6c61 6e64 5f72 6f75 7469 6e67  ng, land_routing
-000041d0: 203a 207b 226b 696e 656d 6174 6963 2d77   : {"kinematic-w
-000041e0: 6176 6522 2c20 226c 6f63 616c 2d69 6e65  ave", "local-ine
-000041f0: 7274 6961 6c22 7d0a 2020 2020 2020 2020  rtial"}.        
-00004200: 2020 2020 6368 616e 6765 7320 7766 6c6f      changes wflo
-00004210: 7720 636f 6e66 6967 206d 6f64 656c 2e72  w config model.r
-00004220: 6976 6572 5f72 6f75 7469 6e67 2028 6279  iver_routing (by
-00004230: 2064 6566 6175 6c74 2022 6c6f 6361 6c2d   default "local-
-00004240: 696e 6572 7469 616c 2229 0a20 2020 2020  inertial").     
-00004250: 2020 2020 2020 2061 6e64 206d 6f64 656c         and model
-00004260: 2e6c 616e 645f 726f 7574 696e 6720 2864  .land_routing (d
-00004270: 6566 6175 6c74 2022 6b69 6e65 6d61 7469  efault "kinemati
-00004280: 632d 7761 7665 2229 0a0a 2020 2020 2020  c-wave")..      
-00004290: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-000042a0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-000042b0: 2020 2020 6879 6472 6f6d 742e 666c 772e      hydromt.flw.
-000042c0: 6465 6d5f 6164 6a75 7374 0a20 2020 2020  dem_adjust.     
-000042d0: 2020 2070 7966 6c77 6469 722e 466c 7764     pyflwdir.Flwd
-000042e0: 6972 5261 7374 6572 2e64 656d 5f61 646a  irRaster.dem_adj
-000042f0: 7573 740a 2020 2020 2020 2020 2222 220a  ust.        """.
-00004300: 2020 2020 2020 2020 725f 6c69 7374 203d          r_list =
-00004310: 205b 226b 696e 656d 6174 6963 2d77 6176   ["kinematic-wav
-00004320: 6522 2c20 226c 6f63 616c 2d69 6e65 7274  e", "local-inert
-00004330: 6961 6c22 5d0a 2020 2020 2020 2020 6966  ial"].        if
-00004340: 206e 6f74 2065 6c65 7674 6e5f 6d61 7020   not elevtn_map 
-00004350: 696e 2073 656c 662e 7374 6174 6963 6d61  in self.staticma
-00004360: 7073 3a0a 2020 2020 2020 2020 2020 2020  ps:.            
-00004370: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00004380: 2866 2722 7b65 6c65 7674 6e5f 6d61 707d  (f'"{elevtn_map}
-00004390: 2220 6e6f 7420 666f 756e 6420 696e 2073  " not found in s
-000043a0: 7461 7469 636d 6170 7327 290a 2020 2020  taticmaps').    
-000043b0: 2020 2020 6966 2072 6976 6572 5f72 6f75      if river_rou
-000043c0: 7469 6e67 206e 6f74 2069 6e20 725f 6c69  ting not in r_li
-000043d0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-000043e0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000043f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00004400: 2020 6627 7269 7665 725f 726f 7574 696e    f'river_routin
-00004410: 673d 227b 7269 7665 725f 726f 7574 696e  g="{river_routin
-00004420: 677d 2220 756e 6b6e 6f77 6e2e 2053 656c  g}" unknown. Sel
-00004430: 6563 7420 6672 6f6d 207b 725f 6c69 7374  ect from {r_list
-00004440: 7d2e 270a 2020 2020 2020 2020 2020 2020  }.'.            
-00004450: 290a 2020 2020 2020 2020 6966 206c 616e  ).        if lan
-00004460: 645f 726f 7574 696e 6720 6e6f 7420 696e  d_routing not in
-00004470: 2072 5f6c 6973 743a 0a20 2020 2020 2020   r_list:.       
-00004480: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00004490: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-000044a0: 2020 2020 2020 2066 276c 616e 645f 726f         f'land_ro
-000044b0: 7574 696e 673d 227b 6c61 6e64 5f72 6f75  uting="{land_rou
-000044c0: 7469 6e67 7d22 2075 6e6b 6e6f 776e 2e20  ting}" unknown. 
-000044d0: 5365 6c65 6374 2066 726f 6d20 7b72 5f6c  Select from {r_l
-000044e0: 6973 747d 2e27 0a20 2020 2020 2020 2020  ist}.'.         
-000044f0: 2020 2029 0a0a 2020 2020 2020 2020 706f     )..        po
-00004500: 7374 6669 7820 3d20 7b22 7766 6c6f 775f  stfix = {"wflow_
-00004510: 6465 6d22 3a20 225f 6176 6722 2c20 2264  dem": "_avg", "d
-00004520: 656d 5f73 7562 6772 6964 223a 2022 5f73  em_subgrid": "_s
-00004530: 7562 6772 6964 227d 2e67 6574 2865 6c65  ubgrid"}.get(ele
-00004540: 7674 6e5f 6d61 702c 2022 2229 0a20 2020  vtn_map, "").   
-00004550: 2020 2020 206e 616d 6520 3d20 6622 6879       name = f"hy
-00004560: 6472 6f64 656d 7b70 6f73 7466 6978 7d22  drodem{postfix}"
-00004570: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-00004580: 6f67 6765 722e 696e 666f 2866 2250 7265  ogger.info(f"Pre
-00004590: 7061 7269 6e67 207b 6e61 6d65 7d20 6d61  paring {name} ma
-000045a0: 7020 666f 7220 726f 7574 696e 672e 2229  p for routing.")
-000045b0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-000045c0: 6976 6974 7920 3d20 7b22 6c6f 6361 6c2d  ivity = {"local-
-000045d0: 696e 6572 7469 616c 223a 2034 2c20 226b  inertial": 4, "k
-000045e0: 696e 656d 6174 6963 2d77 6176 6522 3a20  inematic-wave": 
-000045f0: 387d 5b6c 616e 645f 726f 7574 696e 675d  8}[land_routing]
-00004600: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-00004610: 6622 6879 6472 6f64 656d 7b70 6f73 7466  f"hydrodem{postf
-00004620: 6978 7d5f 447b 636f 6e6e 6563 7469 7669  ix}_D{connectivi
-00004630: 7479 7d22 0a20 2020 2020 2020 2073 656c  ty}".        sel
-00004640: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
-00004650: 5072 6570 6172 696e 6720 7b6e 616d 657d  Preparing {name}
-00004660: 206d 6170 2066 6f72 2072 6f75 7469 6e67   map for routing
-00004670: 2e22 290a 2020 2020 2020 2020 6473 5f6f  .").        ds_o
-00004680: 7574 203d 2066 6c77 2e64 656d 5f61 646a  ut = flw.dem_adj
-00004690: 7573 7428 0a20 2020 2020 2020 2020 2020  ust(.           
-000046a0: 2064 615f 666c 7764 6972 3d73 656c 662e   da_flwdir=self.
-000046b0: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
-000046c0: 5f4d 4150 535b 2266 6c77 6469 7222 5d5d  _MAPS["flwdir"]]
-000046d0: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-000046e0: 5f65 6c65 7674 6e3d 7365 6c66 2e73 7461  _elevtn=self.sta
-000046f0: 7469 636d 6170 735b 656c 6576 746e 5f6d  ticmaps[elevtn_m
-00004700: 6170 5d2c 0a20 2020 2020 2020 2020 2020  ap],.           
-00004710: 2064 615f 7269 766d 736b 3d73 656c 662e   da_rivmsk=self.
-00004720: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
-00004730: 5f4d 4150 535b 2272 6976 6d73 6b22 5d5d  _MAPS["rivmsk"]]
-00004740: 2c0a 2020 2020 2020 2020 2020 2020 666c  ,.            fl
-00004750: 7764 6972 3d73 656c 662e 666c 7764 6972  wdir=self.flwdir
-00004760: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00004770: 6e6e 6563 7469 7669 7479 3d63 6f6e 6e65  nnectivity=conne
-00004780: 6374 6976 6974 792c 0a20 2020 2020 2020  ctivity,.       
-00004790: 2020 2020 2072 6976 6572 5f64 383d 5472       river_d8=Tr
-000047a0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-000047b0: 6c6f 6767 6572 3d73 656c 662e 6c6f 6767  logger=self.logg
-000047c0: 6572 2c0a 2020 2020 2020 2020 292e 7265  er,.        ).re
-000047d0: 6e61 6d65 286e 616d 6529 0a20 2020 2020  name(name).     
-000047e0: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
-000047f0: 6963 6d61 7073 2864 735f 6f75 7429 0a0a  icmaps(ds_out)..
-00004800: 2020 2020 2020 2020 2320 7570 6461 7465          # update
-00004810: 2074 6f6d 6c20 6d6f 6465 6c2e 7269 7665   toml model.rive
-00004820: 725f 726f 7574 696e 670a 2020 2020 2020  r_routing.      
-00004830: 2020 7365 6c66 2e6c 6f67 6765 722e 6465    self.logger.de
-00004840: 6275 6728 6627 5570 6461 7465 2077 666c  bug(f'Update wfl
-00004850: 6f77 2063 6f6e 6669 6720 6d6f 6465 6c2e  ow config model.
-00004860: 7269 7665 725f 726f 7574 696e 673d 227b  river_routing="{
-00004870: 7269 7665 725f 726f 7574 696e 677d 2227  river_routing}"'
-00004880: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-00004890: 6574 5f63 6f6e 6669 6728 226d 6f64 656c  et_config("model
-000048a0: 2e72 6976 6572 5f72 6f75 7469 6e67 222c  .river_routing",
-000048b0: 2072 6976 6572 5f72 6f75 7469 6e67 290a   river_routing).
-000048c0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-000048d0: 6765 722e 6465 6275 6728 6627 5570 6461  ger.debug(f'Upda
-000048e0: 7465 2077 666c 6f77 2063 6f6e 6669 6720  te wflow config 
-000048f0: 6d6f 6465 6c2e 6c61 6e64 5f72 6f75 7469  model.land_routi
-00004900: 6e67 3d22 7b6c 616e 645f 726f 7574 696e  ng="{land_routin
-00004910: 677d 2227 290a 2020 2020 2020 2020 7365  g}"').        se
-00004920: 6c66 2e73 6574 5f63 6f6e 6669 6728 226d  lf.set_config("m
-00004930: 6f64 656c 2e6c 616e 645f 726f 7574 696e  odel.land_routin
-00004940: 6722 2c20 6c61 6e64 5f72 6f75 7469 6e67  g", land_routing
-00004950: 290a 2020 2020 2020 2020 6966 2072 6976  ).        if riv
-00004960: 6572 5f72 6f75 7469 6e67 203d 3d20 226c  er_routing == "l
-00004970: 6f63 616c 2d69 6e65 7274 6961 6c22 3a0a  ocal-inertial":.
-00004980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004990: 2e73 6574 5f63 6f6e 6669 6728 2269 6e70  .set_config("inp
-000049a0: 7574 2e6c 6174 6572 616c 2e72 6976 6572  ut.lateral.river
-000049b0: 2e62 616e 6b66 756c 6c5f 6465 7074 6822  .bankfull_depth"
-000049c0: 2c20 7365 6c66 2e5f 4d41 5053 5b22 7269  , self._MAPS["ri
-000049d0: 7664 7068 225d 290a 2020 2020 2020 2020  vdph"]).        
-000049e0: 2020 2020 7365 6c66 2e73 6574 5f63 6f6e      self.set_con
-000049f0: 6669 6728 2269 6e70 7574 2e6c 6174 6572  fig("input.later
-00004a00: 616c 2e72 6976 6572 2e62 616e 6b66 756c  al.river.bankful
-00004a10: 6c5f 656c 6576 6174 696f 6e22 2c20 6e61  l_elevation", na
-00004a20: 6d65 290a 2020 2020 2020 2020 6966 206c  me).        if l
-00004a30: 616e 645f 726f 7574 696e 6720 3d3d 2022  and_routing == "
-00004a40: 6c6f 6361 6c2d 696e 6572 7469 616c 223a  local-inertial":
-00004a50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00004a60: 662e 7365 745f 636f 6e66 6967 2822 696e  f.set_config("in
-00004a70: 7075 742e 6c61 7465 7261 6c2e 6c61 6e64  put.lateral.land
-00004a80: 2e65 6c65 7661 7469 6f6e 222c 206e 616d  .elevation", nam
-00004a90: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00004aa0: 656c 662e 636f 6e66 6967 5b22 7374 6174  elf.config["stat
-00004ab0: 6522 5d5b 226c 6174 6572 616c 225d 5b22  e"]["lateral"]["
-00004ac0: 6c61 6e64 225d 2e70 6f70 2822 7122 2c20  land"].pop("q", 
-00004ad0: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00004ae0: 2020 7365 6c66 2e63 6f6e 6669 675b 226f    self.config["o
-00004af0: 7574 7075 7422 5d5b 226c 6174 6572 616c  utput"]["lateral
-00004b00: 225d 5b22 6c61 6e64 225d 2e70 6f70 2822  "]["land"].pop("
-00004b10: 7122 2c20 4e6f 6e65 290a 2020 2020 2020  q", None).      
-00004b20: 2020 2020 2020 7365 6c66 2e73 6574 5f63        self.set_c
-00004b30: 6f6e 6669 6728 2273 7461 7465 2e6c 6174  onfig("state.lat
-00004b40: 6572 616c 2e6c 616e 642e 7178 222c 2022  eral.land.qx", "
-00004b50: 7178 5f6c 616e 6422 290a 2020 2020 2020  qx_land").      
-00004b60: 2020 2020 2020 7365 6c66 2e73 6574 5f63        self.set_c
-00004b70: 6f6e 6669 6728 2273 7461 7465 2e6c 6174  onfig("state.lat
-00004b80: 6572 616c 2e6c 616e 642e 7179 222c 2022  eral.land.qy", "
-00004b90: 7179 5f6c 616e 6422 290a 2020 2020 2020  qy_land").      
-00004ba0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004bb0: 2020 2020 7365 6c66 2e63 6f6e 6669 675b      self.config[
-00004bc0: 2273 7461 7465 225d 5b22 6c61 7465 7261  "state"]["latera
-00004bd0: 6c22 5d5b 226c 616e 6422 5d2e 706f 7028  l"]["land"].pop(
-00004be0: 2271 7822 2c20 4e6f 6e65 290a 2020 2020  "qx", None).    
-00004bf0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00004c00: 6669 675b 2273 7461 7465 225d 5b22 6c61  fig["state"]["la
-00004c10: 7465 7261 6c22 5d5b 226c 616e 6422 5d2e  teral"]["land"].
-00004c20: 706f 7028 2271 7922 2c20 4e6f 6e65 290a  pop("qy", None).
-00004c30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004c40: 2e63 6f6e 6669 675b 226f 7574 7075 7422  .config["output"
-00004c50: 5d5b 226c 6174 6572 616c 225d 5b22 6c61  ]["lateral"]["la
-00004c60: 6e64 225d 2e70 6f70 2822 7178 222c 204e  nd"].pop("qx", N
-00004c70: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-00004c80: 2073 656c 662e 636f 6e66 6967 5b22 6f75   self.config["ou
-00004c90: 7470 7574 225d 5b22 6c61 7465 7261 6c22  tput"]["lateral"
-00004ca0: 5d5b 226c 616e 6422 5d2e 706f 7028 2271  ]["land"].pop("q
-00004cb0: 7922 2c20 4e6f 6e65 290a 2020 2020 2020  y", None).      
-00004cc0: 2020 2020 2020 7365 6c66 2e73 6574 5f63        self.set_c
-00004cd0: 6f6e 6669 6728 2273 7461 7465 2e6c 6174  onfig("state.lat
-00004ce0: 6572 616c 2e6c 616e 642e 7122 2c20 2271  eral.land.q", "q
-00004cf0: 5f6c 616e 6422 290a 0a20 2020 2064 6566  _land")..    def
-00004d00: 2073 6574 7570 5f72 6976 6572 7769 6474   setup_riverwidt
-00004d10: 6828 0a20 2020 2020 2020 2073 656c 662c  h(.        self,
-00004d20: 0a20 2020 2020 2020 2070 7265 6469 6374  .        predict
-00004d30: 6f72 3d22 6469 7363 6861 7267 6522 2c0a  or="discharge",.
-00004d40: 2020 2020 2020 2020 6669 6c6c 3d46 616c          fill=Fal
-00004d50: 7365 2c0a 2020 2020 2020 2020 6669 743d  se,.        fit=
-00004d60: 4661 6c73 652c 0a20 2020 2020 2020 206d  False,.        m
-00004d70: 696e 5f77 7468 3d31 2e30 2c0a 2020 2020  in_wth=1.0,.    
-00004d80: 2020 2020 7072 6563 6970 5f66 6e3d 2263      precip_fn="c
-00004d90: 6865 6c73 6122 2c0a 2020 2020 2020 2020  helsa",.        
-00004da0: 636c 696d 6174 655f 666e 3d22 6b6f 7070  climate_fn="kopp
-00004db0: 656e 5f67 6569 6765 7222 2c0a 2020 2020  en_geiger",.    
-00004dc0: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
-00004dd0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00004de0: 0a20 2020 2020 2020 2054 6869 7320 636f  .        This co
-00004df0: 6d70 6f6e 656e 7420 7365 7473 2074 6865  mponent sets the
-00004e00: 2072 6976 6572 2077 6964 7468 2070 6172   river width par
-00004e10: 616d 6574 6572 2062 6173 6564 206f 6e20  ameter based on 
-00004e20: 6120 706f 7765 722d 6c61 7920 7265 6c61  a power-lay rela
-00004e30: 7469 6f6e 7368 6970 2077 6974 6820 6120  tionship with a 
-00004e40: 7072 6564 6963 746f 722e 0a0a 2020 2020  predictor...    
-00004e50: 2020 2020 4279 2064 6566 6175 6c74 2074      By default t
-00004e60: 6865 2072 6976 6572 7769 6474 6820 6973  he riverwidth is
-00004e70: 2065 7374 696d 6174 6564 2062 6173 6564   estimated based
-00004e80: 206f 6e20 6469 7363 6861 7267 6520 6173   on discharge as
-00004e90: 2060 6070 7265 6469 6374 6f72 6060 2061   ``predictor`` a
-00004ea0: 6e64 2075 7365 6420 746f 0a20 2020 2020  nd used to.     
-00004eb0: 2020 2073 6574 2074 6865 2072 6976 6572     set the river
-00004ec0: 7769 6474 6820 676c 6f62 616c 6c79 2062  width globally b
-00004ed0: 6173 6564 206f 6e20 7072 652d 6465 6669  ased on pre-defi
-00004ee0: 6e65 6420 706f 7765 722d 6c61 7720 7061  ned power-law pa
-00004ef0: 7261 6d65 7465 7273 2070 6572 2063 6c69  rameters per cli
-00004f00: 6d61 7465 2063 6c61 7373 2e0a 2020 2020  mate class..    
-00004f10: 2020 2020 5769 7468 2060 6066 6974 6060      With ``fit``
-00004f20: 2073 6574 2074 6f20 5472 7565 2c20 7468   set to True, th
-00004f30: 6520 706f 7765 722d 6c61 7720 7265 6c61  e power-law rela
-00004f40: 7469 6f6e 7373 6869 7020 7061 7261 6d74  tionsship paramt
-00004f50: 6572 7320 6172 6520 7365 7420 6f6e 2d74  ers are set on-t
-00004f60: 6865 2d66 6c79 2e0a 2020 2020 2020 2020  he-fly..        
-00004f70: 5769 7468 2060 6066 696c 6c60 6020 7365  With ``fill`` se
-00004f80: 7420 746f 2054 7275 652c 2074 6865 2065  t to True, the e
-00004f90: 7374 696d 6174 6564 2072 6976 6572 2077  stimated river w
-00004fa0: 6964 7468 7320 6172 6520 6f6e 6c79 2075  idths are only u
-00004fb0: 7365 6420 6669 6c6c 2067 6170 7320 696e  sed fill gaps in
-00004fc0: 2074 6865 0a20 2020 2020 2020 206f 6273   the.        obs
-00004fd0: 6572 7665 6420 6461 7461 2e20 416c 7465  erved data. Alte
-00004fe0: 726e 6174 6976 6520 6060 7072 6564 6963  rnative ``predic
-00004ff0: 746f 7260 6020 7661 6c75 6573 2061 7265  tor`` values are
-00005000: 2070 7265 6369 7020 2861 6363 756d 756c   precip (accumul
-00005010: 6174 6564 2070 7265 6369 7069 7461 7469  ated precipitati
-00005020: 6f6e 290a 2020 2020 2020 2020 616e 6420  on).        and 
-00005030: 7570 6172 6561 2028 7570 7374 7265 616d  uparea (upstream
-00005040: 2061 7265 6129 2e20 466f 7220 7468 6573   area). For thes
-00005050: 6520 7072 6564 6963 746f 7273 2076 616c  e predictors val
-00005060: 7565 7320 6060 6669 7460 6020 6465 6661  ues ``fit`` defa
-00005070: 756c 7420 746f 2054 7275 652e 0a20 2020  ult to True..   
-00005080: 2020 2020 2042 7920 6465 6661 756c 7420       By default 
-00005090: 7468 6520 7072 6564 6963 746f 7220 6973  the predictor is
-000050a0: 2062 6173 6564 206f 6e20 6469 7363 6861   based on discha
-000050b0: 7267 6520 7768 6963 6820 6973 2065 7374  rge which is est
-000050c0: 696d 6174 6564 2074 6872 6f75 6768 206d  imated through m
-000050d0: 756c 7469 706c 6520 6c69 6e65 6172 0a20  ultiple linear. 
-000050e0: 2020 2020 2020 2072 6567 7265 7373 696f         regressio
-000050f0: 6e20 7769 7468 2070 7265 6369 7069 7461  n with precipita
-00005100: 7469 6f6e 2061 6e64 2075 7073 7472 6561  tion and upstrea
-00005110: 6d20 6172 6561 2070 6572 2063 6c69 6d61  m area per clima
-00005120: 7465 207a 6f6e 652e 0a0a 2020 2020 2020  te zone...      
-00005130: 2020 2a20 2a2a 7766 6c6f 775f 7269 7665    * **wflow_rive
-00005140: 7277 6964 7468 2a2a 206d 6170 3a20 7269  rwidth** map: ri
-00005150: 7665 7220 7769 6474 6820 5b6d 5d0a 0a20  ver width [m].. 
-00005160: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00005170: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00005180: 2d2d 2d2d 0a20 2020 2020 2020 2070 7265  ----.        pre
-00005190: 6469 6374 6f72 203a 207b 2264 6973 6368  dictor : {"disch
-000051a0: 6172 6765 222c 2022 7072 6563 6970 222c  arge", "precip",
-000051b0: 2022 7570 6172 6561 227d 0a20 2020 2020   "uparea"}.     
-000051c0: 2020 2020 2020 2050 7265 6469 6374 6f72         Predictor
-000051d0: 2075 7365 6420 696e 2074 6865 2070 6f77   used in the pow
-000051e0: 6572 2d6c 6177 2065 7175 6174 696f 6e3a  er-law equation:
-000051f0: 2077 6964 7468 203d 2061 202a 2070 7265   width = a * pre
-00005200: 6469 6374 6f72 205e 2062 2e0a 2020 2020  dictor ^ b..    
-00005210: 2020 2020 2020 2020 4469 7363 6861 7267          Discharg
-00005220: 6520 6973 2062 6173 6564 206f 6e20 6d75  e is based on mu
-00005230: 6c74 6970 6c65 206c 696e 6561 7220 7265  ltiple linear re
-00005240: 6772 6573 7369 6f6e 2070 6572 2063 6c69  gression per cli
-00005250: 6d61 7465 207a 6f6e 652e 0a20 2020 2020  mate zone..     
-00005260: 2020 2020 2020 2050 7265 6369 7020 6973         Precip is
-00005270: 2062 6173 6564 206f 6e20 7468 6520 3130   based on the 10
-00005280: 7820 7468 6520 6461 696c 7920 6176 6572  x the daily aver
-00005290: 6167 6520 6163 6375 6d75 6c61 7465 6420  age accumulated 
-000052a0: 7072 6563 6970 6974 6174 696f 6e20 5b6d  precipitation [m
-000052b0: 332f 735d 2e0a 2020 2020 2020 2020 2020  3/s]..          
-000052c0: 2020 5570 6172 6561 2069 7320 6261 7365    Uparea is base
-000052d0: 6420 6f6e 2074 6865 2075 7073 7472 6561  d on the upstrea
-000052e0: 6d20 6172 6561 2067 7269 6420 5b6b 6d32  m area grid [km2
-000052f0: 5d2e 0a20 2020 2020 2020 2020 2020 204f  ]..            O
-00005300: 7468 6572 2076 6172 6961 626c 6573 2c20  ther variables, 
-00005310: 652e 672e 2062 616e 6b66 756c 6c20 6469  e.g. bankfull di
-00005320: 7363 6861 7267 652c 2063 616e 2061 6c73  scharge, can als
-00005330: 6f20 6265 2070 726f 7669 6465 6420 6966  o be provided if
-00005340: 2070 7265 7365 6e74 2069 6e20 7468 6520   present in the 
-00005350: 7374 6174 6963 6d61 7073 0a20 2020 2020  staticmaps.     
-00005360: 2020 2066 696c 6c20 3a20 626f 6f6c 2c20     fill : bool, 
-00005370: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00005380: 2020 2020 2049 6620 5472 7565 2028 6465       If True (de
-00005390: 6661 756c 7429 2c20 7573 6520 6573 7469  fault), use esti
-000053a0: 6d61 7465 2074 6f20 6669 6c6c 2067 6170  mate to fill gap
-000053b0: 732c 206f 7574 6c69 6572 7320 616e 6420  s, outliers and 
-000053c0: 6c61 6b65 2f72 6573 2061 7265 6173 2069  lake/res areas i
-000053d0: 6e20 6f62 7365 7276 6564 2077 6964 7468  n observed width
-000053e0: 2064 6174 6120 2869 6620 7072 6573 656e   data (if presen
-000053f0: 7429 3b0a 2020 2020 2020 2020 2020 2020  t);.            
-00005400: 6966 2046 616c 7365 2c20 7365 7420 616c  if False, set al
-00005410: 6c20 7269 7665 7277 6964 7468 7320 6261  l riverwidths ba
-00005420: 7365 6420 6f6e 2070 7265 6469 6374 6f72  sed on predictor
-00005430: 2028 6175 746f 6d61 7469 6320 6368 6f69   (automatic choi
-00005440: 6365 2069 6620 6e6f 206f 6273 6572 7661  ce if no observa
-00005450: 7469 6f6e 7320 666f 756e 6429 0a20 2020  tions found).   
-00005460: 2020 2020 2066 6974 203a 2062 6f6f 6c2c       fit : bool,
-00005470: 206f 7074 696f 6e61 6c20 6b77 6172 670a   optional kwarg.
-00005480: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00005490: 7275 652c 2074 6865 2070 6f77 6572 2d6c  rue, the power-l
-000054a0: 6177 2070 6172 616d 6574 6572 7320 6172  aw parameters ar
-000054b0: 6520 6669 7474 6564 206f 6e20 7468 6520  e fitted on the 
-000054c0: 666c 790a 2020 2020 2020 2020 2020 2020  fly.            
-000054d0: 4279 2064 6566 6175 6c74 2054 7275 6520  By default True 
-000054e0: 666f 7220 616c 6c20 6275 7420 2264 6973  for all but "dis
-000054f0: 6368 6172 6765 2220 7072 6564 6963 746f  charge" predicto
-00005500: 722e 0a20 2020 2020 2020 2020 2020 2041  r..            A
-00005510: 2d70 7269 6f72 6920 6465 7269 7665 6420  -priori derived 
-00005520: 7061 7261 6d65 7465 7273 2077 696c 6c20  parameters will 
-00005530: 6265 206f 7665 7277 7269 7474 656e 2069  be overwritten i
-00005540: 6620 5472 7565 2e0a 2020 2020 2020 2020  f True..        
-00005550: 612c 2062 203a 2066 6c6f 6174 2c20 6f70  a, b : float, op
-00005560: 7469 6f6e 616c 206b 7761 7267 0a20 2020  tional kwarg.   
-00005570: 2020 2020 2020 2020 204d 616e 7561 6c20           Manual 
-00005580: 706f 7765 722d 6c61 7720 7061 7261 6d65  power-law parame
-00005590: 7465 7273 0a20 2020 2020 2020 206d 696e  ters.        min
-000055a0: 5f77 7468 203a 2066 6c6f 6174 0a20 2020  _wth : float.   
-000055b0: 2020 2020 2020 2020 206d 696e 696d 756d           minimum
-000055c0: 2072 6976 6572 2077 6964 7468 0a20 2020   river width.   
-000055d0: 2020 2020 2070 7265 6369 705f 666e 203a       precip_fn :
-000055e0: 207b 2763 6865 6c73 6127 7d0a 2020 2020   {'chelsa'}.    
-000055f0: 2020 2020 2020 2020 536f 7572 6365 206f          Source o
-00005600: 6620 6c6f 6e67 2074 6572 6d20 7072 6563  f long term prec
-00005610: 6970 6974 6174 696f 6e20 6772 6964 2069  ipitation grid i
-00005620: 6620 7468 6520 7072 6564 6963 746f 7220  f the predictor 
-00005630: 6973 2073 6574 2074 6f20 2764 6973 6368  is set to 'disch
-00005640: 6172 6765 2720 6f72 2027 7072 6563 6970  arge' or 'precip
-00005650: 272e 0a20 2020 2020 2020 2063 6c69 6d61  '..        clima
-00005660: 7465 5f66 6e3a 207b 276b 6f70 7065 6e5f  te_fn: {'koppen_
-00005670: 6765 6967 6572 277d 0a20 2020 2020 2020  geiger'}.       
-00005680: 2020 2020 2053 6f75 7263 6520 6f66 206c       Source of l
-00005690: 6f6e 672d 7465 726d 2063 6c69 6d61 7465  ong-term climate
-000056a0: 2067 7269 6420 6966 2074 6865 2070 7265   grid if the pre
-000056b0: 6469 6374 6f72 2069 7320 7365 7420 746f  dictor is set to
-000056c0: 2027 6469 7363 6861 7267 6527 2e0a 2020   'discharge'..  
-000056d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000056e0: 2020 7365 6c66 2e6c 6f67 6765 722e 7761    self.logger.wa
-000056f0: 726e 696e 6728 0a20 2020 2020 2020 2020  rning(.         
-00005700: 2020 2027 5468 6520 2273 6574 7570 5f72     'The "setup_r
-00005710: 6976 6572 7769 6474 6822 206d 6574 686f  iverwidth" metho
-00005720: 6420 6861 7320 6265 656e 2064 6570 7265  d has been depre
-00005730: 6361 7465 6420 616e 6420 7769 6c6c 2073  cated and will s
-00005740: 6f6f 6e20 6265 2072 656d 6f76 6564 2e20  oon be removed. 
-00005750: 270a 2020 2020 2020 2020 2020 2020 2759  '.            'Y
-00005760: 6f75 2063 616e 206e 6f77 2075 7365 2074  ou can now use t
-00005770: 6865 2022 7365 7475 705f 7269 7665 7222  he "setup_river"
-00005780: 206d 6574 686f 6420 666f 7220 616c 6c20   method for all 
-00005790: 7269 7665 7220 7061 7261 6d65 7465 7273  river parameters
-000057a0: 2e27 0a20 2020 2020 2020 2029 0a20 2020  .'.        ).   
-000057b0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000057c0: 2e5f 4d41 5053 5b22 7269 766d 736b 225d  ._MAPS["rivmsk"]
-000057d0: 2069 6e20 7365 6c66 2e73 7461 7469 636d   in self.staticm
-000057e0: 6170 733a 0a20 2020 2020 2020 2020 2020  aps:.           
-000057f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00005800: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00005810: 2020 2027 5468 6520 2273 6574 7570 5f72     'The "setup_r
-00005820: 6976 6572 7769 6474 6822 206d 6574 686f  iverwidth" metho
-00005830: 6420 7265 7175 6972 6573 2074 6f20 7275  d requires to ru
-00005840: 6e20 7365 7475 705f 7269 7665 7220 6d65  n setup_river me
-00005850: 7468 6f64 2066 6972 7374 2e27 0a20 2020  thod first.'.   
-00005860: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00005870: 2020 2020 2320 6465 7269 7665 2072 6976      # derive riv
-00005880: 6572 2077 6964 7468 0a20 2020 2020 2020  er width.       
-00005890: 2064 6174 6120 3d20 7b7d 0a20 2020 2020   data = {}.     
-000058a0: 2020 2069 6620 7072 6564 6963 746f 7220     if predictor 
-000058b0: 696e 205b 2264 6973 6368 6172 6765 222c  in ["discharge",
-000058c0: 2022 7072 6563 6970 225d 3a0a 2020 2020   "precip"]:.    
-000058d0: 2020 2020 2020 2020 6461 5f70 7265 6369          da_preci
-000058e0: 7020 3d20 7365 6c66 2e64 6174 615f 6361  p = self.data_ca
-000058f0: 7461 6c6f 672e 6765 745f 7261 7374 6572  talog.get_raster
-00005900: 6461 7461 7365 7428 0a20 2020 2020 2020  dataset(.       
-00005910: 2020 2020 2020 2020 2070 7265 6369 705f           precip_
-00005920: 666e 2c20 6765 6f6d 3d73 656c 662e 7265  fn, geom=self.re
-00005930: 6769 6f6e 2c20 6275 6666 6572 3d32 0a20  gion, buffer=2. 
-00005940: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00005950: 2020 2020 2020 2020 2064 615f 7072 6563           da_prec
-00005960: 6970 2e6e 616d 6520 3d20 7072 6563 6970  ip.name = precip
-00005970: 5f66 6e0a 2020 2020 2020 2020 2020 2020  _fn.            
-00005980: 6461 7461 5b22 6461 5f70 7265 6369 7022  data["da_precip"
-00005990: 5d20 3d20 6461 5f70 7265 6369 700a 2020  ] = da_precip.  
-000059a0: 2020 2020 2020 6966 2070 7265 6469 6374        if predict
-000059b0: 6f72 203d 3d20 2264 6973 6368 6172 6765  or == "discharge
-000059c0: 223a 0a20 2020 2020 2020 2020 2020 2064  ":.            d
-000059d0: 615f 636c 696d 6174 6520 3d20 7365 6c66  a_climate = self
-000059e0: 2e64 6174 615f 6361 7461 6c6f 672e 6765  .data_catalog.ge
-000059f0: 745f 7261 7374 6572 6461 7461 7365 7428  t_rasterdataset(
-00005a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a10: 2063 6c69 6d61 7465 5f66 6e2c 2067 656f   climate_fn, geo
-00005a20: 6d3d 7365 6c66 2e72 6567 696f 6e2c 2062  m=self.region, b
-00005a30: 7566 6665 723d 320a 2020 2020 2020 2020  uffer=2.        
-00005a40: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00005a50: 2020 6461 5f63 6c69 6d61 7465 2e6e 616d    da_climate.nam
-00005a60: 6520 3d20 636c 696d 6174 655f 666e 0a20  e = climate_fn. 
-00005a70: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-00005a80: 2264 615f 636c 696d 6174 6522 5d20 3d20  "da_climate"] = 
-00005a90: 6461 5f63 6c69 6d61 7465 0a0a 2020 2020  da_climate..    
-00005aa0: 2020 2020 696e 765f 7265 6e61 6d65 203d      inv_rename =
-00005ab0: 207b 763a 206b 2066 6f72 206b 2c20 7620   {v: k for k, v 
-00005ac0: 696e 2073 656c 662e 5f4d 4150 532e 6974  in self._MAPS.it
-00005ad0: 656d 7328 2920 6966 2076 2069 6e20 7365  ems() if v in se
-00005ae0: 6c66 2e73 7461 7469 636d 6170 737d 0a20  lf.staticmaps}. 
-00005af0: 2020 2020 2020 2064 615f 7269 7677 7468         da_rivwth
-00005b00: 203d 2077 6f72 6b66 6c6f 7773 2e72 6976   = workflows.riv
-00005b10: 6572 5f77 6964 7468 280a 2020 2020 2020  er_width(.      
-00005b20: 2020 2020 2020 6473 5f6c 696b 653d 7365        ds_like=se
-00005b30: 6c66 2e73 7461 7469 636d 6170 732e 7265  lf.staticmaps.re
-00005b40: 6e61 6d65 2869 6e76 5f72 656e 616d 6529  name(inv_rename)
-00005b50: 2c0a 2020 2020 2020 2020 2020 2020 666c  ,.            fl
-00005b60: 7764 6972 3d73 656c 662e 666c 7764 6972  wdir=self.flwdir
-00005b70: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-00005b80: 7461 3d64 6174 612c 0a20 2020 2020 2020  ta=data,.       
-00005b90: 2020 2020 2066 696c 6c3d 6669 6c6c 2c0a       fill=fill,.
-00005ba0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-00005bb0: 5f6f 7574 6c69 6572 733d 6b77 6172 6773  _outliers=kwargs
-00005bc0: 2e70 6f70 2822 6669 6c6c 5f6f 7574 6c69  .pop("fill_outli
-00005bd0: 6572 7322 2c20 6669 6c6c 292c 0a20 2020  ers", fill),.   
-00005be0: 2020 2020 2020 2020 206d 696e 5f77 7468           min_wth
-00005bf0: 3d6d 696e 5f77 7468 2c0a 2020 2020 2020  =min_wth,.      
-00005c00: 2020 2020 2020 6d61 736b 5f6e 616d 6573        mask_names
-00005c10: 3d5b 226c 616b 6561 7265 6173 222c 2022  =["lakeareas", "
-00005c20: 7265 7361 7265 6173 222c 2022 676c 6163  resareas", "glac
-00005c30: 6172 6561 7322 5d2c 0a20 2020 2020 2020  areas"],.       
-00005c40: 2020 2020 2070 7265 6469 6374 6f72 3d70       predictor=p
-00005c50: 7265 6469 6374 6f72 2c0a 2020 2020 2020  redictor,.      
-00005c60: 2020 2020 2020 613d 6b77 6172 6773 2e67        a=kwargs.g
-00005c70: 6574 2822 6122 2c20 4e6f 6e65 292c 0a20  et("a", None),. 
-00005c80: 2020 2020 2020 2020 2020 2062 3d6b 7761             b=kwa
-00005c90: 7267 732e 6765 7428 2262 222c 204e 6f6e  rgs.get("b", Non
-00005ca0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00005cb0: 6c6f 6767 6572 3d73 656c 662e 6c6f 6767  logger=self.logg
-00005cc0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00005cd0: 6669 743d 6669 742c 0a20 2020 2020 2020  fit=fit,.       
-00005ce0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-00005cf0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00005d00: 2020 7365 6c66 2e73 6574 5f73 7461 7469    self.set_stati
-00005d10: 636d 6170 7328 6461 5f72 6976 7774 682c  cmaps(da_rivwth,
-00005d20: 206e 616d 653d 7365 6c66 2e5f 4d41 5053   name=self._MAPS
-00005d30: 5b22 7269 7677 7468 225d 290a 0a20 2020  ["rivwth"])..   
-00005d40: 2064 6566 2073 6574 7570 5f6c 756c 636d   def setup_lulcm
-00005d50: 6170 7328 0a20 2020 2020 2020 2073 656c  aps(.        sel
-00005d60: 662c 0a20 2020 2020 2020 206c 756c 635f  f,.        lulc_
-00005d70: 666e 3d22 676c 6f62 636f 7665 7222 2c0a  fn="globcover",.
-00005d80: 2020 2020 2020 2020 6c75 6c63 5f6d 6170          lulc_map
-00005d90: 7069 6e67 5f66 6e3d 4e6f 6e65 2c0a 2020  ping_fn=None,.  
-00005da0: 2020 2020 2020 6c75 6c63 5f76 6172 733d        lulc_vars=
-00005db0: 5b0a 2020 2020 2020 2020 2020 2020 226c  [.            "l
-00005dc0: 616e 6475 7365 222c 0a20 2020 2020 2020  anduse",.       
-00005dd0: 2020 2020 2022 4b65 7874 222c 0a20 2020       "Kext",.   
-00005de0: 2020 2020 2020 2020 2022 4e22 2c0a 2020           "N",.  
-00005df0: 2020 2020 2020 2020 2020 2250 6174 6846            "PathF
-00005e00: 7261 6322 2c0a 2020 2020 2020 2020 2020  rac",.          
-00005e10: 2020 2252 6f6f 7469 6e67 4465 7074 6822    "RootingDepth"
-00005e20: 2c0a 2020 2020 2020 2020 2020 2020 2253  ,.            "S
-00005e30: 6c22 2c0a 2020 2020 2020 2020 2020 2020  l",.            
-00005e40: 2253 776f 6f64 222c 0a20 2020 2020 2020  "Swood",.       
-00005e50: 2020 2020 2022 5761 7465 7246 7261 6322       "WaterFrac"
-00005e60: 2c0a 2020 2020 2020 2020 5d2c 0a20 2020  ,.        ],.   
-00005e70: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
-00005e80: 2020 2020 2020 2020 5468 6973 2063 6f6d          This com
-00005e90: 706f 6e65 6e74 2064 6572 6976 6573 2073  ponent derives s
-00005ea0: 6576 6572 616c 2077 666c 6f77 206d 6170  everal wflow map
-00005eb0: 7320 6172 6520 6465 7269 7665 6420 6261  s are derived ba
-00005ec0: 7365 6420 6f6e 206c 616e 6475 7365 2d0a  sed on landuse-.
-00005ed0: 2020 2020 2020 2020 6c61 6e64 636f 7665          landcove
-00005ee0: 7220 284c 554c 4329 2064 6174 612e 0a0a  r (LULC) data...
-00005ef0: 2020 2020 2020 2020 4375 7272 656e 746c          Currentl
-00005f00: 792c 2060 606c 756c 635f 666e 6060 2063  y, ``lulc_fn`` c
-00005f10: 616e 2062 6520 7365 7420 746f 2074 6865  an be set to the
-00005f20: 2022 7669 746f 222c 2022 676c 6f62 636f   "vito", "globco
-00005f30: 7665 7222 0a20 2020 2020 2020 206f 7220  ver".        or 
-00005f40: 2263 6f72 696e 6522 2c20 666f 2077 6869  "corine", fo whi
-00005f50: 6368 206c 6f6f 6b75 7020 7461 626c 6573  ch lookup tables
-00005f60: 2061 7265 2063 6f6e 7374 7275 6374 6564   are constructed
-00005f70: 2074 6f20 636f 6e76 6572 7420 6c75 6c63   to convert lulc
-00005f80: 2063 6c61 7373 7365 7320 746f 0a20 2020   classses to.   
-00005f90: 2020 2020 206d 6f64 656c 2070 6172 616d       model param
-00005fa0: 6574 6572 7320 6261 7365 6420 6f6e 206c  eters based on l
-00005fb0: 6974 6572 6174 7572 652e 2054 6865 2064  iterature. The d
-00005fc0: 6174 6120 6973 2072 656d 6170 7065 6420  ata is remapped 
-00005fd0: 6174 2069 7473 206f 7269 6769 6e61 6c0a  at its original.
-00005fe0: 2020 2020 2020 2020 7265 736f 6c75 7469          resoluti
-00005ff0: 6f6e 2061 6e64 2074 6865 6e20 7265 7361  on and then resa
-00006000: 6d70 6c65 6420 746f 2074 6865 206d 6f64  mpled to the mod
-00006010: 656c 2072 6573 6f6c 7574 696f 6e20 7573  el resolution us
-00006020: 696e 6720 7468 6520 6176 6572 6167 650a  ing the average.
-00006030: 2020 2020 2020 2020 7661 6c75 652c 2075          value, u
-00006040: 6e6c 6573 7320 6e6f 7465 6420 6469 6666  nless noted diff
-00006050: 6572 656e 746c 792e 0a0a 2020 2020 2020  erently...      
-00006060: 2020 4164 6473 206d 6f64 656c 206c 6179    Adds model lay
-00006070: 6572 733a 0a0a 2020 2020 2020 2020 2a20  ers:..        * 
-00006080: 2a2a 6c61 6e64 7573 652a 2a20 6d61 703a  **landuse** map:
-00006090: 204c 616e 6475 7365 2063 6c61 7373 205b   Landuse class [
-000060a0: 2d5d 0a20 2020 2020 2020 202a 202a 2a4b  -].        * **K
-000060b0: 6578 742a 2a20 6d61 703a 2045 7874 696e  ext** map: Extin
-000060c0: 6374 696f 6e20 636f 6566 6669 6369 656e  ction coefficien
-000060d0: 7420 696e 2074 6865 2063 616e 6f70 7920  t in the canopy 
-000060e0: 6761 7020 6672 6163 7469 6f6e 2065 7175  gap fraction equ
-000060f0: 6174 696f 6e20 5b2d 5d0a 2020 2020 2020  ation [-].      
-00006100: 2020 2a20 2a2a 536c 2a2a 206d 6170 3a20    * **Sl** map: 
-00006110: 5370 6563 6966 6963 206c 6561 6620 7374  Specific leaf st
-00006120: 6f72 6167 6520 5b6d 6d5d 0a20 2020 2020  orage [mm].     
-00006130: 2020 202a 202a 2a53 776f 6f64 2a2a 206d     * **Swood** m
-00006140: 6170 3a20 4672 6163 7469 6f6e 206f 6620  ap: Fraction of 
-00006150: 776f 6f64 2069 6e20 7468 6520 7665 6765  wood in the vege
-00006160: 7461 7469 6f6e 2f70 6c61 6e74 205b 2d5d  tation/plant [-]
-00006170: 0a20 2020 2020 2020 202a 202a 2a52 6f6f  .        * **Roo
-00006180: 7469 6e67 4465 7074 682a 2a20 6d61 703a  tingDepth** map:
-00006190: 204c 656e 6774 6820 6f66 2076 6567 6574   Length of veget
-000061a0: 6174 696f 6e20 726f 6f74 7320 5b6d 6d5d  ation roots [mm]
-000061b0: 0a20 2020 2020 2020 202a 202a 2a50 6174  .        * **Pat
-000061c0: 6846 7261 632a 2a20 6d61 703a 2054 6865  hFrac** map: The
-000061d0: 2066 7261 6374 696f 6e20 6f66 2063 6f6d   fraction of com
-000061e0: 7061 6374 6564 206f 7220 7572 6261 6e20  pacted or urban 
-000061f0: 6172 6561 2070 6572 2067 7269 6420 6365  area per grid ce
-00006200: 6c6c 205b 2d5d 0a20 2020 2020 2020 202a  ll [-].        *
-00006210: 202a 2a57 6174 6572 4672 6163 2a2a 206d   **WaterFrac** m
-00006220: 6170 3a20 5468 6520 6672 6163 7469 6f6e  ap: The fraction
-00006230: 206f 6620 6f70 656e 2077 6174 6572 2070   of open water p
-00006240: 6572 2067 7269 6420 6365 6c6c 205b 2d5d  er grid cell [-]
-00006250: 0a20 2020 2020 2020 202a 202a 2a4e 2a2a  .        * **N**
-00006260: 206d 6170 3a20 4d61 6e6e 696e 6720 526f   map: Manning Ro
-00006270: 7567 686e 6573 7320 5b2d 5d0a 0a20 2020  ughness [-]..   
-00006280: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00006290: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000062a0: 2d2d 0a20 2020 2020 2020 206c 756c 635f  --.        lulc_
-000062b0: 666e 203a 207b 2267 6c6f 6263 6f76 6572  fn : {"globcover
-000062c0: 222c 2022 7669 746f 222c 2022 636f 7269  ", "vito", "cori
-000062d0: 6e65 227d 0a20 2020 2020 2020 2020 2020  ne"}.           
-000062e0: 204e 616d 6520 6f66 2064 6174 6120 736f   Name of data so
-000062f0: 7572 6365 2069 6e20 6461 7461 5f73 6f75  urce in data_sou
-00006300: 7263 6573 2e79 6d6c 2066 696c 652e 0a20  rces.yml file.. 
-00006310: 2020 2020 2020 206c 756c 635f 6d61 7070         lulc_mapp
-00006320: 696e 675f 666e 203a 2073 7472 0a20 2020  ing_fn : str.   
-00006330: 2020 2020 2020 2020 2050 6174 6820 746f           Path to
-00006340: 2061 206d 6170 7069 6e67 2063 7376 2066   a mapping csv f
-00006350: 696c 6520 6672 6f6d 206c 616e 6475 7365  ile from landuse
-00006360: 2069 6e20 736f 7572 6365 206e 616d 6520   in source name 
-00006370: 746f 2070 6172 616d 6574 6572 2076 616c  to parameter val
-00006380: 7565 7320 696e 206c 756c 635f 7661 7273  ues in lulc_vars
-00006390: 2e0a 2020 2020 2020 2020 6c75 6c63 5f76  ..        lulc_v
-000063a0: 6172 7320 3a20 6c69 7374 0a20 2020 2020  ars : list.     
-000063b0: 2020 2020 2020 204c 6973 7420 6f66 206c         List of l
-000063c0: 616e 6475 7365 2070 6172 616d 6574 6572  anduse parameter
-000063d0: 7320 746f 206b 6565 702e 5c0a 2020 2020  s to keep.\.    
-000063e0: 2020 2020 2020 2020 4279 2064 6566 6175          By defau
-000063f0: 6c74 205b 226c 616e 6475 7365 222c 224b  lt ["landuse","K
-00006400: 6578 7422 2c22 4e22 2c22 5061 7468 4672  ext","N","PathFr
-00006410: 6163 222c 2252 6f6f 7469 6e67 4465 7074  ac","RootingDept
-00006420: 6822 2c22 536c 222c 2253 776f 6f64 222c  h","Sl","Swood",
-00006430: 2257 6174 6572 4672 6163 225d 0a20 2020  "WaterFrac"].   
-00006440: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00006450: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
-00006460: 6f28 6622 5072 6570 6172 696e 6720 4c55  o(f"Preparing LU
-00006470: 4c43 2070 6172 616d 6574 6572 206d 6170  LC parameter map
-00006480: 732e 2229 0a20 2020 2020 2020 2069 6620  s.").        if 
-00006490: 6c75 6c63 5f6d 6170 7069 6e67 5f66 6e20  lulc_mapping_fn 
-000064a0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000064b0: 2020 2020 2066 6e5f 6d61 7020 3d20 6a6f       fn_map = jo
-000064c0: 696e 2844 4154 4144 4952 2c20 226c 756c  in(DATADIR, "lul
-000064d0: 6322 2c20 6622 7b6c 756c 635f 666e 7d5f  c", f"{lulc_fn}_
-000064e0: 6d61 7070 696e 672e 6373 7622 290a 2020  mapping.csv").  
-000064f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00006500: 2020 2020 2020 2020 666e 5f6d 6170 203d          fn_map =
-00006510: 206c 756c 635f 6d61 7070 696e 675f 666e   lulc_mapping_fn
-00006520: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00006530: 6973 6669 6c65 2866 6e5f 6d61 7029 3a0a  isfile(fn_map):.
-00006540: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006550: 2e6c 6f67 6765 722e 6572 726f 7228 6622  .logger.error(f"
-00006560: 4c55 4c43 206d 6170 7069 6e67 2066 696c  LULC mapping fil
-00006570: 6520 6e6f 7420 666f 756e 643a 207b 666e  e not found: {fn
-00006580: 5f6d 6170 7d22 290a 2020 2020 2020 2020  _map}").        
-00006590: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-000065a0: 2020 2023 2072 6561 6420 6c61 6e64 7573     # read landus
-000065b0: 6520 6d61 7020 746f 2044 6174 6141 7272  e map to DataArr
-000065c0: 6179 0a20 2020 2020 2020 2064 6120 3d20  ay.        da = 
-000065d0: 7365 6c66 2e64 6174 615f 6361 7461 6c6f  self.data_catalo
-000065e0: 672e 6765 745f 7261 7374 6572 6461 7461  g.get_rasterdata
-000065f0: 7365 7428 0a20 2020 2020 2020 2020 2020  set(.           
-00006600: 206c 756c 635f 666e 2c20 6765 6f6d 3d73   lulc_fn, geom=s
-00006610: 656c 662e 7265 6769 6f6e 2c20 6275 6666  elf.region, buff
-00006620: 6572 3d32 2c20 7661 7269 6162 6c65 733d  er=2, variables=
-00006630: 5b22 6c61 6e64 7573 6522 5d0a 2020 2020  ["landuse"].    
-00006640: 2020 2020 290a 2020 2020 2020 2020 2320      ).        # 
-00006650: 7072 6f63 6573 7320 6c61 6e64 7573 650a  process landuse.
-00006660: 2020 2020 2020 2020 6473 5f6c 756c 635f          ds_lulc_
-00006670: 6d61 7073 203d 2077 6f72 6b66 6c6f 7773  maps = workflows
-00006680: 2e6c 616e 6475 7365 280a 2020 2020 2020  .landuse(.      
-00006690: 2020 2020 2020 6461 3d64 612c 0a20 2020        da=da,.   
-000066a0: 2020 2020 2020 2020 2064 735f 6c69 6b65           ds_like
-000066b0: 3d73 656c 662e 7374 6174 6963 6d61 7073  =self.staticmaps
-000066c0: 2c0a 2020 2020 2020 2020 2020 2020 666e  ,.            fn
-000066d0: 5f6d 6170 3d66 6e5f 6d61 702c 0a20 2020  _map=fn_map,.   
-000066e0: 2020 2020 2020 2020 2070 6172 616d 733d           params=
-000066f0: 6c75 6c63 5f76 6172 732c 0a20 2020 2020  lulc_vars,.     
-00006700: 2020 2020 2020 206c 6f67 6765 723d 7365         logger=se
-00006710: 6c66 2e6c 6f67 6765 722c 0a20 2020 2020  lf.logger,.     
-00006720: 2020 2029 0a20 2020 2020 2020 2072 6d64     ).        rmd
-00006730: 6963 7420 3d20 7b6b 3a20 7620 666f 7220  ict = {k: v for 
-00006740: 6b2c 2076 2069 6e20 7365 6c66 2e5f 4d41  k, v in self._MA
-00006750: 5053 2e69 7465 6d73 2829 2069 6620 6b20  PS.items() if k 
-00006760: 696e 2064 735f 6c75 6c63 5f6d 6170 732e  in ds_lulc_maps.
-00006770: 6461 7461 5f76 6172 737d 0a20 2020 2020  data_vars}.     
-00006780: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
-00006790: 6963 6d61 7073 2864 735f 6c75 6c63 5f6d  icmaps(ds_lulc_m
-000067a0: 6170 732e 7265 6e61 6d65 2872 6d64 6963  aps.rename(rmdic
-000067b0: 7429 290a 0a20 2020 2064 6566 2073 6574  t))..    def set
-000067c0: 7570 5f6c 6169 6d61 7073 2873 656c 662c  up_laimaps(self,
-000067d0: 206c 6169 5f66 6e3d 226d 6f64 6973 5f6c   lai_fn="modis_l
-000067e0: 6169 2229 3a0a 2020 2020 2020 2020 2222  ai"):.        ""
-000067f0: 220a 2020 2020 2020 2020 5468 6973 2063  ".        This c
-00006800: 6f6d 706f 6e65 6e74 2073 6574 7320 6c65  omponent sets le
-00006810: 6166 2061 7265 6120 696e 6465 7820 284c  af area index (L
-00006820: 4149 2920 636c 696d 6174 6f6c 6f67 7920  AI) climatology 
-00006830: 6d61 7073 2070 6572 206d 6f6e 7468 2e0a  maps per month..
-00006840: 0a20 2020 2020 2020 2054 6865 2076 616c  .        The val
-00006850: 7565 7320 6172 6520 7265 7361 6d70 6c65  ues are resample
-00006860: 6420 746f 2074 6865 206d 6f64 656c 2072  d to the model r
-00006870: 6573 6f6c 7574 696f 6e20 7573 696e 6720  esolution using 
-00006880: 7468 6520 6176 6572 6167 6520 7661 6c75  the average valu
-00006890: 652e 0a20 2020 2020 2020 2054 6865 206f  e..        The o
-000068a0: 6e6c 7920 6060 6c61 695f 666e 6060 2063  nly ``lai_fn`` c
-000068b0: 7572 7265 6e74 6c79 2073 7570 706f 7274  urrently support
-000068c0: 6564 2069 7320 226d 6f64 6973 5f6c 6169  ed is "modis_lai
-000068d0: 2220 6261 7365 6420 6f6e 204d 4f44 4953  " based on MODIS
-000068e0: 2064 6174 612e 0a0a 2020 2020 2020 2020   data...        
-000068f0: 4164 6473 206d 6f64 656c 206c 6179 6572  Adds model layer
-00006900: 733a 0a0a 2020 2020 2020 2020 2a20 2a2a  s:..        * **
-00006910: 4c41 492a 2a20 6d61 703a 204c 6561 6620  LAI** map: Leaf 
-00006920: 4172 6561 2049 6e64 6578 2063 6c69 6d61  Area Index clima
-00006930: 746f 6c6f 6779 205b 2d5d 0a20 2020 2020  tology [-].     
-00006940: 2020 2020 2020 2052 6573 616d 706c 6564         Resampled
-00006950: 2066 726f 6d20 736f 7572 6365 2064 6174   from source dat
-00006960: 6120 7573 696e 6720 6176 6572 6167 652e  a using average.
-00006970: 2041 7373 756d 696e 6720 7468 6174 206d   Assuming that m
-00006980: 6973 7369 6e67 2076 616c 7565 730a 2020  issing values.  
-00006990: 2020 2020 2020 2020 2020 636f 7272 6573            corres
-000069a0: 706f 6e64 2074 6f20 6261 7265 2073 6f69  pond to bare soi
-000069b0: 6c2c 2074 6865 7365 2061 7265 2073 6574  l, these are set
-000069c0: 2074 6f20 7a65 726f 2062 6566 6f72 6520   to zero before 
-000069d0: 7265 7361 6d70 6c69 6e67 2e0a 0a20 2020  resampling...   
-000069e0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-000069f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00006a00: 2d2d 0a20 2020 2020 2020 206c 6169 5f66  --.        lai_f
-00006a10: 6e20 3a20 7b27 6d6f 6469 735f 6c61 6927  n : {'modis_lai'
-00006a20: 7d0a 2020 2020 2020 2020 2020 2020 4e61  }.            Na
-00006a30: 6d65 206f 6620 6461 7461 2073 6f75 7263  me of data sourc
-00006a40: 6520 666f 7220 4c41 4920 7061 7261 6d65  e for LAI parame
-00006a50: 7465 7273 2c20 7365 6520 6461 7461 2f64  ters, see data/d
-00006a60: 6174 615f 736f 7572 6365 732e 796d 6c2e  ata_sources.yml.
-00006a70: 0a0a 2020 2020 2020 2020 2020 2020 2a20  ..            * 
-00006a80: 5265 7175 6972 6564 2076 6172 6961 626c  Required variabl
-00006a90: 6573 3a20 5b27 4c41 4927 5d0a 2020 2020  es: ['LAI'].    
-00006aa0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00006ab0: 6966 206c 6169 5f66 6e20 6e6f 7420 696e  if lai_fn not in
-00006ac0: 2073 656c 662e 6461 7461 5f63 6174 616c   self.data_catal
-00006ad0: 6f67 3a0a 2020 2020 2020 2020 2020 2020  og:.            
-00006ae0: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
-00006af0: 696e 6728 6622 496e 7661 6c69 6420 736f  ing(f"Invalid so
-00006b00: 7572 6365 2027 7b6c 6169 5f66 6e7d 272c  urce '{lai_fn}',
-00006b10: 2073 6b69 7070 696e 6720 7365 7475 705f   skipping setup_
-00006b20: 6c61 696d 6170 732e 2229 0a20 2020 2020  laimaps.").     
-00006b30: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-00006b40: 2020 2020 2020 2320 7265 7472 6965 7665        # retrieve
-00006b50: 2064 6174 6120 666f 7220 7265 6769 6f6e   data for region
-00006b60: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00006b70: 6767 6572 2e69 6e66 6f28 6622 5072 6570  gger.info(f"Prep
-00006b80: 6172 696e 6720 4c41 4920 6d61 7073 2e22  aring LAI maps."
-00006b90: 290a 2020 2020 2020 2020 6461 203d 2073  ).        da = s
-00006ba0: 656c 662e 6461 7461 5f63 6174 616c 6f67  elf.data_catalog
-00006bb0: 2e67 6574 5f72 6173 7465 7264 6174 6173  .get_rasterdatas
-00006bc0: 6574 286c 6169 5f66 6e2c 2067 656f 6d3d  et(lai_fn, geom=
-00006bd0: 7365 6c66 2e72 6567 696f 6e2c 2062 7566  self.region, buf
-00006be0: 6665 723d 3229 0a20 2020 2020 2020 2064  fer=2).        d
-00006bf0: 615f 6c61 6920 3d20 776f 726b 666c 6f77  a_lai = workflow
-00006c00: 732e 6c61 6928 0a20 2020 2020 2020 2020  s.lai(.         
-00006c10: 2020 2064 613d 6461 2c0a 2020 2020 2020     da=da,.      
-00006c20: 2020 2020 2020 6473 5f6c 696b 653d 7365        ds_like=se
-00006c30: 6c66 2e73 7461 7469 636d 6170 732c 0a20  lf.staticmaps,. 
-00006c40: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00006c50: 723d 7365 6c66 2e6c 6f67 6765 722c 0a20  r=self.logger,. 
-00006c60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00006c70: 2023 2052 656e 616d 6520 7468 6520 6669   # Rename the fi
-00006c80: 7273 7420 6469 6d65 6e73 696f 6e20 746f  rst dimension to
-00006c90: 2074 696d 650a 2020 2020 2020 2020 726d   time.        rm
-00006ca0: 6469 6374 203d 207b 6461 5f6c 6169 2e64  dict = {da_lai.d
-00006cb0: 696d 735b 305d 3a20 2274 696d 6522 7d0a  ims[0]: "time"}.
-00006cc0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00006cd0: 5f73 7461 7469 636d 6170 7328 6461 5f6c  _staticmaps(da_l
-00006ce0: 6169 2e72 656e 616d 6528 726d 6469 6374  ai.rename(rmdict
-00006cf0: 292c 206e 616d 653d 224c 4149 2229 0a0a  ), name="LAI")..
-00006d00: 2020 2020 6465 6620 7365 7475 705f 6761      def setup_ga
-00006d10: 7567 6573 280a 2020 2020 2020 2020 7365  uges(.        se
-00006d20: 6c66 2c0a 2020 2020 2020 2020 6761 7567  lf,.        gaug
-00006d30: 6573 5f66 6e3d 2267 7264 6322 2c0a 2020  es_fn="grdc",.  
-00006d40: 2020 2020 2020 736f 7572 6365 5f67 6466        source_gdf
-00006d50: 3d4e 6f6e 652c 0a20 2020 2020 2020 2069  =None,.        i
-00006d60: 6e64 6578 5f63 6f6c 3d4e 6f6e 652c 0a20  ndex_col=None,. 
-00006d70: 2020 2020 2020 2073 6e61 705f 746f 5f72         snap_to_r
-00006d80: 6976 6572 3d54 7275 652c 0a20 2020 2020  iver=True,.     
-00006d90: 2020 206d 6173 6b3d 4e6f 6e65 2c0a 2020     mask=None,.  
-00006da0: 2020 2020 2020 6465 7269 7665 5f73 7562        derive_sub
-00006db0: 6361 7463 683d 4661 6c73 652c 0a20 2020  catch=False,.   
-00006dc0: 2020 2020 2064 6572 6976 655f 6f75 746c       derive_outl
-00006dd0: 6574 3d54 7275 652c 0a20 2020 2020 2020  et=True,.       
-00006de0: 2062 6173 656e 616d 653d 4e6f 6e65 2c0a   basename=None,.
-00006df0: 2020 2020 2020 2020 7570 6461 7465 5f74          update_t
-00006e00: 6f6d 6c3d 5472 7565 2c0a 2020 2020 2020  oml=True,.      
-00006e10: 2020 6761 7567 655f 746f 6d6c 5f68 6561    gauge_toml_hea
-00006e20: 6465 723d 4e6f 6e65 2c0a 2020 2020 2020  der=None,.      
-00006e30: 2020 6761 7567 655f 746f 6d6c 5f70 6172    gauge_toml_par
-00006e40: 616d 3d4e 6f6e 652c 0a20 2020 2020 2020  am=None,.       
-00006e50: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
-00006e60: 3a0a 2020 2020 2020 2020 2222 2254 6869  :.        """Thi
-00006e70: 7320 636f 6d70 6f6e 656e 7473 2073 6574  s components set
-00006e80: 7320 7468 6520 6465 6661 756c 7420 6761  s the default ga
-00006e90: 7567 6520 6d61 7020 6261 7365 6420 6f6e  uge map based on
-00006ea0: 2062 6173 696e 206f 7574 6c65 7473 2061   basin outlets a
-00006eb0: 6e64 2061 6464 6974 696f 6e61 6c0a 2020  nd additional.  
-00006ec0: 2020 2020 2020 6761 7567 6520 6d61 7073        gauge maps
-00006ed0: 2062 6173 6564 206f 6e20 6060 6761 7567   based on ``gaug
-00006ee0: 6573 5f66 6e60 6020 6461 7461 2e0a 0a20  es_fn`` data... 
-00006ef0: 2020 2020 2020 2053 7570 706f 7274 6564         Supported
-00006f00: 2067 6175 6765 2064 6174 6173 6574 7320   gauge datasets 
-00006f10: 696e 636c 7564 6520 2267 7264 6322 0a20  include "grdc". 
-00006f20: 2020 2020 2020 206f 7220 223c 7061 7468         or "<path
-00006f30: 5f74 6f5f 736f 7572 6365 3e22 2066 6f72  _to_source>" for
-00006f40: 2075 7365 7220 7375 7070 6c69 6564 2063   user supplied c
-00006f50: 7376 206f 7220 6765 6f6d 6574 7279 2066  sv or geometry f
-00006f60: 696c 6573 2077 6974 6820 6761 7567 6520  iles with gauge 
-00006f70: 6c6f 6361 7469 6f6e 732e 0a20 2020 2020  locations..     
-00006f80: 2020 2049 6620 6120 6373 7620 6669 6c65     If a csv file
-00006f90: 2069 7320 7072 6f76 6964 6564 2c20 6120   is provided, a 
-00006fa0: 2278 2220 6f72 2022 6c6f 6e22 2061 6e64  "x" or "lon" and
-00006fb0: 2022 7922 206f 7220 226c 6174 2220 636f   "y" or "lat" co
-00006fc0: 6c75 6d6e 2069 7320 7265 7175 6972 6564  lumn is required
-00006fd0: 0a20 2020 2020 2020 2061 6e64 2074 6865  .        and the
-00006fe0: 2066 6972 7374 2063 6f6c 756d 6e20 7769   first column wi
-00006ff0: 6c6c 2062 6520 7573 6564 2061 7320 4944  ll be used as ID
-00007000: 7320 696e 2074 6865 206d 6170 2e20 4966  s in the map. If
-00007010: 2060 6073 6e61 705f 746f 5f72 6976 6572   ``snap_to_river
-00007020: 6060 2069 7320 7365 740a 2020 2020 2020  `` is set.      
-00007030: 2020 746f 2054 7275 652c 2074 6865 2067    to True, the g
-00007040: 6175 6765 206c 6f63 6174 696f 6e20 7769  auge location wi
-00007050: 6c6c 2062 6520 736e 6170 7065 6420 746f  ll be snapped to
-00007060: 2074 6865 2062 6f6f 6c65 616e 2072 6976   the boolean riv
-00007070: 6572 206d 6173 6b2e 2049 660a 2020 2020  er mask. If.    
-00007080: 2020 2020 6060 6465 7269 7665 5f73 7562      ``derive_sub
-00007090: 6361 7463 6860 6020 6973 2073 6574 2074  catch`` is set t
-000070a0: 6f20 5472 7565 2c20 616e 2061 6464 6974  o True, an addit
-000070b0: 696f 6e61 6c20 7375 6263 6174 6368 206d  ional subcatch m
-000070c0: 6170 2069 7320 6465 7269 7665 6420 6672  ap is derived fr
-000070d0: 6f6d 0a20 2020 2020 2020 2074 6865 2067  om.        the g
-000070e0: 6175 6765 206c 6f63 6174 696f 6e73 2e0a  auge locations..
-000070f0: 0a20 2020 2020 2020 2041 6464 7320 6d6f  .        Adds mo
-00007100: 6465 6c20 6c61 7965 7273 3a0a 0a20 2020  del layers:..   
-00007110: 2020 2020 202a 202a 2a77 666c 6f77 5f67       * **wflow_g
-00007120: 6175 6765 732a 2a20 6d61 703a 2067 6175  auges** map: gau
-00007130: 6765 2049 4473 206d 6170 2066 726f 6d20  ge IDs map from 
-00007140: 6361 7463 686d 656e 7420 6f75 746c 6574  catchment outlet
-00007150: 7320 5b2d 5d0a 2020 2020 2020 2020 2a20  s [-].        * 
-00007160: 2a2a 7766 6c6f 775f 6761 7567 6573 5f73  **wflow_gauges_s
-00007170: 6f75 7263 652a 2a20 6d61 703a 2067 6175  ource** map: gau
-00007180: 6765 2049 4473 206d 6170 2066 726f 6d20  ge IDs map from 
-00007190: 736f 7572 6365 205b 2d5d 2028 6966 2067  source [-] (if g
-000071a0: 6175 6765 735f 666e 290a 2020 2020 2020  auges_fn).      
-000071b0: 2020 2a20 2a2a 7766 6c6f 775f 7375 6263    * **wflow_subc
-000071c0: 6174 6368 5f73 6f75 7263 652a 2a20 6d61  atch_source** ma
-000071d0: 703a 2073 7562 6361 7463 686d 656e 7420  p: subcatchment 
-000071e0: 6261 7365 6420 6f6e 2067 6175 6765 206c  based on gauge l
-000071f0: 6f63 6174 696f 6e73 205b 2d5d 2028 6966  ocations [-] (if
-00007200: 2064 6572 6976 655f 7375 6263 6174 6368   derive_subcatch
-00007210: 290a 2020 2020 2020 2020 2a20 2a2a 6761  ).        * **ga
-00007220: 7567 6573 2a2a 2067 656f 6d3a 2070 6f6c  uges** geom: pol
-00007230: 7967 6f6e 206f 6620 6361 7463 686d 656e  ygon of catchmen
-00007240: 7420 6f75 746c 6574 730a 2020 2020 2020  t outlets.      
-00007250: 2020 2a20 2a2a 6761 7567 6573 5f73 6f75    * **gauges_sou
-00007260: 7263 652a 2a20 6765 6f6d 3a20 706f 6c79  rce** geom: poly
-00007270: 676f 6e20 6f66 2067 6175 6765 7320 6672  gon of gauges fr
-00007280: 6f6d 2073 6f75 7263 650a 2020 2020 2020  om source.      
-00007290: 2020 2a20 2a2a 7375 6263 6174 6368 5f73    * **subcatch_s
-000072a0: 6f75 7263 652a 2a20 6765 6f6d 3a20 706f  ource** geom: po
-000072b0: 6c79 676f 6e20 6f66 2073 7562 6361 7463  lygon of subcatc
-000072c0: 686d 656e 7420 6261 7365 6420 6f6e 2067  hment based on g
-000072d0: 6175 6765 206c 6f63 6174 696f 6e73 205b  auge locations [
-000072e0: 2d5d 2028 6966 2064 6572 6976 655f 7375  -] (if derive_su
-000072f0: 6263 6174 6368 290a 0a20 2020 2020 2020  bcatch)..       
-00007300: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00007310: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00007320: 2020 2020 2020 2067 6175 6765 735f 666e         gauges_fn
-00007330: 203a 2073 7472 2c20 7b22 6772 6463 227d   : str, {"grdc"}
-00007340: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00007350: 2020 2020 2020 204b 6e6f 776e 2073 6f75         Known sou
-00007360: 7263 6520 6e61 6d65 206f 7220 7061 7468  rce name or path
-00007370: 2074 6f20 6761 7567 6573 2066 696c 6520   to gauges file 
-00007380: 6765 6f6d 6574 7279 2066 696c 652c 2062  geometry file, b
-00007390: 7920 6465 6661 756c 7420 4e6f 6e65 2e0a  y default None..
-000073a0: 2020 2020 2020 2020 736f 7572 6365 5f67          source_g
-000073b0: 6466 203a 2067 656f 7061 6e64 6173 2e47  df : geopandas.G
-000073c0: 656f 4461 7461 4661 6d65 2c20 6f70 7469  eoDataFame, opti
-000073d0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-000073e0: 2044 6972 6563 7420 6761 7567 6573 2066   Direct gauges f
-000073f0: 696c 6520 6765 6f6d 6574 7279 2c20 6279  ile geometry, by
-00007400: 2064 6566 6175 6c74 204e 6f6e 652e 0a20   default None.. 
-00007410: 2020 2020 2020 2069 6e64 6578 5f63 6f6c         index_col
-00007420: 203a 2073 7472 2c20 6f70 7469 6f6e 616c   : str, optional
-00007430: 0a20 2020 2020 2020 2020 2020 2043 6f6c  .            Col
-00007440: 756d 6e20 696e 2067 6175 6765 735f 666e  umn in gauges_fn
-00007450: 2074 6f20 7573 6520 666f 7220 4944 2076   to use for ID v
-00007460: 616c 7565 732c 2062 7920 6465 6661 756c  alues, by defaul
-00007470: 7420 4e6f 6e65 2028 7573 6520 7468 6520  t None (use the 
-00007480: 6465 6661 756c 7420 696e 6465 7820 636f  default index co
-00007490: 6c75 6d6e 290a 2020 2020 2020 2020 736e  lumn).        sn
-000074a0: 6170 5f74 6f5f 7269 7665 7220 3a20 626f  ap_to_river : bo
-000074b0: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
-000074c0: 2020 2020 2020 2020 2053 6e61 7020 706f           Snap po
-000074d0: 696e 7420 6c6f 6361 7469 6f6e 7320 746f  int locations to
-000074e0: 2074 6865 2063 6c6f 7365 7374 2064 6f77   the closest dow
-000074f0: 6e73 7472 6561 6d20 7269 7665 7220 6365  nstream river ce
-00007500: 6c6c 2c20 6279 2064 6566 6175 6c74 2054  ll, by default T
-00007510: 7275 650a 2020 2020 2020 2020 6d61 736b  rue.        mask
-00007520: 203a 206e 702e 626f 6f6c 6561 6e2c 206f   : np.boolean, o
-00007530: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00007540: 2020 2020 4966 2070 726f 7669 6465 6420      If provided 
-00007550: 736e 6170 7320 746f 2074 6865 206d 6173  snaps to the mas
-00007560: 6b2c 2065 6c73 6520 736e 6170 7320 746f  k, else snaps to
-00007570: 2074 6865 2072 6976 6572 2028 6465 6661   the river (defa
-00007580: 756c 7429 2e0a 2020 2020 2020 2020 6465  ult)..        de
-00007590: 7269 7665 5f73 7562 6361 7463 6820 3a20  rive_subcatch : 
-000075a0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 0a20  bool, optional. 
-000075b0: 2020 2020 2020 2020 2020 2044 6572 6976             Deriv
-000075c0: 6520 7375 6263 6174 6368 206d 6170 2066  e subcatch map f
-000075d0: 6f72 2067 6175 6765 732c 2062 7920 6465  or gauges, by de
-000075e0: 6661 756c 7420 4661 6c73 650a 2020 2020  fault False.    
-000075f0: 2020 2020 6465 7269 7665 5f6f 7574 6c65      derive_outle
-00007600: 7420 3a20 626f 6f6c 2c20 6f70 7469 6f6e  t : bool, option
-00007610: 616c 0a20 2020 2020 2020 2020 2020 2044  al.            D
-00007620: 6572 6976 6520 6761 7567 656d 6170 2062  erive gaugemap b
-00007630: 6173 6564 206f 6e20 6361 7463 686d 656e  ased on catchmen
-00007640: 7420 6f75 746c 6574 732c 2062 7920 6465  t outlets, by de
-00007650: 6661 756c 7420 5472 7565 0a20 2020 2020  fault True.     
-00007660: 2020 2062 6173 656e 616d 6520 3a20 7374     basename : st
-00007670: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
-00007680: 2020 2020 2020 2020 4d61 7020 6e61 6d65          Map name
-00007690: 2069 6e20 7374 6174 6963 6d61 7073 2028   in staticmaps (
-000076a0: 7766 6c6f 775f 6761 7567 6573 5f62 6173  wflow_gauges_bas
-000076b0: 656e 616d 6529 2c20 6966 204e 6f6e 6520  ename), if None 
-000076c0: 7573 6520 7468 6520 6761 7567 6573 5f66  use the gauges_f
-000076d0: 6e20 6261 7365 6e61 6d65 2e0a 2020 2020  n basename..    
-000076e0: 2020 2020 7570 6461 7465 5f74 6f6d 6c20      update_toml 
-000076f0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
-00007700: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00007710: 5570 6461 7465 205b 6f75 7470 7574 6373  Update [outputcs
-00007720: 765d 2073 6563 7469 6f6e 206f 6620 7766  v] section of wf
-00007730: 6c6f 7720 746f 6d6c 2066 696c 652e 0a20  low toml file.. 
-00007740: 2020 2020 2020 2067 6175 6765 5f74 6f6d         gauge_tom
-00007750: 6c5f 6865 6164 6572 203a 206c 6973 742c  l_header : list,
-00007760: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00007770: 2020 2020 2020 5361 7665 2073 7065 6369        Save speci
-00007780: 6669 6320 6d6f 6465 6c20 7061 7261 6d65  fic model parame
-00007790: 7465 7273 2069 6e20 6373 7620 7365 6374  ters in csv sect
-000077a0: 696f 6e2e 2054 6869 7320 6f70 7469 6f6e  ion. This option
-000077b0: 2064 6566 696e 6573 2074 6865 2068 6561   defines the hea
-000077c0: 6465 7220 6f66 2074 6865 2063 7376 2066  der of the csv f
-000077d0: 696c 652e 2f0a 2020 2020 2020 2020 2020  ile./.          
-000077e0: 2020 4279 2064 6566 6175 6c74 2073 6176    By default sav
-000077f0: 6573 2051 2028 666f 7220 6c61 7465 7261  es Q (for latera
-00007800: 6c2e 7269 7665 722e 715f 6176 2920 616e  l.river.q_av) an
-00007810: 6420 5020 2866 6f72 2076 6572 7469 6361  d P (for vertica
-00007820: 6c2e 7072 6563 6970 6974 6174 696f 6e29  l.precipitation)
-00007830: 2e0a 2020 2020 2020 2020 6761 7567 655f  ..        gauge_
-00007840: 746f 6d6c 5f70 6172 616d 3a20 6c69 7374  toml_param: list
-00007850: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00007860: 2020 2020 2020 2053 6176 6520 7370 6563         Save spec
-00007870: 6966 6963 206d 6f64 656c 2070 6172 616d  ific model param
-00007880: 6574 6572 7320 696e 2063 7376 2073 6563  eters in csv sec
-00007890: 7469 6f6e 2e20 5468 6973 206f 7074 696f  tion. This optio
-000078a0: 6e20 6465 6669 6e65 7320 7468 6520 7766  n defines the wf
-000078b0: 6c6f 7720 7661 7269 6162 6c65 2063 6f72  low variable cor
-000078c0: 7265 7370 6f6e 6469 6e67 2074 6f20 7468  responding to th
-000078d0: 652f 0a20 2020 2020 2020 2020 2020 206e  e/.            n
-000078e0: 616d 6573 2069 6e20 6761 7567 655f 746f  ames in gauge_to
-000078f0: 6d6c 5f68 6561 6465 722e 2042 7920 6465  ml_header. By de
-00007900: 6661 756c 7420 7361 7665 7320 6c61 7465  fault saves late
-00007910: 7261 6c2e 7269 7665 722e 715f 6176 2028  ral.river.q_av (
-00007920: 666f 7220 5129 2061 6e64 2076 6572 7469  for Q) and verti
-00007930: 6361 6c2e 7072 6563 6970 6974 6174 696f  cal.precipitatio
-00007940: 6e20 2866 6f72 2050 292e 0a20 2020 2020  n (for P)..     
-00007950: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-00007960: 2072 6561 6420 6578 6973 7469 6e67 2073   read existing s
-00007970: 7461 7469 6367 656f 6d73 3b20 696d 706f  taticgeoms; impo
-00007980: 7274 616e 7420 746f 2067 6574 2074 6865  rtant to get the
-00007990: 2072 6967 6874 2062 6173 696e 2077 6865   right basin whe
-000079a0: 6e20 7570 6461 7469 6e67 0a20 2020 2020  n updating.     
-000079b0: 2020 2073 656c 662e 7374 6174 6963 6765     self.staticge
-000079c0: 6f6d 730a 0a20 2020 2020 2020 2069 6620  oms..        if 
-000079d0: 6465 7269 7665 5f6f 7574 6c65 743a 0a20  derive_outlet:. 
-000079e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000079f0: 6c6f 6767 6572 2e69 6e66 6f28 6622 4761  logger.info(f"Ga
-00007a00: 7567 6573 206c 6f63 6174 696f 6e73 2073  uges locations s
-00007a10: 6574 2062 6173 6564 206f 6e20 7269 7665  et based on rive
-00007a20: 7220 6f75 746c 6574 732e 2229 0a20 2020  r outlets.").   
-00007a30: 2020 2020 2020 2020 2064 612c 2069 6478           da, idx
-00007a40: 732c 2069 6473 203d 2066 6c77 2e67 6175  s, ids = flw.gau
-00007a50: 6765 5f6d 6170 2873 656c 662e 7374 6174  ge_map(self.stat
-00007a60: 6963 6d61 7073 2c20 6964 7873 3d73 656c  icmaps, idxs=sel
-00007a70: 662e 666c 7764 6972 2e69 6478 735f 7069  f.flwdir.idxs_pi
-00007a80: 7429 0a20 2020 2020 2020 2020 2020 2023  t).            #
-00007a90: 204f 6e6c 7920 6b65 6570 2072 6976 6572   Only keep river
-00007aa0: 206f 7574 6c65 7473 2066 6f72 2067 6175   outlets for gau
-00007ab0: 6765 730a 2020 2020 2020 2020 2020 2020  ges.            
-00007ac0: 6461 203d 2064 612e 7768 6572 6528 7365  da = da.where(se
-00007ad0: 6c66 2e73 7461 7469 636d 6170 735b 7365  lf.staticmaps[se
-00007ae0: 6c66 2e5f 4d41 5053 5b22 7269 766d 736b  lf._MAPS["rivmsk
-00007af0: 225d 5d20 213d 2030 2c20 6461 2e72 6173  "]] != 0, da.ras
-00007b00: 7465 722e 6e6f 6461 7461 290a 2020 2020  ter.nodata).    
-00007b10: 2020 2020 2020 2020 6964 735f 6461 203d          ids_da =
-00007b20: 206e 702e 756e 6971 7565 2864 612e 7661   np.unique(da.va
-00007b30: 6c75 6573 5b64 612e 7661 6c75 6573 203e  lues[da.values >
-00007b40: 2030 5d29 0a20 2020 2020 2020 2020 2020   0]).           
-00007b50: 2069 6478 735f 6461 203d 2069 6478 735b   idxs_da = idxs[
-00007b60: 6e70 2e69 7369 6e28 6964 732c 2069 6473  np.isin(ids, ids
-00007b70: 5f64 6129 5d0a 2020 2020 2020 2020 2020  _da)].          
-00007b80: 2020 7365 6c66 2e73 6574 5f73 7461 7469    self.set_stati
-00007b90: 636d 6170 7328 6461 2c20 6e61 6d65 3d73  cmaps(da, name=s
-00007ba0: 656c 662e 5f4d 4150 535b 2267 6175 6765  elf._MAPS["gauge
-00007bb0: 7322 5d29 0a20 2020 2020 2020 2020 2020  s"]).           
-00007bc0: 2070 6f69 6e74 7320 3d20 6770 642e 706f   points = gpd.po
-00007bd0: 696e 7473 5f66 726f 6d5f 7879 282a 7365  ints_from_xy(*se
-00007be0: 6c66 2e73 7461 7469 636d 6170 732e 7261  lf.staticmaps.ra
-00007bf0: 7374 6572 2e69 6478 5f74 6f5f 7879 2869  ster.idx_to_xy(i
-00007c00: 6478 735f 6461 2929 0a20 2020 2020 2020  dxs_da)).       
-00007c10: 2020 2020 2067 6466 203d 2067 7064 2e47       gdf = gpd.G
-00007c20: 656f 4461 7461 4672 616d 6528 0a20 2020  eoDataFrame(.   
-00007c30: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00007c40: 6578 3d69 6473 5f64 612e 6173 7479 7065  ex=ids_da.astype
-00007c50: 286e 702e 696e 7433 3229 2c20 6765 6f6d  (np.int32), geom
-00007c60: 6574 7279 3d70 6f69 6e74 732c 2063 7273  etry=points, crs
-00007c70: 3d73 656c 662e 6372 730a 2020 2020 2020  =self.crs.      
-00007c80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00007c90: 2020 2020 6764 665b 2266 6964 225d 203d      gdf["fid"] =
-00007ca0: 2069 6473 5f64 612e 6173 7479 7065 286e   ids_da.astype(n
-00007cb0: 702e 696e 7433 3229 0a20 2020 2020 2020  p.int32).       
-00007cc0: 2020 2020 2073 656c 662e 7365 745f 7374       self.set_st
-00007cd0: 6174 6963 6765 6f6d 7328 6764 662c 206e  aticgeoms(gdf, n
-00007ce0: 616d 653d 2267 6175 6765 7322 290a 2020  ame="gauges").  
-00007cf0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00007d00: 6f67 6765 722e 696e 666f 2866 2247 6175  ogger.info(f"Gau
-00007d10: 6765 7320 6d61 7020 6261 7365 6420 6f6e  ges map based on
-00007d20: 2063 6174 6368 6d65 6e74 2072 6976 6572   catchment river
-00007d30: 206f 7574 6c65 7473 2061 6464 6564 2e22   outlets added."
-00007d40: 290a 0a20 2020 2020 2020 2069 6620 6761  )..        if ga
-00007d50: 7567 6573 5f66 6e20 6973 206e 6f74 204e  uges_fn is not N
-00007d60: 6f6e 6520 6f72 2073 6f75 7263 655f 6764  one or source_gd
-00007d70: 6620 6973 206e 6f74 204e 6f6e 653a 0a20  f is not None:. 
-00007d80: 2020 2020 2020 2020 2020 2023 2061 7070             # app
-00007d90: 656e 6420 6c6f 6361 7469 6f6e 2066 726f  end location fro
-00007da0: 6d20 6765 6f6d 6574 7279 0a20 2020 2020  m geometry.     
-00007db0: 2020 2020 2020 2023 2054 4f44 4f20 6368         # TODO ch
-00007dc0: 6563 6b20 736e 6170 7069 6e67 206c 6f63  eck snapping loc
-00007dd0: 6174 696f 6e73 2062 6173 6564 206f 6e20  ations based on 
-00007de0: 7570 7374 7265 616d 2061 7265 6120 6174  upstream area at
-00007df0: 7472 6962 7574 6520 6f66 2074 6865 2067  tribute of the g
-00007e00: 6175 6765 2064 6174 610a 2020 2020 2020  auge data.      
-00007e10: 2020 2020 2020 6966 2067 6175 6765 735f        if gauges_
-00007e20: 666e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  fn is not None:.
-00007e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e40: 6b77 6172 6773 203d 207b 7d0a 2020 2020  kwargs = {}.    
-00007e50: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00007e60: 7366 696c 6528 6761 7567 6573 5f66 6e29  sfile(gauges_fn)
-00007e70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007e80: 2020 2020 2020 2320 7472 7920 746f 2067        # try to g
-00007e90: 6574 2065 7073 6720 6e75 6d62 6572 2064  et epsg number d
-00007ea0: 6972 6563 746c 792c 2069 6d70 6f72 7461  irectly, importa
-00007eb0: 6e74 2077 6865 6e20 7772 6974 7469 6e67  nt when writting
-00007ec0: 2062 6163 6b20 6461 7461 5f63 6174 616c   back data_catal
-00007ed0: 6f67 0a20 2020 2020 2020 2020 2020 2020  og.             
-00007ee0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-00007ef0: 7228 7365 6c66 2e63 7273 2c20 2274 6f5f  r(self.crs, "to_
-00007f00: 6570 7367 2229 3a0a 2020 2020 2020 2020  epsg"):.        
-00007f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f20: 636f 6465 203d 2073 656c 662e 6372 732e  code = self.crs.
-00007f30: 746f 5f65 7073 6728 290a 2020 2020 2020  to_epsg().      
-00007f40: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00007f50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00007f60: 2020 2020 2020 2020 2020 2020 636f 6465              code
-00007f70: 203d 2073 656c 662e 6372 730a 2020 2020   = self.crs.    
-00007f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f90: 6b77 6172 6773 2e75 7064 6174 6528 6372  kwargs.update(cr
-00007fa0: 733d 636f 6465 290a 2020 2020 2020 2020  s=code).        
-00007fb0: 2020 2020 2020 2020 6764 6620 3d20 7365          gdf = se
-00007fc0: 6c66 2e64 6174 615f 6361 7461 6c6f 672e  lf.data_catalog.
-00007fd0: 6765 745f 6765 6f64 6174 6166 7261 6d65  get_geodataframe
-00007fe0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007ff0: 2020 2020 2020 6761 7567 6573 5f66 6e2c        gauges_fn,
-00008000: 2067 656f 6d3d 7365 6c66 2e62 6173 696e   geom=self.basin
-00008010: 732c 2061 7373 6572 745f 6774 7970 653d  s, assert_gtype=
-00008020: 2250 6f69 6e74 222c 202a 2a6b 7761 7267  "Point", **kwarg
-00008030: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00008040: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00008050: 2020 2020 6764 6620 3d20 6764 662e 746f      gdf = gdf.to
-00008060: 5f63 7273 2873 656c 662e 6372 7329 0a20  _crs(self.crs). 
-00008070: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00008080: 736f 7572 6365 5f67 6466 2069 7320 6e6f  source_gdf is no
-00008090: 7420 4e6f 6e65 2061 6e64 2062 6173 656e  t None and basen
-000080a0: 616d 6520 6973 204e 6f6e 653a 0a20 2020  ame is None:.   
-000080b0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000080c0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-000080d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080e0: 2020 2022 4261 7365 6e61 6d65 2069 7320     "Basename is 
-000080f0: 7265 7175 6972 6564 2077 6865 6e20 7365  required when se
-00008100: 7474 696e 6720 6761 7567 6573 2062 6173  tting gauges bas
-00008110: 6564 206f 6e20 736f 7572 6365 5f67 6466  ed on source_gdf
-00008120: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00008130: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00008140: 656c 6966 2073 6f75 7263 655f 6764 6620  elif source_gdf 
-00008150: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00008160: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00008170: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
-00008180: 4761 7567 6573 206c 6f63 6174 696f 6e73  Gauges locations
-00008190: 2072 6561 6420 6672 6f6d 2073 6f75 7263   read from sourc
-000081a0: 655f 6764 6622 290a 2020 2020 2020 2020  e_gdf").        
-000081b0: 2020 2020 2020 2020 6764 6620 3d20 736f          gdf = so
-000081c0: 7572 6365 5f67 6466 2e74 6f5f 6372 7328  urce_gdf.to_crs(
-000081d0: 7365 6c66 2e63 7273 290a 0a20 2020 2020  self.crs)..     
-000081e0: 2020 2020 2020 2069 6620 6764 662e 696e         if gdf.in
-000081f0: 6465 782e 7369 7a65 203d 3d20 303a 0a20  dex.size == 0:. 
-00008200: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008210: 656c 662e 6c6f 6767 6572 2e77 6172 6e69  elf.logger.warni
-00008220: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
-00008230: 2020 2020 2020 2020 6622 4e6f 207b 6761          f"No {ga
-00008240: 7567 6573 5f66 6e7d 2067 6175 6765 206c  uges_fn} gauge l
-00008250: 6f63 6174 696f 6e73 2066 6f75 6e64 2077  ocations found w
-00008260: 6974 6869 6e20 646f 6d61 696e 220a 2020  ithin domain".  
-00008270: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00008280: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00008290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000082a0: 2020 6966 2062 6173 656e 616d 6520 6973    if basename is
-000082b0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000082c0: 2020 2020 2020 2020 2020 2062 6173 656e             basen
-000082d0: 616d 6520 3d20 280a 2020 2020 2020 2020  ame = (.        
-000082e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082f0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-00008300: 2867 6175 6765 735f 666e 292e 7370 6c69  (gauges_fn).spli
-00008310: 7428 222e 2229 5b30 5d2e 7265 706c 6163  t(".")[0].replac
-00008320: 6528 225f 222c 2022 2d22 290a 2020 2020  e("_", "-").    
-00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008340: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00008350: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
-00008360: 666f 280a 2020 2020 2020 2020 2020 2020  fo(.            
-00008370: 2020 2020 2020 2020 6622 7b67 6466 2e69          f"{gdf.i
-00008380: 6e64 6578 2e73 697a 657d 207b 6261 7365  ndex.size} {base
-00008390: 6e61 6d65 7d20 6761 7567 6520 6c6f 6361  name} gauge loca
-000083a0: 7469 6f6e 7320 666f 756e 6420 7769 7468  tions found with
-000083b0: 696e 2064 6f6d 6169 6e22 0a20 2020 2020  in domain".     
-000083c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000083d0: 2020 2020 2020 2020 2020 2020 2023 2053               # S
-000083e0: 6574 2069 6e64 6578 2074 6f20 696e 6465  et index to inde
-000083f0: 785f 636f 6c0a 2020 2020 2020 2020 2020  x_col.          
-00008400: 2020 2020 2020 6966 2069 6e64 6578 5f63        if index_c
-00008410: 6f6c 2069 7320 6e6f 7420 4e6f 6e65 2061  ol is not None a
-00008420: 6e64 2069 6e64 6578 5f63 6f6c 2069 6e20  nd index_col in 
-00008430: 6764 663a 0a20 2020 2020 2020 2020 2020  gdf:.           
-00008440: 2020 2020 2020 2020 2067 6466 203d 2067           gdf = g
-00008450: 6466 2e73 6574 5f69 6e64 6578 2869 6e64  df.set_index(ind
-00008460: 6578 5f63 6f6c 290a 2020 2020 2020 2020  ex_col).        
-00008470: 2020 2020 2020 2020 7873 2c20 7973 203d          xs, ys =
-00008480: 206e 702e 7665 6374 6f72 697a 6528 6c61   np.vectorize(la
-00008490: 6d62 6461 2070 3a20 2870 2e78 795b 305d  mbda p: (p.xy[0]
-000084a0: 5b30 5d2c 2070 2e78 795b 315d 5b30 5d29  [0], p.xy[1][0])
-000084b0: 2928 0a20 2020 2020 2020 2020 2020 2020  )(.             
-000084c0: 2020 2020 2020 2067 6466 5b22 6765 6f6d         gdf["geom
-000084d0: 6574 7279 225d 0a20 2020 2020 2020 2020  etry"].         
-000084e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000084f0: 2020 2020 2020 2020 2069 6478 7320 3d20           idxs = 
-00008500: 7365 6c66 2e73 7461 7469 636d 6170 732e  self.staticmaps.
-00008510: 7261 7374 6572 2e78 795f 746f 5f69 6478  raster.xy_to_idx
-00008520: 2878 732c 2079 7329 0a20 2020 2020 2020  (xs, ys).       
-00008530: 2020 2020 2020 2020 2069 6473 203d 2067           ids = g
-00008540: 6466 2e69 6e64 6578 2e76 616c 7565 730a  df.index.values.
-00008550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008560: 2069 6620 736e 6170 5f74 6f5f 7269 7665   if snap_to_rive
-00008570: 7220 616e 6420 6d61 736b 2069 7320 4e6f  r and mask is No
-00008580: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00008590: 2020 2020 2020 2020 6d61 736b 203d 2073          mask = s
-000085a0: 656c 662e 7374 6174 6963 6d61 7073 5b73  elf.staticmaps[s
-000085b0: 656c 662e 5f4d 4150 535b 2272 6976 6d73  elf._MAPS["rivms
-000085c0: 6b22 5d5d 2e76 616c 7565 730a 2020 2020  k"]].values.    
-000085d0: 2020 2020 2020 2020 2020 2020 6461 2c20              da, 
-000085e0: 6964 7873 2c20 6964 7320 3d20 666c 772e  idxs, ids = flw.
-000085f0: 6761 7567 655f 6d61 7028 0a20 2020 2020  gauge_map(.     
-00008600: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008610: 656c 662e 7374 6174 6963 6d61 7073 2c0a  elf.staticmaps,.
-00008620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008630: 2020 2020 6964 7873 3d69 6478 732c 0a20      idxs=idxs,. 
-00008640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008650: 2020 2069 6473 3d69 6473 2c0a 2020 2020     ids=ids,.    
-00008660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008670: 7374 7265 616d 3d6d 6173 6b2c 0a20 2020  stream=mask,.   
-00008680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008690: 2066 6c77 6469 723d 7365 6c66 2e66 6c77   flwdir=self.flw
-000086a0: 6469 722c 0a20 2020 2020 2020 2020 2020  dir,.           
-000086b0: 2020 2020 2020 2020 206c 6f67 6765 723d           logger=
-000086c0: 7365 6c66 2e6c 6f67 6765 722c 0a20 2020  self.logger,.   
-000086d0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-000086e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000086f0: 2046 696c 7465 7220 6761 7567 6573 2074   Filter gauges t
-00008700: 6861 7420 636f 756c 6420 6e6f 7420 6265  hat could not be
-00008710: 2073 6e61 7070 6564 2074 6f20 7269 7665   snapped to rive
-00008720: 7273 0a20 2020 2020 2020 2020 2020 2020  rs.             
-00008730: 2020 2069 6620 736e 6170 5f74 6f5f 7269     if snap_to_ri
-00008740: 7665 723a 0a20 2020 2020 2020 2020 2020  ver:.           
-00008750: 2020 2020 2020 2020 2069 6473 5f6f 6c64           ids_old
-00008760: 203d 2069 6473 2e63 6f70 7928 290a 2020   = ids.copy().  
-00008770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008780: 2020 6461 203d 2064 612e 7768 6572 6528    da = da.where(
-00008790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000087a0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-000087b0: 6174 6963 6d61 7073 5b73 656c 662e 5f4d  aticmaps[self._M
-000087c0: 4150 535b 2272 6976 6d73 6b22 5d5d 2021  APS["rivmsk"]] !
-000087d0: 3d20 302c 2064 612e 7261 7374 6572 2e6e  = 0, da.raster.n
-000087e0: 6f64 6174 610a 2020 2020 2020 2020 2020  odata.          
-000087f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00008800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008810: 6964 735f 6e65 7720 3d20 6e70 2e75 6e69  ids_new = np.uni
-00008820: 7175 6528 6461 2e76 616c 7565 735b 6461  que(da.values[da
-00008830: 2e76 616c 7565 7320 3e20 305d 290a 2020  .values > 0]).  
-00008840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008850: 2020 6964 7873 203d 2069 6478 735b 6e70    idxs = idxs[np
-00008860: 2e69 7369 6e28 6964 735f 6f6c 642c 2069  .isin(ids_old, i
-00008870: 6473 5f6e 6577 295d 0a20 2020 2020 2020  ds_new)].       
-00008880: 2020 2020 2020 2020 2020 2020 2069 6473               ids
-00008890: 203d 2064 612e 7661 6c75 6573 2e66 6c61   = da.values.fla
-000088a0: 745b 6964 7873 5d0a 2020 2020 2020 2020  t[idxs].        
-000088b0: 2020 2020 2020 2020 2320 4164 6420 746f          # Add to
-000088c0: 2073 7461 7469 636d 6170 730a 2020 2020   staticmaps.    
-000088d0: 2020 2020 2020 2020 2020 2020 6d61 706e              mapn
-000088e0: 616d 6520 3d20 6627 7b73 7472 2873 656c  ame = f'{str(sel
-000088f0: 662e 5f4d 4150 535b 2267 6175 6765 7322  f._MAPS["gauges"
-00008900: 5d29 7d5f 7b62 6173 656e 616d 657d 270a  ])}_{basename}'.
-00008910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008920: 7365 6c66 2e73 6574 5f73 7461 7469 636d  self.set_staticm
-00008930: 6170 7328 6461 2c20 6e61 6d65 3d6d 6170  aps(da, name=map
-00008940: 6e61 6d65 290a 0a20 2020 2020 2020 2020  name)..         
-00008950: 2020 2020 2020 2023 2067 656f 6d73 0a20         # geoms. 
-00008960: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008970: 6f69 6e74 7320 3d20 6770 642e 706f 696e  oints = gpd.poin
-00008980: 7473 5f66 726f 6d5f 7879 282a 7365 6c66  ts_from_xy(*self
-00008990: 2e73 7461 7469 636d 6170 732e 7261 7374  .staticmaps.rast
-000089a0: 6572 2e69 6478 5f74 6f5f 7879 2869 6478  er.idx_to_xy(idx
-000089b0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-000089c0: 2020 2020 2320 6966 2063 7376 2063 6f6e      # if csv con
-000089d0: 7461 696e 7320 6164 6469 7469 6f6e 616c  tains additional
-000089e0: 2063 6f6c 756d 6e73 2c20 7468 6573 6520   columns, these 
-000089f0: 6172 6520 616c 736f 2077 7269 7474 656e  are also written
-00008a00: 2069 6e20 7468 6520 7374 6174 6963 6765   in the staticge
-00008a10: 6f6d 730a 2020 2020 2020 2020 2020 2020  oms.            
-00008a20: 2020 2020 6764 665f 736e 6170 7065 6420      gdf_snapped 
-00008a30: 3d20 6770 642e 4765 6f44 6174 6146 7261  = gpd.GeoDataFra
-00008a40: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-00008a50: 2020 2020 2020 2020 696e 6465 783d 6964          index=id
-00008a60: 732e 6173 7479 7065 286e 702e 696e 7433  s.astype(np.int3
-00008a70: 3229 2c20 6765 6f6d 6574 7279 3d70 6f69  2), geometry=poi
-00008a80: 6e74 732c 2063 7273 3d73 656c 662e 6372  nts, crs=self.cr
-00008a90: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00008aa0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00008ab0: 2020 2020 2320 5365 7420 7468 6520 696e      # Set the in
-00008ac0: 6465 7820 6e61 6d65 206f 6620 6764 6620  dex name of gdf 
-00008ad0: 736e 6170 7065 6420 6261 7365 6420 6f6e  snapped based on
-00008ae0: 206f 7269 6769 6e61 6c20 6764 660a 2020   original gdf.  
-00008af0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00008b00: 2067 6466 2e69 6e64 6578 2e6e 616d 6520   gdf.index.name 
-00008b10: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00008b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b30: 2067 6466 5f73 6e61 7070 6564 2e69 6e64   gdf_snapped.ind
-00008b40: 6578 2e6e 616d 6520 3d20 6764 662e 696e  ex.name = gdf.in
-00008b50: 6465 782e 6e61 6d65 0a20 2020 2020 2020  dex.name.       
-00008b60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00008b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b80: 2020 2067 6466 5f73 6e61 7070 6564 2e69     gdf_snapped.i
-00008b90: 6e64 6578 2e6e 616d 6520 3d20 2266 6964  ndex.name = "fid
-00008ba0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00008bb0: 2020 2020 2020 6764 662e 696e 6465 782e        gdf.index.
-00008bc0: 6e61 6d65 203d 2022 6669 6422 0a20 2020  name = "fid".   
-00008bd0: 2020 2020 2020 2020 2020 2020 2023 2041               # A
-00008be0: 6464 2067 6466 2061 7474 7269 6275 7465  dd gdf attribute
-00008bf0: 7320 746f 2067 6466 5f73 6e61 7070 6564  s to gdf_snapped
-00008c00: 2028 6669 6c74 6572 206f 6e20 736e 6170   (filter on snap
-00008c10: 7065 6420 696e 6465 7820 6265 666f 7265  ped index before
-00008c20: 206d 6572 6769 6e67 290a 2020 2020 2020   merging).      
-00008c30: 2020 2020 2020 2020 2020 6466 5f61 7474            df_att
-00008c40: 7273 203d 2070 642e 4461 7461 4672 616d  rs = pd.DataFram
-00008c50: 6528 6764 662e 6472 6f70 2863 6f6c 756d  e(gdf.drop(colum
-00008c60: 6e73 3d22 6765 6f6d 6574 7279 2229 290a  ns="geometry")).
-00008c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c80: 6466 5f61 7474 7273 203d 2064 665f 6174  df_attrs = df_at
-00008c90: 7472 735b 6e70 2e69 7369 6e28 6466 5f61  trs[np.isin(df_a
-00008ca0: 7474 7273 2e69 6e64 6578 2c20 6764 665f  ttrs.index, gdf_
-00008cb0: 736e 6170 7065 642e 696e 6465 7829 5d0a  snapped.index)].
-00008cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008cd0: 6764 665f 736e 6170 7065 6420 3d20 6764  gdf_snapped = gd
-00008ce0: 665f 736e 6170 7065 642e 6d65 7267 6528  f_snapped.merge(
-00008cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008d00: 2020 2020 2064 665f 6174 7472 732c 2068       df_attrs, h
-00008d10: 6f77 3d22 696e 6e65 7222 2c20 6f6e 3d67  ow="inner", on=g
-00008d20: 6466 2e69 6e64 6578 2e6e 616d 650a 2020  df.index.name.  
-00008d30: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00008d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d50: 2320 4164 6420 6764 665f 736e 6170 7065  # Add gdf_snappe
-00008d60: 6420 746f 2073 7461 7469 6367 656f 6d73  d to staticgeoms
-00008d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008d80: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
-00008d90: 6765 6f6d 7328 6764 665f 736e 6170 7065  geoms(gdf_snappe
-00008da0: 642c 206e 616d 653d 6d61 706e 616d 652e  d, name=mapname.
-00008db0: 7265 706c 6163 6528 2277 666c 6f77 5f22  replace("wflow_"
-00008dc0: 2c20 2222 2929 0a0a 2020 2020 2020 2020  , ""))..        
-00008dd0: 2020 2020 2020 2020 2320 2320 4164 6420          # # Add 
-00008de0: 6e65 7720 6f75 7470 7574 6373 7620 7365  new outputcsv se
-00008df0: 6374 696f 6e20 696e 2074 6865 2063 6f6e  ction in the con
-00008e00: 6669 670a 2020 2020 2020 2020 2020 2020  fig.            
-00008e10: 2020 2020 6966 2067 6175 6765 5f74 6f6d      if gauge_tom
-00008e20: 6c5f 7061 7261 6d20 6973 204e 6f6e 6520  l_param is None 
-00008e30: 616e 6420 7570 6461 7465 5f74 6f6d 6c3a  and update_toml:
-00008e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008e50: 2020 2020 2067 6175 6765 5f74 6f6d 6c5f       gauge_toml_
-00008e60: 6865 6164 6572 203d 205b 2251 222c 2022  header = ["Q", "
-00008e70: 5022 5d0a 2020 2020 2020 2020 2020 2020  P"].            
-00008e80: 2020 2020 2020 2020 6761 7567 655f 746f          gauge_to
-00008e90: 6d6c 5f70 6172 616d 203d 205b 226c 6174  ml_param = ["lat
-00008ea0: 6572 616c 2e72 6976 6572 2e71 5f61 7622  eral.river.q_av"
-00008eb0: 2c20 2276 6572 7469 6361 6c2e 7072 6563  , "vertical.prec
-00008ec0: 6970 6974 6174 696f 6e22 5d0a 0a20 2020  ipitation"]..   
-00008ed0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00008ee0: 7570 6461 7465 5f74 6f6d 6c3a 0a20 2020  update_toml:.   
-00008ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f00: 2073 656c 662e 7365 745f 636f 6e66 6967   self.set_config
-00008f10: 2866 2269 6e70 7574 2e67 6175 6765 735f  (f"input.gauges_
-00008f20: 7b62 6173 656e 616d 657d 222c 2066 227b  {basename}", f"{
-00008f30: 6d61 706e 616d 657d 2229 0a20 2020 2020  mapname}").     
-00008f40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00008f50: 6620 7365 6c66 2e67 6574 5f63 6f6e 6669  f self.get_confi
-00008f60: 6728 2263 7376 2229 2069 7320 6e6f 7420  g("csv") is not 
-00008f70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00008f80: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00008f90: 7220 6f20 696e 2072 616e 6765 286c 656e  r o in range(len
-00008fa0: 2867 6175 6765 5f74 6f6d 6c5f 7061 7261  (gauge_toml_para
-00008fb0: 6d29 293a 0a20 2020 2020 2020 2020 2020  m)):.           
-00008fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fd0: 2067 6175 6765 5f74 6f6d 6c5f 6469 6374   gauge_toml_dict
-00008fe0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00008ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009000: 2020 2020 2022 6865 6164 6572 223a 2067       "header": g
-00009010: 6175 6765 5f74 6f6d 6c5f 6865 6164 6572  auge_toml_header
-00009020: 5b6f 5d2c 0a20 2020 2020 2020 2020 2020  [o],.           
-00009030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009040: 2020 2020 2022 6d61 7022 3a20 6622 6761       "map": f"ga
-00009050: 7567 6573 5f7b 6261 7365 6e61 6d65 7d22  uges_{basename}"
-00009060: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009080: 2020 2270 6172 616d 6574 6572 223a 2067    "parameter": g
-00009090: 6175 6765 5f74 6f6d 6c5f 7061 7261 6d5b  auge_toml_param[
-000090a0: 6f5d 2c0a 2020 2020 2020 2020 2020 2020  o],.            
-000090b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000090c0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000090d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000090e0: 4966 2074 6865 2067 6175 6765 206f 7574  If the gauge out
-000090f0: 6373 7620 636f 6c75 6d6e 2061 6c72 6561  csv column alrea
-00009100: 6479 2065 7869 7374 7320 736b 6970 2077  dy exists skip w
-00009110: 7269 7474 696e 6720 7477 6963 650a 2020  ritting twice.  
-00009120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009130: 2020 2020 2020 2020 2020 6966 2067 6175            if gau
-00009140: 6765 5f74 6f6d 6c5f 6469 6374 206e 6f74  ge_toml_dict not
-00009150: 2069 6e20 7365 6c66 2e63 6f6e 6669 675b   in self.config[
-00009160: 2263 7376 225d 5b22 636f 6c75 6d6e 225d  "csv"]["column"]
-00009170: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009190: 2020 7365 6c66 2e63 6f6e 6669 675b 2263    self.config["c
-000091a0: 7376 225d 5b22 636f 6c75 6d6e 225d 2e61  sv"]["column"].a
-000091b0: 7070 656e 6428 6761 7567 655f 746f 6d6c  ppend(gauge_toml
-000091c0: 5f64 6963 7429 0a20 2020 2020 2020 2020  _dict).         
-000091d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000091e0: 6c6f 6767 6572 2e69 6e66 6f28 6622 4761  logger.info(f"Ga
-000091f0: 7567 6573 206d 6170 2066 726f 6d20 7b62  uges map from {b
-00009200: 6173 656e 616d 657d 2061 6464 6564 2e22  asename} added."
-00009210: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00009220: 2020 2023 2061 6464 2073 7562 6361 7463     # add subcatc
-00009230: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
-00009240: 2020 6966 2064 6572 6976 655f 7375 6263    if derive_subc
-00009250: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-00009260: 2020 2020 2020 2020 2020 6461 5f62 6173            da_bas
-00009270: 696e 7320 3d20 666c 772e 6261 7369 6e5f  ins = flw.basin_
-00009280: 6d61 7028 0a20 2020 2020 2020 2020 2020  map(.           
-00009290: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000092a0: 662e 7374 6174 6963 6d61 7073 2c20 7365  f.staticmaps, se
-000092b0: 6c66 2e66 6c77 6469 722c 2069 6478 733d  lf.flwdir, idxs=
-000092c0: 6964 7873 2c20 6964 733d 6964 730a 2020  idxs, ids=ids.  
-000092d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092e0: 2020 295b 305d 0a20 2020 2020 2020 2020    )[0].         
-000092f0: 2020 2020 2020 2020 2020 206d 6170 6e61             mapna
-00009300: 6d65 203d 2073 656c 662e 5f4d 4150 535b  me = self._MAPS[
-00009310: 2262 6173 696e 7322 5d20 2b20 225f 2220  "basins"] + "_" 
-00009320: 2b20 6261 7365 6e61 6d65 0a20 2020 2020  + basename.     
-00009330: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009340: 656c 662e 7365 745f 7374 6174 6963 6d61  elf.set_staticma
-00009350: 7073 2864 615f 6261 7369 6e73 2c20 6e61  ps(da_basins, na
-00009360: 6d65 3d6d 6170 6e61 6d65 290a 2020 2020  me=mapname).    
-00009370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009380: 6764 665f 6261 7369 6e73 203d 2073 656c  gdf_basins = sel
-00009390: 662e 7374 6174 6963 6d61 7073 5b6d 6170  f.staticmaps[map
-000093a0: 6e61 6d65 5d2e 7261 7374 6572 2e76 6563  name].raster.vec
-000093b0: 746f 7269 7a65 2829 0a20 2020 2020 2020  torize().       
-000093c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000093d0: 662e 7365 745f 7374 6174 6963 6765 6f6d  f.set_staticgeom
-000093e0: 7328 6764 665f 6261 7369 6e73 2c20 6e61  s(gdf_basins, na
-000093f0: 6d65 3d6d 6170 6e61 6d65 2e72 6570 6c61  me=mapname.repla
-00009400: 6365 2822 7766 6c6f 775f 222c 2022 2229  ce("wflow_", "")
-00009410: 290a 0a20 2020 2064 6566 2073 6574 7570  )..    def setup
-00009420: 5f61 7265 616d 6170 280a 2020 2020 2020  _areamap(.      
-00009430: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00009440: 6172 6561 5f66 6e3a 2073 7472 2c0a 2020  area_fn: str,.  
-00009450: 2020 2020 2020 636f 6c32 7261 7374 6572        col2raster
-00009460: 3a20 7374 722c 0a20 2020 2020 2020 206e  : str,.        n
-00009470: 6f64 6174 613a 2055 6e69 6f6e 5b69 6e74  odata: Union[int
-00009480: 2c20 666c 6f61 745d 203d 202d 312c 0a20  , float] = -1,. 
-00009490: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-000094a0: 2253 6574 7570 2061 7265 6120 6d61 7020  "Setup area map 
-000094b0: 6672 6f6d 2076 6563 746f 7220 6461 7461  from vector data
-000094c0: 2074 6f20 7361 7665 2077 666c 6f77 206f   to save wflow o
-000094d0: 7574 7075 7473 2066 6f72 2073 7065 6369  utputs for speci
-000094e0: 6669 6320 6172 6561 2e0a 2020 2020 2020  fic area..      
-000094f0: 2020 4164 6473 206d 6f64 656c 206c 6179    Adds model lay
-00009500: 6572 3a0a 2020 2020 2020 2020 2a20 2a2a  er:.        * **
-00009510: 6172 6561 5f66 6e2a 2a20 6d61 703a 2020  area_fn** map:  
-00009520: 6f75 7470 7574 2061 7265 6120 6461 7461  output area data
-00009530: 206d 6170 0a20 2020 2020 2020 2050 6172   map.        Par
-00009540: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00009550: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00009560: 2020 2061 7265 615f 666e 203a 2073 7472     area_fn : str
-00009570: 0a20 2020 2020 2020 2020 2020 204e 616d  .            Nam
-00009580: 6520 6f66 2076 6563 746f 7220 6461 7461  e of vector data
-00009590: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-000095a0: 6f20 7766 6c6f 7720 6f75 7470 7574 2061  o wflow output a
-000095b0: 7265 612e 0a20 2020 2020 2020 2063 6f6c  rea..        col
-000095c0: 3272 6173 7465 7220 3a20 7374 720a 2020  2raster : str.  
-000095d0: 2020 2020 2020 2020 2020 4e61 6d65 206f            Name o
-000095e0: 6620 7468 6520 636f 6c75 6d6e 2066 726f  f the column fro
-000095f0: 6d20 7468 6520 7665 6374 6f72 2066 696c  m the vector fil
-00009600: 6520 746f 2072 6173 7465 7269 7a65 2e0a  e to rasterize..
-00009610: 2020 2020 2020 2020 6e6f 6461 7461 203a          nodata :
-00009620: 2069 6e74 2f66 6c6f 6174 2c20 6f70 7469   int/float, opti
-00009630: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00009640: 204e 6f64 6174 6120 7661 6c75 6520 746f   Nodata value to
-00009650: 2075 7365 2077 6865 6e20 7261 7374 6572   use when raster
-00009660: 697a 696e 672e 2053 686f 756c 6420 6d61  izing. Should ma
-00009670: 7463 6820 7468 6520 6474 7970 6520 6f66  tch the dtype of
-00009680: 2063 6f6c 3272 6173 7465 722e 2042 7920   col2raster. By 
-00009690: 6465 6661 756c 7420 2d31 2e0a 2020 2020  default -1..    
-000096a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000096b0: 6966 2061 7265 615f 666e 206e 6f74 2069  if area_fn not i
-000096c0: 6e20 7365 6c66 2e64 6174 615f 6361 7461  n self.data_cata
-000096d0: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-000096e0: 2073 656c 662e 6c6f 6767 6572 2e77 6172   self.logger.war
-000096f0: 6e69 6e67 2866 2249 6e76 616c 6964 2073  ning(f"Invalid s
-00009700: 6f75 7263 6520 277b 6172 6561 5f66 6e7d  ource '{area_fn}
-00009710: 272c 2073 6b69 7070 696e 6720 7365 7475  ', skipping setu
-00009720: 705f 6172 6561 6d61 702e 2229 0a20 2020  p_areamap.").   
-00009730: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00009740: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00009750: 6767 6572 2e69 6e66 6f28 6622 5072 6570  gger.info(f"Prep
-00009760: 6172 696e 6720 277b 6172 6561 5f66 6e7d  aring '{area_fn}
-00009770: 2720 6d61 702e 2229 0a20 2020 2020 2020  ' map.").       
-00009780: 2067 6466 5f6f 7267 203d 2073 656c 662e   gdf_org = self.
-00009790: 6461 7461 5f63 6174 616c 6f67 2e67 6574  data_catalog.get
-000097a0: 5f67 656f 6461 7461 6672 616d 6528 0a20  _geodataframe(. 
-000097b0: 2020 2020 2020 2020 2020 2061 7265 615f             area_
-000097c0: 666e 2c20 6765 6f6d 3d73 656c 662e 6261  fn, geom=self.ba
-000097d0: 7369 6e73 2c20 6473 745f 6372 733d 7365  sins, dst_crs=se
-000097e0: 6c66 2e63 7273 0a20 2020 2020 2020 2029  lf.crs.        )
-000097f0: 0a20 2020 2020 2020 2069 6620 6764 665f  .        if gdf_
-00009800: 6f72 672e 656d 7074 793a 0a20 2020 2020  org.empty:.     
-00009810: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-00009820: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
-00009830: 2020 2020 2020 2020 2020 2020 6622 4e6f              f"No
-00009840: 2073 6861 7065 7320 6f66 207b 6172 6561   shapes of {area
-00009850: 5f66 6e7d 2066 6f75 6e64 2077 6974 6869  _fn} found withi
-00009860: 6e20 7265 6769 6f6e 2c20 736b 6970 7069  n region, skippi
-00009870: 6e67 2061 7265 616d 6170 2e22 0a20 2020  ng areamap.".   
-00009880: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00009890: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-000098a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000098b0: 2020 2020 2020 2020 6461 5f61 7265 6120          da_area 
-000098c0: 3d20 7365 6c66 2e73 7461 7469 636d 6170  = self.staticmap
-000098d0: 732e 7261 7374 6572 2e72 6173 7465 7269  s.raster.rasteri
-000098e0: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
-000098f0: 2020 2020 6764 663d 6764 665f 6f72 672c      gdf=gdf_org,
-00009900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009910: 2063 6f6c 5f6e 616d 653d 636f 6c32 7261   col_name=col2ra
-00009920: 7374 6572 2c0a 2020 2020 2020 2020 2020  ster,.          
-00009930: 2020 2020 2020 6e6f 6461 7461 3d6e 6f64        nodata=nod
-00009940: 6174 612c 0a20 2020 2020 2020 2020 2020  ata,.           
-00009950: 2020 2020 2061 6c6c 5f74 6f75 6368 6564       all_touched
-00009960: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00009970: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-00009980: 662e 7365 745f 7374 6174 6963 6d61 7073  f.set_staticmaps
-00009990: 2864 615f 6172 6561 2e72 656e 616d 6528  (da_area.rename(
-000099a0: 6172 6561 5f66 6e29 290a 0a20 2020 2064  area_fn))..    d
-000099b0: 6566 2073 6574 7570 5f6c 616b 6573 2873  ef setup_lakes(s
-000099c0: 656c 662c 206c 616b 6573 5f66 6e3d 2268  elf, lakes_fn="h
-000099d0: 7964 726f 5f6c 616b 6573 222c 206d 696e  ydro_lakes", min
-000099e0: 5f61 7265 613d 3130 2e30 293a 0a20 2020  _area=10.0):.   
-000099f0: 2020 2020 2022 2222 5468 6973 2063 6f6d       """This com
-00009a00: 706f 6e65 6e74 2067 656e 6572 6174 6573  ponent generates
-00009a10: 206d 6170 7320 6f66 206c 616b 6520 6172   maps of lake ar
-00009a20: 6561 7320 616e 6420 6f75 746c 6574 7320  eas and outlets 
-00009a30: 6173 2077 656c 6c20 6173 2070 6172 616d  as well as param
-00009a40: 6574 6572 730a 2020 2020 2020 2020 7769  eters.        wi
-00009a50: 7468 2061 7665 7261 6765 206c 616b 6520  th average lake 
-00009a60: 6172 6561 2c20 6465 7074 6820 6120 6469  area, depth a di
-00009a70: 7363 6861 7267 6520 7661 6c75 6573 2e0a  scharge values..
-00009a80: 0a20 2020 2020 2020 2054 6865 2064 6174  .        The dat
-00009a90: 6120 6973 2067 656e 6572 6174 6564 2066  a is generated f
-00009aa0: 726f 6d20 6665 6174 7572 6573 2077 6974  rom features wit
-00009ab0: 6820 6060 6d69 6e5f 6172 6561 6060 205b  h ``min_area`` [
-00009ac0: 6b6d 325d 2028 6465 6661 756c 7420 3120  km2] (default 1 
-00009ad0: 6b6d 3229 2066 726f 6d20 6120 6461 7461  km2) from a data
-00009ae0: 6261 7365 2077 6974 680a 2020 2020 2020  base with.      
-00009af0: 2020 6c61 6b65 2067 656f 6d65 7472 792c    lake geometry,
-00009b00: 2049 4473 2061 6e64 206d 6574 6164 6174   IDs and metadat
-00009b10: 612e 2044 6174 6120 7265 7175 6972 6564  a. Data required
-00009b20: 2061 7265 206c 616b 6520 4944 2027 7761   are lake ID 'wa
-00009b30: 7465 7262 6f64 795f 6964 272c 2061 7665  terbody_id', ave
-00009b40: 7261 6765 2061 7265 6120 2741 7265 615f  rage area 'Area_
-00009b50: 6176 6727 205b 6d32 5d2c 0a20 2020 2020  avg' [m2],.     
-00009b60: 2020 2061 7665 7261 6765 2076 6f6c 756d     average volum
-00009b70: 6520 2756 6f6c 5f61 7667 2720 5b6d 335d  e 'Vol_avg' [m3]
-00009b80: 2c20 6176 6572 6167 6520 6465 7074 6820  , average depth 
-00009b90: 2744 6570 7468 5f61 7667 2720 5b6d 5d20  'Depth_avg' [m] 
-00009ba0: 616e 6420 6176 6572 6167 6520 6469 7363  and average disc
-00009bb0: 6861 7267 6520 2744 6973 5f61 7667 2720  harge 'Dis_avg' 
-00009bc0: 5b6d 332f 735d 2e0a 0a20 2020 2020 2020  [m3/s]...       
-00009bd0: 2041 6464 7320 6d6f 6465 6c20 6c61 7965   Adds model laye
-00009be0: 7273 3a0a 0a20 2020 2020 2020 202a 202a  rs:..        * *
-00009bf0: 2a77 666c 6f77 5f6c 616b 6561 7265 6173  *wflow_lakeareas
-00009c00: 2a2a 206d 6170 3a20 6c61 6b65 2049 4473  ** map: lake IDs
-00009c10: 205b 2d5d 0a20 2020 2020 2020 202a 202a   [-].        * *
-00009c20: 2a77 666c 6f77 5f6c 616b 656c 6f63 732a  *wflow_lakelocs*
-00009c30: 2a20 6d61 703a 206c 616b 6520 4944 7320  * map: lake IDs 
-00009c40: 6174 206f 7574 6c65 7420 6c6f 6361 7469  at outlet locati
-00009c50: 6f6e 7320 5b2d 5d0a 2020 2020 2020 2020  ons [-].        
-00009c60: 2a20 2a2a 4c61 6b65 4172 6561 2a2a 206d  * **LakeArea** m
-00009c70: 6170 3a20 6c61 6b65 2061 7265 6120 5b6d  ap: lake area [m
-00009c80: 325d 0a20 2020 2020 2020 202a 202a 2a4c  2].        * **L
-00009c90: 616b 6541 7667 4c65 7665 6c2a 2a20 6d61  akeAvgLevel** ma
-00009ca0: 703a 206c 616b 6520 6176 6572 6167 6520  p: lake average 
-00009cb0: 7761 7465 7220 6c65 7665 6c20 5b6d 5d0a  water level [m].
-00009cc0: 2020 2020 2020 2020 2a20 2a2a 4c61 6b65          * **Lake
-00009cd0: 4176 674f 7574 2a2a 206d 6170 3a20 6c61  AvgOut** map: la
-00009ce0: 6b65 2061 7665 7261 6765 2064 6973 6368  ke average disch
-00009cf0: 6172 6765 205b 6d33 2f73 5d0a 2020 2020  arge [m3/s].    
-00009d00: 2020 2020 2a20 2a2a 4c61 6b65 5f62 2a2a      * **Lake_b**
-00009d10: 206d 6170 3a20 6c61 6b65 2072 6174 696e   map: lake ratin
-00009d20: 6720 6375 7276 6520 636f 6566 6669 6369  g curve coeffici
-00009d30: 656e 7420 5b2d 5d0a 2020 2020 2020 2020  ent [-].        
-00009d40: 2a20 2a2a 6c61 6b65 732a 2a20 6765 6f6d  * **lakes** geom
-00009d50: 3a20 706f 6c79 676f 6e20 7769 7468 206c  : polygon with l
-00009d60: 616b 6573 2061 6e64 2077 666c 6f77 206c  akes and wflow l
-00009d70: 616b 6520 7061 7261 6d65 7465 7273 0a0a  ake parameters..
-00009d80: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00009d90: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00009da0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6c61  -----.        la
-00009db0: 6b65 735f 666e 203a 207b 2768 7964 726f  kes_fn : {'hydro
-00009dc0: 5f6c 616b 6573 277d 0a20 2020 2020 2020  _lakes'}.       
-00009dd0: 2020 2020 204e 616d 6520 6f66 2064 6174       Name of dat
-00009de0: 6120 736f 7572 6365 2066 6f72 206c 616b  a source for lak
-00009df0: 6520 7061 7261 6d65 7465 7273 2c20 7365  e parameters, se
-00009e00: 6520 6461 7461 2f64 6174 615f 736f 7572  e data/data_sour
-00009e10: 6365 732e 796d 6c2e 0a0a 2020 2020 2020  ces.yml...      
-00009e20: 2020 2020 2020 2a20 5265 7175 6972 6564        * Required
-00009e30: 2076 6172 6961 626c 6573 3a20 5b27 7761   variables: ['wa
-00009e40: 7465 7262 6f64 795f 6964 272c 2027 4172  terbody_id', 'Ar
-00009e50: 6561 5f61 7667 272c 2027 566f 6c5f 6176  ea_avg', 'Vol_av
-00009e60: 6727 2c20 2744 6570 7468 5f61 7667 272c  g', 'Depth_avg',
-00009e70: 2027 4469 735f 6176 6727 5d0a 2020 2020   'Dis_avg'].    
-00009e80: 2020 2020 6d69 6e5f 6172 6561 203a 2066      min_area : f
-00009e90: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0a20  loat, optional. 
-00009ea0: 2020 2020 2020 2020 2020 204d 696e 696d             Minim
-00009eb0: 756d 206c 616b 6520 6172 6561 2074 6872  um lake area thr
-00009ec0: 6573 686f 6c64 205b 6b6d 325d 2c20 6279  eshold [km2], by
-00009ed0: 2064 6566 6175 6c74 2031 2e30 206b 6d32   default 1.0 km2
-00009ee0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00009ef0: 2020 2020 2020 206c 616b 6573 5f74 6f6d         lakes_tom
-00009f00: 6c20 3d20 7b0a 2020 2020 2020 2020 2020  l = {.          
-00009f10: 2020 226d 6f64 656c 2e6c 616b 6573 223a    "model.lakes":
-00009f20: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
-00009f30: 2020 2022 7374 6174 652e 6c61 7465 7261     "state.latera
-00009f40: 6c2e 7269 7665 722e 6c61 6b65 2e77 6174  l.river.lake.wat
-00009f50: 6572 6c65 7665 6c22 3a20 2277 6174 6572  erlevel": "water
-00009f60: 6c65 7665 6c5f 6c61 6b65 222c 0a20 2020  level_lake",.   
-00009f70: 2020 2020 2020 2020 2022 696e 7075 742e           "input.
-00009f80: 6c61 7465 7261 6c2e 7269 7665 722e 6c61  lateral.river.la
-00009f90: 6b65 2e61 7265 6122 3a20 224c 616b 6541  ke.area": "LakeA
-00009fa0: 7265 6122 2c0a 2020 2020 2020 2020 2020  rea",.          
-00009fb0: 2020 2269 6e70 7574 2e6c 6174 6572 616c    "input.lateral
-00009fc0: 2e72 6976 6572 2e6c 616b 652e 6172 6561  .river.lake.area
-00009fd0: 7322 3a20 2277 666c 6f77 5f6c 616b 6561  s": "wflow_lakea
-00009fe0: 7265 6173 222c 0a20 2020 2020 2020 2020  reas",.         
-00009ff0: 2020 2022 696e 7075 742e 6c61 7465 7261     "input.latera
-0000a000: 6c2e 7269 7665 722e 6c61 6b65 2e62 223a  l.river.lake.b":
-0000a010: 2022 4c61 6b65 5f62 222c 0a20 2020 2020   "Lake_b",.     
-0000a020: 2020 2020 2020 2022 696e 7075 742e 6c61         "input.la
-0000a030: 7465 7261 6c2e 7269 7665 722e 6c61 6b65  teral.river.lake
-0000a040: 2e65 223a 2022 4c61 6b65 5f65 222c 0a20  .e": "Lake_e",. 
-0000a050: 2020 2020 2020 2020 2020 2022 696e 7075             "inpu
-0000a060: 742e 6c61 7465 7261 6c2e 7269 7665 722e  t.lateral.river.
-0000a070: 6c61 6b65 2e6c 6f63 7322 3a20 2277 666c  lake.locs": "wfl
-0000a080: 6f77 5f6c 616b 656c 6f63 7322 2c0a 2020  ow_lakelocs",.  
-0000a090: 2020 2020 2020 2020 2020 2269 6e70 7574            "input
-0000a0a0: 2e6c 6174 6572 616c 2e72 6976 6572 2e6c  .lateral.river.l
-0000a0b0: 616b 652e 6f75 7466 6c6f 7766 756e 6322  ake.outflowfunc"
-0000a0c0: 3a20 224c 616b 654f 7574 666c 6f77 4675  : "LakeOutflowFu
-0000a0d0: 6e63 222c 0a20 2020 2020 2020 2020 2020  nc",.           
-0000a0e0: 2022 696e 7075 742e 6c61 7465 7261 6c2e   "input.lateral.
-0000a0f0: 7269 7665 722e 6c61 6b65 2e73 746f 7266  river.lake.storf
-0000a100: 756e 6322 3a20 224c 616b 6553 746f 7246  unc": "LakeStorF
-0000a110: 756e 6322 2c0a 2020 2020 2020 2020 2020  unc",.          
-0000a120: 2020 2269 6e70 7574 2e6c 6174 6572 616c    "input.lateral
-0000a130: 2e72 6976 6572 2e6c 616b 652e 7468 7265  .river.lake.thre
-0000a140: 7368 6f6c 6422 3a20 224c 616b 6554 6872  shold": "LakeThr
-0000a150: 6573 686f 6c64 222c 0a20 2020 2020 2020  eshold",.       
-0000a160: 2020 2020 2022 696e 7075 742e 6c61 7465       "input.late
-0000a170: 7261 6c2e 7269 7665 722e 6c61 6b65 2e6c  ral.river.lake.l
-0000a180: 696e 6b65 646c 616b 656c 6f63 7322 3a20  inkedlakelocs": 
-0000a190: 224c 696e 6b65 644c 616b 654c 6f63 7322  "LinkedLakeLocs"
-0000a1a0: 2c0a 2020 2020 2020 2020 2020 2020 2269  ,.            "i
-0000a1b0: 6e70 7574 2e6c 6174 6572 616c 2e72 6976  nput.lateral.riv
-0000a1c0: 6572 2e6c 616b 652e 7761 7465 726c 6576  er.lake.waterlev
-0000a1d0: 656c 223a 2022 4c61 6b65 4176 674c 6576  el": "LakeAvgLev
-0000a1e0: 656c 222c 0a20 2020 2020 2020 207d 0a0a  el",.        }..
-0000a1f0: 2020 2020 2020 2020 6764 665f 6f72 672c          gdf_org,
-0000a200: 2064 735f 6c61 6b65 7320 3d20 7365 6c66   ds_lakes = self
-0000a210: 2e5f 7365 7475 705f 7761 7465 7262 6f64  ._setup_waterbod
-0000a220: 6965 7328 6c61 6b65 735f 666e 2c20 226c  ies(lakes_fn, "l
-0000a230: 616b 6522 2c20 6d69 6e5f 6172 6561 290a  ake", min_area).
-0000a240: 2020 2020 2020 2020 6966 2064 735f 6c61          if ds_la
-0000a250: 6b65 7320 6973 206e 6f74 204e 6f6e 653a  kes is not None:
-0000a260: 0a20 2020 2020 2020 2020 2020 2072 6d64  .            rmd
-0000a270: 6963 7420 3d20 7b6b 3a20 7620 666f 7220  ict = {k: v for 
-0000a280: 6b2c 2076 2069 6e20 7365 6c66 2e5f 4d41  k, v in self._MA
-0000a290: 5053 2e69 7465 6d73 2829 2069 6620 6b20  PS.items() if k 
-0000a2a0: 696e 2064 735f 6c61 6b65 732e 6461 7461  in ds_lakes.data
-0000a2b0: 5f76 6172 737d 0a20 2020 2020 2020 2020  _vars}.         
-0000a2c0: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
-0000a2d0: 6963 6d61 7073 2864 735f 6c61 6b65 732e  icmaps(ds_lakes.
-0000a2e0: 7265 6e61 6d65 2872 6d64 6963 7429 290a  rename(rmdict)).
-0000a2f0: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
-0000a300: 6420 7761 7465 7262 6f64 7920 7061 7261  d waterbody para
-0000a310: 6d65 7465 7273 0a20 2020 2020 2020 2020  meters.         
-0000a320: 2020 2023 2072 656e 616d 6520 746f 2070     # rename to p
-0000a330: 6172 616d 2076 616c 7565 730a 2020 2020  aram values.    
-0000a340: 2020 2020 2020 2020 6764 665f 6f72 6720          gdf_org 
-0000a350: 3d20 6764 665f 6f72 672e 7265 6e61 6d65  = gdf_org.rename
-0000a360: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000a370: 2020 636f 6c75 6d6e 733d 7b0a 2020 2020    columns={.    
-0000a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a390: 2241 7265 615f 6176 6722 3a20 224c 616b  "Area_avg": "Lak
-0000a3a0: 6541 7265 6122 2c0a 2020 2020 2020 2020  eArea",.        
-0000a3b0: 2020 2020 2020 2020 2020 2020 2244 6570              "Dep
-0000a3c0: 7468 5f61 7667 223a 2022 4c61 6b65 4176  th_avg": "LakeAv
-0000a3d0: 674c 6576 656c 222c 0a20 2020 2020 2020  gLevel",.       
-0000a3e0: 2020 2020 2020 2020 2020 2020 2022 4469               "Di
-0000a3f0: 735f 6176 6722 3a20 224c 616b 6541 7667  s_avg": "LakeAvg
-0000a400: 4f75 7422 2c0a 2020 2020 2020 2020 2020  Out",.          
-0000a410: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000a420: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000a430: 2020 2320 4d69 6e69 6d75 6d20 7661 6c75    # Minimum valu
-0000a440: 6520 666f 7220 4c61 6b65 4176 674f 7574  e for LakeAvgOut
-0000a450: 0a20 2020 2020 2020 2020 2020 204c 616b  .            Lak
-0000a460: 6541 7667 4f75 7420 3d20 6764 665f 6f72  eAvgOut = gdf_or
-0000a470: 675b 224c 616b 6541 7667 4f75 7422 5d2e  g["LakeAvgOut"].
-0000a480: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-0000a490: 2020 2067 6466 5f6f 7267 5b22 4c61 6b65     gdf_org["Lake
-0000a4a0: 4176 674f 7574 225d 203d 206e 702e 6d61  AvgOut"] = np.ma
-0000a4b0: 7869 6d75 6d28 6764 665f 6f72 675b 224c  ximum(gdf_org["L
-0000a4c0: 616b 6541 7667 4f75 7422 5d2c 2030 2e30  akeAvgOut"], 0.0
-0000a4d0: 3129 0a20 2020 2020 2020 2020 2020 2067  1).            g
-0000a4e0: 6466 5f6f 7267 5b22 4c61 6b65 5f62 225d  df_org["Lake_b"]
-0000a4f0: 203d 2067 6466 5f6f 7267 5b22 4c61 6b65   = gdf_org["Lake
-0000a500: 4176 674f 7574 225d 2e76 616c 7565 7320  AvgOut"].values 
-0000a510: 2f20 280a 2020 2020 2020 2020 2020 2020  / (.            
-0000a520: 2020 2020 6764 665f 6f72 675b 224c 616b      gdf_org["Lak
-0000a530: 6541 7667 4c65 7665 6c22 5d2e 7661 6c75  eAvgLevel"].valu
-0000a540: 6573 0a20 2020 2020 2020 2020 2020 2029  es.            )
-0000a550: 202a 2a20 2832 290a 2020 2020 2020 2020   ** (2).        
-0000a560: 2020 2020 6764 665f 6f72 675b 224c 616b      gdf_org["Lak
-0000a570: 655f 6522 5d20 3d20 320a 2020 2020 2020  e_e"] = 2.      
-0000a580: 2020 2020 2020 6764 665f 6f72 675b 224c        gdf_org["L
-0000a590: 616b 6553 746f 7246 756e 6322 5d20 3d20  akeStorFunc"] = 
-0000a5a0: 310a 2020 2020 2020 2020 2020 2020 6764  1.            gd
-0000a5b0: 665f 6f72 675b 224c 616b 654f 7574 666c  f_org["LakeOutfl
-0000a5c0: 6f77 4675 6e63 225d 203d 2033 0a20 2020  owFunc"] = 3.   
-0000a5d0: 2020 2020 2020 2020 2067 6466 5f6f 7267           gdf_org
-0000a5e0: 5b22 4c61 6b65 5468 7265 7368 6f6c 6422  ["LakeThreshold"
-0000a5f0: 5d20 3d20 302e 300a 2020 2020 2020 2020  ] = 0.0.        
-0000a600: 2020 2020 6764 665f 6f72 675b 224c 696e      gdf_org["Lin
-0000a610: 6b65 644c 616b 654c 6f63 7322 5d20 3d20  kedLakeLocs"] = 
-0000a620: 300a 0a20 2020 2020 2020 2020 2020 2023  0..            #
-0000a630: 2043 6865 636b 2069 6620 736f 6d65 204c   Check if some L
-0000a640: 616b 6541 7667 4f75 7420 7661 6c75 6573  akeAvgOut values
-0000a650: 2068 6176 6520 6265 656e 2072 6570 6c61   have been repla
-0000a660: 6365 640a 2020 2020 2020 2020 2020 2020  ced.            
-0000a670: 6966 206e 6f74 206e 702e 616c 6c28 4c61  if not np.all(La
-0000a680: 6b65 4176 674f 7574 203d 3d20 6764 665f  keAvgOut == gdf_
-0000a690: 6f72 675b 224c 616b 6541 7667 4f75 7422  org["LakeAvgOut"
-0000a6a0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-0000a6b0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-0000a6c0: 7761 726e 696e 6728 0a20 2020 2020 2020  warning(.       
-0000a6d0: 2020 2020 2020 2020 2020 2020 2022 536f               "So
-0000a6e0: 6d65 2076 616c 7565 7320 6f66 204c 616b  me values of Lak
-0000a6f0: 6541 7667 4f75 7420 6861 7665 2062 6565  eAvgOut have bee
-0000a700: 6e20 7265 706c 6163 6564 2062 7920 6120  n replaced by a 
-0000a710: 6d69 6e69 6d75 6d20 7661 6c75 6520 6f66  minimum value of
-0000a720: 2030 2e30 316d 332f 7322 0a20 2020 2020   0.01m3/s".     
-0000a730: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000a740: 2020 2020 2020 2020 2020 6c61 6b65 5f70            lake_p
-0000a750: 6172 616d 7320 3d20 5b0a 2020 2020 2020  arams = [.      
-0000a760: 2020 2020 2020 2020 2020 2277 6174 6572            "water
-0000a770: 626f 6479 5f69 6422 2c0a 2020 2020 2020  body_id",.      
-0000a780: 2020 2020 2020 2020 2020 224c 616b 6541            "LakeA
-0000a790: 7265 6122 2c0a 2020 2020 2020 2020 2020  rea",.          
-0000a7a0: 2020 2020 2020 224c 616b 6541 7667 4c65        "LakeAvgLe
-0000a7b0: 7665 6c22 2c0a 2020 2020 2020 2020 2020  vel",.          
-0000a7c0: 2020 2020 2020 224c 616b 6541 7667 4f75        "LakeAvgOu
-0000a7d0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-0000a7e0: 2020 2020 224c 616b 655f 6222 2c0a 2020      "Lake_b",.  
-0000a7f0: 2020 2020 2020 2020 2020 2020 2020 224c                "L
-0000a800: 616b 655f 6522 2c0a 2020 2020 2020 2020  ake_e",.        
-0000a810: 2020 2020 2020 2020 224c 616b 6553 746f          "LakeSto
-0000a820: 7246 756e 6322 2c0a 2020 2020 2020 2020  rFunc",.        
-0000a830: 2020 2020 2020 2020 224c 616b 654f 7574          "LakeOut
-0000a840: 666c 6f77 4675 6e63 222c 0a20 2020 2020  flowFunc",.     
-0000a850: 2020 2020 2020 2020 2020 2022 4c61 6b65             "Lake
-0000a860: 5468 7265 7368 6f6c 6422 2c0a 2020 2020  Threshold",.    
-0000a870: 2020 2020 2020 2020 2020 2020 224c 696e              "Lin
-0000a880: 6b65 644c 616b 654c 6f63 7322 2c0a 2020  kedLakeLocs",.  
-0000a890: 2020 2020 2020 2020 2020 5d0a 0a20 2020            ]..   
-0000a8a0: 2020 2020 2020 2020 2067 6466 5f6f 7267           gdf_org
-0000a8b0: 5f70 6f69 6e74 7320 3d20 6770 642e 4765  _points = gpd.Ge
-0000a8c0: 6f44 6174 6146 7261 6d65 280a 2020 2020  oDataFrame(.    
-0000a8d0: 2020 2020 2020 2020 2020 2020 6764 665f              gdf_
-0000a8e0: 6f72 675b 6c61 6b65 5f70 6172 616d 735d  org[lake_params]
-0000a8f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a900: 2020 6765 6f6d 6574 7279 3d67 7064 2e70    geometry=gpd.p
-0000a910: 6f69 6e74 735f 6672 6f6d 5f78 7928 6764  oints_from_xy(gd
-0000a920: 665f 6f72 672e 786f 7574 2c20 6764 665f  f_org.xout, gdf_
-0000a930: 6f72 672e 796f 7574 292c 0a20 2020 2020  org.yout),.     
-0000a940: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000a950: 2020 2020 2020 2320 7772 6974 6520 6c61        # write la
-0000a960: 6b65 7320 7769 7468 2061 7474 7220 7461  kes with attr ta
-0000a970: 626c 6573 2074 6f20 7374 6174 6963 2067  bles to static g
-0000a980: 656f 6d73 2e0a 2020 2020 2020 2020 2020  eoms..          
-0000a990: 2020 7365 6c66 2e73 6574 5f73 7461 7469    self.set_stati
-0000a9a0: 6367 656f 6d73 2867 6466 5f6f 7267 2c20  cgeoms(gdf_org, 
-0000a9b0: 6e61 6d65 3d22 6c61 6b65 7322 290a 0a20  name="lakes").. 
-0000a9c0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-0000a9d0: 616d 6520 696e 206c 616b 655f 7061 7261  ame in lake_para
-0000a9e0: 6d73 5b31 3a5d 3a0a 2020 2020 2020 2020  ms[1:]:.        
-0000a9f0: 2020 2020 2020 2020 6461 5f6c 616b 6520          da_lake 
-0000aa00: 3d20 6473 5f6c 616b 6573 2e72 6173 7465  = ds_lakes.raste
-0000aa10: 722e 7261 7374 6572 697a 6528 0a20 2020  r.rasterize(.   
-0000aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa30: 2067 6466 5f6f 7267 5f70 6f69 6e74 732c   gdf_org_points,
-0000aa40: 2063 6f6c 5f6e 616d 653d 6e61 6d65 2c20   col_name=name, 
-0000aa50: 6474 7970 653d 2266 6c6f 6174 3332 222c  dtype="float32",
-0000aa60: 206e 6f64 6174 613d 2d39 3939 0a20 2020   nodata=-999.   
-0000aa70: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000aa80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000aa90: 656c 662e 7365 745f 7374 6174 6963 6d61  elf.set_staticma
-0000aaa0: 7073 2864 615f 6c61 6b65 290a 0a20 2020  ps(da_lake)..   
-0000aab0: 2020 2020 2020 2020 2023 2069 6620 7468           # if th
-0000aac0: 6572 6520 6172 6520 6c61 6b65 732c 2063  ere are lakes, c
-0000aad0: 6861 6e67 6520 5472 7565 2069 6e20 746f  hange True in to
-0000aae0: 6d6c 0a20 2020 2020 2020 2020 2020 2066  ml.            f
-0000aaf0: 6f72 206f 7074 696f 6e20 696e 206c 616b  or option in lak
-0000ab00: 6573 5f74 6f6d 6c3a 0a20 2020 2020 2020  es_toml:.       
-0000ab10: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-0000ab20: 745f 636f 6e66 6967 286f 7074 696f 6e2c  t_config(option,
-0000ab30: 206c 616b 6573 5f74 6f6d 6c5b 6f70 7469   lakes_toml[opti
-0000ab40: 6f6e 5d29 0a0a 2020 2020 6465 6620 7365  on])..    def se
-0000ab50: 7475 705f 7265 7365 7276 6f69 7273 280a  tup_reservoirs(.
-0000ab60: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000ab70: 2020 2020 2020 7265 7365 7276 6f69 7273        reservoirs
-0000ab80: 5f66 6e3d 2268 7964 726f 5f72 6573 6572  _fn="hydro_reser
-0000ab90: 766f 6972 7322 2c0a 2020 2020 2020 2020  voirs",.        
-0000aba0: 6d69 6e5f 6172 6561 3d31 2e30 2c0a 2020  min_area=1.0,.  
-0000abb0: 2020 2020 2020 7072 696f 7269 7479 5f6a        priority_j
-0000abc0: 7263 3d54 7275 652c 0a20 2020 2020 2020  rc=True,.       
-0000abd0: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
-0000abe0: 3a0a 2020 2020 2020 2020 2222 2254 6869  :.        """Thi
-0000abf0: 7320 636f 6d70 6f6e 656e 7420 6765 6e65  s component gene
-0000ac00: 7261 7465 7320 6d61 7073 206f 6620 7265  rates maps of re
-0000ac10: 7365 7276 6f69 7220 6172 6561 7320 616e  servoir areas an
-0000ac20: 6420 6f75 746c 6574 7320 6173 2077 656c  d outlets as wel
-0000ac30: 6c20 6173 2070 6172 616d 6574 6572 730a  l as parameters.
-0000ac40: 2020 2020 2020 2020 7769 7468 2061 7665          with ave
-0000ac50: 7261 6765 2072 6573 6572 766f 6972 2061  rage reservoir a
-0000ac60: 7265 612c 2064 656d 616e 642c 206d 696e  rea, demand, min
-0000ac70: 2061 6e64 206d 6178 2074 6172 6765 7420   and max target 
-0000ac80: 7374 6f72 6167 6520 6361 7061 6369 7469  storage capaciti
-0000ac90: 6573 2061 6e64 0a20 2020 2020 2020 2064  es and.        d
-0000aca0: 6973 6368 6172 6765 2063 6170 6163 6974  ischarge capacit
-0000acb0: 7920 7661 6c75 6573 2e0a 0a20 2020 2020  y values...     
-0000acc0: 2020 2054 6865 2064 6174 6120 6973 2067     The data is g
-0000acd0: 656e 6572 6174 6564 2066 726f 6d20 6665  enerated from fe
-0000ace0: 6174 7572 6573 2077 6974 6820 6060 6d69  atures with ``mi
-0000acf0: 6e5f 6172 6561 6060 205b 6b6d 325d 2028  n_area`` [km2] (
-0000ad00: 6465 6661 756c 7420 6973 2031 206b 6d32  default is 1 km2
-0000ad10: 290a 2020 2020 2020 2020 6672 6f6d 2061  ).        from a
-0000ad20: 2064 6174 6162 6173 6520 7769 7468 2072   database with r
-0000ad30: 6573 6572 766f 6972 2067 656f 6d65 7472  eservoir geometr
-0000ad40: 792c 2049 4473 2061 6e64 206d 6574 6164  y, IDs and metad
-0000ad50: 6174 612e 0a0a 2020 2020 2020 2020 4461  ata...        Da
-0000ad60: 7461 2072 6571 7569 7265 6d65 6e74 7320  ta requirements 
-0000ad70: 666f 7220 6469 7265 6374 2075 7365 2028  for direct use (
-0000ad80: 6965 2077 666c 6f77 2070 6172 616d 6574  ie wflow paramet
-0000ad90: 6572 7320 6172 6520 6461 7461 2061 6c72  ers are data alr
-0000ada0: 6561 6479 2070 7265 7365 6e74 2069 6e20  eady present in 
-0000adb0: 7265 7365 7276 6f69 7273 5f66 6e29 0a20  reservoirs_fn). 
-0000adc0: 2020 2020 2020 2061 7265 2072 6573 6572         are reser
-0000add0: 766f 6972 2049 4420 2777 6174 6572 626f  voir ID 'waterbo
-0000ade0: 6479 5f69 6427 2c20 6172 6561 2027 5265  dy_id', area 'Re
-0000adf0: 7353 696d 706c 6541 7265 6127 205b 6d32  sSimpleArea' [m2
-0000ae00: 5d2c 206d 6178 696d 756d 2076 6f6c 756d  ], maximum volum
-0000ae10: 6520 2752 6573 4d61 7856 6f6c 756d 6527  e 'ResMaxVolume'
-0000ae20: 205b 6d33 5d2c 0a20 2020 2020 2020 2074   [m3],.        t
-0000ae30: 6865 2074 6172 6765 7465 6420 6d69 6e69  he targeted mini
-0000ae40: 6d75 6d20 616e 6420 6d61 7869 6d75 6d20  mum and maximum 
-0000ae50: 6672 6163 7469 6f6e 206f 6620 7761 7465  fraction of wate
-0000ae60: 7220 766f 6c75 6d65 2069 6e20 7468 6520  r volume in the 
-0000ae70: 7265 7365 7276 6f69 7220 2752 6573 5461  reservoir 'ResTa
-0000ae80: 7267 6574 4d69 6e46 7261 6327 0a20 2020  rgetMinFrac'.   
-0000ae90: 2020 2020 2061 6e64 2027 5265 7354 6172       and 'ResTar
-0000aea0: 6765 744d 6178 4672 6163 2720 5b2d 5d2c  getMaxFrac' [-],
-0000aeb0: 2074 6865 2061 7665 7261 6765 2077 6174   the average wat
-0000aec0: 6572 2064 656d 616e 6420 5265 7344 656d  er demand ResDem
-0000aed0: 616e 6420 5b6d 332f 735d 2061 6e64 2074  and [m3/s] and t
-0000aee0: 6865 206d 6178 696d 756d 2072 656c 6561  he maximum relea
-0000aef0: 7365 206f 660a 2020 2020 2020 2020 7468  se of.        th
-0000af00: 6520 7265 7365 7276 6f69 7220 6265 666f  e reservoir befo
-0000af10: 7265 2073 7069 6c6c 696e 6720 2752 6573  re spilling 'Res
-0000af20: 4d61 7852 656c 6561 7365 2720 5b6d 332f  MaxRelease' [m3/
-0000af30: 735d 2e0a 0a20 2020 2020 2020 2049 6e20  s]...        In 
-0000af40: 6361 7365 2074 6865 2077 666c 6f77 2070  case the wflow p
-0000af50: 6172 616d 6574 6572 7320 6172 6520 6e6f  arameters are no
-0000af60: 7420 6469 7265 6374 6c79 2061 7661 696c  t directly avail
-0000af70: 6162 6c65 2074 6865 7920 6361 6e20 6265  able they can be
-0000af80: 2063 6f6d 7075 7465 6420 6279 2048 7964   computed by Hyd
-0000af90: 726f 4d54 2075 7369 6e67 206f 7468 6572  roMT using other
-0000afa0: 0a20 2020 2020 2020 2072 6573 6572 766f  .        reservo
-0000afb0: 6972 2063 6861 7261 6374 6572 6973 7469  ir characteristi
-0000afc0: 6373 2e20 4966 206e 6f74 2065 6e6f 7567  cs. If not enoug
-0000afd0: 6820 6368 6172 6163 7465 7269 7374 6963  h characteristic
-0000afe0: 7320 6172 6520 6176 6169 6c61 626c 652c  s are available,
-0000aff0: 2074 6865 2068 7964 726f 656e 6769 6e65   the hydroengine
-0000b000: 2074 6f6f 6c20 7769 6c6c 2062 650a 2020   tool will be.  
-0000b010: 2020 2020 2020 7573 6564 2074 6f20 646f        used to do
-0000b020: 776e 6c6f 6164 2061 6464 6974 696f 6e6e  wnload additionn
-0000b030: 616c 2074 696d 6573 6572 6965 7320 6672  al timeseries fr
-0000b040: 6f6d 2074 6865 204a 5243 2064 6174 6162  om the JRC datab
-0000b050: 6173 652e 0a20 2020 2020 2020 2054 6865  ase..        The
-0000b060: 2072 6571 7569 7265 6420 7661 7269 6162   required variab
-0000b070: 6c65 7320 666f 7220 636f 6d70 7574 6174  les for computat
-0000b080: 696f 6e20 6f66 2074 6865 2070 6172 616d  ion of the param
-0000b090: 6574 6572 7320 7769 7468 2068 7964 726f  eters with hydro
-0000b0a0: 656e 6769 6e65 2061 7265 2072 6573 6572  engine are reser
-0000b0b0: 766f 6972 2049 4420 2777 6174 6572 626f  voir ID 'waterbo
-0000b0c0: 6479 5f69 6427 2c0a 2020 2020 2020 2020  dy_id',.        
-0000b0d0: 7265 7365 7276 6f69 7220 4944 2069 6e20  reservoir ID in 
-0000b0e0: 7468 6520 4879 6472 6f4c 414b 4553 2064  the HydroLAKES d
-0000b0f0: 6174 6162 6173 6520 2748 796c 616b 5f69  atabase 'Hylak_i
-0000b100: 6427 2c20 6176 6572 6167 6520 766f 6c75  d', average volu
-0000b110: 6d65 2027 566f 6c5f 6176 6727 205b 6d33  me 'Vol_avg' [m3
-0000b120: 5d2c 2061 7665 7261 6765 2064 6570 7468  ], average depth
-0000b130: 2027 4465 7074 685f 6176 6727 0a20 2020   'Depth_avg'.   
-0000b140: 2020 2020 205b 6d5d 2c20 6176 6572 6167       [m], averag
-0000b150: 6520 6469 7363 6861 7267 6520 2744 6973  e discharge 'Dis
-0000b160: 5f61 7667 2720 5b6d 332f 735d 2061 6e64  _avg' [m3/s] and
-0000b170: 2064 616d 2068 6569 6768 7420 2744 616d   dam height 'Dam
-0000b180: 5f68 6569 6768 7427 205b 6d5d 2e0a 2020  _height' [m]..  
-0000b190: 2020 2020 2020 546f 2063 6f6d 7075 7465        To compute
-0000b1a0: 2070 6172 616d 6574 6572 7320 7769 7468   parameters with
-0000b1b0: 6f75 7420 7573 696e 6720 6879 6472 6f65  out using hydroe
-0000b1c0: 6e67 696e 652c 2074 6865 2072 6571 7569  ngine, the requi
-0000b1d0: 7265 6420 7661 7269 6261 6c65 7320 696e  red varibales in
-0000b1e0: 2072 6573 6572 766f 6972 735f 666e 2061   reservoirs_fn a
-0000b1f0: 7265 2072 6573 6572 766f 6972 2049 4420  re reservoir ID 
-0000b200: 2777 6174 6572 626f 6479 5f69 6427 2c0a  'waterbody_id',.
-0000b210: 2020 2020 2020 2020 6176 6572 6167 6520          average 
-0000b220: 6172 6561 2027 4172 6561 5f61 7667 2720  area 'Area_avg' 
-0000b230: 5b6d 325d 2c20 6176 6572 6167 6520 766f  [m2], average vo
-0000b240: 6c75 6d65 2027 566f 6c5f 6176 6727 205b  lume 'Vol_avg' [
-0000b250: 6d33 5d2c 2061 7665 7261 6765 2064 6570  m3], average dep
-0000b260: 7468 2027 4465 7074 685f 6176 6727 205b  th 'Depth_avg' [
-0000b270: 6d5d 2c20 6176 6572 6167 6520 6469 7363  m], average disc
-0000b280: 6861 7267 6520 2744 6973 5f61 7667 270a  harge 'Dis_avg'.
-0000b290: 2020 2020 2020 2020 5b6d 332f 735d 2061          [m3/s] a
-0000b2a0: 6e64 2064 616d 2068 6569 6768 7420 2744  nd dam height 'D
-0000b2b0: 616d 5f68 6569 6768 7427 205b 6d5d 2061  am_height' [m] a
-0000b2c0: 6e64 206d 696e 696d 756d 202f 206e 6f72  nd minimum / nor
-0000b2d0: 6d61 6c20 2f20 6d61 7869 6d75 6d20 7374  mal / maximum st
-0000b2e0: 6f72 6167 6520 6361 7061 6369 7479 206f  orage capacity o
-0000b2f0: 6620 7468 6520 6461 6d20 2743 6170 6163  f the dam 'Capac
-0000b300: 6974 795f 6d69 6e27 2c0a 2020 2020 2020  ity_min',.      
-0000b310: 2020 2743 6170 6163 6974 795f 6e6f 726d    'Capacity_norm
-0000b320: 272c 2027 4361 7061 6369 7479 5f6d 6178  ', 'Capacity_max
-0000b330: 2720 5b6d 335d 2e0a 0a0a 0a20 2020 2020  ' [m3].....     
-0000b340: 2020 2041 6464 7320 6d6f 6465 6c20 6c61     Adds model la
-0000b350: 7965 7273 3a0a 0a20 2020 2020 2020 202a  yers:..        *
-0000b360: 202a 2a77 666c 6f77 5f72 6573 6572 766f   **wflow_reservo
-0000b370: 6972 6172 6561 732a 2a20 6d61 703a 2072  irareas** map: r
-0000b380: 6573 6572 766f 6972 2049 4473 205b 2d5d  eservoir IDs [-]
-0000b390: 0a20 2020 2020 2020 202a 202a 2a77 666c  .        * **wfl
-0000b3a0: 6f77 5f72 6573 6572 766f 6972 6c6f 6373  ow_reservoirlocs
-0000b3b0: 2a2a 206d 6170 3a20 7265 7365 7276 6f69  ** map: reservoi
-0000b3c0: 7220 4944 7320 6174 206f 7574 6c65 7420  r IDs at outlet 
-0000b3d0: 6c6f 6361 7469 6f6e 7320 5b2d 5d0a 2020  locations [-].  
-0000b3e0: 2020 2020 2020 2a20 2a2a 5265 7353 696d        * **ResSim
-0000b3f0: 706c 6541 7265 612a 2a20 6d61 703a 2072  pleArea** map: r
-0000b400: 6573 6572 766f 6972 2061 7265 6120 5b6d  eservoir area [m
-0000b410: 325d 0a20 2020 2020 2020 202a 202a 2a52  2].        * **R
-0000b420: 6573 4d61 7856 6f6c 756d 652a 2a20 6d61  esMaxVolume** ma
-0000b430: 703a 2072 6573 6572 766f 6972 206d 6178  p: reservoir max
-0000b440: 2076 6f6c 756d 6520 5b6d 335d 0a20 2020   volume [m3].   
-0000b450: 2020 2020 202a 202a 2a52 6573 5461 7267       * **ResTarg
-0000b460: 6574 4d69 6e46 7261 632a 2a20 6d61 703a  etMinFrac** map:
-0000b470: 2072 6573 6572 766f 6972 2074 6172 6765   reservoir targe
-0000b480: 7420 6d69 6e20 6672 6163 205b 6d33 2f6d  t min frac [m3/m
-0000b490: 335d 0a20 2020 2020 2020 202a 202a 2a52  3].        * **R
-0000b4a0: 6573 5461 7267 6574 4675 6c6c 4672 6163  esTargetFullFrac
-0000b4b0: 2a2a 206d 6170 3a20 7265 7365 7276 6f69  ** map: reservoi
-0000b4c0: 7220 7461 7267 6574 2066 756c 6c20 6672  r target full fr
-0000b4d0: 6163 205b 6d33 2f6d 335d 0a20 2020 2020  ac [m3/m3].     
-0000b4e0: 2020 202a 202a 2a52 6573 4465 6d61 6e64     * **ResDemand
-0000b4f0: 2a2a 206d 6170 3a20 7265 7365 7276 6f69  ** map: reservoi
-0000b500: 7220 6465 6d61 6e64 2066 6c6f 7720 5b6d  r demand flow [m
-0000b510: 332f 735d 0a20 2020 2020 2020 202a 202a  3/s].        * *
-0000b520: 2a52 6573 4d61 7852 656c 6561 7365 2a2a  *ResMaxRelease**
-0000b530: 206d 6170 3a20 7265 7365 7276 6f69 7220   map: reservoir 
-0000b540: 6d61 7820 7265 6c65 6173 6520 666c 6f77  max release flow
-0000b550: 205b 6d33 2f73 5d0a 2020 2020 2020 2020   [m3/s].        
-0000b560: 2a20 2a2a 7265 7365 7276 6f69 7273 2a2a  * **reservoirs**
-0000b570: 2067 656f 6d3a 2070 6f6c 7967 6f6e 2077   geom: polygon w
-0000b580: 6974 6820 7265 7365 7276 6f69 7273 2061  ith reservoirs a
-0000b590: 6e64 2077 666c 6f77 2072 6573 6572 766f  nd wflow reservo
-0000b5a0: 6972 2070 6172 616d 6574 6572 730a 0a20  ir parameters.. 
-0000b5b0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0000b5c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0000b5d0: 2d2d 2d2d 0a20 2020 2020 2020 2072 6573  ----.        res
-0000b5e0: 6572 766f 6972 735f 666e 203a 207b 2768  ervoirs_fn : {'h
-0000b5f0: 7964 726f 5f72 6573 6572 766f 6972 7327  ydro_reservoirs'
-0000b600: 7d0a 2020 2020 2020 2020 2020 2020 4e61  }.            Na
-0000b610: 6d65 206f 6620 6461 7461 2073 6f75 7263  me of data sourc
-0000b620: 6520 666f 7220 7265 7365 7276 6f69 7220  e for reservoir 
-0000b630: 7061 7261 6d65 7465 7273 2c20 7365 6520  parameters, see 
-0000b640: 6461 7461 2f64 6174 615f 736f 7572 6365  data/data_source
-0000b650: 732e 796d 6c2e 0a0a 2020 2020 2020 2020  s.yml...        
-0000b660: 2020 2020 2a20 5265 7175 6972 6564 2076      * Required v
-0000b670: 6172 6961 626c 6573 2066 6f72 2064 6972  ariables for dir
-0000b680: 6563 7420 7573 653a 205b 2777 6174 6572  ect use: ['water
-0000b690: 626f 6479 5f69 6427 2c20 2752 6573 5369  body_id', 'ResSi
-0000b6a0: 6d70 6c65 4172 6561 272c 2027 5265 734d  mpleArea', 'ResM
-0000b6b0: 6178 566f 6c75 6d65 272c 2027 5265 7354  axVolume', 'ResT
-0000b6c0: 6172 6765 744d 696e 4672 6163 272c 2027  argetMinFrac', '
-0000b6d0: 5265 7354 6172 6765 7446 756c 6c46 7261  ResTargetFullFra
-0000b6e0: 6327 2c20 2752 6573 4465 6d61 6e64 272c  c', 'ResDemand',
-0000b6f0: 2027 5265 734d 6178 5265 6c65 6173 6527   'ResMaxRelease'
-0000b700: 5d0a 0a20 2020 2020 2020 2020 2020 202a  ]..            *
-0000b710: 2052 6571 7569 7265 6420 7661 7269 6162   Required variab
-0000b720: 6c65 7320 666f 7220 636f 6d70 7574 6174  les for computat
-0000b730: 696f 6e20 7769 7468 2068 7964 726f 656e  ion with hydroen
-0000b740: 6769 6e65 3a20 5b27 7761 7465 7262 6f64  gine: ['waterbod
-0000b750: 795f 6964 272c 2027 4879 6c61 6b5f 6964  y_id', 'Hylak_id
-0000b760: 272c 2027 566f 6c5f 6176 6727 2c20 2744  ', 'Vol_avg', 'D
-0000b770: 6570 7468 5f61 7667 272c 2027 4469 735f  epth_avg', 'Dis_
-0000b780: 6176 6727 2c20 2744 616d 5f68 6569 6768  avg', 'Dam_heigh
-0000b790: 7427 5d0a 0a20 2020 2020 2020 2020 2020  t']..           
-0000b7a0: 202a 2052 6571 7569 7265 6420 7661 7269   * Required vari
-0000b7b0: 6162 6c65 7320 666f 7220 636f 6d70 7574  ables for comput
-0000b7c0: 6174 696f 6e20 7769 7468 6f75 7420 6879  ation without hy
-0000b7d0: 6472 6f65 6e67 696e 653a 205b 2777 6174  droengine: ['wat
-0000b7e0: 6572 626f 6479 5f69 6427 2c20 2741 7265  erbody_id', 'Are
-0000b7f0: 615f 6176 6727 2c20 2756 6f6c 5f61 7667  a_avg', 'Vol_avg
-0000b800: 272c 2027 4465 7074 685f 6176 6727 2c20  ', 'Depth_avg', 
-0000b810: 2744 6973 5f61 7667 272c 2027 4361 7061  'Dis_avg', 'Capa
-0000b820: 6369 7479 5f6d 6178 272c 2027 4361 7061  city_max', 'Capa
-0000b830: 6369 7479 5f6e 6f72 6d27 2c20 2743 6170  city_norm', 'Cap
-0000b840: 6163 6974 795f 6d69 6e27 2c20 2744 616d  acity_min', 'Dam
-0000b850: 5f68 6569 6768 7427 5d0a 2020 2020 2020  _height'].      
-0000b860: 2020 6d69 6e5f 6172 6561 203a 2066 6c6f    min_area : flo
-0000b870: 6174 2c20 6f70 7469 6f6e 616c 0a20 2020  at, optional.   
-0000b880: 2020 2020 2020 2020 204d 696e 696d 756d           Minimum
-0000b890: 2072 6573 6572 766f 6972 2061 7265 6120   reservoir area 
-0000b8a0: 7468 7265 7368 6f6c 6420 5b6b 6d32 5d2c  threshold [km2],
-0000b8b0: 2062 7920 6465 6661 756c 7420 312e 3020   by default 1.0 
-0000b8c0: 6b6d 322e 0a20 2020 2020 2020 2070 7269  km2..        pri
-0000b8d0: 6f72 6974 795f 6a72 6320 3a20 626f 6f6c  ority_jrc : bool
-0000b8e0: 6561 6e2c 206f 7074 696f 6e61 6c0a 2020  ean, optional.  
-0000b8f0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-0000b900: 652c 2075 7365 204a 5243 2077 6174 6572  e, use JRC water
-0000b910: 206f 6363 7572 7265 6e63 6520 2850 656b   occurrence (Pek
-0000b920: 656c 2c32 3031 3629 2064 6174 6120 6672  el,2016) data fr
-0000b930: 6f6d 2047 4545 2074 6f20 6361 6c63 756c  om GEE to calcul
-0000b940: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-0000b950: 616e 6420 6f76 6572 7772 6974 6520 7468  and overwrite th
-0000b960: 6520 7265 7365 7276 6f69 7220 766f 6c75  e reservoir volu
-0000b970: 6d65 2f61 7265 6173 206f 6620 7468 6520  me/areas of the 
-0000b980: 6461 7461 2073 6f75 7263 652e 0a20 2020  data source..   
-0000b990: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000b9a0: 2023 2072 656e 616d 6520 746f 2077 666c   # rename to wfl
-0000b9b0: 6f77 206e 616d 696e 6720 636f 6e76 656e  ow naming conven
-0000b9c0: 7469 6f6e 0a20 2020 2020 2020 2074 626c  tion.        tbl
-0000b9d0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-0000b9e0: 2020 2272 6573 6172 6561 223a 2022 5265    "resarea": "Re
-0000b9f0: 7353 696d 706c 6541 7265 6122 2c0a 2020  sSimpleArea",.  
-0000ba00: 2020 2020 2020 2020 2020 2272 6573 6465            "resde
-0000ba10: 6d61 6e64 223a 2022 5265 7344 656d 616e  mand": "ResDeman
-0000ba20: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-0000ba30: 2272 6573 6675 6c6c 6672 6163 223a 2022  "resfullfrac": "
-0000ba40: 5265 7354 6172 6765 7446 756c 6c46 7261  ResTargetFullFra
-0000ba50: 6322 2c0a 2020 2020 2020 2020 2020 2020  c",.            
-0000ba60: 2272 6573 6d69 6e66 7261 6322 3a20 2252  "resminfrac": "R
-0000ba70: 6573 5461 7267 6574 4d69 6e46 7261 6322  esTargetMinFrac"
-0000ba80: 2c0a 2020 2020 2020 2020 2020 2020 2272  ,.            "r
-0000ba90: 6573 6d61 7872 656c 6561 7365 223a 2022  esmaxrelease": "
-0000baa0: 5265 734d 6178 5265 6c65 6173 6522 2c0a  ResMaxRelease",.
-0000bab0: 2020 2020 2020 2020 2020 2020 2272 6573              "res
-0000bac0: 6d61 7876 6f6c 756d 6522 3a20 2252 6573  maxvolume": "Res
-0000bad0: 4d61 7856 6f6c 756d 6522 2c0a 2020 2020  MaxVolume",.    
-0000bae0: 2020 2020 2020 2020 2272 6573 6964 223a          "resid":
-0000baf0: 2022 6578 7072 3122 2c0a 2020 2020 2020   "expr1",.      
-0000bb00: 2020 7d0a 0a20 2020 2020 2020 2072 6573    }..        res
-0000bb10: 5f74 6f6d 6c20 3d20 7b0a 2020 2020 2020  _toml = {.      
-0000bb20: 2020 2020 2020 226d 6f64 656c 2e72 6573        "model.res
-0000bb30: 6572 766f 6972 7322 3a20 5472 7565 2c0a  ervoirs": True,.
-0000bb40: 2020 2020 2020 2020 2020 2020 2273 7461              "sta
-0000bb50: 7465 2e6c 6174 6572 616c 2e72 6976 6572  te.lateral.river
-0000bb60: 2e72 6573 6572 766f 6972 2e76 6f6c 756d  .reservoir.volum
-0000bb70: 6522 3a20 2276 6f6c 756d 655f 7265 7365  e": "volume_rese
-0000bb80: 7276 6f69 7222 2c0a 2020 2020 2020 2020  rvoir",.        
-0000bb90: 2020 2020 2269 6e70 7574 2e6c 6174 6572      "input.later
-0000bba0: 616c 2e72 6976 6572 2e72 6573 6572 766f  al.river.reservo
-0000bbb0: 6972 2e61 7265 6122 3a20 2252 6573 5369  ir.area": "ResSi
-0000bbc0: 6d70 6c65 4172 6561 222c 0a20 2020 2020  mpleArea",.     
-0000bbd0: 2020 2020 2020 2022 696e 7075 742e 6c61         "input.la
-0000bbe0: 7465 7261 6c2e 7269 7665 722e 7265 7365  teral.river.rese
-0000bbf0: 7276 6f69 722e 6172 6561 7322 3a20 2277  rvoir.areas": "w
-0000bc00: 666c 6f77 5f72 6573 6572 766f 6972 6172  flow_reservoirar
-0000bc10: 6561 7322 2c0a 2020 2020 2020 2020 2020  eas",.          
-0000bc20: 2020 2269 6e70 7574 2e6c 6174 6572 616c    "input.lateral
-0000bc30: 2e72 6976 6572 2e72 6573 6572 766f 6972  .river.reservoir
-0000bc40: 2e64 656d 616e 6422 3a20 2252 6573 4465  .demand": "ResDe
-0000bc50: 6d61 6e64 222c 0a20 2020 2020 2020 2020  mand",.         
-0000bc60: 2020 2022 696e 7075 742e 6c61 7465 7261     "input.latera
-0000bc70: 6c2e 7269 7665 722e 7265 7365 7276 6f69  l.river.reservoi
-0000bc80: 722e 6c6f 6373 223a 2022 7766 6c6f 775f  r.locs": "wflow_
-0000bc90: 7265 7365 7276 6f69 726c 6f63 7322 2c0a  reservoirlocs",.
-0000bca0: 2020 2020 2020 2020 2020 2020 2269 6e70              "inp
-0000bcb0: 7574 2e6c 6174 6572 616c 2e72 6976 6572  ut.lateral.river
-0000bcc0: 2e72 6573 6572 766f 6972 2e6d 6178 7265  .reservoir.maxre
-0000bcd0: 6c65 6173 6522 3a20 2252 6573 4d61 7852  lease": "ResMaxR
-0000bce0: 656c 6561 7365 222c 0a20 2020 2020 2020  elease",.       
-0000bcf0: 2020 2020 2022 696e 7075 742e 6c61 7465       "input.late
-0000bd00: 7261 6c2e 7269 7665 722e 7265 7365 7276  ral.river.reserv
-0000bd10: 6f69 722e 6d61 7876 6f6c 756d 6522 3a20  oir.maxvolume": 
-0000bd20: 2252 6573 4d61 7856 6f6c 756d 6522 2c0a  "ResMaxVolume",.
-0000bd30: 2020 2020 2020 2020 2020 2020 2269 6e70              "inp
-0000bd40: 7574 2e6c 6174 6572 616c 2e72 6976 6572  ut.lateral.river
-0000bd50: 2e72 6573 6572 766f 6972 2e74 6172 6765  .reservoir.targe
-0000bd60: 7466 756c 6c66 7261 6322 3a20 2252 6573  tfullfrac": "Res
-0000bd70: 5461 7267 6574 4675 6c6c 4672 6163 222c  TargetFullFrac",
-0000bd80: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
-0000bd90: 7075 742e 6c61 7465 7261 6c2e 7269 7665  put.lateral.rive
-0000bda0: 722e 7265 7365 7276 6f69 722e 7461 7267  r.reservoir.targ
-0000bdb0: 6574 6d69 6e66 7261 6322 3a20 2252 6573  etminfrac": "Res
-0000bdc0: 5461 7267 6574 4d69 6e46 7261 6322 2c0a  TargetMinFrac",.
-0000bdd0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0000bde0: 2020 2067 6466 5f6f 7267 2c20 6473 5f72     gdf_org, ds_r
-0000bdf0: 6573 203d 2073 656c 662e 5f73 6574 7570  es = self._setup
-0000be00: 5f77 6174 6572 626f 6469 6573 2872 6573  _waterbodies(res
-0000be10: 6572 766f 6972 735f 666e 2c20 2272 6573  ervoirs_fn, "res
-0000be20: 6572 766f 6972 222c 206d 696e 5f61 7265  ervoir", min_are
-0000be30: 6129 0a20 2020 2020 2020 2023 2054 4f44  a).        # TOD
-0000be40: 4f3a 2063 6865 636b 2069 6620 7468 6572  O: check if ther
-0000be50: 6520 6172 6520 6d69 7373 696e 6720 7661  e are missing va
-0000be60: 6c75 6573 2069 6e20 7468 6520 6162 6f76  lues in the abov
-0000be70: 6520 636f 6c75 6d6e 7320 6f66 2074 6865  e columns of the
-0000be80: 2070 6172 616d 6574 6572 7320 7462 6c73   parameters tbls
-0000be90: 203d 0a20 2020 2020 2020 2023 2069 6620   =.        # if 
-0000bea0: 6576 6572 7974 6869 6e67 2069 7320 7072  everything is pr
-0000beb0: 6573 656e 742c 2073 6b69 7020 6361 6c63  esent, skip calc
-0000bec0: 756c 6174 6520 7265 7365 7276 6f69 7261  ulate reservoira
-0000bed0: 7474 7273 2829 2061 6e64 2064 6972 6563  ttrs() and direc
-0000bee0: 746c 7920 6d61 6b65 2074 6865 206d 6170  tly make the map
-0000bef0: 730a 2020 2020 2020 2020 6966 2064 735f  s.        if ds_
-0000bf00: 7265 7320 6973 206e 6f74 204e 6f6e 653a  res is not None:
-0000bf10: 0a20 2020 2020 2020 2020 2020 2072 6d64  .            rmd
-0000bf20: 6963 7420 3d20 7b6b 3a20 7620 666f 7220  ict = {k: v for 
-0000bf30: 6b2c 2076 2069 6e20 7365 6c66 2e5f 4d41  k, v in self._MA
-0000bf40: 5053 2e69 7465 6d73 2829 2069 6620 6b20  PS.items() if k 
-0000bf50: 696e 2064 735f 7265 732e 6461 7461 5f76  in ds_res.data_v
-0000bf60: 6172 737d 0a20 2020 2020 2020 2020 2020  ars}.           
-0000bf70: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
-0000bf80: 6d61 7073 2864 735f 7265 732e 7265 6e61  maps(ds_res.rena
-0000bf90: 6d65 2872 6d64 6963 7429 290a 0a20 2020  me(rmdict))..   
-0000bfa0: 2020 2020 2020 2020 2023 2061 6464 2061           # add a
-0000bfb0: 7474 7269 6275 7465 730a 2020 2020 2020  ttributes.      
-0000bfc0: 2020 2020 2020 2320 6966 2070 7265 7365        # if prese
-0000bfd0: 6e74 2075 7365 2064 6972 6563 746c 790a  nt use directly.
-0000bfe0: 2020 2020 2020 2020 2020 2020 7265 7361              resa
-0000bff0: 7474 7269 6275 7465 7320 3d20 5b0a 2020  ttributes = [.  
-0000c000: 2020 2020 2020 2020 2020 2020 2020 2277                "w
-0000c010: 6174 6572 626f 6479 5f69 6422 2c0a 2020  aterbody_id",.  
-0000c020: 2020 2020 2020 2020 2020 2020 2020 2252                "R
-0000c030: 6573 5369 6d70 6c65 4172 6561 222c 0a20  esSimpleArea",. 
-0000c040: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000c050: 5265 734d 6178 566f 6c75 6d65 222c 0a20  ResMaxVolume",. 
-0000c060: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000c070: 5265 7354 6172 6765 744d 696e 4672 6163  ResTargetMinFrac
-0000c080: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000c090: 2020 2022 5265 7354 6172 6765 7446 756c     "ResTargetFul
-0000c0a0: 6c46 7261 6322 2c0a 2020 2020 2020 2020  lFrac",.        
-0000c0b0: 2020 2020 2020 2020 2252 6573 4465 6d61          "ResDema
-0000c0c0: 6e64 222c 0a20 2020 2020 2020 2020 2020  nd",.           
-0000c0d0: 2020 2020 2022 5265 734d 6178 5265 6c65       "ResMaxRele
-0000c0e0: 6173 6522 2c0a 2020 2020 2020 2020 2020  ase",.          
-0000c0f0: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
-0000c100: 6966 206e 702e 616c 6c28 6e70 2e69 7369  if np.all(np.isi
-0000c110: 6e28 7265 7361 7474 7269 6275 7465 732c  n(resattributes,
-0000c120: 2067 6466 5f6f 7267 2e63 6f6c 756d 6e73   gdf_org.columns
-0000c130: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000c140: 2020 2020 696e 7462 6c5f 7265 7365 7276      intbl_reserv
-0000c150: 6f69 7273 203d 2067 6466 5f6f 7267 5b72  oirs = gdf_org[r
-0000c160: 6573 6174 7472 6962 7574 6573 5d0a 2020  esattributes].  
-0000c170: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000c180: 7365 7276 6f69 725f 6163 6375 7261 6379  servoir_accuracy
-0000c190: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000c1a0: 2020 2020 2320 656c 7365 2063 6f6d 7075      # else compu
-0000c1b0: 7465 0a20 2020 2020 2020 2020 2020 2065  te.            e
-0000c1c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000c1d0: 2020 2020 2069 6e74 626c 5f72 6573 6572       intbl_reser
-0000c1e0: 766f 6972 732c 2072 6573 6572 766f 6972  voirs, reservoir
-0000c1f0: 5f61 6363 7572 6163 7920 3d20 776f 726b  _accuracy = work
-0000c200: 666c 6f77 732e 7265 7365 7276 6f69 7261  flows.reservoira
-0000c210: 7474 7273 280a 2020 2020 2020 2020 2020  ttrs(.          
-0000c220: 2020 2020 2020 2020 2020 6764 663d 6764            gdf=gd
-0000c230: 665f 6f72 672c 0a20 2020 2020 2020 2020  f_org,.         
-0000c240: 2020 2020 2020 2020 2020 2070 7269 6f72             prior
-0000c250: 6974 794a 5243 3d70 7269 6f72 6974 795f  ityJRC=priority_
-0000c260: 6a72 632c 0a20 2020 2020 2020 2020 2020  jrc,.           
-0000c270: 2020 2020 2020 2020 2075 7365 6865 3d6b           usehe=k
-0000c280: 7761 7267 732e 6765 7428 2275 7365 6865  wargs.get("usehe
-0000c290: 222c 2054 7275 6529 2c0a 2020 2020 2020  ", True),.      
-0000c2a0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0000c2b0: 6767 6572 3d73 656c 662e 6c6f 6767 6572  gger=self.logger
-0000c2c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c2d0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000c2e0: 2020 2020 696e 7462 6c5f 7265 7365 7276      intbl_reserv
-0000c2f0: 6f69 7273 203d 2069 6e74 626c 5f72 6573  oirs = intbl_res
-0000c300: 6572 766f 6972 732e 7265 6e61 6d65 2863  ervoirs.rename(c
-0000c310: 6f6c 756d 6e73 3d74 626c 7329 0a0a 2020  olumns=tbls)..  
-0000c320: 2020 2020 2020 2020 2020 2320 6372 6561            # crea
-0000c330: 7465 2061 2067 656f 6466 2077 6974 6820  te a geodf with 
-0000c340: 6964 206f 6620 7265 7365 7276 6f69 7220  id of reservoir 
-0000c350: 616e 6420 6765 6d6f 6574 7279 2061 7420  and gemoetry at 
-0000c360: 6f75 7466 6c6f 7720 6c6f 6361 7469 6f6e  outflow location
-0000c370: 0a20 2020 2020 2020 2020 2020 2067 6466  .            gdf
-0000c380: 5f6f 7267 5f70 6f69 6e74 7320 3d20 6770  _org_points = gp
-0000c390: 642e 4765 6f44 6174 6146 7261 6d65 280a  d.GeoDataFrame(.
-0000c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3b0: 6764 665f 6f72 675b 2277 6174 6572 626f  gdf_org["waterbo
-0000c3c0: 6479 5f69 6422 5d2c 0a20 2020 2020 2020  dy_id"],.       
-0000c3d0: 2020 2020 2020 2020 2067 656f 6d65 7472           geometr
-0000c3e0: 793d 6770 642e 706f 696e 7473 5f66 726f  y=gpd.points_fro
-0000c3f0: 6d5f 7879 2867 6466 5f6f 7267 2e78 6f75  m_xy(gdf_org.xou
-0000c400: 742c 2067 6466 5f6f 7267 2e79 6f75 7429  t, gdf_org.yout)
-0000c410: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000c420: 2020 2020 2020 2020 2020 2020 696e 7462              intb
-0000c430: 6c5f 7265 7365 7276 6f69 7273 203d 2069  l_reservoirs = i
-0000c440: 6e74 626c 5f72 6573 6572 766f 6972 732e  ntbl_reservoirs.
-0000c450: 7265 6e61 6d65 280a 2020 2020 2020 2020  rename(.        
-0000c460: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
-0000c470: 7b22 6578 7072 3122 3a20 2277 6174 6572  {"expr1": "water
-0000c480: 626f 6479 5f69 6422 7d0a 2020 2020 2020  body_id"}.      
-0000c490: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000c4a0: 2020 2020 6764 665f 6f72 675f 706f 696e      gdf_org_poin
-0000c4b0: 7473 203d 2067 6466 5f6f 7267 5f70 6f69  ts = gdf_org_poi
-0000c4c0: 6e74 732e 6d65 7267 6528 0a20 2020 2020  nts.merge(.     
-0000c4d0: 2020 2020 2020 2020 2020 2069 6e74 626c             intbl
-0000c4e0: 5f72 6573 6572 766f 6972 732c 206f 6e3d  _reservoirs, on=
-0000c4f0: 2277 6174 6572 626f 6479 5f69 6422 0a20  "waterbody_id". 
-0000c500: 2020 2020 2020 2020 2020 2029 2020 2320             )  # 
-0000c510: 6d65 7267 650a 2020 2020 2020 2020 2020  merge.          
-0000c520: 2020 2320 6164 6420 7061 7261 6d65 7465    # add paramete
-0000c530: 7220 6174 7472 6962 7574 6573 2074 6f20  r attributes to 
-0000c540: 706f 6c79 676f 6e65 2067 6466 3a0a 2020  polygone gdf:.  
-0000c550: 2020 2020 2020 2020 2020 6764 665f 6f72            gdf_or
-0000c560: 6720 3d20 6764 665f 6f72 672e 6d65 7267  g = gdf_org.merg
-0000c570: 6528 696e 7462 6c5f 7265 7365 7276 6f69  e(intbl_reservoi
-0000c580: 7273 2c20 6f6e 3d22 7761 7465 7262 6f64  rs, on="waterbod
-0000c590: 795f 6964 2229 0a0a 2020 2020 2020 2020  y_id")..        
-0000c5a0: 2020 2020 2320 7772 6974 6520 7265 7365      # write rese
-0000c5b0: 7276 6f69 7273 2077 6974 6820 7061 7261  rvoirs with para
-0000c5c0: 6d20 7661 6c75 6573 2074 6f20 7374 6174  m values to stat
-0000c5d0: 6963 6765 6f6d 730a 2020 2020 2020 2020  icgeoms.        
-0000c5e0: 2020 2020 7365 6c66 2e73 6574 5f73 7461      self.set_sta
-0000c5f0: 7469 6367 656f 6d73 2867 6466 5f6f 7267  ticgeoms(gdf_org
-0000c600: 2c20 6e61 6d65 3d22 7265 7365 7276 6f69  , name="reservoi
-0000c610: 7273 2229 0a0a 2020 2020 2020 2020 2020  rs")..          
-0000c620: 2020 666f 7220 6e61 6d65 2069 6e20 6764    for name in gd
-0000c630: 665f 6f72 675f 706f 696e 7473 2e63 6f6c  f_org_points.col
-0000c640: 756d 6e73 5b32 3a5d 3a0a 2020 2020 2020  umns[2:]:.      
-0000c650: 2020 2020 2020 2020 2020 6764 665f 6f72            gdf_or
-0000c660: 675f 706f 696e 7473 5b6e 616d 655d 203d  g_points[name] =
-0000c670: 2067 6466 5f6f 7267 5f70 6f69 6e74 735b   gdf_org_points[
-0000c680: 6e61 6d65 5d2e 6173 7479 7065 2822 666c  name].astype("fl
-0000c690: 6f61 7433 3222 290a 2020 2020 2020 2020  oat32").        
-0000c6a0: 2020 2020 2020 2020 6461 5f72 6573 203d          da_res =
-0000c6b0: 2064 735f 7265 732e 7261 7374 6572 2e72   ds_res.raster.r
-0000c6c0: 6173 7465 7269 7a65 280a 2020 2020 2020  asterize(.      
-0000c6d0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-0000c6e0: 665f 6f72 675f 706f 696e 7473 2c20 636f  f_org_points, co
-0000c6f0: 6c5f 6e61 6d65 3d6e 616d 652c 2064 7479  l_name=name, dty
-0000c700: 7065 3d22 666c 6f61 7433 3222 2c20 6e6f  pe="float32", no
-0000c710: 6461 7461 3d2d 3939 390a 2020 2020 2020  data=-999.      
-0000c720: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000c730: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c740: 2e73 6574 5f73 7461 7469 636d 6170 7328  .set_staticmaps(
-0000c750: 6461 5f72 6573 290a 0a20 2020 2020 2020  da_res)..       
-0000c760: 2020 2020 2023 2053 6176 6520 6163 6375       # Save accu
-0000c770: 7261 6379 2069 6e66 6f72 6d61 7469 6f6e  racy information
-0000c780: 206f 6e20 7265 7365 7276 6f69 7220 7061   on reservoir pa
-0000c790: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0000c7a0: 2020 2020 2069 6620 7265 7365 7276 6f69       if reservoi
-0000c7b0: 725f 6163 6375 7261 6379 2069 7320 6e6f  r_accuracy is no
-0000c7c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000c7d0: 2020 2020 2020 2020 7265 7365 7276 6f69          reservoi
-0000c7e0: 725f 6163 6375 7261 6379 2e74 6f5f 6373  r_accuracy.to_cs
-0000c7f0: 7628 6a6f 696e 2873 656c 662e 726f 6f74  v(join(self.root
-0000c800: 2c20 2272 6573 6572 766f 6972 5f61 6363  , "reservoir_acc
-0000c810: 7572 6163 792e 6373 7622 2929 0a0a 2020  uracy.csv"))..  
-0000c820: 2020 2020 2020 2020 2020 666f 7220 6f70            for op
-0000c830: 7469 6f6e 2069 6e20 7265 735f 746f 6d6c  tion in res_toml
-0000c840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c850: 2020 7365 6c66 2e73 6574 5f63 6f6e 6669    self.set_confi
-0000c860: 6728 6f70 7469 6f6e 2c20 7265 735f 746f  g(option, res_to
-0000c870: 6d6c 5b6f 7074 696f 6e5d 290a 0a20 2020  ml[option])..   
-0000c880: 2064 6566 205f 7365 7475 705f 7761 7465   def _setup_wate
-0000c890: 7262 6f64 6965 7328 7365 6c66 2c20 7761  rbodies(self, wa
-0000c8a0: 7465 7262 6f64 6965 735f 666e 2c20 7762  terbodies_fn, wb
-0000c8b0: 5f74 7970 652c 206d 696e 5f61 7265 613d  _type, min_area=
-0000c8c0: 302e 3029 3a0a 2020 2020 2020 2020 2222  0.0):.        ""
-0000c8d0: 2248 656c 7065 7220 6d65 7468 6f64 2077  "Helper method w
-0000c8e0: 6974 6820 7468 6520 636f 6d6d 6f6e 2077  ith the common w
-0000c8f0: 6f72 6b66 6c6f 7720 6f66 2073 6574 7570  orkflow of setup
-0000c900: 5f6c 616b 6573 2061 6e64 2073 6574 7570  _lakes and setup
-0000c910: 5f72 6573 6572 766f 6972 2e0a 2020 2020  _reservoir..    
-0000c920: 2020 2020 5365 6520 7370 6563 6966 6963      See specific
-0000c930: 206d 6574 686f 6473 2066 6f72 206d 6f72   methods for mor
-0000c940: 6520 696e 666f 2061 626f 7574 2074 6865  e info about the
-0000c950: 2061 7267 756d 656e 7473 2e22 2222 0a20   arguments.""". 
-0000c960: 2020 2020 2020 2023 2072 6574 7269 6576         # retriev
-0000c970: 6520 6461 7461 2066 6f72 2062 6173 696e  e data for basin
-0000c980: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-0000c990: 6767 6572 2e69 6e66 6f28 6622 5072 6570  gger.info(f"Prep
-0000c9a0: 6172 696e 6720 7b77 625f 7479 7065 7d20  aring {wb_type} 
-0000c9b0: 6d61 7073 2e22 290a 2020 2020 2020 2020  maps.").        
-0000c9c0: 6764 665f 6f72 6720 3d20 7365 6c66 2e64  gdf_org = self.d
-0000c9d0: 6174 615f 6361 7461 6c6f 672e 6765 745f  ata_catalog.get_
-0000c9e0: 6765 6f64 6174 6166 7261 6d65 280a 2020  geodataframe(.  
-0000c9f0: 2020 2020 2020 2020 2020 7761 7465 7262            waterb
-0000ca00: 6f64 6965 735f 666e 2c20 6765 6f6d 3d73  odies_fn, geom=s
-0000ca10: 656c 662e 6261 7369 6e73 2c20 7072 6564  elf.basins, pred
-0000ca20: 6963 6174 653d 2263 6f6e 7461 696e 7322  icate="contains"
-0000ca30: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0000ca40: 2020 2023 2073 6b69 7020 736d 616c 6c20     # skip small 
-0000ca50: 7369 7a65 2077 6174 6572 626f 6469 6573  size waterbodies
-0000ca60: 0a20 2020 2020 2020 2069 6620 2241 7265  .        if "Are
-0000ca70: 615f 6176 6722 2069 6e20 6764 665f 6f72  a_avg" in gdf_or
-0000ca80: 672e 636f 6c75 6d6e 7320 616e 6420 6764  g.columns and gd
-0000ca90: 665f 6f72 672e 6765 6f6d 6574 7279 2e73  f_org.geometry.s
-0000caa0: 697a 6520 3e20 303a 0a20 2020 2020 2020  ize > 0:.       
-0000cab0: 2020 2020 206d 696e 5f61 7265 615f 6d32       min_area_m2
-0000cac0: 203d 206d 696e 5f61 7265 6120 2a20 3165   = min_area * 1e
-0000cad0: 360a 2020 2020 2020 2020 2020 2020 6764  6.            gd
-0000cae0: 665f 6f72 6720 3d20 6764 665f 6f72 675b  f_org = gdf_org[
-0000caf0: 6764 665f 6f72 672e 4172 6561 5f61 7667  gdf_org.Area_avg
-0000cb00: 203e 3d20 6d69 6e5f 6172 6561 5f6d 325d   >= min_area_m2]
-0000cb10: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000cb20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000cb30: 6c6f 6767 6572 2e77 6172 6e69 6e67 280a  logger.warning(.
-0000cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb50: 6622 7b77 625f 7479 7065 7d27 7320 6461  f"{wb_type}'s da
-0000cb60: 7461 6261 7365 2068 6173 206e 6f20 6172  tabase has no ar
-0000cb70: 6561 2061 7474 7269 6275 7465 2e20 220a  ea attribute. ".
-0000cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb90: 6622 416c 6c20 7b77 625f 7479 7065 7d73  f"All {wb_type}s
-0000cba0: 2077 696c 6c20 6265 2063 6f6e 7369 6465   will be conside
-0000cbb0: 7265 642e 220a 2020 2020 2020 2020 2020  red.".          
-0000cbc0: 2020 290a 2020 2020 2020 2020 2320 6765    ).        # ge
-0000cbd0: 7420 7761 7465 7262 6f64 6965 7320 6d61  t waterbodies ma
-0000cbe0: 7073 2061 6e64 2070 6172 616d 6574 6572  ps and parameter
-0000cbf0: 730a 2020 2020 2020 2020 6e62 5f77 6220  s.        nb_wb 
-0000cc00: 3d20 6764 665f 6f72 672e 6765 6f6d 6574  = gdf_org.geomet
-0000cc10: 7279 2e73 697a 650a 2020 2020 2020 2020  ry.size.        
-0000cc20: 6473 5f77 6174 6572 626f 6479 203d 204e  ds_waterbody = N
-0000cc30: 6f6e 650a 2020 2020 2020 2020 6966 206e  one.        if n
-0000cc40: 625f 7762 203e 2030 3a0a 2020 2020 2020  b_wb > 0:.      
-0000cc50: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-0000cc60: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
-0000cc70: 2020 2020 2020 2020 6622 7b6e 625f 7762          f"{nb_wb
-0000cc80: 7d20 7b77 625f 7479 7065 7d28 7329 206f  } {wb_type}(s) o
-0000cc90: 6620 7375 6666 6963 6965 6e74 2073 697a  f sufficient siz
-0000cca0: 6520 666f 756e 6420 7769 7468 696e 2072  e found within r
-0000ccb0: 6567 696f 6e2e 220a 2020 2020 2020 2020  egion.".        
-0000ccc0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000ccd0: 2020 2320 6164 6420 7761 7465 7262 6f64    # add waterbod
-0000cce0: 7920 6d61 7073 0a20 2020 2020 2020 2020  y maps.         
-0000ccf0: 2020 2075 7061 7265 615f 6e61 6d65 203d     uparea_name =
-0000cd00: 2073 656c 662e 5f4d 4150 535b 2275 7061   self._MAPS["upa
-0000cd10: 7265 6122 5d0a 2020 2020 2020 2020 2020  rea"].          
-0000cd20: 2020 6966 2075 7061 7265 615f 6e61 6d65    if uparea_name
-0000cd30: 206e 6f74 2069 6e20 7365 6c66 2e73 7461   not in self.sta
-0000cd40: 7469 636d 6170 732e 6461 7461 5f76 6172  ticmaps.data_var
-0000cd50: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000cd60: 2020 2073 656c 662e 6c6f 6767 6572 2e77     self.logger.w
-0000cd70: 6172 6e69 6e67 280a 2020 2020 2020 2020  arning(.        
-0000cd80: 2020 2020 2020 2020 2020 2020 6622 5570              f"Up
-0000cd90: 7374 7265 616d 2061 7265 6120 6d61 7020  stream area map 
-0000cda0: 666f 7220 7b77 625f 7479 7065 7d20 6f75  for {wb_type} ou
-0000cdb0: 746c 6574 2073 6574 7570 206e 6f74 2066  tlet setup not f
-0000cdc0: 6f75 6e64 2e20 220a 2020 2020 2020 2020  ound. ".        
-0000cdd0: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
-0000cde0: 6162 6173 6520 636f 6f72 6469 6e61 7465  abase coordinate
-0000cdf0: 7320 7573 6564 2069 6e73 7465 6164 220a  s used instead".
-0000ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ce20: 2020 7570 6172 6561 5f6e 616d 6520 3d20    uparea_name = 
-0000ce30: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000ce40: 2064 735f 7761 7465 7262 6f64 792c 2067   ds_waterbody, g
-0000ce50: 6466 5f77 6174 6572 6f75 746c 6574 203d  df_wateroutlet =
-0000ce60: 2077 6f72 6b66 6c6f 7773 2e77 6174 6572   workflows.water
-0000ce70: 626f 6479 6d61 7073 280a 2020 2020 2020  bodymaps(.      
-0000ce80: 2020 2020 2020 2020 2020 6764 663d 6764            gdf=gd
-0000ce90: 665f 6f72 672c 0a20 2020 2020 2020 2020  f_org,.         
-0000cea0: 2020 2020 2020 2064 735f 6c69 6b65 3d73         ds_like=s
-0000ceb0: 656c 662e 7374 6174 6963 6d61 7073 2c0a  elf.staticmaps,.
-0000cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ced0: 7762 5f74 7970 653d 7762 5f74 7970 652c  wb_type=wb_type,
-0000cee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cef0: 2075 7061 7265 615f 6e61 6d65 3d75 7061   uparea_name=upa
-0000cf00: 7265 615f 6e61 6d65 2c0a 2020 2020 2020  rea_name,.      
-0000cf10: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-0000cf20: 3d73 656c 662e 6c6f 6767 6572 2c0a 2020  =self.logger,.  
-0000cf30: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000cf40: 2020 2020 2020 2020 2320 7570 6461 7465          # update
-0000cf50: 2078 6f75 7420 616e 6420 796f 7574 2069   xout and yout i
-0000cf60: 6e20 6764 665f 6f72 6720 6672 6f6d 2067  n gdf_org from g
-0000cf70: 6466 5f77 6174 6572 6f75 746c 6574 3a0a  df_wateroutlet:.
-0000cf80: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-0000cf90: 786f 7574 2220 696e 2067 6466 5f6f 7267  xout" in gdf_org
-0000cfa0: 2e63 6f6c 756d 6e73 2061 6e64 2022 796f  .columns and "yo
-0000cfb0: 7574 2220 696e 2067 6466 5f6f 7267 2e63  ut" in gdf_org.c
-0000cfc0: 6f6c 756d 6e73 3a0a 2020 2020 2020 2020  olumns:.        
-0000cfd0: 2020 2020 2020 2020 6764 665f 6f72 672e          gdf_org.
-0000cfe0: 6c6f 635b 3a2c 2022 786f 7574 225d 203d  loc[:, "xout"] =
-0000cff0: 2067 6466 5f77 6174 6572 6f75 746c 6574   gdf_wateroutlet
-0000d000: 5b22 786f 7574 225d 0a20 2020 2020 2020  ["xout"].       
-0000d010: 2020 2020 2020 2020 2067 6466 5f6f 7267           gdf_org
-0000d020: 2e6c 6f63 5b3a 2c20 2279 6f75 7422 5d20  .loc[:, "yout"] 
-0000d030: 3d20 6764 665f 7761 7465 726f 7574 6c65  = gdf_wateroutle
-0000d040: 745b 2279 6f75 7422 5d0a 0a20 2020 2020  t["yout"]..     
-0000d050: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000d060: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-0000d070: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
-0000d080: 2020 2020 2020 2020 2020 6622 4e6f 207b            f"No {
-0000d090: 7762 5f74 7970 657d 7320 6f66 2073 7566  wb_type}s of suf
-0000d0a0: 6669 6369 656e 7420 7369 7a65 2066 6f75  ficient size fou
-0000d0b0: 6e64 2077 6974 6869 6e20 7265 6769 6f6e  nd within region
-0000d0c0: 2120 220a 2020 2020 2020 2020 2020 2020  ! ".            
-0000d0d0: 2020 2020 6622 536b 6970 7069 6e67 207b      f"Skipping {
-0000d0e0: 7762 5f74 7970 657d 2070 726f 6365 6475  wb_type} procedu
-0000d0f0: 7265 7321 220a 2020 2020 2020 2020 2020  res!".          
-0000d100: 2020 290a 0a20 2020 2020 2020 2023 2072    )..        # r
-0000d110: 6173 7465 7269 7a65 2070 6f69 6e74 7320  asterize points 
-0000d120: 706f 6c79 676f 6e73 2069 6e20 7261 7374  polygons in rast
-0000d130: 6572 2e72 6173 7465 7269 7a65 202d 2d20  er.rasterize -- 
-0000d140: 796f 7520 6e65 6564 2073 7461 7469 636d  you need staticm
-0000d150: 6170 7320 746f 206e 6b6f 7720 7468 6520  aps to nkow the 
-0000d160: 6772 6964 0a20 2020 2020 2020 2072 6574  grid.        ret
-0000d170: 7572 6e20 6764 665f 6f72 672c 2064 735f  urn gdf_org, ds_
-0000d180: 7761 7465 7262 6f64 790a 0a20 2020 2064  waterbody..    d
-0000d190: 6566 2073 6574 7570 5f73 6f69 6c6d 6170  ef setup_soilmap
-0000d1a0: 7328 7365 6c66 2c20 736f 696c 5f66 6e3d  s(self, soil_fn=
-0000d1b0: 2273 6f69 6c67 7269 6473 222c 2070 7466  "soilgrids", ptf
-0000d1c0: 5f6b 7361 7476 6572 3d22 6272 616b 656e  _ksatver="braken
-0000d1d0: 7369 656b 2229 3a0a 2020 2020 2020 2020  siek"):.        
-0000d1e0: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
-0000d1f0: 2063 6f6d 706f 6e65 6e74 2064 6572 6976   component deriv
-0000d200: 6573 2073 6576 6572 616c 2028 6c61 7965  es several (laye
-0000d210: 7265 6429 2073 6f69 6c20 7061 7261 6d65  red) soil parame
-0000d220: 7465 7273 2062 6173 6564 206f 6e20 6120  ters based on a 
-0000d230: 6461 7461 6261 7365 2077 6974 680a 2020  database with.  
-0000d240: 2020 2020 2020 7068 7973 6963 616c 2073        physical s
-0000d250: 6f69 6c20 7072 6f70 6572 7469 6573 2075  oil properties u
-0000d260: 7369 6e67 2061 7661 696c 6162 6c65 2070  sing available p
-0000d270: 6f69 6e74 2d73 6361 6c65 2028 7065 646f  oint-scale (pedo
-0000d280: 2974 7261 6e73 6665 7220 6675 6e63 7469  )transfer functi
-0000d290: 6f6e 7320 2850 5446 7329 0a20 2020 2020  ons (PTFs).     
-0000d2a0: 2020 2066 726f 6d20 6c69 7465 7261 7475     from literatu
-0000d2b0: 7265 2077 6974 6820 7570 7363 616c 696e  re with upscalin
-0000d2c0: 6720 7275 6c65 7320 746f 2065 6e73 7572  g rules to ensur
-0000d2d0: 6520 666c 7578 206d 6174 6368 696e 6720  e flux matching 
-0000d2e0: 6163 726f 7373 2073 6361 6c65 732e 0a0a  across scales...
-0000d2f0: 2020 2020 2020 2020 4375 7272 656e 746c          Currentl
-0000d300: 792c 2073 7570 706f 7274 6564 2060 6073  y, supported ``s
-0000d310: 6f69 6c5f 666e 6060 2069 7320 2273 6f69  oil_fn`` is "soi
-0000d320: 6c67 7269 6473 2220 616e 6420 2273 6f69  lgrids" and "soi
-0000d330: 6c67 7269 6473 5f32 3032 3022 2e0a 2020  lgrids_2020"..  
-0000d340: 2020 2020 2020 6060 7074 665f 6b73 6174        ``ptf_ksat
-0000d350: 7665 7260 6020 2850 5446 2066 6f72 2074  ver`` (PTF for t
-0000d360: 6865 2076 6572 7469 6361 6c20 6879 6472  he vertical hydr
-0000d370: 6175 6c69 6320 636f 6e64 7563 7469 7669  aulic conductivi
-0000d380: 7479 2920 6f70 7469 6f6e 7320 6172 6520  ty) options are 
-0000d390: 2262 7261 6b65 6e73 6965 6b22 2061 6e64  "brakensiek" and
-0000d3a0: 2022 636f 7362 7922 2e0a 2020 2020 2020   "cosby"..      
-0000d3b0: 2020 2273 6f69 6c67 7269 6473 2220 7072    "soilgrids" pr
-0000d3c0: 6f76 6964 6573 2064 6174 6120 6174 2037  ovides data at 7
-0000d3d0: 2073 7065 6369 6669 6320 6465 7074 6873   specific depths
-0000d3e0: 2c20 7768 696c 6520 2273 6f69 6c67 7269  , while "soilgri
-0000d3f0: 6473 5f32 3032 3022 2070 726f 7669 6465  ds_2020" provide
-0000d400: 7320 6461 7461 2061 7665 7261 6765 6420  s data averaged 
-0000d410: 6f76 6572 2036 2064 6570 7468 2069 6e74  over 6 depth int
-0000d420: 6572 7661 6c73 2e0a 2020 2020 2020 2020  ervals..        
-0000d430: 5468 6973 206c 6561 6473 2074 6f20 736d  This leads to sm
-0000d440: 616c 6c20 6368 616e 6765 7320 696e 2074  all changes in t
-0000d450: 6865 2077 6f72 6b66 6c6f 773a 2028 3129  he workflow: (1)
-0000d460: 204d 2070 6172 616d 6574 6572 2075 7365   M parameter use
-0000d470: 7320 6d69 6470 6f69 6e74 2064 6570 7468  s midpoint depth
-0000d480: 7320 696e 2073 6f69 6c67 7269 6473 5f32  s in soilgrids_2
-0000d490: 3032 3020 7665 7273 7573 2073 7065 6369  020 versus speci
-0000d4a0: 6669 6320 6465 7074 6873 2069 6e20 736f  fic depths in so
-0000d4b0: 696c 6772 6964 732c 0a20 2020 2020 2020  ilgrids,.       
-0000d4c0: 2028 3229 2077 6569 6768 7465 6420 6176   (2) weighted av
-0000d4d0: 6572 6167 6520 6f66 2073 6f69 6c20 7072  erage of soil pr
-0000d4e0: 6f70 6572 7469 6573 206f 7665 7220 736f  operties over so
-0000d4f0: 696c 2074 6869 636b 6e65 7373 2069 7320  il thickness is 
-0000d500: 646f 6e65 2077 6974 6820 7468 6520 7472  done with the tr
-0000d510: 6170 657a 6f69 6461 6c20 7275 6c65 2069  apezoidal rule i
-0000d520: 6e20 736f 696c 6772 6964 7320 7665 7273  n soilgrids vers
-0000d530: 7573 2073 696d 706c 6520 626c 6f63 6b20  us simple block 
-0000d540: 7765 6967 6874 6564 2061 7665 7261 6765  weighted average
-0000d550: 2069 6e20 736f 696c 6772 6964 735f 3230   in soilgrids_20
-0000d560: 3230 2c0a 2020 2020 2020 2020 2833 2920  20,.        (3) 
-0000d570: 7468 6520 6320 7061 7261 6d65 7465 7220  the c parameter 
-0000d580: 6973 2063 6f6d 7075 7465 6420 6173 2077  is computed as w
-0000d590: 6569 6768 7465 6420 6176 6572 6167 6520  eighted average 
-0000d5a0: 6f76 6572 2077 666c 6f77 5f73 626d 2073  over wflow_sbm s
-0000d5b0: 6f69 6c20 6c61 7965 7273 2069 6e20 736f  oil layers in so
-0000d5c0: 696c 6772 6964 735f 3230 3230 2076 6572  ilgrids_2020 ver
-0000d5d0: 7375 7320 6174 2073 7065 6369 6669 6320  sus at specific 
-0000d5e0: 6465 7074 6873 2066 6f72 2073 6f69 6c67  depths for soilg
-0000d5f0: 7269 6473 2e0a 0a20 2020 2020 2020 2054  rids...        T
-0000d600: 6865 2066 6f6c 6c6f 7769 6e67 206d 6170  he following map
-0000d610: 7320 6172 6520 6164 6465 6420 746f 2073  s are added to s
-0000d620: 7461 7469 636d 6170 733a 0a0a 2020 2020  taticmaps:..    
-0000d630: 2020 2020 2a20 2a2a 7468 6574 6153 2a2a      * **thetaS**
-0000d640: 206d 6170 3a20 6176 6572 6167 6520 7361   map: average sa
-0000d650: 7475 7261 7465 6420 736f 696c 2077 6174  turated soil wat
-0000d660: 6572 2063 6f6e 7465 6e74 205b 6d33 2f6d  er content [m3/m
-0000d670: 335d 0a20 2020 2020 2020 202a 202a 2a74  3].        * **t
-0000d680: 6865 7461 522a 2a20 6d61 703a 2061 7665  hetaR** map: ave
-0000d690: 7261 6765 2072 6573 6964 7561 6c20 7761  rage residual wa
-0000d6a0: 7465 7220 636f 6e74 656e 7420 5b6d 332f  ter content [m3/
-0000d6b0: 6d33 5d0a 2020 2020 2020 2020 2a20 2a2a  m3].        * **
-0000d6c0: 4b73 6174 5665 722a 2a20 6d61 703a 2076  KsatVer** map: v
-0000d6d0: 6572 7469 6361 6c20 7361 7475 7261 7465  ertical saturate
-0000d6e0: 6420 6879 6472 6175 6c69 6320 636f 6e64  d hydraulic cond
-0000d6f0: 7563 7469 7669 7479 2061 7420 736f 696c  uctivity at soil
-0000d700: 2073 7572 6661 6365 205b 6d6d 2f64 6179   surface [mm/day
-0000d710: 5d0a 2020 2020 2020 2020 2a20 2a2a 536f  ].        * **So
-0000d720: 696c 5468 6963 6b6e 6573 732a 2a20 6d61  ilThickness** ma
-0000d730: 703a 2073 6f69 6c20 7468 6963 6b6e 6573  p: soil thicknes
-0000d740: 7320 5b6d 6d5d 0a20 2020 2020 2020 202a  s [mm].        *
-0000d750: 202a 2a53 6f69 6c4d 696e 5468 6963 6b6e   **SoilMinThickn
-0000d760: 6573 732a 2a20 6d61 703a 206d 696e 696d  ess** map: minim
-0000d770: 756d 2073 6f69 6c20 7468 6963 6b6e 6573  um soil thicknes
-0000d780: 7320 5b6d 6d5d 2028 6571 7561 6c20 746f  s [mm] (equal to
-0000d790: 2053 6f69 6c54 6869 636b 6e65 7373 290a   SoilThickness).
-0000d7a0: 2020 2020 2020 2020 2a20 2a2a 4d2a 2a20          * **M** 
-0000d7b0: 6d61 703a 206d 6f64 656c 2070 6172 616d  map: model param
-0000d7c0: 6574 6572 205b 6d6d 5d20 7468 6174 2063  eter [mm] that c
-0000d7d0: 6f6e 7472 6f6c 7320 6578 706f 6e65 6e74  ontrols exponent
-0000d7e0: 6961 6c20 6465 636c 696e 6520 6f66 204b  ial decline of K
-0000d7f0: 7361 7456 6572 2077 6974 6820 736f 696c  satVer with soil
-0000d800: 2064 6570 7468 0a20 2020 2020 2020 2020   depth.         
-0000d810: 2020 2028 6669 7474 6564 2077 6974 6820     (fitted with 
-0000d820: 6375 7276 655f 6669 7420 2873 6369 7079  curve_fit (scipy
-0000d830: 2e6f 7074 696d 697a 6529 292c 2062 6f75  .optimize)), bou
-0000d840: 6e64 7320 6f66 204d 2061 7265 2063 6865  nds of M are che
-0000d850: 636b 6564 0a20 2020 2020 2020 202a 202a  cked.        * *
-0000d860: 2a60 4d5f 602a 2a20 6d61 703a 206d 6f64  *`M_`** map: mod
-0000d870: 656c 2070 6172 616d 6574 6572 205b 6d6d  el parameter [mm
-0000d880: 5d20 7468 6174 2063 6f6e 7472 6f6c 7320  ] that controls 
-0000d890: 6578 706f 6e65 6e74 6961 6c20 6465 636c  exponential decl
-0000d8a0: 696e 6520 6f66 204b 7361 7456 6572 2077  ine of KsatVer w
-0000d8b0: 6974 6820 736f 696c 2064 6570 7468 0a20  ith soil depth. 
-0000d8c0: 2020 2020 2020 2020 2020 2028 6669 7474             (fitt
-0000d8d0: 6564 2077 6974 6820 6e75 6d70 7920 6c69  ed with numpy li
-0000d8e0: 6e61 6c67 2072 6567 7265 7373 696f 6e29  nalg regression)
-0000d8f0: 2c20 626f 756e 6473 206f 6620 604d 5f60  , bounds of `M_`
-0000d900: 2061 7265 2063 6865 636b 6564 0a20 2020   are checked.   
-0000d910: 2020 2020 202a 202a 2a4d 5f6f 7269 6769       * **M_origi
-0000d920: 6e61 6c2a 2a20 6d61 703a 204d 2077 6974  nal** map: M wit
-0000d930: 686f 7574 2063 6865 636b 696e 6720 626f  hout checking bo
-0000d940: 756e 6473 0a20 2020 2020 2020 202a 202a  unds.        * *
-0000d950: 2a60 4d5f 6f72 6967 696e 616c 5f60 2a2a  *`M_original_`**
-0000d960: 206d 6170 3a20 604d 5f60 2077 6974 686f   map: `M_` witho
-0000d970: 7574 2063 6865 636b 696e 6720 626f 756e  ut checking boun
-0000d980: 6473 0a20 2020 2020 2020 202a 202a 2a66  ds.        * **f
-0000d990: 2a2a 206d 6170 3a20 7363 616c 696e 6720  ** map: scaling 
-0000d9a0: 7061 7261 6d65 7465 7220 636f 6e74 726f  parameter contro
-0000d9b0: 6c6c 696e 6720 7468 6520 6465 636c 696e  lling the declin
-0000d9c0: 6520 6f66 204b 7361 7456 6572 205b 6d6d  e of KsatVer [mm
-0000d9d0: 2d31 5d20 2866 6974 7465 6420 7769 7468  -1] (fitted with
-0000d9e0: 2063 7572 7665 5f66 6974 2028 7363 6970   curve_fit (scip
-0000d9f0: 792e 6f70 7469 6d69 7a65 2929 2c20 626f  y.optimize)), bo
-0000da00: 756e 6473 2061 7265 2063 6865 636b 6564  unds are checked
-0000da10: 0a20 2020 2020 2020 202a 202a 2a60 665f  .        * **`f_
-0000da20: 602a 2a20 6d61 703a 2073 6361 6c69 6e67  `** map: scaling
-0000da30: 2070 6172 616d 6574 6572 2063 6f6e 7472   parameter contr
-0000da40: 6f6c 6c69 6e67 2074 6865 2064 6563 6c69  olling the decli
-0000da50: 6e65 206f 6620 4b73 6174 5665 7220 5b6d  ne of KsatVer [m
-0000da60: 6d2d 315d 2028 6669 7474 6564 2077 6974  m-1] (fitted wit
-0000da70: 6820 6e75 6d70 7920 6c69 6e61 6c67 2072  h numpy linalg r
-0000da80: 6567 7265 7373 696f 6e29 2c20 626f 756e  egression), boun
-0000da90: 6473 2061 7265 2063 6865 636b 6564 0a20  ds are checked. 
-0000daa0: 2020 2020 2020 202a 202a 2a63 5f30 2a2a         * **c_0**
-0000dab0: 206d 6170 3a20 4272 6f6f 6b73 2043 6f72   map: Brooks Cor
-0000dac0: 6579 2063 6f65 6666 6963 6965 6e74 205b  ey coefficient [
-0000dad0: 2d5d 2062 6173 6564 206f 6e20 706f 7265  -] based on pore
-0000dae0: 2073 697a 6520 6469 7374 7269 6275 7469   size distributi
-0000daf0: 6f6e 2069 6e64 6578 2061 740a 2020 2020  on index at.    
-0000db00: 2020 2020 2020 2020 6465 7074 6820 6f66          depth of
-0000db10: 2031 7374 2073 6f69 6c20 6c61 7965 7220   1st soil layer 
-0000db20: 2831 3030 206d 6d29 2077 666c 6f77 5f73  (100 mm) wflow_s
-0000db30: 626d 0a20 2020 2020 2020 202a 202a 2a63  bm.        * **c
-0000db40: 5f31 2a2a 206d 6170 3a20 6964 656d 2063  _1** map: idem c
-0000db50: 5f30 2061 7420 6465 7074 6820 326e 6420  _0 at depth 2nd 
-0000db60: 736f 696c 206c 6179 6572 2028 3430 3020  soil layer (400 
-0000db70: 6d6d 2920 7766 6c6f 775f 7362 6d0a 2020  mm) wflow_sbm.  
-0000db80: 2020 2020 2020 2a20 2a2a 635f 322a 2a20        * **c_2** 
-0000db90: 6d61 703a 2069 6465 6d20 635f 3020 6174  map: idem c_0 at
-0000dba0: 2064 6570 7468 2033 7264 2073 6f69 6c20   depth 3rd soil 
-0000dbb0: 6c61 7965 7220 2831 3230 3020 6d6d 2920  layer (1200 mm) 
-0000dbc0: 7766 6c6f 775f 7362 6d0a 2020 2020 2020  wflow_sbm.      
-0000dbd0: 2020 2a20 2a2a 635f 332a 2a20 6d61 703a    * **c_3** map:
-0000dbe0: 2069 6465 6d20 635f 3020 6174 2064 6570   idem c_0 at dep
-0000dbf0: 7468 2034 7468 2073 6f69 6c20 6c61 7965  th 4th soil laye
-0000dc00: 7220 283e 2031 3230 3020 6d6d 2920 7766  r (> 1200 mm) wf
-0000dc10: 6c6f 775f 7362 6d0a 2020 2020 2020 2020  low_sbm.        
-0000dc20: 2a20 2a2a 4b73 6174 5665 725f 5b7a 5d63  * **KsatVer_[z]c
-0000dc30: 6d2a 2a20 6d61 703a 204b 7361 7456 6572  m** map: KsatVer
-0000dc40: 205b 6d6d 2f64 6179 5d20 6174 2073 6f69   [mm/day] at soi
-0000dc50: 6c20 6465 7074 6873 205b 7a5d 206f 6620  l depths [z] of 
-0000dc60: 536f 696c 4772 6964 7320 6461 7461 205b  SoilGrids data [
-0000dc70: 302e 302c 2035 2e30 2c20 3135 2e30 2c20  0.0, 5.0, 15.0, 
-0000dc80: 3330 2e30 2c20 3630 2e30 2c20 3130 302e  30.0, 60.0, 100.
-0000dc90: 302c 2032 3030 2e30 5d0a 2020 2020 2020  0, 200.0].      
-0000dca0: 2020 2a20 2a2a 7766 6c6f 775f 736f 696c    * **wflow_soil
-0000dcb0: 2a2a 206d 6170 3a20 736f 696c 2074 6578  ** map: soil tex
-0000dcc0: 7475 7265 2062 6173 6564 206f 6e20 5553  ture based on US
-0000dcd0: 4441 2073 6f69 6c20 7465 7874 7572 6520  DA soil texture 
-0000dce0: 7472 6961 6e67 6c65 2028 6d61 7070 696e  triangle (mappin
-0000dcf0: 673a 205b 313a 436c 6179 2c20 323a 5369  g: [1:Clay, 2:Si
-0000dd00: 6c74 7920 436c 6179 2c20 333a 5369 6c74  lty Clay, 3:Silt
-0000dd10: 7920 436c 6179 2d4c 6f61 6d2c 2034 3a53  y Clay-Loam, 4:S
-0000dd20: 616e 6479 2043 6c61 792c 2035 3a53 616e  andy Clay, 5:San
-0000dd30: 6479 2043 6c61 792d 4c6f 616d 2c20 363a  dy Clay-Loam, 6:
-0000dd40: 436c 6179 2d4c 6f61 6d2c 2037 3a53 696c  Clay-Loam, 7:Sil
-0000dd50: 742c 2038 3a53 696c 742d 4c6f 616d 2c20  t, 8:Silt-Loam, 
-0000dd60: 393a 4c6f 616d 2c20 3130 3a53 616e 642c  9:Loam, 10:Sand,
-0000dd70: 2031 313a 204c 6f61 6d79 2053 616e 642c   11: Loamy Sand,
-0000dd80: 2031 323a 5361 6e64 7920 4c6f 616d 5d29   12:Sandy Loam])
-0000dd90: 0a0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-0000dda0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-0000ddb0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0000ddc0: 2073 6f69 6c5f 666e 203a 207b 2773 6f69   soil_fn : {'soi
-0000ddd0: 6c67 7269 6473 272c 2027 736f 696c 6772  lgrids', 'soilgr
-0000dde0: 6964 735f 3230 3230 277d 0a20 2020 2020  ids_2020'}.     
-0000ddf0: 2020 2020 2020 204e 616d 6520 6f66 2064         Name of d
-0000de00: 6174 6120 736f 7572 6365 2066 6f72 2073  ata source for s
-0000de10: 6f69 6c20 7061 7261 6d65 7465 7220 6d61  oil parameter ma
-0000de20: 7073 2c20 7365 6520 6461 7461 2f64 6174  ps, see data/dat
-0000de30: 615f 736f 7572 6365 732e 796d 6c2e 2053  a_sources.yml. S
-0000de40: 686f 756c 6420 636f 6e74 6169 6e20 696e  hould contain in
-0000de50: 666f 2066 6f72 2074 6865 0a20 2020 2020  fo for the.     
-0000de60: 2020 2020 2020 2037 2073 6f69 6c20 6465         7 soil de
-0000de70: 7074 6873 206f 6620 736f 696c 6772 6964  pths of soilgrid
-0000de80: 7320 286f 7220 3620 6465 7074 6873 2069  s (or 6 depths i
-0000de90: 6e74 6572 7661 6c73 2066 6f72 2073 6f69  ntervals for soi
-0000dea0: 6c67 7269 6473 5f32 3032 3029 2e0a 2020  lgrids_2020)..  
-0000deb0: 2020 2020 2020 2020 2020 2a20 5265 7175            * Requ
-0000dec0: 6972 6564 2076 6172 6961 626c 6573 3a20  ired variables: 
-0000ded0: 5b27 6264 5f73 6c2a 272c 2027 636c 7970  ['bd_sl*', 'clyp
-0000dee0: 7074 5f73 6c2a 272c 2027 736c 7470 7074  pt_sl*', 'sltppt
-0000def0: 5f73 6c2a 272c 2027 6f63 5f73 6c2a 272c  _sl*', 'oc_sl*',
-0000df00: 2027 7068 5f73 6c2a 272c 2027 736e 6470   'ph_sl*', 'sndp
-0000df10: 7074 5f73 6c2a 272c 2027 736f 696c 7468  pt_sl*', 'soilth
-0000df20: 6963 6b6e 6573 7327 2c20 2774 6178 5f75  ickness', 'tax_u
-0000df30: 7364 6127 5d0a 2020 2020 2020 2020 7074  sda'].        pt
-0000df40: 665f 6b73 6174 7665 7220 3a20 7b27 6272  f_ksatver : {'br
-0000df50: 616b 656e 7369 656b 272c 2027 636f 7362  akensiek', 'cosb
-0000df60: 7927 7d0a 2020 2020 2020 2020 2020 2020  y'}.            
-0000df70: 5065 646f 7472 616e 7366 6572 2066 756e  Pedotransfer fun
-0000df80: 6374 696f 6e20 2850 5446 2920 746f 2075  ction (PTF) to u
-0000df90: 7365 2066 6f72 2063 616c 6375 6c61 7469  se for calculati
-0000dfa0: 6f6e 204b 7361 7456 6572 2028 7665 7274  on KsatVer (vert
-0000dfb0: 6963 616c 2073 6174 7572 6174 6564 0a20  ical saturated. 
-0000dfc0: 2020 2020 2020 2020 2020 2068 7964 7261             hydra
-0000dfd0: 756c 6963 2063 6f6e 6475 6374 6976 6974  ulic conductivit
-0000dfe0: 7920 5b6d 6d2f 6461 795d 292e 2042 7920  y [mm/day]). By 
-0000dff0: 6465 6661 756c 7420 2762 7261 6b65 6e73  default 'brakens
-0000e000: 6965 6b27 2e0a 2020 2020 2020 2020 2222  iek'..        ""
-0000e010: 220a 2020 2020 2020 2020 7365 6c66 2e6c  ".        self.l
-0000e020: 6f67 6765 722e 696e 666f 2866 2250 7265  ogger.info(f"Pre
-0000e030: 7061 7269 6e67 2073 6f69 6c20 7061 7261  paring soil para
-0000e040: 6d65 7465 7220 6d61 7073 2e22 290a 2020  meter maps.").  
-0000e050: 2020 2020 2020 2320 544f 444f 2061 6464        # TODO add
-0000e060: 2076 6172 6961 626c 6573 206c 6973 7420   variables list 
-0000e070: 7769 7468 2072 6571 7569 7265 6420 7661  with required va
-0000e080: 7269 6162 6c65 206e 616d 6573 0a20 2020  riable names.   
-0000e090: 2020 2020 2064 7369 6e20 3d20 7365 6c66       dsin = self
-0000e0a0: 2e64 6174 615f 6361 7461 6c6f 672e 6765  .data_catalog.ge
-0000e0b0: 745f 7261 7374 6572 6461 7461 7365 7428  t_rasterdataset(
-0000e0c0: 736f 696c 5f66 6e2c 2067 656f 6d3d 7365  soil_fn, geom=se
-0000e0d0: 6c66 2e72 6567 696f 6e2c 2062 7566 6665  lf.region, buffe
-0000e0e0: 723d 3229 0a20 2020 2020 2020 2064 736f  r=2).        dso
-0000e0f0: 7574 203d 2077 6f72 6b66 6c6f 7773 2e73  ut = workflows.s
-0000e100: 6f69 6c67 7269 6473 280a 2020 2020 2020  oilgrids(.      
-0000e110: 2020 2020 2020 6473 696e 2c0a 2020 2020        dsin,.    
-0000e120: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-0000e130: 7469 636d 6170 732c 0a20 2020 2020 2020  ticmaps,.       
-0000e140: 2020 2020 2070 7466 5f6b 7361 7476 6572       ptf_ksatver
-0000e150: 2c0a 2020 2020 2020 2020 2020 2020 736f  ,.            so
-0000e160: 696c 5f66 6e2c 0a20 2020 2020 2020 2020  il_fn,.         
-0000e170: 2020 206c 6f67 6765 723d 7365 6c66 2e6c     logger=self.l
-0000e180: 6f67 6765 722c 0a20 2020 2020 2020 2029  ogger,.        )
-0000e190: 2e72 6573 6574 5f63 6f6f 7264 7328 6472  .reset_coords(dr
-0000e1a0: 6f70 3d54 7275 6529 0a20 2020 2020 2020  op=True).       
-0000e1b0: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
-0000e1c0: 6d61 7073 2864 736f 7574 290a 0a20 2020  maps(dsout)..   
-0000e1d0: 2064 6566 2073 6574 7570 5f67 6c61 6369   def setup_glaci
-0000e1e0: 6572 7328 7365 6c66 2c20 676c 6163 6965  ers(self, glacie
-0000e1f0: 7273 5f66 6e3d 2272 6769 222c 206d 696e  rs_fn="rgi", min
-0000e200: 5f61 7265 613d 3129 3a0a 2020 2020 2020  _area=1):.      
-0000e210: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
-0000e220: 6973 2063 6f6d 706f 6e65 6e74 2067 656e  is component gen
-0000e230: 6572 6174 6573 206d 6170 7320 6f66 2067  erates maps of g
-0000e240: 6c61 6369 6572 2061 7265 6173 2c20 6172  lacier areas, ar
-0000e250: 6561 2066 7261 6374 696f 6e20 616e 6420  ea fraction and 
-0000e260: 766f 6c75 6d65 2066 7261 6374 696f 6e2c  volume fraction,
-0000e270: 0a20 2020 2020 2020 2061 7320 7765 6c6c  .        as well
-0000e280: 2061 7320 7461 626c 6573 2077 6974 6820   as tables with 
-0000e290: 7465 6d70 6572 6174 7572 6520 7468 7265  temperature thre
-0000e2a0: 7368 6f6c 642c 206d 656c 7469 6e67 2066  shold, melting f
-0000e2b0: 6163 746f 7220 616e 6420 736e 6f77 2d74  actor and snow-t
-0000e2c0: 6f2d 6963 650a 2020 2020 2020 2020 636f  o-ice.        co
-0000e2d0: 6e76 6572 7469 6f6e 2066 7261 6374 696f  nvertion fractio
-0000e2e0: 6e2e 0a0a 2020 2020 2020 2020 5468 6520  n...        The 
-0000e2f0: 6461 7461 2069 7320 6765 6e65 7261 7465  data is generate
-0000e300: 6420 6672 6f6d 2066 6561 7475 7265 7320  d from features 
-0000e310: 7769 7468 2060 606d 696e 5f61 7265 6160  with ``min_area`
-0000e320: 6020 5b6b 6d32 5d20 2864 6566 6175 6c74  ` [km2] (default
-0000e330: 2069 7320 3120 6b6d 3229 0a20 2020 2020   is 1 km2).     
-0000e340: 2020 2066 726f 6d20 6120 6461 7461 6261     from a databa
-0000e350: 7365 2077 6974 6820 676c 6163 6965 7220  se with glacier 
-0000e360: 6765 6f6d 6574 7279 2c20 4944 7320 616e  geometry, IDs an
-0000e370: 6420 6d65 7461 6461 7461 2e0a 0a20 2020  d metadata...   
-0000e380: 2020 2020 2054 6865 2072 6571 7569 7265       The require
-0000e390: 6420 7661 7269 6162 6c65 7320 6672 6f6d  d variables from
-0000e3a0: 2067 6c61 6369 6572 735f 666e 2064 6174   glaciers_fn dat
-0000e3b0: 6173 6574 2061 7265 2067 6c61 6369 6572  aset are glacier
-0000e3c0: 2049 4420 2773 696d 706c 655f 6964 272e   ID 'simple_id'.
-0000e3d0: 0a20 2020 2020 2020 204f 7074 696f 6e6e  .        Optionn
-0000e3e0: 616c 6c79 2067 6c61 6369 6572 2061 7265  ally glacier are
-0000e3f0: 6120 2741 5245 4127 205b 6b6d 325d 2063  a 'AREA' [km2] c
-0000e400: 616e 2062 6520 7072 6573 656e 7420 746f  an be present to
-0000e410: 2066 696c 7465 7220 7468 6520 676c 6163   filter the glac
-0000e420: 6965 7273 0a20 2020 2020 2020 2062 7920  iers.        by 
-0000e430: 7369 7a65 2e20 4966 206e 6f74 2070 7265  size. If not pre
-0000e440: 7365 6e74 2069 7420 7769 6c6c 2062 6520  sent it will be 
-0000e450: 636f 6d70 7574 6564 206f 6e20 7468 6520  computed on the 
-0000e460: 666c 792e 0a0a 2020 2020 2020 2020 4164  fly...        Ad
-0000e470: 6473 206d 6f64 656c 206c 6179 6572 733a  ds model layers:
-0000e480: 0a0a 2020 2020 2020 2020 2a20 2a2a 7766  ..        * **wf
-0000e490: 6c6f 775f 676c 6163 6965 7261 7265 6173  low_glacierareas
-0000e4a0: 2a2a 206d 6170 3a20 676c 6163 6965 7220  ** map: glacier 
-0000e4b0: 4944 7320 5b2d 5d0a 2020 2020 2020 2020  IDs [-].        
-0000e4c0: 2a20 2a2a 7766 6c6f 775f 676c 6163 6965  * **wflow_glacie
-0000e4d0: 7266 7261 632a 2a20 6d61 703a 2061 7265  rfrac** map: are
-0000e4e0: 6120 6672 6163 7469 6f6e 206f 6620 676c  a fraction of gl
-0000e4f0: 6163 6965 7220 7065 7220 6365 6c6c 205b  acier per cell [
-0000e500: 2d5d 0a20 2020 2020 2020 202a 202a 2a77  -].        * **w
-0000e510: 666c 6f77 5f67 6c61 6369 6572 7374 6f72  flow_glacierstor
-0000e520: 652a 2a20 6d61 703a 2073 746f 7261 6765  e** map: storage
-0000e530: 2028 766f 6c75 6d65 2920 6f66 2067 6c61   (volume) of gla
-0000e540: 6369 6572 2070 6572 2063 656c 6c20 5b6d  cier per cell [m
-0000e550: 6d5d 0a20 2020 2020 2020 202a 202a 2a47  m].        * **G
-0000e560: 5f54 542a 2a20 6d61 703a 2074 656d 7065  _TT** map: tempe
-0000e570: 7261 7475 7265 2074 6872 6573 686f 6c64  rature threshold
-0000e580: 2066 6f72 2067 6c61 6369 6572 206d 656c   for glacier mel
-0000e590: 742f 6275 696c 6475 7020 5bc2 b043 5d0a  t/buildup [..C].
-0000e5a0: 2020 2020 2020 2020 2a20 2a2a 475f 4366          * **G_Cf
-0000e5b0: 6d61 782a 2a20 6d61 703a 2067 6c61 6369  max** map: glaci
-0000e5c0: 6572 206d 656c 7469 6e67 2066 6163 746f  er melting facto
-0000e5d0: 7220 5b6d 6d2f c2b0 432a 6461 795d 0a20  r [mm/..C*day]. 
-0000e5e0: 2020 2020 2020 202a 202a 2a47 5f53 4966         * **G_SIf
-0000e5f0: 7261 632a 2a20 6d61 703a 2066 7261 6374  rac** map: fract
-0000e600: 696f 6e20 6f66 2073 6e6f 7770 6163 6b20  ion of snowpack 
-0000e610: 6f6e 2074 6f70 206f 6620 676c 6163 6965  on top of glacie
-0000e620: 7220 636f 6e76 6572 7465 6420 746f 2069  r converted to i
-0000e630: 6365 2c20 6164 6465 6420 746f 2067 6c61  ce, added to gla
-0000e640: 6369 6572 7374 6f72 6520 5b2d 5d0a 0a20  cierstore [-].. 
-0000e650: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0000e660: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0000e670: 2d2d 2d2d 0a20 2020 2020 2020 2067 6c61  ----.        gla
-0000e680: 6369 6572 735f 666e 203a 207b 2772 6769  ciers_fn : {'rgi
-0000e690: 277d 0a20 2020 2020 2020 2020 2020 204e  '}.            N
-0000e6a0: 616d 6520 6f66 2064 6174 6120 736f 7572  ame of data sour
-0000e6b0: 6365 2066 6f72 2067 6c61 6369 6572 732c  ce for glaciers,
-0000e6c0: 2073 6565 2064 6174 612f 6461 7461 5f73   see data/data_s
-0000e6d0: 6f75 7263 6573 2e79 6d6c 2e0a 0a20 2020  ources.yml...   
-0000e6e0: 2020 2020 2020 2020 202a 2052 6571 7569           * Requi
-0000e6f0: 7265 6420 7661 7269 6162 6c65 733a 205b  red variables: [
-0000e700: 2773 696d 706c 655f 6964 275d 0a20 2020  'simple_id'].   
-0000e710: 2020 2020 206d 696e 5f61 7265 6120 3a20       min_area : 
-0000e720: 666c 6f61 742c 206f 7074 696f 6e61 6c0a  float, optional.
-0000e730: 2020 2020 2020 2020 2020 2020 4d69 6e69              Mini
-0000e740: 6d75 6d20 676c 6163 6965 7220 6172 6561  mum glacier area
-0000e750: 2074 6872 6573 686f 6c64 205b 6b6d 325d   threshold [km2]
-0000e760: 2c20 6279 2064 6566 6175 6c74 2030 2028  , by default 0 (
-0000e770: 616c 6c20 696e 636c 7564 6564 290a 2020  all included).  
-0000e780: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000e790: 2020 676c 6163 5f74 6f6d 6c20 3d20 7b0a    glac_toml = {.
-0000e7a0: 2020 2020 2020 2020 2020 2020 226d 6f64              "mod
-0000e7b0: 656c 2e67 6c61 6369 6572 223a 2054 7275  el.glacier": Tru
-0000e7c0: 652c 0a20 2020 2020 2020 2020 2020 2022  e,.            "
-0000e7d0: 7374 6174 652e 7665 7274 6963 616c 2e67  state.vertical.g
-0000e7e0: 6c61 6369 6572 7374 6f72 6522 3a20 2267  lacierstore": "g
-0000e7f0: 6c61 6369 6572 7374 6f72 6522 2c0a 2020  lacierstore",.  
-0000e800: 2020 2020 2020 2020 2020 2269 6e70 7574            "input
-0000e810: 2e76 6572 7469 6361 6c2e 676c 6163 6965  .vertical.glacie
-0000e820: 7273 746f 7265 223a 2022 7766 6c6f 775f  rstore": "wflow_
-0000e830: 676c 6163 6965 7273 746f 7265 222c 0a20  glacierstore",. 
-0000e840: 2020 2020 2020 2020 2020 2022 696e 7075             "inpu
-0000e850: 742e 7665 7274 6963 616c 2e67 6c61 6369  t.vertical.glaci
-0000e860: 6572 6672 6163 223a 2022 7766 6c6f 775f  erfrac": "wflow_
-0000e870: 676c 6163 6965 7266 7261 6322 2c0a 2020  glacierfrac",.  
-0000e880: 2020 2020 2020 2020 2020 2269 6e70 7574            "input
-0000e890: 2e76 6572 7469 6361 6c2e 675f 6366 6d61  .vertical.g_cfma
-0000e8a0: 7822 3a20 2247 5f43 666d 6178 222c 0a20  x": "G_Cfmax",. 
-0000e8b0: 2020 2020 2020 2020 2020 2022 696e 7075             "inpu
-0000e8c0: 742e 7665 7274 6963 616c 2e67 5f74 7422  t.vertical.g_tt"
-0000e8d0: 3a20 2247 5f54 5422 2c0a 2020 2020 2020  : "G_TT",.      
-0000e8e0: 2020 2020 2020 2269 6e70 7574 2e76 6572        "input.ver
-0000e8f0: 7469 6361 6c2e 675f 7369 6672 6163 223a  tical.g_sifrac":
-0000e900: 2022 475f 5349 6672 6163 222c 0a20 2020   "G_SIfrac",.   
-0000e910: 2020 2020 207d 0a20 2020 2020 2020 2023       }.        #
-0000e920: 2072 6574 7269 6576 6520 6461 7461 2066   retrieve data f
-0000e930: 6f72 2062 6173 696e 0a20 2020 2020 2020  or basin.       
-0000e940: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
-0000e950: 6f28 6622 5072 6570 6172 696e 6720 676c  o(f"Preparing gl
-0000e960: 6163 6965 7220 6d61 7073 2e22 290a 2020  acier maps.").  
-0000e970: 2020 2020 2020 6764 665f 6f72 6720 3d20        gdf_org = 
-0000e980: 7365 6c66 2e64 6174 615f 6361 7461 6c6f  self.data_catalo
-0000e990: 672e 6765 745f 6765 6f64 6174 6166 7261  g.get_geodatafra
-0000e9a0: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-0000e9b0: 676c 6163 6965 7273 5f66 6e2c 2067 656f  glaciers_fn, geo
-0000e9c0: 6d3d 7365 6c66 2e62 6173 696e 732c 2070  m=self.basins, p
-0000e9d0: 7265 6469 6361 7465 3d22 696e 7465 7273  redicate="inters
-0000e9e0: 6563 7473 220a 2020 2020 2020 2020 290a  ects".        ).
-0000e9f0: 2020 2020 2020 2020 2320 736b 6970 2073          # skip s
-0000ea00: 6d61 6c6c 2073 697a 6520 676c 6163 6965  mall size glacie
-0000ea10: 720a 2020 2020 2020 2020 6966 2022 4152  r.        if "AR
-0000ea20: 4541 2220 696e 2067 6466 5f6f 7267 2e63  EA" in gdf_org.c
-0000ea30: 6f6c 756d 6e73 2061 6e64 2067 6466 5f6f  olumns and gdf_o
-0000ea40: 7267 2e67 656f 6d65 7472 792e 7369 7a65  rg.geometry.size
-0000ea50: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0000ea60: 2020 6764 665f 6f72 6720 3d20 6764 665f    gdf_org = gdf_
-0000ea70: 6f72 675b 6764 665f 6f72 675b 2241 5245  org[gdf_org["ARE
-0000ea80: 4122 5d20 3e3d 206d 696e 5f61 7265 615d  A"] >= min_area]
-0000ea90: 0a20 2020 2020 2020 2023 2067 6574 2067  .        # get g
-0000eaa0: 6c61 6369 6572 206d 6170 7320 616e 6420  lacier maps and 
-0000eab0: 7061 7261 6d65 7465 7273 0a20 2020 2020  parameters.     
-0000eac0: 2020 206e 625f 676c 6163 203d 2067 6466     nb_glac = gdf
-0000ead0: 5f6f 7267 2e67 656f 6d65 7472 792e 7369  _org.geometry.si
-0000eae0: 7a65 0a20 2020 2020 2020 2064 735f 676c  ze.        ds_gl
-0000eaf0: 6163 203d 204e 6f6e 650a 2020 2020 2020  ac = None.      
-0000eb00: 2020 6966 206e 625f 676c 6163 203e 2030    if nb_glac > 0
-0000eb10: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000eb20: 6c66 2e6c 6f67 6765 722e 696e 666f 280a  lf.logger.info(.
-0000eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb40: 6622 7b6e 625f 676c 6163 7d20 676c 6163  f"{nb_glac} glac
-0000eb50: 6965 7273 206f 6620 7375 6666 6963 6965  iers of sufficie
-0000eb60: 6e74 2073 697a 6520 666f 756e 6420 7769  nt size found wi
-0000eb70: 7468 696e 2072 6567 696f 6e2e 220a 2020  thin region.".  
-0000eb80: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000eb90: 2020 2020 2020 2020 2320 6164 6420 676c          # add gl
-0000eba0: 6163 6965 7220 6d61 7073 0a20 2020 2020  acier maps.     
-0000ebb0: 2020 2020 2020 2064 735f 676c 6163 203d         ds_glac =
-0000ebc0: 2077 6f72 6b66 6c6f 7773 2e67 6c61 6369   workflows.glaci
-0000ebd0: 6572 6d61 7073 280a 2020 2020 2020 2020  ermaps(.        
-0000ebe0: 2020 2020 2020 2020 6764 663d 6764 665f          gdf=gdf_
-0000ebf0: 6f72 672c 0a20 2020 2020 2020 2020 2020  org,.           
-0000ec00: 2020 2020 2064 735f 6c69 6b65 3d73 656c       ds_like=sel
-0000ec10: 662e 7374 6174 6963 6d61 7073 2c0a 2020  f.staticmaps,.  
-0000ec20: 2020 2020 2020 2020 2020 2020 2020 6964                id
-0000ec30: 5f63 6f6c 756d 6e3d 2273 696d 706c 655f  _column="simple_
-0000ec40: 6964 222c 0a20 2020 2020 2020 2020 2020  id",.           
-0000ec50: 2020 2020 2065 6c65 7674 6e5f 6e61 6d65       elevtn_name
-0000ec60: 3d73 656c 662e 5f4d 4150 535b 2265 6c65  =self._MAPS["ele
-0000ec70: 7674 6e22 5d2c 0a20 2020 2020 2020 2020  vtn"],.         
-0000ec80: 2020 2020 2020 206c 6f67 6765 723d 7365         logger=se
-0000ec90: 6c66 2e6c 6f67 6765 722c 0a20 2020 2020  lf.logger,.     
-0000eca0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000ecb0: 2020 2020 2020 726d 6469 6374 203d 207b        rmdict = {
-0000ecc0: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
-0000ecd0: 2073 656c 662e 5f4d 4150 532e 6974 656d   self._MAPS.item
-0000ece0: 7328 2920 6966 206b 2069 6e20 6473 5f67  s() if k in ds_g
-0000ecf0: 6c61 632e 6461 7461 5f76 6172 737d 0a20  lac.data_vars}. 
-0000ed00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000ed10: 7365 745f 7374 6174 6963 6d61 7073 2864  set_staticmaps(d
-0000ed20: 735f 676c 6163 2e72 656e 616d 6528 726d  s_glac.rename(rm
-0000ed30: 6469 6374 2929 0a0a 2020 2020 2020 2020  dict))..        
-0000ed40: 2020 2020 7365 6c66 2e73 6574 5f73 7461      self.set_sta
-0000ed50: 7469 6367 656f 6d73 2867 6466 5f6f 7267  ticgeoms(gdf_org
-0000ed60: 2c20 6e61 6d65 3d22 676c 6163 6965 7273  , name="glaciers
-0000ed70: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0000ed80: 666f 7220 6f70 7469 6f6e 2069 6e20 676c  for option in gl
-0000ed90: 6163 5f74 6f6d 6c3a 0a20 2020 2020 2020  ac_toml:.       
-0000eda0: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-0000edb0: 745f 636f 6e66 6967 286f 7074 696f 6e2c  t_config(option,
-0000edc0: 2067 6c61 635f 746f 6d6c 5b6f 7074 696f   glac_toml[optio
-0000edd0: 6e5d 290a 2020 2020 2020 2020 656c 7365  n]).        else
-0000ede0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000edf0: 6c66 2e6c 6f67 6765 722e 7761 726e 696e  lf.logger.warnin
-0000ee00: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
-0000ee10: 2020 2066 224e 6f20 676c 6163 6965 7273     f"No glaciers
-0000ee20: 206f 6620 7375 6666 6963 6965 6e74 2073   of sufficient s
-0000ee30: 697a 6520 666f 756e 6420 7769 7468 696e  ize found within
-0000ee40: 2072 6567 696f 6e21 220a 2020 2020 2020   region!".      
-0000ee50: 2020 2020 2020 2020 2020 6622 536b 6970            f"Skip
-0000ee60: 7069 6e67 2067 6c61 6369 6572 2070 726f  ping glacier pro
-0000ee70: 6365 6475 7265 7321 220a 2020 2020 2020  cedures!".      
-0000ee80: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0000ee90: 2073 6574 7570 5f63 6f6e 7374 616e 745f   setup_constant_
-0000eea0: 7061 7273 2873 656c 662c 2064 7479 7065  pars(self, dtype
-0000eeb0: 3d22 666c 6f61 7433 3222 2c20 6e6f 6461  ="float32", noda
-0000eec0: 7461 3d2d 3939 392c 202a 2a6b 7761 7267  ta=-999, **kwarg
-0000eed0: 7329 3a0a 2020 2020 2020 2020 2222 2253  s):.        """S
-0000eee0: 6574 7570 2063 6f6e 7374 616e 7420 7061  etup constant pa
-0000eef0: 7261 6d65 7465 7220 6d61 7073 2066 6f72  rameter maps for
-0000ef00: 2061 6c6c 2061 6374 6976 6520 6d6f 6465   all active mode
-0000ef10: 6c20 6365 6c6c 732e 0a0a 2020 2020 2020  l cells...      
-0000ef20: 2020 4164 6473 206d 6f64 656c 206c 6179    Adds model lay
-0000ef30: 6572 3a0a 0a20 2020 2020 2020 202a 202a  er:..        * *
-0000ef40: 2a70 6172 616d 5f6e 616d 652a 2a20 6d61  *param_name** ma
-0000ef50: 703a 2063 6f6e 7374 616e 7420 7061 7261  p: constant para
-0000ef60: 6d65 7465 7220 6d61 702e 0a0a 2020 2020  meter map...    
-0000ef70: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0000ef80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0000ef90: 2d0a 2020 2020 2020 2020 6474 7970 653a  -.        dtype:
-0000efa0: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-0000efb0: 2064 6174 6120 7479 7065 0a20 2020 2020   data type.     
-0000efc0: 2020 206e 6f64 6174 613a 2069 6e74 206f     nodata: int o
-0000efd0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-0000efe0: 2020 2020 6e6f 6461 7461 2076 616c 7565      nodata value
-0000eff0: 0a20 2020 2020 2020 206b 7761 7267 730a  .        kwargs.
-0000f000: 2020 2020 2020 2020 2020 2020 2270 6172              "par
-0000f010: 616d 5f6e 616d 653a 2076 616c 7565 2220  am_name: value" 
-0000f020: 7061 6972 7320 666f 7220 636f 6e73 7461  pairs for consta
-0000f030: 6e74 2073 7461 7469 636d 6170 732e 0a0a  nt staticmaps...
-0000f040: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000f050: 2020 2020 666f 7220 6b65 792c 2076 616c      for key, val
-0000f060: 7565 2069 6e20 6b77 6172 6773 2e69 7465  ue in kwargs.ite
-0000f070: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000f080: 2020 6e6f 6461 7461 203d 206e 702e 6474    nodata = np.dt
-0000f090: 7970 6528 6474 7970 6529 2e74 7970 6528  ype(dtype).type(
-0000f0a0: 6e6f 6461 7461 290a 2020 2020 2020 2020  nodata).        
-0000f0b0: 2020 2020 6461 5f70 6172 616d 203d 2078      da_param = x
-0000f0c0: 722e 7768 6572 6528 0a20 2020 2020 2020  r.where(.       
-0000f0d0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0000f0e0: 6174 6963 6d61 7073 5b73 656c 662e 5f4d  aticmaps[self._M
-0000f0f0: 4150 535b 2262 6173 696e 7322 5d5d 2c20  APS["basins"]], 
-0000f100: 7661 6c75 652c 206e 6f64 6174 610a 2020  value, nodata.  
-0000f110: 2020 2020 2020 2020 2020 292e 6173 7479            ).asty
-0000f120: 7065 2864 7479 7065 290a 2020 2020 2020  pe(dtype).      
-0000f130: 2020 2020 2020 6461 5f70 6172 616d 2e72        da_param.r
-0000f140: 6173 7465 722e 7365 745f 6e6f 6461 7461  aster.set_nodata
-0000f150: 286e 6f64 6174 6129 0a0a 2020 2020 2020  (nodata)..      
-0000f160: 2020 2020 2020 6461 5f70 6172 616d 203d        da_param =
-0000f170: 2064 615f 7061 7261 6d2e 7265 6e61 6d65   da_param.rename
-0000f180: 286b 6579 290a 2020 2020 2020 2020 2020  (key).          
-0000f190: 2020 7365 6c66 2e73 6574 5f73 7461 7469    self.set_stati
-0000f1a0: 636d 6170 7328 6461 5f70 6172 616d 290a  cmaps(da_param).
-0000f1b0: 0a20 2020 2064 6566 2073 6574 7570 5f73  .    def setup_s
-0000f1c0: 7461 7469 636d 6170 735f 6672 6f6d 5f72  taticmaps_from_r
-0000f1d0: 6173 7465 7228 0a20 2020 2020 2020 2073  aster(.        s
-0000f1e0: 656c 662c 0a20 2020 2020 2020 2072 6173  elf,.        ras
-0000f1f0: 7465 725f 666e 3a20 7374 722c 0a20 2020  ter_fn: str,.   
-0000f200: 2020 2020 2072 6570 726f 6a65 6374 5f6d       reproject_m
-0000f210: 6574 686f 643a 2073 7472 2c0a 2020 2020  ethod: str,.    
-0000f220: 2020 2020 7661 7269 6162 6c65 733a 204f      variables: O
-0000f230: 7074 696f 6e61 6c5b 4c69 7374 5d20 3d20  ptional[List] = 
-0000f240: 4e6f 6e65 2c0a 2020 2020 2020 2020 7766  None,.        wf
-0000f250: 6c6f 775f 7661 7269 6162 6c65 733a 204f  low_variables: O
-0000f260: 7074 696f 6e61 6c5b 4c69 7374 5d20 3d20  ptional[List] = 
-0000f270: 4e6f 6e65 2c0a 2020 2020 2020 2020 6669  None,.        fi
-0000f280: 6c6c 5f6d 6574 686f 643a 204f 7074 696f  ll_method: Optio
-0000f290: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
-0000f2a0: 0a20 2020 2029 202d 3e20 4c69 7374 5b73  .    ) -> List[s
-0000f2b0: 7472 5d3a 0a20 2020 2020 2020 2022 2222  tr]:.        """
-0000f2c0: 0a20 2020 2020 2020 2054 6869 7320 636f  .        This co
-0000f2d0: 6d70 6f6e 656e 7420 6164 6473 2064 6174  mponent adds dat
-0000f2e0: 6120 7661 7269 6162 6c65 2873 2920 6672  a variable(s) fr
-0000f2f0: 6f6d 2060 6072 6173 7465 725f 666e 6060  om ``raster_fn``
-0000f300: 2074 6f20 7374 6174 6963 6d61 7073 206f   to staticmaps o
-0000f310: 626a 6563 742e 0a20 2020 2020 2020 2049  bject..        I
-0000f320: 6620 7261 7374 6572 2069 7320 6120 6461  f raster is a da
-0000f330: 7461 7365 742c 2061 6c6c 2076 6172 6961  taset, all varia
-0000f340: 626c 6573 2077 696c 6c20 6265 2061 6464  bles will be add
-0000f350: 6564 2075 6e6c 6573 7320 6060 7661 7269  ed unless ``vari
-0000f360: 6162 6c65 7360 6020 6c69 7374 2069 7320  ables`` list is 
-0000f370: 7370 6563 6966 6965 642e 0a20 2020 2020  specified..     
-0000f380: 2020 2054 6865 2063 6f6e 6669 6720 746f     The config to
-0000f390: 6d6c 2063 616e 2061 6c73 6f20 6265 2075  ml can also be u
-0000f3a0: 7064 6174 6564 2074 6f20 696e 636c 7564  pdated to includ
-0000f3b0: 6520 7468 6520 6e65 7720 6d61 7073 2075  e the new maps u
-0000f3c0: 7369 6e67 2060 6077 666c 6f77 5f76 6172  sing ``wflow_var
-0000f3d0: 6961 626c 6573 6060 2e0a 0a20 2020 2020  iables``...     
-0000f3e0: 2020 2041 6464 7320 6d6f 6465 6c20 6c61     Adds model la
-0000f3f0: 7965 7273 3a0a 2020 2020 2020 2020 2a20  yers:.        * 
-0000f400: 2a2a 7261 7374 6572 2e6e 616d 652a 2a20  **raster.name** 
-0000f410: 6f72 202a 2a76 6172 6961 626c 6573 2a2a  or **variables**
-0000f420: 2073 7461 7469 636d 6170 733a 2064 6174   staticmaps: dat
-0000f430: 6120 6672 6f6d 2072 6173 7465 725f 666e  a from raster_fn
-0000f440: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0000f450: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0000f460: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0000f470: 7261 7374 6572 5f66 6e3a 2073 7472 0a20  raster_fn: str. 
-0000f480: 2020 2020 2020 2020 2020 2053 6f75 7263             Sourc
-0000f490: 6520 6e61 6d65 206f 6620 7261 7374 6572  e name of raster
-0000f4a0: 2064 6174 6120 696e 2064 6174 615f 6361   data in data_ca
-0000f4b0: 7461 6c6f 672e 0a20 2020 2020 2020 2072  talog..        r
-0000f4c0: 6570 726f 6a65 6374 5f6d 6574 686f 643a  eproject_method:
-0000f4d0: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-0000f4e0: 2052 6570 726f 6a65 6374 696f 6e20 6d65   Reprojection me
-0000f4f0: 7468 6f64 2066 726f 6d20 7261 7374 6572  thod from raster
-0000f500: 696f 2e65 6e75 6d73 2e52 6573 616d 706c  io.enums.Resampl
-0000f510: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-0000f520: 2041 7661 696c 6162 6c65 206d 6574 686f   Available metho
-0000f530: 6473 3a20 5b27 6e65 6172 6573 7427 2c20  ds: ['nearest', 
-0000f540: 2762 696c 696e 6561 7227 2c20 2763 7562  'bilinear', 'cub
-0000f550: 6963 272c 2027 6375 6269 635f 7370 6c69  ic', 'cubic_spli
-0000f560: 6e65 272c 2027 6c61 6e63 7a6f 7327 2c20  ne', 'lanczos', 
-0000f570: 2761 7665 7261 6765 272c 2027 6d6f 6465  'average', 'mode
-0000f580: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-0000f590: 6761 7573 7327 2c20 276d 6178 272c 2027  gauss', 'max', '
-0000f5a0: 6d69 6e27 2c20 276d 6564 272c 2027 7131  min', 'med', 'q1
-0000f5b0: 272c 2027 7133 272c 2027 7375 6d27 2c20  ', 'q3', 'sum', 
-0000f5c0: 2772 6d73 275d 0a20 2020 2020 2020 2076  'rms'].        v
-0000f5d0: 6172 6961 626c 6573 3a20 6c69 7374 2c20  ariables: list, 
-0000f5e0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0000f5f0: 2020 2020 204c 6973 7420 6f66 2076 6172       List of var
-0000f600: 6961 626c 6573 2074 6f20 6164 6420 746f  iables to add to
-0000f610: 2073 7461 7469 636d 6170 7320 6672 6f6d   staticmaps from
-0000f620: 2072 6173 7465 725f 666e 2e20 4279 2064   raster_fn. By d
-0000f630: 6566 6175 6c74 2061 6c6c 2e0a 2020 2020  efault all..    
-0000f640: 2020 2020 7766 6c6f 775f 7661 7269 6162      wflow_variab
-0000f650: 6c65 733a 206c 6973 742c 206f 7074 696f  les: list, optio
-0000f660: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0000f670: 4c69 7374 206f 6620 636f 7272 6573 706f  List of correspo
-0000f680: 6e64 696e 6720 7766 6c6f 7720 7661 7269  nding wflow vari
-0000f690: 6162 6c65 7320 746f 2075 7064 6174 6520  ables to update 
-0000f6a0: 7468 6520 636f 6e66 6967 2074 6f6d 6c20  the config toml 
-0000f6b0: 2865 2e67 3a20 5b22 696e 7075 742e 7665  (e.g: ["input.ve
-0000f6c0: 7274 6963 616c 2e61 6c74 6974 7564 6522  rtical.altitude"
-0000f6d0: 5d29 2e0a 2020 2020 2020 2020 2020 2020  ])..            
-0000f6e0: 5368 6f75 6c64 206d 6174 6368 2074 6865  Should match the
-0000f6f0: 2076 6172 6961 626c 6573 206c 6973 742e   variables list.
-0000f700: 2076 6172 6961 626c 6573 206c 6973 7420   variables list 
-0000f710: 7368 6f75 6c64 2062 6520 7072 6f76 6964  should be provid
-0000f720: 6564 2075 6e6c 6573 7320 7261 7374 6572  ed unless raster
-0000f730: 5f66 6e20 636f 6e74 6169 6e73 0a20 2020  _fn contains.   
-0000f740: 2020 2020 2020 2020 2061 2073 696e 676c           a singl
-0000f750: 6520 7661 7269 6162 6c65 2028 6c65 6e20  e variable (len 
-0000f760: 3129 2e0a 2020 2020 2020 2020 6669 6c6c  1)..        fill
-0000f770: 5f6d 6574 686f 6420 3a20 7374 722c 206f  _method : str, o
-0000f780: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0000f790: 2020 2020 4966 2073 7065 6369 6669 6564      If specified
-0000f7a0: 2c20 6669 6c6c 7320 6e6f 6461 7461 2076  , fills nodata v
-0000f7b0: 616c 7565 7320 7573 696e 6720 6669 6c6c  alues using fill
-0000f7c0: 5f6e 6f64 6174 6120 6d65 7468 6f64 2e0a  _nodata method..
-0000f7d0: 2020 2020 2020 2020 2020 2020 4176 6169              Avai
-0000f7e0: 6c61 626c 6520 6d65 7468 6f64 7320 6172  lable methods ar
-0000f7f0: 6520 7b27 6c69 6e65 6172 272c 2027 6e65  e {'linear', 'ne
-0000f800: 6172 6573 7427 2c20 2763 7562 6963 272c  arest', 'cubic',
-0000f810: 2027 7269 6f5f 6964 7727 7d2e 0a0a 2020   'rio_idw'}...  
-0000f820: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0000f830: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0000f840: 2020 2020 2020 6c69 7374 0a20 2020 2020        list.     
-0000f850: 2020 2020 2020 204e 616d 6573 206f 6620         Names of 
-0000f860: 6164 6465 6420 6d6f 6465 6c20 7374 6174  added model stat
-0000f870: 6963 6d61 7020 6c61 7965 7273 2e0a 2020  icmap layers..  
-0000f880: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f890: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
-0000f8a0: 666f 2866 2250 7265 7061 7269 6e67 2073  fo(f"Preparing s
-0000f8b0: 7461 7469 636d 6170 7320 6461 7461 2066  taticmaps data f
-0000f8c0: 726f 6d20 7261 7374 6572 2073 6f75 7263  rom raster sourc
-0000f8d0: 6520 7b72 6173 7465 725f 666e 7d22 290a  e {raster_fn}").
-0000f8e0: 2020 2020 2020 2020 2320 5265 6164 2072          # Read r
-0000f8f0: 6173 7465 7220 6461 7461 2061 6e64 2073  aster data and s
-0000f900: 656c 6563 7420 7661 7269 6162 6c65 730a  elect variables.
-0000f910: 2020 2020 2020 2020 6473 203d 2073 656c          ds = sel
-0000f920: 662e 6461 7461 5f63 6174 616c 6f67 2e67  f.data_catalog.g
-0000f930: 6574 5f72 6173 7465 7264 6174 6173 6574  et_rasterdataset
-0000f940: 280a 2020 2020 2020 2020 2020 2020 7261  (.            ra
-0000f950: 7374 6572 5f66 6e2c 0a20 2020 2020 2020  ster_fn,.       
-0000f960: 2020 2020 2067 656f 6d3d 7365 6c66 2e72       geom=self.r
-0000f970: 6567 696f 6e2c 0a20 2020 2020 2020 2020  egion,.         
-0000f980: 2020 2062 7566 6665 723d 322c 0a20 2020     buffer=2,.   
-0000f990: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0000f9a0: 6573 3d76 6172 6961 626c 6573 2c0a 2020  es=variables,.  
-0000f9b0: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-0000f9c0: 5f76 6172 5f61 735f 6172 7261 793d 4661  _var_as_array=Fa
-0000f9d0: 6c73 652c 0a20 2020 2020 2020 2029 0a20  lse,.        ). 
-0000f9e0: 2020 2020 2020 2023 2046 696c 6c20 6e6f         # Fill no
-0000f9f0: 6461 7461 0a20 2020 2020 2020 2069 6620  data.        if 
-0000fa00: 6669 6c6c 5f6d 6574 686f 6420 6973 206e  fill_method is n
-0000fa10: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000fa20: 2020 2020 2064 7320 3d20 6473 2e72 6173       ds = ds.ras
-0000fa30: 7465 722e 696e 7465 7270 6f6c 6174 655f  ter.interpolate_
-0000fa40: 6e61 286d 6574 686f 643d 6669 6c6c 5f6d  na(method=fill_m
-0000fa50: 6574 686f 6429 0a20 2020 2020 2020 2023  ethod).        #
-0000fa60: 2052 6570 726f 6a65 6374 696f 6e0a 2020   Reprojection.  
-0000fa70: 2020 2020 2020 6473 5f6f 7574 203d 2064        ds_out = d
-0000fa80: 732e 7261 7374 6572 2e72 6570 726f 6a65  s.raster.reproje
-0000fa90: 6374 5f6c 696b 6528 7365 6c66 2e73 7461  ct_like(self.sta
-0000faa0: 7469 636d 6170 732c 206d 6574 686f 643d  ticmaps, method=
-0000fab0: 7265 7072 6f6a 6563 745f 6d65 7468 6f64  reproject_method
-0000fac0: 290a 2020 2020 2020 2020 2320 4164 6420  ).        # Add 
-0000fad0: 746f 2073 7461 7469 636d 6170 730a 2020  to staticmaps.  
-0000fae0: 2020 2020 2020 7365 6c66 2e73 6574 5f73        self.set_s
-0000faf0: 7461 7469 636d 6170 7328 6473 5f6f 7574  taticmaps(ds_out
-0000fb00: 290a 0a20 2020 2020 2020 2023 2055 7064  )..        # Upd
-0000fb10: 6174 6520 636f 6e66 6967 0a20 2020 2020  ate config.     
-0000fb20: 2020 2069 6620 7766 6c6f 775f 7661 7269     if wflow_vari
-0000fb30: 6162 6c65 7320 6973 206e 6f74 204e 6f6e  ables is not Non
-0000fb40: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0000fb50: 656c 662e 6c6f 6767 6572 2e69 6e66 6f28  elf.logger.info(
-0000fb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fb70: 2066 2255 7064 6174 696e 6720 7468 6520   f"Updating the 
-0000fb80: 636f 6e66 6967 2066 6f72 2077 666c 6f77  config for wflow
-0000fb90: 5f76 6172 6961 626c 6573 3a20 7b77 666c  _variables: {wfl
-0000fba0: 6f77 5f76 6172 6961 626c 6573 7d22 0a20  ow_variables}". 
-0000fbb0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000fbc0: 2020 2020 2020 2020 2069 6620 7661 7269           if vari
-0000fbd0: 6162 6c65 7320 6973 204e 6f6e 653a 0a20  ables is None:. 
-0000fbe0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000fbf0: 6620 6c65 6e28 6473 5f6f 7574 2e64 6174  f len(ds_out.dat
-0000fc00: 615f 7661 7273 2920 3d3d 2031 3a0a 2020  a_vars) == 1:.  
-0000fc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc20: 2020 7661 7269 6162 6c65 7320 3d20 6c69    variables = li
-0000fc30: 7374 2864 735f 6f75 742e 6461 7461 5f76  st(ds_out.data_v
-0000fc40: 6172 732e 6b65 7973 2829 290a 2020 2020  ars.keys()).    
-0000fc50: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000fc60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fc70: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000fc80: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000fc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fca0: 6622 4361 6e6e 6f74 2075 7064 6174 6520  f"Cannot update 
-0000fcb0: 7468 6520 746f 6d6c 2069 6620 7261 7374  the toml if rast
-0000fcc0: 6572 5f66 6e20 6861 7320 6d6f 7265 2074  er_fn has more t
-0000fcd0: 6861 6e20 6f6e 6520 7661 7269 6162 6c65  han one variable
-0000fce0: 2061 6e64 2076 6172 6961 626c 6573 206c   and variables l
-0000fcf0: 6973 7420 6973 206e 6f74 2070 726f 7669  ist is not provi
-0000fd00: 6465 642e 220a 2020 2020 2020 2020 2020  ded.".          
-0000fd10: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000fd20: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
-0000fd30: 206f 6e20 6c65 6e0a 2020 2020 2020 2020   on len.        
-0000fd40: 2020 2020 6966 206c 656e 2877 666c 6f77      if len(wflow
-0000fd50: 5f76 6172 6961 626c 6573 2920 213d 206c  _variables) != l
-0000fd60: 656e 2876 6172 6961 626c 6573 293a 0a20  en(variables):. 
-0000fd70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000fd80: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0000fd90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fda0: 2020 2020 2066 224c 656e 6774 6820 6f66       f"Length of
-0000fdb0: 2076 6172 6961 626c 6573 207b 7661 7269   variables {vari
-0000fdc0: 6162 6c65 737d 2064 6f20 6e6f 7420 6d61  ables} do not ma
-0000fdd0: 7463 6820 7766 6c6f 775f 7661 7269 6162  tch wflow_variab
-0000fde0: 6c65 7320 7b77 666c 6f77 5f76 6172 6961  les {wflow_varia
-0000fdf0: 626c 6573 7d2e 2043 616e 6e6f 7420 7570  bles}. Cannot up
-0000fe00: 6461 7465 2074 6865 2074 6f6d 6c2e 220a  date the toml.".
-0000fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe20: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000fe30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000fe40: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0000fe50: 6765 286c 656e 2876 6172 6961 626c 6573  ge(len(variables
-0000fe60: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000fe70: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-0000fe80: 5f63 6f6e 6669 6728 7766 6c6f 775f 7661  _config(wflow_va
-0000fe90: 7269 6162 6c65 735b 695d 2c20 7661 7269  riables[i], vari
-0000fea0: 6162 6c65 735b 695d 290a 0a20 2020 2064  ables[i])..    d
-0000feb0: 6566 2073 6574 7570 5f70 7265 6369 705f  ef setup_precip_
-0000fec0: 666f 7263 696e 6728 0a20 2020 2020 2020  forcing(.       
-0000fed0: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-0000fee0: 7265 6369 705f 666e 3a20 7374 7220 3d20  recip_fn: str = 
-0000fef0: 2265 7261 3522 2c0a 2020 2020 2020 2020  "era5",.        
-0000ff00: 7072 6563 6970 5f63 6c69 6d5f 666e 3a20  precip_clim_fn: 
-0000ff10: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-0000ff20: 4e6f 6e65 2c0a 2020 2020 2020 2020 6368  None,.        ch
-0000ff30: 756e 6b73 697a 653a 204f 7074 696f 6e61  unksize: Optiona
-0000ff40: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-0000ff50: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
-0000ff60: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
-0000ff70: 2020 2020 2020 2020 2222 2253 6574 7570          """Setup
-0000ff80: 2067 7269 6464 6564 2070 7265 6369 7069   gridded precipi
-0000ff90: 7461 7469 6f6e 2066 6f72 6369 6e67 2061  tation forcing a
-0000ffa0: 7420 6d6f 6465 6c20 7265 736f 6c75 7469  t model resoluti
-0000ffb0: 6f6e 2e0a 0a20 2020 2020 2020 2041 6464  on...        Add
-0000ffc0: 7320 6d6f 6465 6c20 6c61 7965 723a 0a0a  s model layer:..
-0000ffd0: 2020 2020 2020 2020 2a20 2a2a 7072 6563          * **prec
-0000ffe0: 6970 2a2a 3a20 7072 6563 6970 6974 6174  ip**: precipitat
-0000fff0: 696f 6e20 5b6d 6d5d 0a0a 2020 2020 2020  ion [mm]..      
-00010000: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00010010: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00010020: 2020 2020 2020 2020 7072 6563 6970 5f66          precip_f
-00010030: 6e20 3a20 7374 722c 2064 6566 6175 6c74  n : str, default
-00010040: 2065 7261 350a 2020 2020 2020 2020 2020   era5.          
-00010050: 2020 5072 6563 6970 6974 6174 696f 6e20    Precipitation 
-00010060: 6461 7461 2073 6f75 7263 652c 2073 6565  data source, see
-00010070: 2064 6174 612f 666f 7263 696e 675f 736f   data/forcing_so
-00010080: 7572 6365 732e 796d 6c2e 0a0a 2020 2020  urces.yml...    
-00010090: 2020 2020 2020 2020 2a20 5265 7175 6972          * Requir
-000100a0: 6564 2076 6172 6961 626c 653a 205b 2770  ed variable: ['p
-000100b0: 7265 6369 7027 5d0a 2020 2020 2020 2020  recip'].        
-000100c0: 7072 6563 6970 5f63 6c69 6d5f 666e 203a  precip_clim_fn :
-000100d0: 2073 7472 2c20 6465 6661 756c 7420 4e6f   str, default No
-000100e0: 6e65 0a20 2020 2020 2020 2020 2020 2048  ne.            H
-000100f0: 6967 6820 7265 736f 6c75 7469 6f6e 2063  igh resolution c
-00010100: 6c69 6d61 746f 6c6f 6779 2070 7265 6369  limatology preci
-00010110: 7069 7461 7469 6f6e 2064 6174 6120 736f  pitation data so
-00010120: 7572 6365 2074 6f20 636f 7272 6563 7420  urce to correct 
-00010130: 7072 6563 6970 6974 6174 696f 6e2c 0a20  precipitation,. 
-00010140: 2020 2020 2020 2020 2020 2073 6565 2064             see d
-00010150: 6174 612f 666f 7263 696e 675f 736f 7572  ata/forcing_sour
-00010160: 6365 732e 796d 6c2e 0a0a 2020 2020 2020  ces.yml...      
-00010170: 2020 2020 2020 2a20 5265 7175 6972 6564        * Required
-00010180: 2076 6172 6961 626c 653a 205b 2770 7265   variable: ['pre
-00010190: 6369 7027 5d0a 2020 2020 2020 2020 6368  cip'].        ch
-000101a0: 756e 6b73 697a 653a 2069 6e74 2c20 6f70  unksize: int, op
-000101b0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-000101c0: 2020 2043 6875 6e6b 7369 7a65 206f 6e20     Chunksize on 
-000101d0: 7469 6d65 2064 696d 656e 7369 6f6e 2066  time dimension f
-000101e0: 6f72 2070 726f 6365 7373 696e 6720 6461  or processing da
-000101f0: 7461 2028 6e6f 7420 666f 7220 7361 7669  ta (not for savi
-00010200: 6e67 2074 6f20 6469 736b 2129 2e0a 2020  ng to disk!)..  
-00010210: 2020 2020 2020 2020 2020 4966 204e 6f6e            If Non
-00010220: 6520 7468 6520 6461 7461 2063 6875 6e6b  e the data chunk
-00010230: 7369 7a65 2069 7320 7573 6564 2c20 7468  size is used, th
-00010240: 6973 2063 616e 2068 6f77 6576 6572 2062  is can however b
-00010250: 6520 6f70 7469 6d69 7a65 6420 666f 720a  e optimized for.
-00010260: 2020 2020 2020 2020 2020 2020 6c61 7267              larg
-00010270: 652f 736d 616c 6c20 6361 7463 686d 656e  e/small catchmen
-00010280: 7473 2e20 4279 2064 6566 6175 6c74 204e  ts. By default N
-00010290: 6f6e 652e 0a20 2020 2020 2020 2022 2222  one..        """
-000102a0: 0a20 2020 2020 2020 2069 6620 7072 6563  .        if prec
-000102b0: 6970 5f66 6e20 6973 204e 6f6e 653a 0a20  ip_fn is None:. 
-000102c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000102d0: 6e0a 2020 2020 2020 2020 7374 6172 7474  n.        startt
-000102e0: 696d 6520 3d20 7365 6c66 2e67 6574 5f63  ime = self.get_c
-000102f0: 6f6e 6669 6728 2273 7461 7274 7469 6d65  onfig("starttime
-00010300: 2229 0a20 2020 2020 2020 2065 6e64 7469  ").        endti
-00010310: 6d65 203d 2073 656c 662e 6765 745f 636f  me = self.get_co
-00010320: 6e66 6967 2822 656e 6474 696d 6522 290a  nfig("endtime").
-00010330: 2020 2020 2020 2020 6672 6571 203d 2070          freq = p
-00010340: 642e 746f 5f74 696d 6564 656c 7461 2873  d.to_timedelta(s
-00010350: 656c 662e 6765 745f 636f 6e66 6967 2822  elf.get_config("
-00010360: 7469 6d65 7374 6570 7365 6373 2229 2c20  timestepsecs"), 
-00010370: 756e 6974 3d22 7322 290a 2020 2020 2020  unit="s").      
-00010380: 2020 6d61 736b 203d 2073 656c 662e 7374    mask = self.st
-00010390: 6174 6963 6d61 7073 5b73 656c 662e 5f4d  aticmaps[self._M
-000103a0: 4150 535b 2262 6173 696e 7322 5d5d 2e76  APS["basins"]].v
-000103b0: 616c 7565 7320 3e20 300a 0a20 2020 2020  alues > 0..     
-000103c0: 2020 2070 7265 6369 7020 3d20 7365 6c66     precip = self
-000103d0: 2e64 6174 615f 6361 7461 6c6f 672e 6765  .data_catalog.ge
-000103e0: 745f 7261 7374 6572 6461 7461 7365 7428  t_rasterdataset(
-000103f0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00010400: 6369 705f 666e 2c0a 2020 2020 2020 2020  cip_fn,.        
-00010410: 2020 2020 6765 6f6d 3d73 656c 662e 7265      geom=self.re
-00010420: 6769 6f6e 2c0a 2020 2020 2020 2020 2020  gion,.          
-00010430: 2020 6275 6666 6572 3d32 2c0a 2020 2020    buffer=2,.    
-00010440: 2020 2020 2020 2020 7469 6d65 5f74 7570          time_tup
-00010450: 6c65 3d28 7374 6172 7474 696d 652c 2065  le=(starttime, e
-00010460: 6e64 7469 6d65 292c 0a20 2020 2020 2020  ndtime),.       
-00010470: 2020 2020 2076 6172 6961 626c 6573 3d5b       variables=[
-00010480: 2270 7265 6369 7022 5d2c 0a20 2020 2020  "precip"],.     
-00010490: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
-000104a0: 2063 6875 6e6b 7369 7a65 2069 7320 6e6f   chunksize is no
-000104b0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000104c0: 2020 2020 7072 6563 6970 203d 2070 7265      precip = pre
-000104d0: 6369 702e 6368 756e 6b28 7b22 7469 6d65  cip.chunk({"time
-000104e0: 223a 2063 6875 6e6b 7369 7a65 7d29 0a0a  ": chunksize})..
-000104f0: 2020 2020 2020 2020 636c 696d 203d 204e          clim = N
-00010500: 6f6e 650a 2020 2020 2020 2020 6966 2070  one.        if p
-00010510: 7265 6369 705f 636c 696d 5f66 6e20 213d  recip_clim_fn !=
-00010520: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00010530: 2020 2063 6c69 6d20 3d20 7365 6c66 2e64     clim = self.d
-00010540: 6174 615f 6361 7461 6c6f 672e 6765 745f  ata_catalog.get_
-00010550: 7261 7374 6572 6461 7461 7365 7428 0a20  rasterdataset(. 
-00010560: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00010570: 7265 6369 705f 636c 696d 5f66 6e2c 0a20  recip_clim_fn,. 
-00010580: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00010590: 656f 6d3d 7072 6563 6970 2e72 6173 7465  eom=precip.raste
-000105a0: 722e 626f 782c 0a20 2020 2020 2020 2020  r.box,.         
-000105b0: 2020 2020 2020 2062 7566 6665 723d 322c         buffer=2,
-000105c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000105d0: 2076 6172 6961 626c 6573 3d5b 2270 7265   variables=["pre
-000105e0: 6369 7022 5d2c 0a20 2020 2020 2020 2020  cip"],.         
-000105f0: 2020 2029 0a0a 2020 2020 2020 2020 7072     )..        pr
-00010600: 6563 6970 5f6f 7574 203d 2068 7964 726f  ecip_out = hydro
-00010610: 6d74 2e77 6f72 6b66 6c6f 7773 2e66 6f72  mt.workflows.for
-00010620: 6369 6e67 2e70 7265 6369 7028 0a20 2020  cing.precip(.   
-00010630: 2020 2020 2020 2020 2070 7265 6369 703d           precip=
-00010640: 7072 6563 6970 2c0a 2020 2020 2020 2020  precip,.        
-00010650: 2020 2020 6461 5f6c 696b 653d 7365 6c66      da_like=self
-00010660: 2e73 7461 7469 636d 6170 735b 7365 6c66  .staticmaps[self
-00010670: 2e5f 4d41 5053 5b22 656c 6576 746e 225d  ._MAPS["elevtn"]
-00010680: 5d2c 0a20 2020 2020 2020 2020 2020 2063  ],.            c
-00010690: 6c69 6d3d 636c 696d 2c0a 2020 2020 2020  lim=clim,.      
-000106a0: 2020 2020 2020 6672 6571 3d66 7265 712c        freq=freq,
-000106b0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000106c0: 616d 706c 655f 6b77 6172 6773 3d64 6963  ample_kwargs=dic
-000106d0: 7428 6c61 6265 6c3d 2272 6967 6874 222c  t(label="right",
-000106e0: 2063 6c6f 7365 643d 2272 6967 6874 2229   closed="right")
-000106f0: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
-00010700: 6767 6572 3d73 656c 662e 6c6f 6767 6572  gger=self.logger
-00010710: 2c0a 2020 2020 2020 2020 2020 2020 2a2a  ,.            **
-00010720: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-00010730: 290a 0a20 2020 2020 2020 2023 2055 7064  )..        # Upd
-00010740: 6174 6520 6d65 7461 2061 7474 7269 6275  ate meta attribu
-00010750: 7465 7320 2875 7365 6420 666f 7220 6465  tes (used for de
-00010760: 6661 756c 7420 6f75 7470 7574 2066 696c  fault output fil
-00010770: 656e 616d 6520 6c61 7465 7229 0a20 2020  ename later).   
-00010780: 2020 2020 2070 7265 6369 705f 6f75 742e       precip_out.
-00010790: 6174 7472 732e 7570 6461 7465 287b 2270  attrs.update({"p
-000107a0: 7265 6369 705f 666e 223a 2070 7265 6369  recip_fn": preci
-000107b0: 705f 666e 7d29 0a20 2020 2020 2020 2069  p_fn}).        i
-000107c0: 6620 7072 6563 6970 5f63 6c69 6d5f 666e  f precip_clim_fn
-000107d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000107e0: 2020 2020 2020 2020 2020 7072 6563 6970            precip
-000107f0: 5f6f 7574 2e61 7474 7273 2e75 7064 6174  _out.attrs.updat
-00010800: 6528 7b22 7072 6563 6970 5f63 6c69 6d5f  e({"precip_clim_
-00010810: 666e 223a 2070 7265 6369 705f 636c 696d  fn": precip_clim
-00010820: 5f66 6e7d 290a 2020 2020 2020 2020 7365  _fn}).        se
-00010830: 6c66 2e73 6574 5f66 6f72 6369 6e67 2870  lf.set_forcing(p
-00010840: 7265 6369 705f 6f75 742e 7768 6572 6528  recip_out.where(
-00010850: 6d61 736b 292c 206e 616d 653d 2270 7265  mask), name="pre
-00010860: 6369 7022 290a 0a20 2020 2064 6566 2073  cip")..    def s
-00010870: 6574 7570 5f74 656d 705f 7065 745f 666f  etup_temp_pet_fo
-00010880: 7263 696e 6728 0a20 2020 2020 2020 2073  rcing(.        s
-00010890: 656c 662c 0a20 2020 2020 2020 2074 656d  elf,.        tem
-000108a0: 705f 7065 745f 666e 3a20 7374 7220 3d20  p_pet_fn: str = 
-000108b0: 2265 7261 3522 2c0a 2020 2020 2020 2020  "era5",.        
-000108c0: 7065 745f 6d65 7468 6f64 3a20 7374 7220  pet_method: str 
-000108d0: 3d20 2264 6562 7275 696e 222c 0a20 2020  = "debruin",.   
-000108e0: 2020 2020 2070 7265 7373 5f63 6f72 7265       press_corre
-000108f0: 6374 696f 6e3a 2062 6f6f 6c20 3d20 5472  ction: bool = Tr
-00010900: 7565 2c0a 2020 2020 2020 2020 7465 6d70  ue,.        temp
-00010910: 5f63 6f72 7265 6374 696f 6e3a 2062 6f6f  _correction: boo
-00010920: 6c20 3d20 5472 7565 2c0a 2020 2020 2020  l = True,.      
-00010930: 2020 6465 6d5f 666f 7263 696e 675f 666e    dem_forcing_fn
-00010940: 3a20 7374 7220 3d20 2265 7261 355f 6f72  : str = "era5_or
-00010950: 6f67 7261 7068 7922 2c0a 2020 2020 2020  ography",.      
-00010960: 2020 736b 6970 5f70 6574 3a20 7374 7220    skip_pet: str 
-00010970: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-00010980: 2063 6875 6e6b 7369 7a65 3a20 4f70 7469   chunksize: Opti
-00010990: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
-000109a0: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
-000109b0: 6773 2c0a 2020 2020 2920 2d3e 204e 6f6e  gs,.    ) -> Non
-000109c0: 653a 0a20 2020 2020 2020 2022 2222 5365  e:.        """Se
-000109d0: 7475 7020 6772 6964 6465 6420 7265 6665  tup gridded refe
-000109e0: 7265 6e63 6520 6576 6170 6f74 7261 6e73  rence evapotrans
-000109f0: 7069 7261 7469 6f6e 2066 6f72 6369 6e67  piration forcing
-00010a00: 2061 7420 6d6f 6465 6c20 7265 736f 6c75   at model resolu
-00010a10: 7469 6f6e 2e0a 0a20 2020 2020 2020 2041  tion...        A
-00010a20: 6464 7320 6d6f 6465 6c20 6c61 7965 723a  dds model layer:
-00010a30: 0a0a 2020 2020 2020 2020 2a20 2a2a 7065  ..        * **pe
-00010a40: 742a 2a3a 2072 6566 6572 656e 6365 2065  t**: reference e
-00010a50: 7661 706f 7472 616e 7370 6972 6174 696f  vapotranspiratio
-00010a60: 6e20 5b6d 6d5d 0a20 2020 2020 2020 202a  n [mm].        *
-00010a70: 202a 2a74 656d 702a 2a3a 2074 656d 7065   **temp**: tempe
-00010a80: 7261 7475 7265 205b c2b0 435d 0a0a 2020  rature [..C]..  
-00010a90: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00010aa0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00010ab0: 2d2d 2d0a 2020 2020 2020 2020 7465 6d70  ---.        temp
-00010ac0: 5f70 6574 5f66 6e20 3a20 7374 722c 206f  _pet_fn : str, o
-00010ad0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00010ae0: 2020 2020 4e61 6d65 206f 7220 7061 7468      Name or path
-00010af0: 206f 6620 6461 7461 2073 6f75 7263 6520   of data source 
-00010b00: 7769 7468 2076 6172 6961 626c 6573 2074  with variables t
-00010b10: 6f20 6361 6c63 756c 6174 6520 7465 6d70  o calculate temp
-00010b20: 6572 6174 7572 6520 616e 6420 7265 6665  erature and refe
-00010b30: 7265 6e63 6520 6576 6170 6f74 7261 6e73  rence evapotrans
-00010b40: 7069 7261 7469 6f6e 2c0a 2020 2020 2020  piration,.      
-00010b50: 2020 2020 2020 7365 6520 6461 7461 2f66        see data/f
-00010b60: 6f72 6369 6e67 5f73 6f75 7263 6573 2e79  orcing_sources.y
-00010b70: 6d6c 2c20 6279 2064 6566 6175 6c74 2027  ml, by default '
-00010b80: 6572 6135 272e 0a0a 2020 2020 2020 2020  era5'...        
-00010b90: 2020 2020 2a20 5265 7175 6972 6564 2076      * Required v
-00010ba0: 6172 6961 626c 6520 666f 7220 7465 6d70  ariable for temp
-00010bb0: 6572 6174 7572 653a 205b 2774 656d 7027  erature: ['temp'
-00010bc0: 5d0a 0a20 2020 2020 2020 2020 2020 202a  ]..            *
-00010bd0: 2052 6571 7569 7265 6420 7661 7269 6162   Required variab
-00010be0: 6c65 7320 666f 7220 4465 2042 7275 696e  les for De Bruin
-00010bf0: 2072 6566 6572 656e 6365 2065 7661 706f   reference evapo
-00010c00: 7472 616e 7370 6972 6174 696f 6e3a 205b  transpiration: [
-00010c10: 2774 656d 7027 2c20 2770 7265 7373 5f6d  'temp', 'press_m
-00010c20: 736c 272c 2027 6b69 6e27 2c20 276b 6f75  sl', 'kin', 'kou
-00010c30: 7427 5d0a 0a20 2020 2020 2020 2020 2020  t']..           
-00010c40: 202a 2052 6571 7569 7265 6420 7661 7269   * Required vari
-00010c50: 6162 6c65 7320 666f 7220 4d61 6b6b 696e  ables for Makkin
-00010c60: 6b20 7265 6665 7265 6e63 6520 6576 6170  k reference evap
-00010c70: 6f74 7261 6e73 7069 7261 7469 6f6e 3a20  otranspiration: 
-00010c80: 5b27 7465 6d70 272c 2027 7072 6573 735f  ['temp', 'press_
-00010c90: 6d73 6c27 2c20 276b 696e 275d 0a20 2020  msl', 'kin'].   
-00010ca0: 2020 2020 2070 6574 5f6d 6574 686f 6420       pet_method 
-00010cb0: 3a20 7b27 6465 6272 7569 6e27 2c20 276d  : {'debruin', 'm
-00010cc0: 616b 6b69 6e6b 277d 2c20 6f70 7469 6f6e  akkink'}, option
-00010cd0: 616c 0a20 2020 2020 2020 2020 2020 2052  al.            R
-00010ce0: 6566 6572 656e 6365 2065 7661 706f 7472  eference evapotr
-00010cf0: 616e 7370 6972 6174 696f 6e20 6d65 7468  anspiration meth
-00010d00: 6f64 2c20 6279 2064 6566 6175 6c74 2027  od, by default '
-00010d10: 6465 6272 7569 6e27 2e0a 2020 2020 2020  debruin'..      
-00010d20: 2020 7072 6573 735f 636f 7272 6563 7469    press_correcti
-00010d30: 6f6e 2c20 7465 6d70 5f63 6f72 7265 6374  on, temp_correct
-00010d40: 696f 6e20 3a20 626f 6f6c 2c20 6f70 7469  ion : bool, opti
-00010d50: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00010d60: 2020 4966 2054 7275 6520 7072 6573 7375    If True pressu
-00010d70: 7265 2c20 7465 6d70 6572 6174 7572 6520  re, temperature 
-00010d80: 6172 6520 636f 7272 6563 7465 6420 7573  are corrected us
-00010d90: 696e 6720 656c 6576 6174 696f 6e20 6c61  ing elevation la
-00010da0: 7073 6520 7261 7465 2c0a 2020 2020 2020  pse rate,.      
-00010db0: 2020 2020 2020 2062 7920 6465 6661 756c         by defaul
-00010dc0: 7420 4661 6c73 652e 0a20 2020 2020 2020  t False..       
-00010dd0: 2064 656d 5f66 6f72 6369 6e67 5f66 6e20   dem_forcing_fn 
-00010de0: 3a20 7374 722c 2064 6566 6175 6c74 204e  : str, default N
-00010df0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00010e00: 2045 6c65 7661 7469 6f6e 2064 6174 6120   Elevation data 
-00010e10: 736f 7572 6365 2077 6974 6820 636f 7665  source with cove
-00010e20: 7261 6765 206f 6620 656e 7469 7265 206d  rage of entire m
-00010e30: 6574 656f 726f 6c6f 6769 6361 6c20 666f  eteorological fo
-00010e40: 7263 696e 6720 646f 6d61 696e 2e0a 2020  rcing domain..  
-00010e50: 2020 2020 2020 2020 2020 2049 6620 7465             If te
-00010e60: 6d70 5f63 6f72 7265 6374 696f 6e20 6973  mp_correction is
-00010e70: 2054 7275 6520 616e 6420 6465 6d5f 666f   True and dem_fo
-00010e80: 7263 696e 675f 666e 2069 7320 7072 6f76  rcing_fn is prov
-00010e90: 6964 6564 2074 6869 7320 6973 2075 7365  ided this is use
-00010ea0: 6420 696e 0a20 2020 2020 2020 2020 2020  d in.           
-00010eb0: 2020 636f 6d62 696e 6174 696f 6e20 7769    combination wi
-00010ec0: 7468 2065 6c65 7661 7469 6f6e 2061 7420  th elevation at 
-00010ed0: 6d6f 6465 6c20 7265 736f 6c75 7469 6f6e  model resolution
-00010ee0: 2074 6f20 636f 7272 6563 7420 7468 6520   to correct the 
-00010ef0: 7465 6d70 6572 6174 7572 652e 0a20 2020  temperature..   
-00010f00: 2020 2020 2073 6b69 705f 7065 7420 3a20       skip_pet : 
-00010f10: 626f 6f6c 2c20 6f70 7469 6f6e 616c 0a20  bool, optional. 
-00010f20: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-00010f30: 7565 2063 616c 6375 6c61 7465 2074 656d  ue calculate tem
-00010f40: 7020 6f6e 6c79 2e0a 2020 2020 2020 2020  p only..        
-00010f50: 6368 756e 6b73 697a 653a 2069 6e74 2c20  chunksize: int, 
-00010f60: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00010f70: 2020 2020 2043 6875 6e6b 7369 7a65 206f       Chunksize o
-00010f80: 6e20 7469 6d65 2064 696d 656e 7369 6f6e  n time dimension
-00010f90: 2066 6f72 2070 726f 6365 7373 696e 6720   for processing 
-00010fa0: 6461 7461 2028 6e6f 7420 666f 7220 7361  data (not for sa
-00010fb0: 7669 6e67 2074 6f20 6469 736b 2129 2e0a  ving to disk!)..
-00010fc0: 2020 2020 2020 2020 2020 2020 4966 204e              If N
-00010fd0: 6f6e 6520 7468 6520 6461 7461 2063 6875  one the data chu
-00010fe0: 6e6b 7369 7a65 2069 7320 7573 6564 2c20  nksize is used, 
-00010ff0: 7468 6973 2063 616e 2068 6f77 6576 6572  this can however
-00011000: 2062 6520 6f70 7469 6d69 7a65 6420 666f   be optimized fo
-00011010: 720a 2020 2020 2020 2020 2020 2020 6c61  r.            la
-00011020: 7267 652f 736d 616c 6c20 6361 7463 686d  rge/small catchm
-00011030: 656e 7473 2e20 4279 2064 6566 6175 6c74  ents. By default
-00011040: 204e 6f6e 652e 0a20 2020 2020 2020 2022   None..        "
-00011050: 2222 0a20 2020 2020 2020 2069 6620 7465  "".        if te
-00011060: 6d70 5f70 6574 5f66 6e20 6973 204e 6f6e  mp_pet_fn is Non
-00011070: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00011080: 6574 7572 6e0a 2020 2020 2020 2020 7374  eturn.        st
-00011090: 6172 7474 696d 6520 3d20 7365 6c66 2e67  arttime = self.g
-000110a0: 6574 5f63 6f6e 6669 6728 2273 7461 7274  et_config("start
-000110b0: 7469 6d65 2229 0a20 2020 2020 2020 2065  time").        e
-000110c0: 6e64 7469 6d65 203d 2073 656c 662e 6765  ndtime = self.ge
-000110d0: 745f 636f 6e66 6967 2822 656e 6474 696d  t_config("endtim
-000110e0: 6522 290a 2020 2020 2020 2020 7469 6d65  e").        time
-000110f0: 7374 6570 203d 2073 656c 662e 6765 745f  step = self.get_
-00011100: 636f 6e66 6967 2822 7469 6d65 7374 6570  config("timestep
-00011110: 7365 6373 2229 0a20 2020 2020 2020 2066  secs").        f
-00011120: 7265 7120 3d20 7064 2e74 6f5f 7469 6d65  req = pd.to_time
-00011130: 6465 6c74 6128 7469 6d65 7374 6570 2c20  delta(timestep, 
-00011140: 756e 6974 3d22 7322 290a 2020 2020 2020  unit="s").      
-00011150: 2020 6d61 736b 203d 2073 656c 662e 7374    mask = self.st
-00011160: 6174 6963 6d61 7073 5b73 656c 662e 5f4d  aticmaps[self._M
-00011170: 4150 535b 2262 6173 696e 7322 5d5d 2e76  APS["basins"]].v
-00011180: 616c 7565 7320 3e20 300a 0a20 2020 2020  alues > 0..     
-00011190: 2020 2076 6172 6961 626c 6573 203d 205b     variables = [
-000111a0: 2274 656d 7022 5d0a 2020 2020 2020 2020  "temp"].        
-000111b0: 6966 206e 6f74 2073 6b69 705f 7065 743a  if not skip_pet:
-000111c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000111d0: 7065 745f 6d65 7468 6f64 203d 3d20 2264  pet_method == "d
-000111e0: 6562 7275 696e 223a 0a20 2020 2020 2020  ebruin":.       
-000111f0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00011200: 6573 202b 3d20 5b22 7072 6573 735f 6d73  es += ["press_ms
-00011210: 6c22 2c20 226b 696e 222c 2022 6b6f 7574  l", "kin", "kout
-00011220: 225d 0a20 2020 2020 2020 2020 2020 2065  "].            e
-00011230: 6c69 6620 7065 745f 6d65 7468 6f64 203d  lif pet_method =
-00011240: 3d20 226d 616b 6b69 6e6b 223a 0a20 2020  = "makkink":.   
-00011250: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00011260: 6961 626c 6573 202b 3d20 5b22 7072 6573  iables += ["pres
-00011270: 735f 6d73 6c22 2c20 226b 696e 225d 0a20  s_msl", "kin"]. 
-00011280: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00011290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000112a0: 206d 6574 686f 6473 203d 205b 2264 6562   methods = ["deb
-000112b0: 7275 696e 222c 2022 6d61 6b6b 696e 6722  ruin", "makking"
-000112c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000112d0: 2020 5661 6c75 6545 7272 6f72 2866 2255    ValueError(f"U
-000112e0: 6e6b 6e6f 776e 2070 6574 206d 6574 686f  nknown pet metho
-000112f0: 6420 7b70 6574 5f6d 6574 686f 647d 2c20  d {pet_method}, 
-00011300: 7365 6c65 6374 2066 726f 6d20 7b6d 6574  select from {met
-00011310: 686f 6473 7d22 290a 0a20 2020 2020 2020  hods}")..       
-00011320: 2064 7320 3d20 7365 6c66 2e64 6174 615f   ds = self.data_
-00011330: 6361 7461 6c6f 672e 6765 745f 7261 7374  catalog.get_rast
-00011340: 6572 6461 7461 7365 7428 0a20 2020 2020  erdataset(.     
-00011350: 2020 2020 2020 2074 656d 705f 7065 745f         temp_pet_
-00011360: 666e 2c0a 2020 2020 2020 2020 2020 2020  fn,.            
-00011370: 6765 6f6d 3d73 656c 662e 7265 6769 6f6e  geom=self.region
-00011380: 2c0a 2020 2020 2020 2020 2020 2020 6275  ,.            bu
-00011390: 6666 6572 3d31 2c0a 2020 2020 2020 2020  ffer=1,.        
-000113a0: 2020 2020 7469 6d65 5f74 7570 6c65 3d28      time_tuple=(
-000113b0: 7374 6172 7474 696d 652c 2065 6e64 7469  starttime, endti
-000113c0: 6d65 292c 0a20 2020 2020 2020 2020 2020  me),.           
-000113d0: 2076 6172 6961 626c 6573 3d76 6172 6961   variables=varia
-000113e0: 626c 6573 2c0a 2020 2020 2020 2020 2020  bles,.          
-000113f0: 2020 7369 6e67 6c65 5f76 6172 5f61 735f    single_var_as_
-00011400: 6172 7261 793d 4661 6c73 652c 2020 2320  array=False,  # 
-00011410: 616c 7761 7973 2072 6574 7572 6e20 6461  always return da
-00011420: 7461 7365 740a 2020 2020 2020 2020 290a  taset.        ).
-00011430: 2020 2020 2020 2020 6966 2063 6875 6e6b          if chunk
-00011440: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-00011450: 3a0a 2020 2020 2020 2020 2020 2020 6473  :.            ds
-00011460: 203d 2064 732e 6368 756e 6b28 7b22 7469   = ds.chunk({"ti
-00011470: 6d65 223a 2063 6875 6e6b 7369 7a65 7d29  me": chunksize})
-00011480: 0a0a 2020 2020 2020 2020 6465 6d5f 666f  ..        dem_fo
-00011490: 7263 696e 6720 3d20 4e6f 6e65 0a20 2020  rcing = None.   
-000114a0: 2020 2020 2069 6620 6465 6d5f 666f 7263       if dem_forc
-000114b0: 696e 675f 666e 2021 3d20 4e6f 6e65 3a0a  ing_fn != None:.
-000114c0: 2020 2020 2020 2020 2020 2020 6465 6d5f              dem_
-000114d0: 666f 7263 696e 6720 3d20 7365 6c66 2e64  forcing = self.d
-000114e0: 6174 615f 6361 7461 6c6f 672e 6765 745f  ata_catalog.get_
-000114f0: 7261 7374 6572 6461 7461 7365 7428 0a20  rasterdataset(. 
-00011500: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00011510: 656d 5f66 6f72 6369 6e67 5f66 6e2c 0a20  em_forcing_fn,. 
-00011520: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00011530: 656f 6d3d 6473 2e72 6173 7465 722e 626f  eom=ds.raster.bo
-00011540: 782c 2020 2320 636c 6970 2064 656d 2077  x,  # clip dem w
-00011550: 6974 6820 666f 7263 696e 6720 6262 6f78  ith forcing bbox
-00011560: 2066 6f72 2066 756c 6c20 636f 7665 7261   for full covera
-00011570: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
-00011580: 2020 2062 7566 6665 723d 322c 0a20 2020     buffer=2,.   
-00011590: 2020 2020 2020 2020 2020 2020 2076 6172               var
-000115a0: 6961 626c 6573 3d5b 2265 6c65 7674 6e22  iables=["elevtn"
-000115b0: 5d2c 0a20 2020 2020 2020 2020 2020 2029  ],.            )
-000115c0: 2e73 7175 6565 7a65 2829 0a0a 2020 2020  .squeeze()..    
-000115d0: 2020 2020 7465 6d70 5f69 6e20 3d20 6879      temp_in = hy
-000115e0: 6472 6f6d 742e 776f 726b 666c 6f77 732e  dromt.workflows.
-000115f0: 666f 7263 696e 672e 7465 6d70 280a 2020  forcing.temp(.  
-00011600: 2020 2020 2020 2020 2020 6473 5b22 7465            ds["te
-00011610: 6d70 225d 2c0a 2020 2020 2020 2020 2020  mp"],.          
-00011620: 2020 6465 6d5f 6d6f 6465 6c3d 7365 6c66    dem_model=self
-00011630: 2e73 7461 7469 636d 6170 735b 7365 6c66  .staticmaps[self
-00011640: 2e5f 4d41 5053 5b22 656c 6576 746e 225d  ._MAPS["elevtn"]
-00011650: 5d2c 0a20 2020 2020 2020 2020 2020 2064  ],.            d
-00011660: 656d 5f66 6f72 6369 6e67 3d64 656d 5f66  em_forcing=dem_f
-00011670: 6f72 6369 6e67 2c0a 2020 2020 2020 2020  orcing,.        
-00011680: 2020 2020 6c61 7073 655f 636f 7272 6563      lapse_correc
-00011690: 7469 6f6e 3d74 656d 705f 636f 7272 6563  tion=temp_correc
-000116a0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-000116b0: 2020 6c6f 6767 6572 3d73 656c 662e 6c6f    logger=self.lo
-000116c0: 6767 6572 2c0a 2020 2020 2020 2020 2020  gger,.          
-000116d0: 2020 6672 6571 3d4e 6f6e 652c 2020 2320    freq=None,  # 
-000116e0: 7265 7361 6d70 6c65 2074 696d 6520 6166  resample time af
-000116f0: 7465 7220 7065 7420 776f 726b 666c 6f77  ter pet workflow
-00011700: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
-00011710: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
-00011720: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00011730: 2073 6b69 705f 7065 743a 0a20 2020 2020   skip_pet:.     
-00011740: 2020 2020 2020 2070 6574 5f6f 7574 203d         pet_out =
-00011750: 2068 7964 726f 6d74 2e77 6f72 6b66 6c6f   hydromt.workflo
-00011760: 7773 2e66 6f72 6369 6e67 2e70 6574 280a  ws.forcing.pet(.
-00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011780: 6473 5b76 6172 6961 626c 6573 5b31 3a5d  ds[variables[1:]
-00011790: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000117a0: 2020 2064 656d 5f6d 6f64 656c 3d73 656c     dem_model=sel
-000117b0: 662e 7374 6174 6963 6d61 7073 5b73 656c  f.staticmaps[sel
-000117c0: 662e 5f4d 4150 535b 2265 6c65 7674 6e22  f._MAPS["elevtn"
-000117d0: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
-000117e0: 2020 2020 7465 6d70 3d74 656d 705f 696e      temp=temp_in
-000117f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011800: 2020 6d65 7468 6f64 3d70 6574 5f6d 6574    method=pet_met
-00011810: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
-00011820: 2020 2020 2070 7265 7373 5f63 6f72 7265       press_corre
-00011830: 6374 696f 6e3d 7072 6573 735f 636f 7272  ction=press_corr
-00011840: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
-00011850: 2020 2020 2020 2020 6672 6571 3d66 7265          freq=fre
-00011860: 712c 0a20 2020 2020 2020 2020 2020 2020  q,.             
-00011870: 2020 2072 6573 616d 706c 655f 6b77 6172     resample_kwar
-00011880: 6773 3d64 6963 7428 6c61 6265 6c3d 2272  gs=dict(label="r
-00011890: 6967 6874 222c 2063 6c6f 7365 643d 2272  ight", closed="r
-000118a0: 6967 6874 2229 2c0a 2020 2020 2020 2020  ight"),.        
-000118b0: 2020 2020 2020 2020 6c6f 6767 6572 3d73          logger=s
-000118c0: 656c 662e 6c6f 6767 6572 2c0a 2020 2020  elf.logger,.    
-000118d0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-000118e0: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-000118f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00011900: 2320 5570 6461 7465 206d 6574 6120 6174  # Update meta at
-00011910: 7472 6962 7574 6573 2077 6974 6820 7365  tributes with se
-00011920: 7475 7020 6f70 740a 2020 2020 2020 2020  tup opt.        
-00011930: 2020 2020 6f70 745f 6174 7472 203d 207b      opt_attr = {
-00011940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011950: 2022 7065 745f 666e 223a 2074 656d 705f   "pet_fn": temp_
-00011960: 7065 745f 666e 2c0a 2020 2020 2020 2020  pet_fn,.        
-00011970: 2020 2020 2020 2020 2270 6574 5f6d 6574          "pet_met
-00011980: 686f 6422 3a20 7065 745f 6d65 7468 6f64  hod": pet_method
-00011990: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
-000119a0: 2020 2020 2020 2020 2020 2020 7065 745f              pet_
-000119b0: 6f75 742e 6174 7472 732e 7570 6461 7465  out.attrs.update
-000119c0: 286f 7074 5f61 7474 7229 0a20 2020 2020  (opt_attr).     
-000119d0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-000119e0: 666f 7263 696e 6728 7065 745f 6f75 742e  forcing(pet_out.
-000119f0: 7768 6572 6528 6d61 736b 292c 206e 616d  where(mask), nam
-00011a00: 653d 2270 6574 2229 0a0a 2020 2020 2020  e="pet")..      
-00011a10: 2020 2320 7265 7361 6d70 6c65 2074 656d    # resample tem
-00011a20: 7020 6166 7465 7220 7065 7420 776f 726b  p after pet work
-00011a30: 666c 6f77 0a20 2020 2020 2020 2074 656d  flow.        tem
-00011a40: 705f 6f75 7420 3d20 6879 6472 6f6d 742e  p_out = hydromt.
-00011a50: 776f 726b 666c 6f77 732e 666f 7263 696e  workflows.forcin
-00011a60: 672e 7265 7361 6d70 6c65 5f74 696d 6528  g.resample_time(
-00011a70: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
-00011a80: 705f 696e 2c0a 2020 2020 2020 2020 2020  p_in,.          
-00011a90: 2020 6672 6571 2c0a 2020 2020 2020 2020    freq,.        
-00011aa0: 2020 2020 7570 7361 6d70 6c69 6e67 3d22      upsampling="
-00011ab0: 6266 696c 6c22 2c20 2023 2077 6520 6173  bfill",  # we as
-00011ac0: 7375 6d65 2072 6967 6874 206c 6162 656c  sume right label
-00011ad0: 6564 206f 7269 6769 6e61 6c20 6461 7461  ed original data
-00011ae0: 0a20 2020 2020 2020 2020 2020 2064 6f77  .            dow
-00011af0: 6e73 616d 706c 696e 673d 226d 6561 6e22  nsampling="mean"
-00011b00: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-00011b10: 6265 6c3d 2272 6967 6874 222c 0a20 2020  bel="right",.   
-00011b20: 2020 2020 2020 2020 2063 6c6f 7365 643d           closed=
-00011b30: 2272 6967 6874 222c 0a20 2020 2020 2020  "right",.       
-00011b40: 2020 2020 2063 6f6e 7365 7276 655f 6d61       conserve_ma
-00011b50: 7373 3d46 616c 7365 2c0a 2020 2020 2020  ss=False,.      
-00011b60: 2020 2020 2020 6c6f 6767 6572 3d73 656c        logger=sel
-00011b70: 662e 6c6f 6767 6572 2c0a 2020 2020 2020  f.logger,.      
-00011b80: 2020 290a 2020 2020 2020 2020 2320 5570    ).        # Up
-00011b90: 6461 7465 206d 6574 6120 6174 7472 6962  date meta attrib
-00011ba0: 7574 6573 2077 6974 6820 7365 7475 7020  utes with setup 
-00011bb0: 6f70 7420 2875 7365 6420 666f 7220 6465  opt (used for de
-00011bc0: 6661 756c 7420 6e61 6d69 6e67 206c 6174  fault naming lat
-00011bd0: 6572 290a 2020 2020 2020 2020 6f70 745f  er).        opt_
-00011be0: 6174 7472 203d 207b 0a20 2020 2020 2020  attr = {.       
-00011bf0: 2020 2020 2022 7465 6d70 5f66 6e22 3a20       "temp_fn": 
-00011c00: 7465 6d70 5f70 6574 5f66 6e2c 0a20 2020  temp_pet_fn,.   
-00011c10: 2020 2020 2020 2020 2022 7465 6d70 5f63           "temp_c
-00011c20: 6f72 7265 6374 696f 6e22 3a20 7374 7228  orrection": str(
-00011c30: 7465 6d70 5f63 6f72 7265 6374 696f 6e29  temp_correction)
-00011c40: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-00011c50: 2020 2020 7465 6d70 5f6f 7574 2e61 7474      temp_out.att
-00011c60: 7273 2e75 7064 6174 6528 6f70 745f 6174  rs.update(opt_at
-00011c70: 7472 290a 2020 2020 2020 2020 7365 6c66  tr).        self
-00011c80: 2e73 6574 5f66 6f72 6369 6e67 2874 656d  .set_forcing(tem
-00011c90: 705f 6f75 742e 7768 6572 6528 6d61 736b  p_out.where(mask
-00011ca0: 292c 206e 616d 653d 2274 656d 7022 290a  ), name="temp").
-00011cb0: 0a20 2020 2023 2049 2f4f 0a20 2020 2064  .    # I/O.    d
-00011cc0: 6566 2072 6561 6428 7365 6c66 293a 0a20  ef read(self):. 
-00011cd0: 2020 2020 2020 2022 2222 4d65 7468 6f64         """Method
-00011ce0: 2074 6f20 7265 6164 2074 6865 2063 6f6d   to read the com
-00011cf0: 706c 6574 6520 6d6f 6465 6c20 7363 6865  plete model sche
-00011d00: 6d61 7469 7a61 7469 6f6e 2061 6e64 2063  matization and c
-00011d10: 6f6e 6669 6775 7261 7469 6f6e 2066 726f  onfiguration fro
-00011d20: 6d20 6669 6c65 2e22 2222 0a20 2020 2020  m file.""".     
-00011d30: 2020 2073 656c 662e 7265 6164 5f63 6f6e     self.read_con
-00011d40: 6669 6728 290a 2020 2020 2020 2020 7365  fig().        se
-00011d50: 6c66 2e72 6561 645f 7374 6174 6963 6d61  lf.read_staticma
-00011d60: 7073 2829 0a20 2020 2020 2020 2073 656c  ps().        sel
-00011d70: 662e 7265 6164 5f69 6e74 626c 2829 0a20  f.read_intbl(). 
-00011d80: 2020 2020 2020 2073 656c 662e 7265 6164         self.read
-00011d90: 5f73 7461 7469 6367 656f 6d73 2829 0a20  _staticgeoms(). 
-00011da0: 2020 2020 2020 2073 656c 662e 7265 6164         self.read
-00011db0: 5f66 6f72 6369 6e67 2829 0a20 2020 2020  _forcing().     
-00011dc0: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
-00011dd0: 6e66 6f28 224d 6f64 656c 2072 6561 6422  nfo("Model read"
-00011de0: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
-00011df0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00011e00: 2222 224d 6574 686f 6420 746f 2077 7269  """Method to wri
-00011e10: 7465 2074 6865 2063 6f6d 706c 6574 6520  te the complete 
-00011e20: 6d6f 6465 6c20 7363 6865 6d61 7469 7a61  model schematiza
-00011e30: 7469 6f6e 2061 6e64 2063 6f6e 6669 6775  tion and configu
-00011e40: 7261 7469 6f6e 2074 6f20 6669 6c65 2e22  ration to file."
-00011e50: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00011e60: 6c6f 6767 6572 2e69 6e66 6f28 6622 5772  logger.info(f"Wr
-00011e70: 6974 6520 6d6f 6465 6c20 6461 7461 2074  ite model data t
-00011e80: 6f20 7b73 656c 662e 726f 6f74 7d22 290a  o {self.root}").
-00011e90: 2020 2020 2020 2020 2320 6966 2069 6e20          # if in 
-00011ea0: 722c 2072 2b20 6d6f 6465 2c20 6f6e 6c79  r, r+ mode, only
-00011eb0: 2077 7269 7465 2075 7064 6174 6564 2063   write updated c
-00011ec0: 6f6d 706f 6e65 6e74 730a 2020 2020 2020  omponents.      
-00011ed0: 2020 6966 206e 6f74 2073 656c 662e 5f77    if not self._w
-00011ee0: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
-00011ef0: 2020 7365 6c66 2e6c 6f67 6765 722e 7761    self.logger.wa
-00011f00: 726e 696e 6728 2243 616e 6e6f 7420 7772  rning("Cannot wr
-00011f10: 6974 6520 696e 2072 6561 642d 6f6e 6c79  ite in read-only
-00011f20: 206d 6f64 6522 290a 2020 2020 2020 2020   mode").        
-00011f30: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-00011f40: 2020 2073 656c 662e 7772 6974 655f 6461     self.write_da
-00011f50: 7461 5f63 6174 616c 6f67 2829 0a20 2020  ta_catalog().   
-00011f60: 2020 2020 2069 6620 7365 6c66 2e63 6f6e       if self.con
-00011f70: 6669 673a 2020 2320 7472 7920 746f 2072  fig:  # try to r
-00011f80: 6561 6420 6465 6661 756c 7420 6966 206e  ead default if n
-00011f90: 6f74 2079 6574 2073 6574 0a20 2020 2020  ot yet set.     
-00011fa0: 2020 2020 2020 2073 656c 662e 7772 6974         self.writ
-00011fb0: 655f 636f 6e66 6967 2829 0a20 2020 2020  e_config().     
-00011fc0: 2020 2069 6620 7365 6c66 2e5f 7374 6174     if self._stat
-00011fd0: 6963 6d61 7073 3a0a 2020 2020 2020 2020  icmaps:.        
-00011fe0: 2020 2020 7365 6c66 2e77 7269 7465 5f73      self.write_s
-00011ff0: 7461 7469 636d 6170 7328 290a 2020 2020  taticmaps().    
-00012000: 2020 2020 6966 2073 656c 662e 5f73 7461      if self._sta
-00012010: 7469 6367 656f 6d73 3a0a 2020 2020 2020  ticgeoms:.      
-00012020: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
-00012030: 5f73 7461 7469 6367 656f 6d73 2829 0a20  _staticgeoms(). 
-00012040: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00012050: 666f 7263 696e 673a 0a20 2020 2020 2020  forcing:.       
-00012060: 2020 2020 2073 656c 662e 7772 6974 655f       self.write_
-00012070: 666f 7263 696e 6728 290a 0a20 2020 2064  forcing()..    d
-00012080: 6566 2072 6561 645f 7374 6174 6963 6d61  ef read_staticma
-00012090: 7073 2873 656c 662c 202a 2a6b 7761 7267  ps(self, **kwarg
-000120a0: 7329 3a0a 2020 2020 2020 2020 2222 2252  s):.        """R
-000120b0: 6561 6420 7374 6174 6963 6d61 7073 2222  ead staticmaps""
-000120c0: 220a 2020 2020 2020 2020 666e 5f64 6566  ".        fn_def
-000120d0: 6175 6c74 203d 206a 6f69 6e28 7365 6c66  ault = join(self
-000120e0: 2e72 6f6f 742c 2022 7374 6174 6963 6d61  .root, "staticma
-000120f0: 7073 2e6e 6322 290a 2020 2020 2020 2020  ps.nc").        
-00012100: 666e 203d 2073 656c 662e 6765 745f 636f  fn = self.get_co
-00012110: 6e66 6967 2822 696e 7075 742e 7061 7468  nfig("input.path
-00012120: 5f73 7461 7469 6322 2c20 6162 735f 7061  _static", abs_pa
-00012130: 7468 3d54 7275 652c 2066 616c 6c62 6163  th=True, fallbac
-00012140: 6b3d 666e 5f64 6566 6175 6c74 290a 2020  k=fn_default).  
-00012150: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00012160: 662e 5f77 7269 7465 3a0a 2020 2020 2020  f._write:.      
-00012170: 2020 2020 2020 2320 7374 6172 7420 6672        # start fr
-00012180: 6573 6820 696e 2072 6561 642d 6f6e 6c79  esh in read-only
-00012190: 206d 6f64 650a 2020 2020 2020 2020 2020   mode.          
-000121a0: 2020 7365 6c66 2e5f 7374 6174 6963 6d61    self._staticma
-000121b0: 7073 203d 2078 722e 4461 7461 7365 7428  ps = xr.Dataset(
-000121c0: 290a 2020 2020 2020 2020 6966 2066 6e20  ).        if fn 
-000121d0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-000121e0: 6973 6669 6c65 2866 6e29 3a0a 2020 2020  isfile(fn):.    
-000121f0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00012200: 6765 722e 696e 666f 2866 2252 6561 6420  ger.info(f"Read 
-00012210: 7374 6174 6963 6d61 7073 2066 726f 6d20  staticmaps from 
-00012220: 7b66 6e7d 2229 0a20 2020 2020 2020 2020  {fn}").         
-00012230: 2020 2023 2046 4958 4d45 3a20 7765 206e     # FIXME: we n
-00012240: 6565 6420 6120 736d 6172 7465 7220 286c  eed a smarter (l
-00012250: 617a 7929 2073 6f6c 7574 696f 6e20 666f  azy) solution fo
-00012260: 7220 6269 6720 6d6f 6465 6c73 2077 6869  r big models whi
-00012270: 6368 2061 6c73 6f0a 2020 2020 2020 2020  ch also.        
-00012280: 2020 2020 2320 776f 726b 7320 7768 656e      # works when
-00012290: 206f 7665 7277 7269 7469 6e67 202f 2061   overwriting / a
-000122a0: 7070 656e 6469 6e67 2064 6174 6120 696e  ppending data in
-000122b0: 2074 6865 2073 616d 6520 736f 7572 6365   the same source
-000122c0: 210a 2020 2020 2020 2020 2020 2020 6473  !.            ds
-000122d0: 203d 2078 722e 6f70 656e 5f64 6174 6173   = xr.open_datas
-000122e0: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-000122f0: 2020 2020 666e 2c20 6d61 736b 5f61 6e64      fn, mask_and
-00012300: 5f73 6361 6c65 3d46 616c 7365 2c20 6465  _scale=False, de
-00012310: 636f 6465 5f63 6f6f 7264 733d 2261 6c6c  code_coords="all
-00012320: 222c 202a 2a6b 7761 7267 730a 2020 2020  ", **kwargs.    
-00012330: 2020 2020 2020 2020 292e 6c6f 6164 2829          ).load()
-00012340: 0a20 2020 2020 2020 2020 2020 2064 732e  .            ds.
-00012350: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-00012360: 2020 2020 2320 6d61 6b65 2073 7572 6520      # make sure 
-00012370: 696e 7465 726e 616c 6c79 206d 6170 7320  internally maps 
-00012380: 6172 6520 616c 7761 7973 204e 6f72 7468  are always North
-00012390: 202d 3e20 536f 7574 6820 6f72 6965 6e74   -> South orient
-000123a0: 6564 0a20 2020 2020 2020 2020 2020 2069  ed.            i
-000123b0: 6620 6473 2e72 6173 7465 722e 7265 735b  f ds.raster.res[
-000123c0: 315d 203e 2030 3a0a 2020 2020 2020 2020  1] > 0:.        
-000123d0: 2020 2020 2020 2020 6473 203d 2064 732e          ds = ds.
-000123e0: 7261 7374 6572 2e66 6c69 7075 6428 290a  raster.flipud().
-000123f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012400: 2e73 6574 5f73 7461 7469 636d 6170 7328  .set_staticmaps(
-00012410: 6473 290a 2020 2020 2020 2020 656c 6966  ds).        elif
-00012420: 206c 656e 2867 6c6f 622e 676c 6f62 286a   len(glob.glob(j
-00012430: 6f69 6e28 7365 6c66 2e72 6f6f 742c 2022  oin(self.root, "
-00012440: 7374 6174 6963 6d61 7073 222c 2022 2a2e  staticmaps", "*.
-00012450: 6d61 7022 2929 2920 3e20 303a 0a20 2020  map"))) > 0:.   
-00012460: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-00012470: 6164 5f73 7461 7469 636d 6170 735f 7063  ad_staticmaps_pc
-00012480: 7228 290a 0a20 2020 2064 6566 2077 7269  r()..    def wri
-00012490: 7465 5f73 7461 7469 636d 6170 7328 7365  te_staticmaps(se
-000124a0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-000124b0: 5772 6974 6520 7374 6174 6963 6d61 7073  Write staticmaps
-000124c0: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-000124d0: 6f74 2073 656c 662e 5f77 7269 7465 3a0a  ot self._write:.
-000124e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000124f0: 6520 494f 4572 726f 7228 224d 6f64 656c  e IOError("Model
-00012500: 206f 7065 6e65 6420 696e 2072 6561 642d   opened in read-
-00012510: 6f6e 6c79 206d 6f64 6522 290a 2020 2020  only mode").    
-00012520: 2020 2020 2320 636c 6561 6e2d 7570 2073      # clean-up s
-00012530: 7461 7469 636d 6170 7320 616e 6420 7772  taticmaps and wr
-00012540: 6974 6520 4352 5320 6163 636f 7264 696e  ite CRS accordin
-00012550: 6720 746f 2043 462d 636f 6e76 656e 7469  g to CF-conventi
-00012560: 6f6e 730a 2020 2020 2020 2020 2320 544f  ons.        # TO
-00012570: 444f 2072 6570 6c61 6365 206c 6174 6572  DO replace later
-00012580: 2077 6974 6820 6879 6472 6f6d 742e 7261   with hydromt.ra
-00012590: 7374 6572 2e67 6461 6c5f 636f 6d70 6c69  ster.gdal_compli
-000125a0: 616e 7420 6d65 7468 6f64 2061 6674 6572  ant method after
-000125b0: 2063 6f72 6520 7265 6c65 6173 650a 2020   core release.  
-000125c0: 2020 2020 2020 6372 7320 3d20 7365 6c66        crs = self
-000125d0: 2e73 7461 7469 636d 6170 732e 7261 7374  .staticmaps.rast
-000125e0: 6572 2e63 7273 0a20 2020 2020 2020 2064  er.crs.        d
-000125f0: 735f 6f75 7420 3d20 7365 6c66 2e73 7461  s_out = self.sta
-00012600: 7469 636d 6170 732e 7265 7365 745f 636f  ticmaps.reset_co
-00012610: 6f72 6473 2829 0a20 2020 2020 2020 2023  ords().        #
-00012620: 2054 4f44 4f3f 210a 2020 2020 2020 2020   TODO?!.        
-00012630: 2320 6966 2064 735f 6f75 742e 7261 7374  # if ds_out.rast
-00012640: 6572 2e72 6573 5b31 5d20 3c20 303a 2023  er.res[1] < 0: #
-00012650: 2077 7269 7465 2064 6174 6120 7769 7468   write data with
-00012660: 2053 6f75 7468 202d 3e20 4e6f 7274 6820   South -> North 
-00012670: 6f72 6965 6e74 6174 696f 6e0a 2020 2020  orientation.    
-00012680: 2020 2020 2320 2020 2020 6473 5f6f 7574      #     ds_out
-00012690: 203d 2064 735f 6f75 742e 7261 7374 6572   = ds_out.raster
-000126a0: 2e66 6c69 7075 6428 290a 2020 2020 2020  .flipud().      
-000126b0: 2020 785f 6469 6d2c 2079 5f64 696d 2c20    x_dim, y_dim, 
-000126c0: 785f 6174 7472 732c 2079 5f61 7474 7273  x_attrs, y_attrs
-000126d0: 203d 2068 7964 726f 6d74 2e67 6973 5f75   = hydromt.gis_u
-000126e0: 7469 6c73 2e61 7865 735f 6174 7472 7328  tils.axes_attrs(
-000126f0: 6372 7329 0a20 2020 2020 2020 2064 735f  crs).        ds_
-00012700: 6f75 7420 3d20 6473 5f6f 7574 2e72 656e  out = ds_out.ren
-00012710: 616d 6528 7b64 735f 6f75 742e 7261 7374  ame({ds_out.rast
-00012720: 6572 2e78 5f64 696d 3a20 785f 6469 6d2c  er.x_dim: x_dim,
-00012730: 2064 735f 6f75 742e 7261 7374 6572 2e79   ds_out.raster.y
-00012740: 5f64 696d 3a20 795f 6469 6d7d 290a 2020  _dim: y_dim}).  
-00012750: 2020 2020 2020 6473 5f6f 7574 5b78 5f64        ds_out[x_d
-00012760: 696d 5d2e 6174 7472 732e 7570 6461 7465  im].attrs.update
-00012770: 2878 5f61 7474 7273 290a 2020 2020 2020  (x_attrs).      
-00012780: 2020 6473 5f6f 7574 5b79 5f64 696d 5d2e    ds_out[y_dim].
-00012790: 6174 7472 732e 7570 6461 7465 2879 5f61  attrs.update(y_a
-000127a0: 7474 7273 290a 2020 2020 2020 2020 6473  ttrs).        ds
-000127b0: 5f6f 7574 203d 2064 735f 6f75 742e 6472  _out = ds_out.dr
-000127c0: 6f70 5f76 6172 7328 5b22 6d61 736b 222c  op_vars(["mask",
-000127d0: 2022 7370 6174 6961 6c5f 7265 6622 2c20   "spatial_ref", 
-000127e0: 226c 7322 5d2c 2065 7272 6f72 733d 2269  "ls"], errors="i
-000127f0: 676e 6f72 6522 290a 2020 2020 2020 2020  gnore").        
-00012800: 6473 5f6f 7574 2e72 696f 2e77 7269 7465  ds_out.rio.write
-00012810: 5f63 7273 2863 7273 2c20 696e 706c 6163  _crs(crs, inplac
-00012820: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00012830: 6473 5f6f 7574 2e72 696f 2e77 7269 7465  ds_out.rio.write
-00012840: 5f74 7261 6e73 666f 726d 2873 656c 662e  _transform(self.
-00012850: 7374 6174 6963 6d61 7073 2e72 6173 7465  staticmaps.raste
-00012860: 722e 7472 616e 7366 6f72 6d2c 2069 6e70  r.transform, inp
-00012870: 6c61 6365 3d54 7275 6529 0a20 2020 2020  lace=True).     
-00012880: 2020 2064 735f 6f75 742e 7261 7374 6572     ds_out.raster
-00012890: 2e73 6574 5f73 7061 7469 616c 5f64 696d  .set_spatial_dim
-000128a0: 7328 290a 0a20 2020 2020 2020 2023 2066  s()..        # f
-000128b0: 696c 656e 616d 650a 2020 2020 2020 2020  ilename.        
-000128c0: 666e 5f64 6566 6175 6c74 203d 206a 6f69  fn_default = joi
-000128d0: 6e28 7365 6c66 2e72 6f6f 742c 2022 7374  n(self.root, "st
-000128e0: 6174 6963 6d61 7073 2e6e 6322 290a 2020  aticmaps.nc").  
-000128f0: 2020 2020 2020 666e 203d 2073 656c 662e        fn = self.
-00012900: 6765 745f 636f 6e66 6967 2822 696e 7075  get_config("inpu
-00012910: 742e 7061 7468 5f73 7461 7469 6322 2c20  t.path_static", 
-00012920: 6162 735f 7061 7468 3d54 7275 652c 2066  abs_path=True, f
-00012930: 616c 6c62 6163 6b3d 666e 5f64 6566 6175  allback=fn_defau
-00012940: 6c74 290a 2020 2020 2020 2020 2320 4368  lt).        # Ch
-00012950: 6563 6b20 6966 2061 6c6c 2073 7562 2d66  eck if all sub-f
-00012960: 6f6c 6465 7273 2069 6e20 666e 2065 7869  olders in fn exi
-00012970: 7374 7320 616e 6420 6966 206e 6f74 2063  sts and if not c
-00012980: 7265 6174 6520 7468 656d 0a20 2020 2020  reate them.     
-00012990: 2020 2069 6620 6e6f 7420 6973 6469 7228     if not isdir(
-000129a0: 6469 726e 616d 6528 666e 2929 3a0a 2020  dirname(fn)):.  
-000129b0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
-000129c0: 6564 6972 7328 6469 726e 616d 6528 666e  edirs(dirname(fn
-000129d0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-000129e0: 6c6f 6767 6572 2e69 6e66 6f28 6622 5772  logger.info(f"Wr
-000129f0: 6974 6520 7374 6174 6963 6d61 7073 2074  ite staticmaps t
-00012a00: 6f20 7b66 6e7d 2229 0a20 2020 2020 2020  o {fn}").       
-00012a10: 206d 6173 6b20 3d20 6473 5f6f 7574 5b73   mask = ds_out[s
-00012a20: 656c 662e 5f4d 4150 535b 2262 6173 696e  elf._MAPS["basin
-00012a30: 7322 5d5d 203e 2030 0a20 2020 2020 2020  s"]] > 0.       
-00012a40: 2066 6f72 2076 2069 6e20 6473 5f6f 7574   for v in ds_out
-00012a50: 2e64 6174 615f 7661 7273 3a0a 2020 2020  .data_vars:.    
-00012a60: 2020 2020 2020 2020 2320 6e6f 6461 7461          # nodata
-00012a70: 2069 7320 7265 7175 6972 6564 2066 6f72   is required for
-00012a80: 2061 6c6c 2062 7574 2062 6f6f 6c65 616e   all but boolean
-00012a90: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
-00012aa0: 2020 2020 6966 2064 735f 6f75 745b 765d      if ds_out[v]
-00012ab0: 2e64 7479 7065 2021 3d20 2262 6f6f 6c22  .dtype != "bool"
-00012ac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012ad0: 2020 6473 5f6f 7574 5b76 5d20 3d20 6473    ds_out[v] = ds
-00012ae0: 5f6f 7574 5b76 5d2e 7768 6572 6528 6d61  _out[v].where(ma
-00012af0: 736b 2c20 6473 5f6f 7574 5b76 5d2e 7261  sk, ds_out[v].ra
-00012b00: 7374 6572 2e6e 6f64 6174 6129 0a20 2020  ster.nodata).   
-00012b10: 2020 2020 2064 735f 6f75 742e 746f 5f6e       ds_out.to_n
-00012b20: 6574 6364 6628 666e 290a 2020 2020 2020  etcdf(fn).      
-00012b30: 2020 2320 7365 6c66 2e77 7269 7465 5f73    # self.write_s
-00012b40: 7461 7469 636d 6170 735f 7063 7228 290a  taticmaps_pcr().
-00012b50: 0a20 2020 2064 6566 2072 6561 645f 7374  .    def read_st
-00012b60: 6174 6963 6d61 7073 5f70 6372 2873 656c  aticmaps_pcr(sel
-00012b70: 662c 2063 7273 3d34 3332 362c 202a 2a6b  f, crs=4326, **k
-00012b80: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00012b90: 2222 2252 6561 6420 616e 6420 7374 6174  """Read and stat
-00012ba0: 6963 6d61 7073 2061 7420 3c72 6f6f 742f  icmaps at <root/
-00012bb0: 7374 6174 6963 6d61 7073 3e20 616e 6420  staticmaps> and 
-00012bc0: 7061 7273 6520 746f 2078 6172 7261 7922  parse to xarray"
-00012bd0: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-00012be0: 6c66 2e5f 7265 6164 2061 6e64 2022 6368  lf._read and "ch
-00012bf0: 756e 6b73 2220 6e6f 7420 696e 206b 7761  unks" not in kwa
-00012c00: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00012c10: 206b 7761 7267 732e 7570 6461 7465 2863   kwargs.update(c
-00012c20: 6875 6e6b 733d 7b22 7922 3a20 2d31 2c20  hunks={"y": -1, 
-00012c30: 2278 223a 202d 317d 290a 2020 2020 2020  "x": -1}).      
-00012c40: 2020 666e 203d 206a 6f69 6e28 7365 6c66    fn = join(self
-00012c50: 2e72 6f6f 742c 2022 7374 6174 6963 6d61  .root, "staticma
-00012c60: 7073 222c 2066 222a 2e6d 6170 2229 0a20  ps", f"*.map"). 
-00012c70: 2020 2020 2020 2066 6e73 203d 2067 6c6f         fns = glo
-00012c80: 622e 676c 6f62 2866 6e29 0a20 2020 2020  b.glob(fn).     
-00012c90: 2020 2069 6620 6c65 6e28 666e 7329 203d     if len(fns) =
-00012ca0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00012cb0: 2073 656c 662e 6c6f 6767 6572 2e77 6172   self.logger.war
-00012cc0: 6e69 6e67 2866 224e 6f20 7374 6174 6963  ning(f"No static
-00012cd0: 6d61 7073 2066 6f75 6e64 2061 7420 7b66  maps found at {f
-00012ce0: 6e7d 2229 0a20 2020 2020 2020 2020 2020  n}").           
-00012cf0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-00012d00: 7365 6c66 2e5f 7374 6174 6963 6d61 7073  self._staticmaps
-00012d10: 203d 206f 7065 6e5f 6d66 7261 7374 6572   = open_mfraster
-00012d20: 2866 6e73 2c20 2a2a 6b77 6172 6773 290a  (fns, **kwargs).
-00012d30: 2020 2020 2020 2020 7061 7468 203d 206a          path = j
-00012d40: 6f69 6e28 7365 6c66 2e72 6f6f 742c 2022  oin(self.root, "
-00012d50: 7374 6174 6963 6d61 7073 222c 2022 636c  staticmaps", "cl
-00012d60: 696d 222c 2066 224c 4149 2a22 290a 2020  im", f"LAI*").  
-00012d70: 2020 2020 2020 6966 206c 656e 2867 6c6f        if len(glo
-00012d80: 622e 676c 6f62 2870 6174 6829 2920 3e20  b.glob(path)) > 
-00012d90: 303a 0a20 2020 2020 2020 2020 2020 2064  0:.            d
-00012da0: 615f 6c61 6920 3d20 6f70 656e 5f6d 6672  a_lai = open_mfr
-00012db0: 6173 7465 7228 0a20 2020 2020 2020 2020  aster(.         
-00012dc0: 2020 2020 2020 2070 6174 682c 2063 6f6e         path, con
-00012dd0: 6361 743d 5472 7565 2c20 636f 6e63 6174  cat=True, concat
-00012de0: 5f64 696d 3d22 7469 6d65 222c 206c 6f67  _dim="time", log
-00012df0: 6765 723d 7365 6c66 2e6c 6f67 6765 722c  ger=self.logger,
-00012e00: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
-00012e10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00012e20: 2020 2020 7365 6c66 2e73 6574 5f73 7461      self.set_sta
-00012e30: 7469 636d 6170 7328 6461 5f6c 6169 2c20  ticmaps(da_lai, 
-00012e40: 224c 4149 2229 0a0a 2020 2020 2020 2020  "LAI")..        
-00012e50: 2320 7265 6f72 6761 6e69 7a65 2063 5f30  # reorganize c_0
-00012e60: 2065 7463 206d 6170 730a 2020 2020 2020   etc maps.      
-00012e70: 2020 6461 5f63 203d 205b 5d0a 2020 2020    da_c = [].    
-00012e80: 2020 2020 6c69 7374 5f63 203d 205b 7620      list_c = [v 
-00012e90: 666f 7220 7620 696e 2073 656c 662e 5f73  for v in self._s
-00012ea0: 7461 7469 636d 6170 7320 6966 2073 7472  taticmaps if str
-00012eb0: 2876 292e 7374 6172 7473 7769 7468 2822  (v).startswith("
-00012ec0: 635f 2229 5d0a 2020 2020 2020 2020 6966  c_")].        if
-00012ed0: 206c 656e 286c 6973 745f 6329 203e 2030   len(list_c) > 0
-00012ee0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00012ef0: 7220 692c 2076 2069 6e20 656e 756d 6572  r i, v in enumer
-00012f00: 6174 6528 6c69 7374 5f63 293a 0a20 2020  ate(list_c):.   
-00012f10: 2020 2020 2020 2020 2020 2020 2064 615f               da_
-00012f20: 632e 6170 7065 6e64 2873 656c 662e 5f73  c.append(self._s
-00012f30: 7461 7469 636d 6170 735b 6622 635f 7b69  taticmaps[f"c_{i
-00012f40: 3a64 7d22 5d29 0a20 2020 2020 2020 2020  :d}"]).         
-00012f50: 2020 2064 6120 3d20 7872 2e63 6f6e 6361     da = xr.conca
-00012f60: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00012f70: 2020 2064 615f 632c 2070 642e 496e 6465     da_c, pd.Inde
-00012f80: 7828 6e70 2e61 7261 6e67 6528 6c65 6e28  x(np.arange(len(
-00012f90: 6c69 7374 5f63 292c 2064 7479 7065 3d69  list_c), dtype=i
-00012fa0: 6e74 292c 206e 616d 653d 226c 6179 6572  nt), name="layer
-00012fb0: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-00012fc0: 2e74 7261 6e73 706f 7365 2822 6c61 7965  .transpose("laye
-00012fd0: 7222 2c20 2e2e 2e29 0a20 2020 2020 2020  r", ...).       
-00012fe0: 2020 2020 2073 656c 662e 7365 745f 7374       self.set_st
-00012ff0: 6174 6963 6d61 7073 2864 612c 2022 6322  aticmaps(da, "c"
-00013000: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-00013010: 6c66 2e63 7273 2069 7320 4e6f 6e65 3a0a  lf.crs is None:.
-00013020: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00013030: 7273 2069 7320 4e6f 6e65 3a0a 2020 2020  rs is None:.    
-00013040: 2020 2020 2020 2020 2020 2020 6372 7320              crs 
-00013050: 3d20 3433 3236 2020 2320 6465 6661 756c  = 4326  # defaul
-00013060: 7420 746f 2034 3332 360a 2020 2020 2020  t to 4326.      
-00013070: 2020 2020 2020 7365 6c66 2e73 6574 5f63        self.set_c
-00013080: 7273 2863 7273 290a 0a20 2020 2064 6566  rs(crs)..    def
-00013090: 2077 7269 7465 5f73 7461 7469 636d 6170   write_staticmap
-000130a0: 735f 7063 7228 7365 6c66 293a 0a20 2020  s_pcr(self):.   
-000130b0: 2020 2020 2022 2222 5772 6974 6520 7374       """Write st
-000130c0: 6174 6963 6d61 7073 2061 7420 3c72 6f6f  aticmaps at <roo
-000130d0: 742f 7374 6174 6963 6d61 7073 3e20 696e  t/staticmaps> in
-000130e0: 2050 4352 6173 7465 7220 6d61 7073 2066   PCRaster maps f
-000130f0: 6f72 6d61 742e 2222 220a 2020 2020 2020  ormat.""".      
-00013100: 2020 6966 206e 6f74 2073 656c 662e 5f77    if not self._w
-00013110: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
-00013120: 2020 7261 6973 6520 494f 4572 726f 7228    raise IOError(
-00013130: 224d 6f64 656c 206f 7065 6e65 6420 696e  "Model opened in
-00013140: 2072 6561 642d 6f6e 6c79 206d 6f64 6522   read-only mode"
-00013150: 290a 2020 2020 2020 2020 6473 5f6f 7574  ).        ds_out
-00013160: 203d 2073 656c 662e 7374 6174 6963 6d61   = self.staticma
-00013170: 7073 0a20 2020 2020 2020 2069 6620 224c  ps.        if "L
-00013180: 4149 2220 696e 2064 735f 6f75 742e 6461  AI" in ds_out.da
-00013190: 7461 5f76 6172 733a 0a20 2020 2020 2020  ta_vars:.       
-000131a0: 2020 2020 2064 735f 6f75 7420 3d20 6473       ds_out = ds
-000131b0: 5f6f 7574 2e72 656e 616d 655f 7661 7273  _out.rename_vars
-000131c0: 287b 224c 4149 223a 2022 636c 696d 2f4c  ({"LAI": "clim/L
-000131d0: 4149 227d 290a 2020 2020 2020 2020 6966  AI"}).        if
-000131e0: 2022 6322 2069 6e20 6473 5f6f 7574 2e64   "c" in ds_out.d
-000131f0: 6174 615f 7661 7273 3a0a 2020 2020 2020  ata_vars:.      
-00013200: 2020 2020 2020 666f 7220 6c61 7965 7220        for layer 
-00013210: 696e 2064 735f 6f75 745b 226c 6179 6572  in ds_out["layer
-00013220: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00013230: 2020 2020 6473 5f6f 7574 5b66 2263 5f7b      ds_out[f"c_{
-00013240: 6c61 7965 722e 6974 656d 2829 3a64 7d22  layer.item():d}"
-00013250: 5d20 3d20 6473 5f6f 7574 5b22 6322 5d2e  ] = ds_out["c"].
-00013260: 7365 6c28 6c61 7965 723d 6c61 7965 7229  sel(layer=layer)
-00013270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013280: 2064 735f 6f75 745b 6622 635f 7b6c 6179   ds_out[f"c_{lay
-00013290: 6572 2e69 7465 6d28 293a 647d 225d 2e72  er.item():d}"].r
-000132a0: 6173 7465 722e 7365 745f 6e6f 6461 7461  aster.set_nodata
-000132b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000132c0: 2020 2020 2020 6473 5f6f 7574 5b22 6322        ds_out["c"
-000132d0: 5d2e 7261 7374 6572 2e6e 6f64 6174 610a  ].raster.nodata.
-000132e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132f0: 290a 2020 2020 2020 2020 2020 2020 6473  ).            ds
-00013300: 5f6f 7574 203d 2064 735f 6f75 742e 6472  _out = ds_out.dr
-00013310: 6f70 5f76 6172 7328 5b22 6322 2c20 226c  op_vars(["c", "l
-00013320: 6179 6572 225d 290a 2020 2020 2020 2020  ayer"]).        
-00013330: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
-00013340: 2822 5772 6974 696e 6720 2875 7064 6174  ("Writing (updat
-00013350: 6564 2920 7374 6174 6963 6d61 7020 6669  ed) staticmap fi
-00013360: 6c65 732e 2229 0a20 2020 2020 2020 2023  les.").        #
-00013370: 2061 6464 2064 6174 6174 7970 6573 2066   add datatypes f
-00013380: 6f72 206d 6170 7320 7769 7468 2073 616d  or maps with sam
-00013390: 6520 6261 7365 6e61 6d65 732c 2065 2e67  e basenames, e.g
-000133a0: 2e20 7766 6c6f 775f 6761 7567 6573 5f67  . wflow_gauges_g
-000133b0: 7264 630a 2020 2020 2020 2020 7063 725f  rdc.        pcr_
-000133c0: 7673 5f6d 6170 203d 2050 4352 5f56 535f  vs_map = PCR_VS_
-000133d0: 4d41 502e 636f 7079 2829 0a20 2020 2020  MAP.copy().     
-000133e0: 2020 2066 6f72 2076 6172 5f6e 616d 6520     for var_name 
-000133f0: 696e 2064 735f 6f75 742e 7261 7374 6572  in ds_out.raster
-00013400: 2e76 6172 733a 0a20 2020 2020 2020 2020  .vars:.         
-00013410: 2020 2062 6173 655f 6e61 6d65 203d 2022     base_name = "
-00013420: 5f22 2e6a 6f69 6e28 7661 725f 6e61 6d65  _".join(var_name
-00013430: 2e73 706c 6974 2822 5f22 295b 3a2d 315d  .split("_")[:-1]
-00013440: 2920 2023 2063 6c69 7020 5f3c 706f 7374  )  # clip _<post
-00013450: 6669 783e 0a20 2020 2020 2020 2020 2020  fix>.           
-00013460: 2069 6620 6261 7365 5f6e 616d 6520 696e   if base_name in
-00013470: 2050 4352 5f56 535f 4d41 503a 0a20 2020   PCR_VS_MAP:.   
-00013480: 2020 2020 2020 2020 2020 2020 2070 6372               pcr
-00013490: 5f76 735f 6d61 702e 7570 6461 7465 287b  _vs_map.update({
-000134a0: 7661 725f 6e61 6d65 3a20 5043 525f 5653  var_name: PCR_VS
-000134b0: 5f4d 4150 5b62 6173 655f 6e61 6d65 5d7d  _MAP[base_name]}
-000134c0: 290a 2020 2020 2020 2020 6473 5f6f 7574  ).        ds_out
-000134d0: 2e72 6173 7465 722e 746f 5f6d 6170 7374  .raster.to_mapst
-000134e0: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
-000134f0: 2072 6f6f 743d 6a6f 696e 2873 656c 662e   root=join(self.
-00013500: 726f 6f74 2c20 2273 7461 7469 636d 6170  root, "staticmap
-00013510: 7322 292c 0a20 2020 2020 2020 2020 2020  s"),.           
-00013520: 206d 6173 6b3d 5472 7565 2c0a 2020 2020   mask=True,.    
-00013530: 2020 2020 2020 2020 6472 6976 6572 3d22          driver="
-00013540: 5043 5261 7374 6572 222c 0a20 2020 2020  PCRaster",.     
-00013550: 2020 2020 2020 2070 6372 5f76 735f 6d61         pcr_vs_ma
-00013560: 703d 7063 725f 7673 5f6d 6170 2c0a 2020  p=pcr_vs_map,.  
-00013570: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00013580: 3d73 656c 662e 6c6f 6767 6572 2c0a 2020  =self.logger,.  
-00013590: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-000135a0: 2072 6561 645f 7374 6174 6963 6765 6f6d   read_staticgeom
-000135b0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-000135c0: 2022 2222 5265 6164 2061 6e64 2073 7461   """Read and sta
-000135d0: 7469 6367 656f 6d73 2061 7420 3c72 6f6f  ticgeoms at <roo
-000135e0: 742f 7374 6174 6963 6765 6f6d 733e 2061  t/staticgeoms> a
-000135f0: 6e64 2070 6172 7365 2074 6f20 6765 6f70  nd parse to geop
-00013600: 616e 6461 7322 2222 0a20 2020 2020 2020  andas""".       
-00013610: 2069 6620 6e6f 7420 7365 6c66 2e5f 7772   if not self._wr
-00013620: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
-00013630: 2073 656c 662e 5f73 7461 7469 6367 656f   self._staticgeo
-00013640: 6d73 203d 2064 6963 7428 2920 2023 2066  ms = dict()  # f
-00013650: 7265 7368 2073 7461 7274 2069 6e20 7265  resh start in re
-00013660: 6164 2d6f 6e6c 7920 6d6f 6465 0a20 2020  ad-only mode.   
-00013670: 2020 2020 2064 6972 5f64 6566 6175 6c74       dir_default
-00013680: 203d 206a 6f69 6e28 7365 6c66 2e72 6f6f   = join(self.roo
-00013690: 742c 2022 7374 6174 6963 6d61 7073 2e6e  t, "staticmaps.n
-000136a0: 6322 290a 2020 2020 2020 2020 6469 725f  c").        dir_
-000136b0: 6d6f 6420 3d20 6469 726e 616d 6528 0a20  mod = dirname(. 
-000136c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000136d0: 6765 745f 636f 6e66 6967 2822 696e 7075  get_config("inpu
-000136e0: 742e 7061 7468 5f73 7461 7469 6322 2c20  t.path_static", 
-000136f0: 6162 735f 7061 7468 3d54 7275 652c 2066  abs_path=True, f
-00013700: 616c 6c62 6163 6b3d 6469 725f 6465 6661  allback=dir_defa
-00013710: 756c 7429 0a20 2020 2020 2020 2029 0a20  ult).        ). 
-00013720: 2020 2020 2020 2066 6e73 203d 2067 6c6f         fns = glo
-00013730: 622e 676c 6f62 286a 6f69 6e28 6469 725f  b.glob(join(dir_
-00013740: 6d6f 642c 2022 7374 6174 6963 6765 6f6d  mod, "staticgeom
-00013750: 7322 2c20 222a 2e67 656f 6a73 6f6e 2229  s", "*.geojson")
-00013760: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00013770: 2866 6e73 2920 3e20 313a 0a20 2020 2020  (fns) > 1:.     
-00013780: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-00013790: 6572 2e69 6e66 6f28 2252 6561 6469 6e67  er.info("Reading
-000137a0: 206d 6f64 656c 2073 7461 7469 6367 656f   model staticgeo
-000137b0: 6d20 6669 6c65 732e 2229 0a20 2020 2020  m files.").     
-000137c0: 2020 2066 6f72 2066 6e20 696e 2066 6e73     for fn in fns
-000137d0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
-000137e0: 6d65 203d 2062 6173 656e 616d 6528 666e  me = basename(fn
-000137f0: 292e 7370 6c69 7428 222e 2229 5b30 5d0a  ).split(".")[0].
-00013800: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00013810: 616d 6520 213d 2022 7265 6769 6f6e 223a  ame != "region":
-00013820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013830: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
-00013840: 6765 6f6d 7328 6770 642e 7265 6164 5f66  geoms(gpd.read_f
-00013850: 696c 6528 666e 292c 206e 616d 653d 6e61  ile(fn), name=na
-00013860: 6d65 290a 0a20 2020 2064 6566 2077 7269  me)..    def wri
-00013870: 7465 5f73 7461 7469 6367 656f 6d73 2873  te_staticgeoms(s
-00013880: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00013890: 2257 7269 7465 2073 7461 7469 636d 6170  "Write staticmap
-000138a0: 7320 6174 203c 726f 6f74 2f73 7461 7469  s at <root/stati
-000138b0: 6367 656f 6d73 3e20 696e 206d 6f64 656c  cgeoms> in model
-000138c0: 2072 6561 6479 2066 6f72 6d61 7422 2222   ready format"""
-000138d0: 0a20 2020 2020 2020 2023 2074 6f20 7772  .        # to wr
-000138e0: 6974 6520 7573 6520 7365 6c66 2e73 7461  ite use self.sta
-000138f0: 7469 6367 656f 6d73 5b76 6172 5d2e 746f  ticgeoms[var].to
-00013900: 5f66 696c 6528 290a 2020 2020 2020 2020  _file().        
-00013910: 6966 206e 6f74 2073 656c 662e 5f77 7269  if not self._wri
-00013920: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-00013930: 7261 6973 6520 494f 4572 726f 7228 224d  raise IOError("M
-00013940: 6f64 656c 206f 7065 6e65 6420 696e 2072  odel opened in r
-00013950: 6561 642d 6f6e 6c79 206d 6f64 6522 290a  ead-only mode").
-00013960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00013970: 7374 6174 6963 6765 6f6d 733a 0a20 2020  staticgeoms:.   
-00013980: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00013990: 6767 6572 2e69 6e66 6f28 2257 7269 7469  gger.info("Writi
-000139a0: 6e67 206d 6f64 656c 2073 7461 7469 6367  ng model staticg
-000139b0: 656f 6d20 746f 2066 696c 652e 2229 0a20  eom to file."). 
-000139c0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-000139d0: 616d 652c 2067 6466 2069 6e20 7365 6c66  ame, gdf in self
-000139e0: 2e73 7461 7469 6367 656f 6d73 2e69 7465  .staticgeoms.ite
-000139f0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00013a00: 2020 2020 2020 666e 5f6f 7574 203d 206a        fn_out = j
-00013a10: 6f69 6e28 7365 6c66 2e72 6f6f 742c 2022  oin(self.root, "
-00013a20: 7374 6174 6963 6765 6f6d 7322 2c20 6622  staticgeoms", f"
-00013a30: 7b6e 616d 657d 2e67 656f 6a73 6f6e 2229  {name}.geojson")
+00000090: 6469 720a 6672 6f6d 2070 6174 686c 6962  dir.from pathlib
+000000a0: 2069 6d70 6f72 7420 5061 7468 0a66 726f   import Path.fro
+000000b0: 6d20 7479 7069 6e67 2069 6d70 6f72 7420  m typing import 
+000000c0: 556e 696f 6e2c 204f 7074 696f 6e61 6c2c  Union, Optional,
+000000d0: 204c 6973 740a 696d 706f 7274 2067 6c6f   List.import glo
+000000e0: 620a 696d 706f 7274 206e 756d 7079 2061  b.import numpy a
+000000f0: 7320 6e70 0a69 6d70 6f72 7420 7061 6e64  s np.import pand
+00000100: 6173 2061 7320 7064 0a69 6d70 6f72 7420  as as pd.import 
+00000110: 6765 6f70 616e 6461 7320 6173 2067 7064  geopandas as gpd
+00000120: 0a69 6d70 6f72 7420 7861 7272 6179 2061  .import xarray a
+00000130: 7320 7872 0a66 726f 6d20 7368 6170 656c  s xr.from shapel
+00000140: 792e 6765 6f6d 6574 7279 2069 6d70 6f72  y.geometry impor
+00000150: 7420 626f 780a 696d 706f 7274 2070 7970  t box.import pyp
+00000160: 726f 6a0a 696d 706f 7274 2074 6f6d 6c0a  roj.import toml.
+00000170: 696d 706f 7274 2063 6f64 6563 730a 696d  import codecs.im
+00000180: 706f 7274 2070 7966 6c77 6469 720a 6672  port pyflwdir.fr
+00000190: 6f6d 2070 7966 6c77 6469 7220 696d 706f  om pyflwdir impo
+000001a0: 7274 2063 6f72 655f 6438 2c20 636f 7265  rt core_d8, core
+000001b0: 5f6c 6464 2c20 636f 7265 5f63 6f6e 7665  _ldd, core_conve
+000001c0: 7273 696f 6e0a 6672 6f6d 2064 6173 6b2e  rsion.from dask.
+000001d0: 6469 6167 6e6f 7374 6963 7320 696d 706f  diagnostics impo
+000001e0: 7274 2050 726f 6772 6573 7342 6172 0a69  rt ProgressBar.i
+000001f0: 6d70 6f72 7420 6c6f 6767 696e 670a 696d  mport logging.im
+00000200: 706f 7274 2072 696f 7861 7272 6179 2020  port rioxarray  
+00000210: 2320 7265 7175 6972 6564 2066 6f72 2072  # required for r
+00000220: 696f 2061 6363 6573 736f 720a 0a23 2066  io accessor..# f
+00000230: 726f 6d20 6461 736b 2e64 6973 7472 6962  rom dask.distrib
+00000240: 7574 6564 2069 6d70 6f72 7420 4c6f 6361  uted import Loca
+00000250: 6c43 6c75 7374 6572 2c20 436c 6965 6e74  lCluster, Client
+00000260: 2c20 7065 7266 6f72 6d61 6e63 655f 7265  , performance_re
+00000270: 706f 7274 0a69 6d70 6f72 7420 6879 6472  port.import hydr
+00000280: 6f6d 740a 6672 6f6d 2068 7964 726f 6d74  omt.from hydromt
+00000290: 2e6d 6f64 656c 732e 6d6f 6465 6c5f 6170  .models.model_ap
+000002a0: 6920 696d 706f 7274 204d 6f64 656c 0a66  i import Model.f
+000002b0: 726f 6d20 6879 6472 6f6d 7420 696d 706f  rom hydromt impo
+000002c0: 7274 2066 6c77 0a66 726f 6d20 6879 6472  rt flw.from hydr
+000002d0: 6f6d 742e 696f 2069 6d70 6f72 7420 6f70  omt.io import op
+000002e0: 656e 5f6d 6672 6173 7465 720a 0a66 726f  en_mfraster..fro
+000002f0: 6d20 2e20 696d 706f 7274 2075 7469 6c73  m . import utils
+00000300: 2c20 776f 726b 666c 6f77 732c 2044 4154  , workflows, DAT
+00000310: 4144 4952 0a0a 0a5f 5f61 6c6c 5f5f 203d  ADIR...__all__ =
+00000320: 205b 2257 666c 6f77 4d6f 6465 6c22 5d0a   ["WflowModel"].
+00000330: 0a6c 6f67 6765 7220 3d20 6c6f 6767 696e  .logger = loggin
+00000340: 672e 6765 744c 6f67 6765 7228 5f5f 6e61  g.getLogger(__na
+00000350: 6d65 5f5f 290a 0a23 2073 7065 6369 6679  me__)..# specify
+00000360: 2070 6372 6173 7465 7220 6d61 7020 7479   pcraster map ty
+00000370: 7065 730a 2320 4e4f 5445 206e 6f6e 2073  pes.# NOTE non s
+00000380: 6361 6c61 7220 2866 6c6f 6174 2920 6461  calar (float) da
+00000390: 7461 2074 7970 6573 206f 6e6c 790a 5043  ta types only.PC
+000003a0: 525f 5653 5f4d 4150 203d 207b 0a20 2020  R_VS_MAP = {.   
+000003b0: 2022 7766 6c6f 775f 6c64 6422 3a20 226c   "wflow_ldd": "l
+000003c0: 6464 222c 0a20 2020 2022 7766 6c6f 775f  dd",.    "wflow_
+000003d0: 7269 7665 7222 3a20 2262 6f6f 6c22 2c0a  river": "bool",.
+000003e0: 2020 2020 2277 666c 6f77 5f73 7472 6561      "wflow_strea
+000003f0: 6d6f 7264 6572 223a 2022 6f72 6469 6e61  morder": "ordina
+00000400: 6c22 2c0a 2020 2020 2277 666c 6f77 5f67  l",.    "wflow_g
+00000410: 6175 6765 7322 3a20 226e 6f6d 696e 616c  auges": "nominal
+00000420: 222c 2020 2320 746f 2061 766f 6964 206c  ",  # to avoid l
+00000430: 6172 6765 206d 656d 6f72 7920 7573 6167  arge memory usag
+00000440: 6520 696e 2070 6372 6173 7465 722e 6167  e in pcraster.ag
+00000450: 7569 6c61 0a20 2020 2022 7766 6c6f 775f  uila.    "wflow_
+00000460: 7375 6263 6174 6368 223a 2022 6e6f 6d69  subcatch": "nomi
+00000470: 6e61 6c22 2c20 2023 2069 6465 6d2e 0a20  nal",  # idem.. 
+00000480: 2020 2022 7766 6c6f 775f 6c61 6e64 7573     "wflow_landus
+00000490: 6522 3a20 226e 6f6d 696e 616c 222c 0a20  e": "nominal",. 
+000004a0: 2020 2022 7766 6c6f 775f 736f 696c 223a     "wflow_soil":
+000004b0: 2022 6e6f 6d69 6e61 6c22 2c0a 2020 2020   "nominal",.    
+000004c0: 2277 666c 6f77 5f72 6573 6572 766f 6972  "wflow_reservoir
+000004d0: 6172 6561 7322 3a20 226e 6f6d 696e 616c  areas": "nominal
+000004e0: 222c 0a20 2020 2022 7766 6c6f 775f 7265  ",.    "wflow_re
+000004f0: 7365 7276 6f69 726c 6f63 7322 3a20 226e  servoirlocs": "n
+00000500: 6f6d 696e 616c 222c 0a20 2020 2022 7766  ominal",.    "wf
+00000510: 6c6f 775f 6c61 6b65 6172 6561 7322 3a20  low_lakeareas": 
+00000520: 226e 6f6d 696e 616c 222c 0a20 2020 2022  "nominal",.    "
+00000530: 7766 6c6f 775f 6c61 6b65 6c6f 6373 223a  wflow_lakelocs":
+00000540: 2022 6e6f 6d69 6e61 6c22 2c0a 2020 2020   "nominal",.    
+00000550: 2277 666c 6f77 5f67 6c61 6369 6572 6172  "wflow_glacierar
+00000560: 6561 7322 3a20 226e 6f6d 696e 616c 222c  eas": "nominal",
+00000570: 0a7d 0a0a 0a63 6c61 7373 2057 666c 6f77  .}...class Wflow
+00000580: 4d6f 6465 6c28 4d6f 6465 6c29 3a0a 2020  Model(Model):.  
+00000590: 2020 2222 2254 6869 7320 6973 2074 6865    """This is the
+000005a0: 2077 666c 6f77 206d 6f64 656c 2063 6c61   wflow model cla
+000005b0: 7373 2222 220a 0a20 2020 205f 4e41 4d45  ss"""..    _NAME
+000005c0: 203d 2022 7766 6c6f 7722 0a20 2020 205f   = "wflow".    _
+000005d0: 434f 4e46 203d 2022 7766 6c6f 775f 7362  CONF = "wflow_sb
+000005e0: 6d2e 746f 6d6c 220a 2020 2020 5f44 4154  m.toml".    _DAT
+000005f0: 4144 4952 203d 2044 4154 4144 4952 0a20  ADIR = DATADIR. 
+00000600: 2020 205f 4745 4f4d 5320 3d20 7b7d 0a20     _GEOMS = {}. 
+00000610: 2020 205f 4d41 5053 203d 207b 0a20 2020     _MAPS = {.   
+00000620: 2020 2020 2022 666c 7764 6972 223a 2022       "flwdir": "
+00000630: 7766 6c6f 775f 6c64 6422 2c0a 2020 2020  wflow_ldd",.    
+00000640: 2020 2020 2265 6c65 7674 6e22 3a20 2277      "elevtn": "w
+00000650: 666c 6f77 5f64 656d 222c 0a20 2020 2020  flow_dem",.     
+00000660: 2020 2022 7375 6265 6c76 223a 2022 6465     "subelv": "de
+00000670: 6d5f 7375 6267 7269 6422 2c0a 2020 2020  m_subgrid",.    
+00000680: 2020 2020 2275 7061 7265 6122 3a20 2277      "uparea": "w
+00000690: 666c 6f77 5f75 7061 7265 6122 2c0a 2020  flow_uparea",.  
+000006a0: 2020 2020 2020 2273 7472 6f72 6422 3a20        "strord": 
+000006b0: 2277 666c 6f77 5f73 7472 6561 6d6f 7264  "wflow_streamord
+000006c0: 6572 222c 0a20 2020 2020 2020 2022 6261  er",.        "ba
+000006d0: 7369 6e73 223a 2022 7766 6c6f 775f 7375  sins": "wflow_su
+000006e0: 6263 6174 6368 222c 0a20 2020 2020 2020  bcatch",.       
+000006f0: 2022 7269 766c 656e 223a 2022 7766 6c6f   "rivlen": "wflo
+00000700: 775f 7269 7665 726c 656e 6774 6822 2c0a  w_riverlength",.
+00000710: 2020 2020 2020 2020 2272 6976 6d73 6b22          "rivmsk"
+00000720: 3a20 2277 666c 6f77 5f72 6976 6572 222c  : "wflow_river",
+00000730: 0a20 2020 2020 2020 2022 7269 7677 7468  .        "rivwth
+00000740: 223a 2022 7766 6c6f 775f 7269 7665 7277  ": "wflow_riverw
+00000750: 6964 7468 222c 0a20 2020 2020 2020 2022  idth",.        "
+00000760: 6c6e 6473 6c70 223a 2022 536c 6f70 6522  lndslp": "Slope"
+00000770: 2c0a 2020 2020 2020 2020 2272 6976 736c  ,.        "rivsl
+00000780: 7022 3a20 2252 6976 6572 536c 6f70 6522  p": "RiverSlope"
+00000790: 2c0a 2020 2020 2020 2020 2272 6976 6470  ,.        "rivdp
+000007a0: 6822 3a20 2252 6976 6572 4465 7074 6822  h": "RiverDepth"
+000007b0: 2c0a 2020 2020 2020 2020 2272 6976 6d61  ,.        "rivma
+000007c0: 6e22 3a20 224e 5f52 6976 6572 222c 0a20  n": "N_River",. 
+000007d0: 2020 2020 2020 2022 6761 7567 6573 223a         "gauges":
+000007e0: 2022 7766 6c6f 775f 6761 7567 6573 222c   "wflow_gauges",
+000007f0: 0a20 2020 2020 2020 2022 6c61 6e64 7573  .        "landus
+00000800: 6522 3a20 2277 666c 6f77 5f6c 616e 6475  e": "wflow_landu
+00000810: 7365 222c 0a20 2020 2020 2020 2022 7265  se",.        "re
+00000820: 7361 7265 6173 223a 2022 7766 6c6f 775f  sareas": "wflow_
+00000830: 7265 7365 7276 6f69 7261 7265 6173 222c  reservoirareas",
+00000840: 0a20 2020 2020 2020 2022 7265 736c 6f63  .        "resloc
+00000850: 7322 3a20 2277 666c 6f77 5f72 6573 6572  s": "wflow_reser
+00000860: 766f 6972 6c6f 6373 222c 0a20 2020 2020  voirlocs",.     
+00000870: 2020 2022 6c61 6b65 6172 6561 7322 3a20     "lakeareas": 
+00000880: 2277 666c 6f77 5f6c 616b 6561 7265 6173  "wflow_lakeareas
+00000890: 222c 0a20 2020 2020 2020 2022 6c61 6b65  ",.        "lake
+000008a0: 6c6f 6373 223a 2022 7766 6c6f 775f 6c61  locs": "wflow_la
+000008b0: 6b65 6c6f 6373 222c 0a20 2020 2020 2020  kelocs",.       
+000008c0: 2022 676c 6163 6172 6561 7322 3a20 2277   "glacareas": "w
+000008d0: 666c 6f77 5f67 6c61 6369 6572 6172 6561  flow_glacierarea
+000008e0: 7322 2c0a 2020 2020 2020 2020 2267 6c61  s",.        "gla
+000008f0: 6366 7261 6373 223a 2022 7766 6c6f 775f  cfracs": "wflow_
+00000900: 676c 6163 6965 7266 7261 6322 2c0a 2020  glacierfrac",.  
+00000910: 2020 2020 2020 2267 6c61 6373 746f 7265        "glacstore
+00000920: 223a 2022 7766 6c6f 775f 676c 6163 6965  ": "wflow_glacie
+00000930: 7273 746f 7265 222c 0a20 2020 207d 0a20  rstore",.    }. 
+00000940: 2020 205f 464f 4c44 4552 5320 3d20 5b0a     _FOLDERS = [.
+00000950: 2020 2020 2020 2020 2273 7461 7469 6367          "staticg
+00000960: 656f 6d73 222c 0a20 2020 2020 2020 2022  eoms",.        "
+00000970: 696e 7374 6174 6522 2c0a 2020 2020 2020  instate",.      
+00000980: 2020 2272 756e 5f64 6566 6175 6c74 222c    "run_default",
+00000990: 0a20 2020 205d 0a20 2020 205f 4341 5441  .    ].    _CATA
+000009a0: 4c4f 4753 203d 206a 6f69 6e28 5f44 4154  LOGS = join(_DAT
+000009b0: 4144 4952 2c20 2270 6172 616d 6574 6572  ADIR, "parameter
+000009c0: 735f 6461 7461 2e79 6d6c 2229 0a0a 2020  s_data.yml")..  
+000009d0: 2020 6465 6620 5f5f 696e 6974 5f5f 280a    def __init__(.
+000009e0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000009f0: 2020 2020 2020 726f 6f74 3d4e 6f6e 652c        root=None,
+00000a00: 0a20 2020 2020 2020 206d 6f64 653d 2277  .        mode="w
+00000a10: 222c 0a20 2020 2020 2020 2063 6f6e 6669  ",.        confi
+00000a20: 675f 666e 3d4e 6f6e 652c 0a20 2020 2020  g_fn=None,.     
+00000a30: 2020 2064 6174 615f 6c69 6273 3d4e 6f6e     data_libs=Non
+00000a40: 652c 0a20 2020 2020 2020 2064 656c 7461  e,.        delta
+00000a50: 7265 735f 6461 7461 3d46 616c 7365 2c0a  res_data=False,.
+00000a60: 2020 2020 2020 2020 6c6f 6767 6572 3d6c          logger=l
+00000a70: 6f67 6765 722c 0a20 2020 2029 3a0a 2020  ogger,.    ):.  
+00000a80: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
+00000a90: 696e 6974 5f5f 280a 2020 2020 2020 2020  init__(.        
+00000aa0: 2020 2020 726f 6f74 3d72 6f6f 742c 0a20      root=root,. 
+00000ab0: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
+00000ac0: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
+00000ad0: 2020 636f 6e66 6967 5f66 6e3d 636f 6e66    config_fn=conf
+00000ae0: 6967 5f66 6e2c 0a20 2020 2020 2020 2020  ig_fn,.         
+00000af0: 2020 2064 6174 615f 6c69 6273 3d64 6174     data_libs=dat
+00000b00: 615f 6c69 6273 2c0a 2020 2020 2020 2020  a_libs,.        
+00000b10: 2020 2020 6465 6c74 6172 6573 5f64 6174      deltares_dat
+00000b20: 613d 6465 6c74 6172 6573 5f64 6174 612c  a=deltares_data,
+00000b30: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00000b40: 6765 723d 6c6f 6767 6572 2c0a 2020 2020  ger=logger,.    
+00000b50: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00000b60: 2077 666c 6f77 2073 7065 6369 6669 630a   wflow specific.
+00000b70: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
+00000b80: 7462 6c20 3d20 6469 6374 2829 0a20 2020  tbl = dict().   
+00000b90: 2020 2020 2073 656c 662e 5f74 6162 6c65       self._table
+00000ba0: 7320 3d20 6469 6374 2829 0a20 2020 2020  s = dict().     
+00000bb0: 2020 2073 656c 662e 5f66 6c77 6469 7220     self._flwdir 
+00000bc0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+00000bd0: 656c 662e 6461 7461 5f63 6174 616c 6f67  elf.data_catalog
+00000be0: 2e66 726f 6d5f 796d 6c28 7365 6c66 2e5f  .from_yml(self._
+00000bf0: 4341 5441 4c4f 4753 290a 0a20 2020 2023  CATALOGS)..    #
+00000c00: 2043 4f4d 504f 4e45 4e54 530a 2020 2020   COMPONENTS.    
+00000c10: 6465 6620 7365 7475 705f 6261 7365 6d61  def setup_basema
+00000c20: 7073 280a 2020 2020 2020 2020 7365 6c66  ps(.        self
+00000c30: 2c0a 2020 2020 2020 2020 7265 6769 6f6e  ,.        region
+00000c40: 2c0a 2020 2020 2020 2020 7265 733d 3120  ,.        res=1 
+00000c50: 2f20 3132 302e 302c 0a20 2020 2020 2020  / 120.0,.       
+00000c60: 2068 7964 726f 6772 6170 6879 5f66 6e3d   hydrography_fn=
+00000c70: 226d 6572 6974 5f68 7964 726f 222c 0a20  "merit_hydro",. 
+00000c80: 2020 2020 2020 2062 6173 696e 5f69 6e64         basin_ind
+00000c90: 6578 5f66 6e3d 226d 6572 6974 5f68 7964  ex_fn="merit_hyd
+00000ca0: 726f 5f69 6e64 6578 222c 0a20 2020 2020  ro_index",.     
+00000cb0: 2020 2075 7073 6361 6c65 5f6d 6574 686f     upscale_metho
+00000cc0: 643d 2269 6875 222c 0a20 2020 2029 3a0a  d="ihu",.    ):.
+00000cd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00000ce0: 2020 2020 5468 6973 2063 6f6d 706f 6e65      This compone
+00000cf0: 6e74 2073 6574 7320 7468 6520 6060 7265  nt sets the ``re
+00000d00: 6769 6f6e 6060 206f 6620 696e 7465 7265  gion`` of intere
+00000d10: 7374 2061 6e64 2060 6072 6573 6060 2028  st and ``res`` (
+00000d20: 7265 736f 6c75 7469 6f6e 2069 6e20 6465  resolution in de
+00000d30: 6772 6565 7329 206f 6620 7468 650a 2020  grees) of the.  
+00000d40: 2020 2020 2020 6d6f 6465 6c2e 2041 6c6c        model. All
+00000d50: 2044 454d 2061 6e64 2066 6c6f 7720 6469   DEM and flow di
+00000d60: 7265 6374 696f 6e20 7265 6c61 7465 6420  rection related 
+00000d70: 6d61 7073 2061 7265 2074 6865 6e20 6275  maps are then bu
+00000d80: 696c 642e 0a0a 2020 2020 2020 2020 4966  ild...        If
+00000d90: 2074 6865 206d 6f64 656c 2072 6573 6f6c   the model resol
+00000da0: 7574 696f 6e20 6973 206c 6172 6765 7220  ution is larger 
+00000db0: 7468 616e 2074 6865 2073 6f75 7263 6520  than the source 
+00000dc0: 6461 7461 2072 6573 6f6c 7574 696f 6e2c  data resolution,
+00000dd0: 0a20 2020 2020 2020 2074 6865 2066 6c6f  .        the flo
+00000de0: 7720 6469 7265 6374 696f 6e20 6973 2075  w direction is u
+00000df0: 7073 6361 6c65 6420 7573 696e 6720 7468  pscaled using th
+00000e00: 6520 6060 7570 7363 616c 655f 6d65 7468  e ``upscale_meth
+00000e10: 6f64 6060 2c20 6279 2064 6566 6175 6c74  od``, by default
+00000e20: 2074 6865 0a20 2020 2020 2020 2049 7465   the.        Ite
+00000e30: 7261 7469 7665 2048 7964 726f 6772 6170  rative Hydrograp
+00000e40: 6879 2055 7073 6361 6c69 6e67 2028 4948  hy Upscaling (IH
+00000e50: 5529 2e0a 2020 2020 2020 2020 5468 6520  U)..        The 
+00000e60: 6465 6661 756c 7420 6060 6879 6472 6f67  default ``hydrog
+00000e70: 7261 7068 795f 666e 6060 2069 7320 226d  raphy_fn`` is "m
+00000e80: 6572 6974 5f68 7964 726f 2220 2860 4d45  erit_hydro" (`ME
+00000e90: 5249 5420 6879 6472 6f20 3c68 7474 703a  RIT hydro <http:
+00000ea0: 2f2f 6879 6472 6f2e 6969 732e 752d 746f  //hydro.iis.u-to
+00000eb0: 6b79 6f2e 6163 2e6a 702f 7e79 616d 6164  kyo.ac.jp/~yamad
+00000ec0: 6169 2f4d 4552 4954 5f48 7964 726f 2f69  ai/MERIT_Hydro/i
+00000ed0: 6e64 6578 2e68 746d 6c3e 605f 0a20 2020  ndex.html>`_.   
+00000ee0: 2020 2020 2061 7420 3320 6172 6373 6563       at 3 arcsec
+00000ef0: 2072 6573 6f6c 7574 696f 6e29 2041 6c74   resolution) Alt
+00000f00: 6572 6e61 7469 7665 2073 6f75 7263 6573  ernative sources
+00000f10: 2069 6e63 6c75 6465 2022 6d65 7269 745f   include "merit_
+00000f20: 6879 6472 6f5f 316b 2220 6174 2033 3020  hydro_1k" at 30 
+00000f30: 6172 6373 6563 2072 6573 6f6c 7574 696f  arcsec resolutio
+00000f40: 6e2e 0a20 2020 2020 2020 2055 7365 7273  n..        Users
+00000f50: 2063 616e 2061 6c73 6f20 7375 7070 6c79   can also supply
+00000f60: 2074 6865 6972 206f 776e 2065 6c65 7661   their own eleva
+00000f70: 7469 6f6e 2061 6e64 2066 6c6f 7720 6469  tion and flow di
+00000f80: 7265 6374 696f 6e20 6461 7461 2069 6e20  rection data in 
+00000f90: 616e 7920 4352 5320 616e 6420 6e6f 7420  any CRS and not 
+00000fa0: 6f6e 6c79 2045 5053 473a 3433 3236 2e0a  only EPSG:4326..
+00000fb0: 0a20 2020 2020 2020 204e 6f74 6520 7468  .        Note th
+00000fc0: 6174 2069 6e20 6f72 6465 7220 746f 2064  at in order to d
+00000fd0: 6566 696e 6520 7468 6520 7265 6769 6f6e  efine the region
+00000fe0: 2c20 7573 696e 6720 706f 696e 7473 206f  , using points o
+00000ff0: 7220 626f 756e 6469 6e67 2062 6f78 2c20  r bounding box, 
+00001000: 7468 6520 636f 6f72 6469 6e61 7465 7320  the coordinates 
+00001010: 6f66 2074 6865 2070 6f69 6e74 7320 2f20  of the points / 
+00001020: 626f 756e 6469 6e67 2062 6f78 0a20 2020  bounding box.   
+00001030: 2020 2020 2073 686f 756c 6420 6265 2069       should be i
+00001040: 6e20 7468 6520 7361 6d65 2043 5253 2074  n the same CRS t
+00001050: 6861 6e20 7468 6520 6879 6472 6f67 7261  han the hydrogra
+00001060: 7068 7920 6461 7461 2e20 5468 6520 7766  phy data. The wf
+00001070: 6c6f 7720 6d6f 6465 6c20 7769 6c6c 2074  low model will t
+00001080: 6865 6e20 616c 736f 2062 6520 696e 2074  hen also be in t
+00001090: 6865 2073 616d 6520 4352 5320 7468 616e  he same CRS than
+000010a0: 2074 6865 0a20 2020 2020 2020 2068 7964   the.        hyd
+000010b0: 726f 6772 6170 6879 2064 6174 6120 696e  rography data in
+000010c0: 206f 7264 6572 2074 6f20 6176 6f69 6420   order to avoid 
+000010d0: 6173 7375 6d70 7469 6f6e 7320 616e 6420  assumptions and 
+000010e0: 7265 7072 6f6a 6563 7469 6f6e 2065 7272  reprojection err
+000010f0: 6f72 732e 2049 6620 7468 6520 7573 6572  ors. If the user
+00001100: 2077 6973 6865 7320 746f 2075 7365 2061   wishes to use a
+00001110: 2064 6966 6665 7265 6e74 2043 5253 2c0a   different CRS,.
+00001120: 2020 2020 2020 2020 7765 2072 6563 6f6d          we recom
+00001130: 6d65 6e64 2066 6972 7374 2074 6f20 7265  mend first to re
+00001140: 7072 6f6a 6563 7420 7468 6520 6879 6472  project the hydr
+00001150: 6f67 7261 7068 7920 6461 7461 2073 6570  ography data sep
+00001160: 6572 6174 656c 7920 6265 6361 7573 6520  erately because 
+00001170: 6361 6c6c 696e 6720 6879 6472 6f6d 7420  calling hydromt 
+00001180: 6275 696c 642e 2059 6f75 2063 616e 2066  build. You can f
+00001190: 696e 6420 6578 616d 706c 6573 0a20 2020  ind examples.   
+000011a0: 2020 2020 206f 6e20 686f 7720 746f 2072       on how to r
+000011b0: 6570 726f 6a65 6374 206f 7220 7072 6570  eproject or prep
+000011c0: 6172 6520 6879 6472 6f67 7261 7068 7920  are hydrography 
+000011d0: 6461 7461 2069 6e20 7468 650a 2020 2020  data in the.    
+000011e0: 2020 2020 6070 7265 7061 7265 2066 6c6f      `prepare flo
+000011f0: 7720 6469 7265 6374 696f 6e73 2065 7861  w directions exa
+00001200: 6d70 6c65 206e 6f74 6562 6f6b 203c 6874  mple notebok <ht
+00001210: 7470 733a 2f2f 6465 6c74 6172 6573 2e67  tps://deltares.g
+00001220: 6974 6875 622e 696f 2f68 7964 726f 6d74  ithub.io/hydromt
+00001230: 5f77 666c 6f77 2f6c 6174 6573 742f 5f65  _wflow/latest/_e
+00001240: 7861 6d70 6c65 732f 7072 6570 6172 655f  xamples/prepare_
+00001250: 6c64 642e 6874 6d6c 3e60 2e0a 0a20 2020  ldd.html>`...   
+00001260: 2020 2020 2041 6464 7320 6d6f 6465 6c20       Adds model 
+00001270: 6c61 7965 7273 3a0a 0a20 2020 2020 2020  layers:..       
+00001280: 202a 202a 2a77 666c 6f77 5f6c 6464 2a2a   * **wflow_ldd**
+00001290: 206d 6170 3a20 666c 6f77 2064 6972 6563   map: flow direc
+000012a0: 7469 6f6e 2069 6e20 4c44 4420 666f 726d  tion in LDD form
+000012b0: 6174 205b 2d5d 0a20 2020 2020 2020 202a  at [-].        *
+000012c0: 202a 2a77 666c 6f77 5f73 7562 6361 7463   **wflow_subcatc
+000012d0: 682a 2a20 6d61 703a 2062 6173 696e 2049  h** map: basin I
+000012e0: 4420 6d61 7020 5b2d 5d0a 2020 2020 2020  D map [-].      
+000012f0: 2020 2a20 2a2a 7766 6c6f 775f 7570 6172    * **wflow_upar
+00001300: 6561 2a2a 206d 6170 3a20 7570 7374 7265  ea** map: upstre
+00001310: 616d 2061 7265 6120 5b6b 6d32 5d0a 2020  am area [km2].  
+00001320: 2020 2020 2020 2a20 2a2a 7766 6c6f 775f        * **wflow_
+00001330: 7374 7265 616d 6f72 6465 722a 2a20 6d61  streamorder** ma
+00001340: 703a 2053 7472 6168 6c65 7220 7374 7265  p: Strahler stre
+00001350: 616d 206f 7264 6572 205b 2d5d 0a20 2020  am order [-].   
+00001360: 2020 2020 202a 202a 2a77 666c 6f77 5f64       * **wflow_d
+00001370: 656d 2a2a 206d 6170 3a20 6176 6572 6167  em** map: averag
+00001380: 6520 656c 6576 6174 696f 6e20 5b6d 2b52  e elevation [m+R
+00001390: 4546 5d0a 2020 2020 2020 2020 2a20 2a2a  EF].        * **
+000013a0: 6465 6d5f 7375 6267 7269 642a 2a20 6d61  dem_subgrid** ma
+000013b0: 703a 2073 7562 6772 6964 206f 7574 6c65  p: subgrid outle
+000013c0: 7420 656c 6576 6174 696f 6e20 5b6d 2b52  t elevation [m+R
+000013d0: 4546 5d0a 2020 2020 2020 2020 2a20 2a2a  EF].        * **
+000013e0: 536c 6f70 652a 2a20 6d61 703a 2061 7665  Slope** map: ave
+000013f0: 7261 6765 206c 616e 6420 7375 7266 6163  rage land surfac
+00001400: 6520 736c 6f70 6520 5b6d 2f6d 5d0a 2020  e slope [m/m].  
+00001410: 2020 2020 2020 2a20 2a2a 6261 7369 6e73        * **basins
+00001420: 2a2a 2067 656f 6d3a 2062 6173 696e 7320  ** geom: basins 
+00001430: 626f 756e 6461 7279 2076 6563 746f 720a  boundary vector.
+00001440: 2020 2020 2020 2020 2a20 2a2a 7265 6769          * **regi
+00001450: 6f6e 2a2a 2067 656f 6d3a 2072 6567 696f  on** geom: regio
+00001460: 6e20 626f 756e 6461 7279 2076 6563 746f  n boundary vecto
+00001470: 720a 0a20 2020 2020 2020 2050 6172 616d  r..        Param
+00001480: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00001490: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000014a0: 2068 7964 726f 6772 6170 6879 5f66 6e20   hydrography_fn 
+000014b0: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+000014c0: 2020 4e61 6d65 206f 6620 6461 7461 2073    Name of data s
+000014d0: 6f75 7263 6520 666f 7220 6261 7365 6d61  ource for basema
+000014e0: 7020 7061 7261 6d65 7465 7273 2e0a 0a20  p parameters... 
+000014f0: 2020 2020 2020 2020 2020 202a 2052 6571             * Req
+00001500: 7569 7265 6420 7661 7269 6162 6c65 733a  uired variables:
+00001510: 205b 2766 6c77 6469 7227 2c20 2775 7061   ['flwdir', 'upa
+00001520: 7265 6127 2c20 2762 6173 696e 7327 2c20  rea', 'basins', 
+00001530: 2773 7472 6f72 6427 2c20 2765 6c65 7674  'strord', 'elevt
+00001540: 6e27 5d0a 0a20 2020 2020 2020 2020 2020  n']..           
+00001550: 202a 204f 7074 696f 6e61 6c20 7661 7269   * Optional vari
+00001560: 6162 6c65 733a 205b 276c 6e64 736c 7027  ables: ['lndslp'
+00001570: 2c20 276d 6173 6b27 5d0a 2020 2020 2020  , 'mask'].      
+00001580: 2020 6261 7369 6e5f 696e 6465 785f 666e    basin_index_fn
+00001590: 203a 2073 7472 0a20 2020 2020 2020 2020   : str.         
+000015a0: 2020 204e 616d 6520 6f66 2064 6174 6120     Name of data 
+000015b0: 736f 7572 6365 2066 6f72 2062 6173 696e  source for basin
+000015c0: 5f69 6e64 6578 2064 6174 6120 6c69 6e6b  _index data link
+000015d0: 6564 2074 6f20 6879 6472 6f67 7261 7068  ed to hydrograph
+000015e0: 795f 666e 2e0a 2020 2020 2020 2020 7265  y_fn..        re
+000015f0: 6769 6f6e 203a 2064 6963 740a 2020 2020  gion : dict.    
+00001600: 2020 2020 2020 2020 4469 6374 696f 6e61          Dictiona
+00001610: 7279 2064 6573 6372 6962 696e 6720 7265  ry describing re
+00001620: 6769 6f6e 206f 6620 696e 7465 7265 7374  gion of interest
+00001630: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
+00001640: 6520 3a70 793a 6675 6e63 7469 6f6e 3a7e  e :py:function:~
+00001650: 6261 7369 6e5f 6d61 736b 2e70 6172 7365  basin_mask.parse
+00001660: 5f72 6567 696f 6e20 666f 7220 616c 6c20  _region for all 
+00001670: 6f70 7469 6f6e 730a 2020 2020 2020 2020  options.        
+00001680: 7265 7320 3a20 666c 6f61 740a 2020 2020  res : float.    
+00001690: 2020 2020 2020 2020 4f75 7470 7574 206d          Output m
+000016a0: 6f64 656c 2072 6573 6f6c 7574 696f 6e0a  odel resolution.
+000016b0: 2020 2020 2020 2020 7570 7363 616c 655f          upscale_
+000016c0: 6d65 7468 6f64 203a 207b 2769 6875 272c  method : {'ihu',
+000016d0: 2027 6561 6d27 2c20 2764 6d6d 277d 0a20   'eam', 'dmm'}. 
+000016e0: 2020 2020 2020 2020 2020 2055 7073 6361             Upsca
+000016f0: 6c69 6e67 206d 6574 686f 6420 666f 7220  ling method for 
+00001700: 666c 6f77 2064 6972 6563 7469 6f6e 2064  flow direction d
+00001710: 6174 612c 2062 7920 6465 6661 756c 7420  ata, by default 
+00001720: 2769 6875 272e 0a0a 2020 2020 2020 2020  'ihu'...        
+00001730: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00001740: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00001750: 2020 6879 6472 6f6d 742e 776f 726b 666c    hydromt.workfl
+00001760: 6f77 732e 7061 7273 655f 7265 6769 6f6e  ows.parse_region
+00001770: 0a20 2020 2020 2020 2068 7964 726f 6d74  .        hydromt
+00001780: 2e77 6f72 6b66 6c6f 7773 2e67 6574 5f62  .workflows.get_b
+00001790: 6173 696e 5f67 656f 6d65 7472 790a 2020  asin_geometry.  
+000017a0: 2020 2020 2020 776f 726b 666c 6f77 732e        workflows.
+000017b0: 6879 6472 6f67 7261 7068 790a 2020 2020  hydrography.    
+000017c0: 2020 2020 776f 726b 666c 6f77 732e 746f      workflows.to
+000017d0: 706f 6772 6170 6879 0a20 2020 2020 2020  pography.       
+000017e0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+000017f0: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
+00001800: 5072 6570 6172 696e 6720 6261 7365 2068  Preparing base h
+00001810: 7964 726f 6772 6170 6879 2062 6173 656d  ydrography basem
+00001820: 6170 732e 2229 0a20 2020 2020 2020 2023  aps.").        #
+00001830: 2072 6574 7269 6576 6520 676c 6f62 616c   retrieve global
+00001840: 2064 6174 6120 286c 617a 7921 290a 2020   data (lazy!).  
+00001850: 2020 2020 2020 6473 5f6f 7267 203d 2073        ds_org = s
+00001860: 656c 662e 6461 7461 5f63 6174 616c 6f67  elf.data_catalog
+00001870: 2e67 6574 5f72 6173 7465 7264 6174 6173  .get_rasterdatas
+00001880: 6574 2868 7964 726f 6772 6170 6879 5f66  et(hydrography_f
+00001890: 6e29 0a0a 2020 2020 2020 2020 2320 6765  n)..        # ge
+000018a0: 7420 6261 7369 6e20 6765 6f6d 6574 7279  t basin geometry
+000018b0: 2061 6e64 2063 6c69 7020 6461 7461 0a20   and clip data. 
+000018c0: 2020 2020 2020 206b 696e 642c 2072 6567         kind, reg
+000018d0: 696f 6e20 3d20 6879 6472 6f6d 742e 776f  ion = hydromt.wo
+000018e0: 726b 666c 6f77 732e 7061 7273 655f 7265  rkflows.parse_re
+000018f0: 6769 6f6e 2872 6567 696f 6e2c 206c 6f67  gion(region, log
+00001900: 6765 723d 7365 6c66 2e6c 6f67 6765 7229  ger=self.logger)
+00001910: 0a20 2020 2020 2020 2078 7920 3d20 4e6f  .        xy = No
+00001920: 6e65 0a20 2020 2020 2020 2069 6620 6b69  ne.        if ki
+00001930: 6e64 2069 6e20 5b22 6261 7369 6e22 2c20  nd in ["basin", 
+00001940: 2273 7562 6261 7369 6e22 2c20 226f 7574  "subbasin", "out
+00001950: 6c65 7422 5d3a 0a20 2020 2020 2020 2020  let"]:.         
+00001960: 2020 2069 6620 6261 7369 6e5f 696e 6465     if basin_inde
+00001970: 785f 666e 2069 7320 6e6f 7420 4e6f 6e65  x_fn is not None
+00001980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001990: 2020 6261 735f 696e 6465 7820 3d20 7365    bas_index = se
+000019a0: 6c66 2e64 6174 615f 6361 7461 6c6f 675b  lf.data_catalog[
+000019b0: 6261 7369 6e5f 696e 6465 785f 666e 5d0a  basin_index_fn].
+000019c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000019d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000019e0: 2020 6261 735f 696e 6465 7820 3d20 4e6f    bas_index = No
+000019f0: 6e65 0a20 2020 2020 2020 2020 2020 2067  ne.            g
+00001a00: 656f 6d2c 2078 7920 3d20 6879 6472 6f6d  eom, xy = hydrom
+00001a10: 742e 776f 726b 666c 6f77 732e 6765 745f  t.workflows.get_
+00001a20: 6261 7369 6e5f 6765 6f6d 6574 7279 280a  basin_geometry(.
+00001a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001a40: 6473 3d64 735f 6f72 672c 0a20 2020 2020  ds=ds_org,.     
+00001a50: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
+00001a60: 6b69 6e64 2c0a 2020 2020 2020 2020 2020  kind,.          
+00001a70: 2020 2020 2020 6261 7369 6e5f 696e 6465        basin_inde
+00001a80: 783d 6261 735f 696e 6465 782c 0a20 2020  x=bas_index,.   
+00001a90: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+00001aa0: 6765 723d 7365 6c66 2e6c 6f67 6765 722c  ger=self.logger,
+00001ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001ac0: 202a 2a72 6567 696f 6e2c 0a20 2020 2020   **region,.     
+00001ad0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00001ae0: 2065 6c69 6620 2262 626f 7822 2069 6e20   elif "bbox" in 
+00001af0: 7265 6769 6f6e 3a0a 2020 2020 2020 2020  region:.        
+00001b00: 2020 2020 6262 6f78 203d 2072 6567 696f      bbox = regio
+00001b10: 6e2e 6765 7428 2262 626f 7822 290a 2020  n.get("bbox").  
+00001b20: 2020 2020 2020 2020 2020 6765 6f6d 203d            geom =
+00001b30: 2067 7064 2e47 656f 4461 7461 4672 616d   gpd.GeoDataFram
+00001b40: 6528 6765 6f6d 6574 7279 3d5b 626f 7828  e(geometry=[box(
+00001b50: 2a62 626f 7829 5d2c 2063 7273 3d34 3332  *bbox)], crs=432
+00001b60: 3629 0a20 2020 2020 2020 2065 6c69 6620  6).        elif 
+00001b70: 2267 656f 6d22 2069 6e20 7265 6769 6f6e  "geom" in region
+00001b80: 3a0a 2020 2020 2020 2020 2020 2020 6765  :.            ge
+00001b90: 6f6d 203d 2072 6567 696f 6e2e 6765 7428  om = region.get(
+00001ba0: 2267 656f 6d22 290a 2020 2020 2020 2020  "geom").        
+00001bb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00001bc0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00001bd0: 6f72 2866 2277 666c 6f77 2072 6567 696f  or(f"wflow regio
+00001be0: 6e20 6172 6775 6d65 6e74 206e 6f74 2075  n argument not u
+00001bf0: 6e64 6572 7374 6f6f 643a 207b 7265 6769  nderstood: {regi
+00001c00: 6f6e 7d22 290a 2020 2020 2020 2020 6966  on}").        if
+00001c10: 2067 656f 6d20 6973 206e 6f74 204e 6f6e   geom is not Non
+00001c20: 6520 616e 6420 6765 6f6d 2e63 7273 2069  e and geom.crs i
+00001c30: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00001c40: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00001c50: 7272 6f72 2822 7766 6c6f 7720 7265 6769  rror("wflow regi
+00001c60: 6f6e 2067 656f 6d65 7472 7920 6861 7320  on geometry has 
+00001c70: 6e6f 2043 5253 2229 0a0a 2020 2020 2020  no CRS")..      
+00001c80: 2020 6473 5f6f 7267 203d 2064 735f 6f72    ds_org = ds_or
+00001c90: 672e 7261 7374 6572 2e63 6c69 705f 6765  g.raster.clip_ge
+00001ca0: 6f6d 2867 656f 6d2c 2061 6c69 676e 3d72  om(geom, align=r
+00001cb0: 6573 2c20 6275 6666 6572 3d31 3029 0a20  es, buffer=10). 
+00001cc0: 2020 2020 2020 2064 735f 6f72 672e 636f         ds_org.co
+00001cd0: 6f72 6473 5b22 6d61 736b 225d 203d 2064  ords["mask"] = d
+00001ce0: 735f 6f72 672e 7261 7374 6572 2e67 656f  s_org.raster.geo
+00001cf0: 6d65 7472 795f 6d61 736b 2867 656f 6d29  metry_mask(geom)
+00001d00: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00001d10: 6767 6572 2e64 6562 7567 2822 4164 6469  gger.debug("Addi
+00001d20: 6e67 2062 6173 696e 7320 7665 6374 6f72  ng basins vector
+00001d30: 2074 6f20 7374 6174 6963 6765 6f6d 732e   to staticgeoms.
+00001d40: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00001d50: 7365 745f 7374 6174 6963 6765 6f6d 7328  set_staticgeoms(
+00001d60: 6765 6f6d 2c20 6e61 6d65 3d22 6261 7369  geom, name="basi
+00001d70: 6e73 2229 0a0a 2020 2020 2020 2020 2320  ns")..        # 
+00001d80: 4368 6563 6b20 6f6e 2072 6573 6f6c 7574  Check on resolut
+00001d90: 696f 6e20 2864 6567 7265 6520 7673 206d  ion (degree vs m
+00001da0: 6574 6572 2920 6465 7065 6e64 696e 6720  eter) depending 
+00001db0: 6f6e 2064 735f 6f72 6720 7265 732f 6372  on ds_org res/cr
+00001dc0: 730a 2020 2020 2020 2020 7363 616c 655f  s.        scale_
+00001dd0: 7261 7469 6f20 3d20 696e 7428 6e70 2e72  ratio = int(np.r
+00001de0: 6f75 6e64 2872 6573 202f 2064 735f 6f72  ound(res / ds_or
+00001df0: 672e 7261 7374 6572 2e72 6573 5b30 5d29  g.raster.res[0])
+00001e00: 290a 2020 2020 2020 2020 6966 2073 6361  ).        if sca
+00001e10: 6c65 5f72 6174 696f 203c 2031 3a0a 2020  le_ratio < 1:.  
+00001e20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00001e30: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00001e40: 2020 2020 2020 2020 2020 2020 6622 5468              f"Th
+00001e50: 6520 6d6f 6465 6c20 7265 736f 6c75 7469  e model resoluti
+00001e60: 6f6e 207b 7265 737d 2073 686f 756c 6420  on {res} should 
+00001e70: 6265 206c 6172 6765 7220 7468 616e 2074  be larger than t
+00001e80: 6865 207b 6879 6472 6f67 7261 7068 795f  he {hydrography_
+00001e90: 666e 7d20 7265 736f 6c75 7469 6f6e 207b  fn} resolution {
+00001ea0: 6473 5f6f 7267 2e72 6173 7465 722e 7265  ds_org.raster.re
+00001eb0: 735b 305d 7d22 0a20 2020 2020 2020 2020  s[0]}".         
+00001ec0: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00001ed0: 6473 5f6f 7267 2e72 6173 7465 722e 6372  ds_org.raster.cr
+00001ee0: 732e 6973 5f67 656f 6772 6170 6869 633a  s.is_geographic:
+00001ef0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00001f00: 7265 7320 3e20 313a 2020 2320 3131 3120  res > 1:  # 111 
+00001f10: 6b6d 0a20 2020 2020 2020 2020 2020 2020  km.             
+00001f20: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00001f30: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00001f40: 2020 2020 2020 2020 2066 2254 6865 206d           f"The m
+00001f50: 6f64 656c 2072 6573 6f6c 7574 696f 6e20  odel resolution 
+00001f60: 7b72 6573 7d20 7368 6f75 6c64 2062 6520  {res} should be 
+00001f70: 736d 616c 6c65 7220 7468 616e 2031 2064  smaller than 1 d
+00001f80: 6567 7265 6520 2831 3131 6b6d 2920 666f  egree (111km) fo
+00001f90: 7220 6765 6f67 7261 7068 6963 2063 6f6f  r geographic coo
+00001fa0: 7264 696e 6174 6520 7379 7374 656d 732e  rdinate systems.
+00001fb0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00001fc0: 2020 2020 2020 2022 4d61 6b65 2073 7572         "Make sur
+00001fd0: 6520 796f 7520 7072 6f76 6964 6564 2072  e you provided r
+00001fe0: 6573 2069 6e20 6465 6772 6565 2072 6174  es in degree rat
+00001ff0: 6865 7220 7468 616e 2069 6e20 6d65 7465  her than in mete
+00002000: 7273 2e22 0a20 2020 2020 2020 2020 2020  rs.".           
+00002010: 2020 2020 2029 0a20 2020 2020 2020 2023       ).        #
+00002020: 2073 6574 7570 2068 7964 726f 6772 6170   setup hydrograp
+00002030: 6879 206d 6170 7320 616e 6420 7365 7420  hy maps and set 
+00002040: 7374 6174 6963 6d61 7020 6174 7472 6962  staticmap attrib
+00002050: 7574 6520 7769 7468 2072 656e 616d 6564  ute with renamed
+00002060: 206d 6170 730a 2020 2020 2020 2020 6473   maps.        ds
+00002070: 5f62 6173 652c 205f 203d 2077 6f72 6b66  _base, _ = workf
+00002080: 6c6f 7773 2e68 7964 726f 6772 6170 6879  lows.hydrography
+00002090: 280a 2020 2020 2020 2020 2020 2020 6473  (.            ds
+000020a0: 3d64 735f 6f72 672c 0a20 2020 2020 2020  =ds_org,.       
+000020b0: 2020 2020 2072 6573 3d72 6573 2c0a 2020       res=res,.  
+000020c0: 2020 2020 2020 2020 2020 7879 3d78 792c            xy=xy,
+000020d0: 0a20 2020 2020 2020 2020 2020 2075 7073  .            ups
+000020e0: 6361 6c65 5f6d 6574 686f 643d 7570 7363  cale_method=upsc
+000020f0: 616c 655f 6d65 7468 6f64 2c0a 2020 2020  ale_method,.    
+00002100: 2020 2020 2020 2020 6c6f 6767 6572 3d73          logger=s
+00002110: 656c 662e 6c6f 6767 6572 2c0a 2020 2020  elf.logger,.    
+00002120: 2020 2020 290a 2020 2020 2020 2020 2320      ).        # 
+00002130: 436f 6e76 6572 7420 666c 6f77 2064 6972  Convert flow dir
+00002140: 6563 7469 6f6e 2066 726f 6d20 6438 2074  ection from d8 t
+00002150: 6f20 6c64 6420 666f 726d 6174 0a20 2020  o ldd format.   
+00002160: 2020 2020 2066 6c77 6469 725f 6461 7461       flwdir_data
+00002170: 203d 2064 735f 6261 7365 5b22 666c 7764   = ds_base["flwd
+00002180: 6972 225d 2e76 616c 7565 732e 6173 7479  ir"].values.asty
+00002190: 7065 286e 702e 7569 6e74 3829 2020 2320  pe(np.uint8)  # 
+000021a0: 666f 7263 6520 6474 7970 650a 2020 2020  force dtype.    
+000021b0: 2020 2020 2320 6966 2064 3820 636f 6e76      # if d8 conv
+000021c0: 6572 7420 746f 206c 6464 0a20 2020 2020  ert to ldd.     
+000021d0: 2020 2069 6620 636f 7265 5f64 382e 6973     if core_d8.is
+000021e0: 7661 6c69 6428 666c 7764 6972 5f64 6174  valid(flwdir_dat
+000021f0: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
+00002200: 6461 7461 203d 2063 6f72 655f 636f 6e76  data = core_conv
+00002210: 6572 7369 6f6e 2e64 385f 746f 5f6c 6464  ersion.d8_to_ldd
+00002220: 2866 6c77 6469 725f 6461 7461 290a 2020  (flwdir_data).  
+00002230: 2020 2020 2020 2020 2020 6461 5f66 6c77            da_flw
+00002240: 6469 7220 3d20 7872 2e44 6174 6141 7272  dir = xr.DataArr
+00002250: 6179 280a 2020 2020 2020 2020 2020 2020  ay(.            
+00002260: 2020 2020 6e61 6d65 3d22 666c 7764 6972      name="flwdir
+00002270: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00002280: 2020 2064 6174 613d 6461 7461 2c0a 2020     data=data,.  
+00002290: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000022a0: 6f72 6473 3d64 735f 6261 7365 2e72 6173  ords=ds_base.ras
+000022b0: 7465 722e 636f 6f72 6473 2c0a 2020 2020  ter.coords,.    
+000022c0: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+000022d0: 3d64 735f 6261 7365 2e72 6173 7465 722e  =ds_base.raster.
+000022e0: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+000022f0: 2020 2020 2020 6174 7472 733d 6469 6374        attrs=dict
+00002300: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002310: 2020 2020 2020 6c6f 6e67 5f6e 616d 653d        long_name=
+00002320: 226c 6464 2066 6c6f 7720 6469 7265 6374  "ldd flow direct
+00002330: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+00002340: 2020 2020 2020 2020 2020 5f46 696c 6c56            _FillV
+00002350: 616c 7565 3d63 6f72 655f 6c64 642e 5f6d  alue=core_ldd._m
+00002360: 762c 0a20 2020 2020 2020 2020 2020 2020  v,.             
+00002370: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00002380: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00002390: 6473 5f62 6173 655b 2266 6c77 6469 7222  ds_base["flwdir"
+000023a0: 5d20 3d20 6461 5f66 6c77 6469 720a 2020  ] = da_flwdir.  
+000023b0: 2020 2020 2020 2320 5265 6e61 6d65 2061        # Rename a
+000023c0: 6e64 2061 6464 2074 6f20 7374 6174 6963  nd add to static
+000023d0: 6d61 7073 0a20 2020 2020 2020 2072 6d64  maps.        rmd
+000023e0: 6963 7420 3d20 7b6b 3a20 7620 666f 7220  ict = {k: v for 
+000023f0: 6b2c 2076 2069 6e20 7365 6c66 2e5f 4d41  k, v in self._MA
+00002400: 5053 2e69 7465 6d73 2829 2069 6620 6b20  PS.items() if k 
+00002410: 696e 2064 735f 6261 7365 2e64 6174 615f  in ds_base.data_
+00002420: 7661 7273 7d0a 2020 2020 2020 2020 7365  vars}.        se
+00002430: 6c66 2e73 6574 5f73 7461 7469 636d 6170  lf.set_staticmap
+00002440: 7328 6473 5f62 6173 652e 7265 6e61 6d65  s(ds_base.rename
+00002450: 2872 6d64 6963 7429 290a 0a20 2020 2020  (rmdict))..     
+00002460: 2020 2023 2073 6574 7570 2074 6f70 6f67     # setup topog
+00002470: 7261 7068 7920 6d61 7073 0a20 2020 2020  raphy maps.     
+00002480: 2020 2064 735f 746f 706f 203d 2077 6f72     ds_topo = wor
+00002490: 6b66 6c6f 7773 2e74 6f70 6f67 7261 7068  kflows.topograph
+000024a0: 7928 0a20 2020 2020 2020 2020 2020 2064  y(.            d
+000024b0: 733d 6473 5f6f 7267 2c20 6473 5f6c 696b  s=ds_org, ds_lik
+000024c0: 653d 7365 6c66 2e73 7461 7469 636d 6170  e=self.staticmap
+000024d0: 732c 206d 6574 686f 643d 2261 7665 7261  s, method="avera
+000024e0: 6765 222c 206c 6f67 6765 723d 7365 6c66  ge", logger=self
+000024f0: 2e6c 6f67 6765 720a 2020 2020 2020 2020  .logger.        
+00002500: 290a 2020 2020 2020 2020 6473 5f74 6f70  ).        ds_top
+00002510: 6f5b 226c 6e64 736c 7022 5d20 3d20 6e70  o["lndslp"] = np
+00002520: 2e6d 6178 696d 756d 2864 735f 746f 706f  .maximum(ds_topo
+00002530: 5b22 6c6e 6473 6c70 225d 2c20 302e 3029  ["lndslp"], 0.0)
+00002540: 0a20 2020 2020 2020 2072 6d64 6963 7420  .        rmdict 
+00002550: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+00002560: 2069 6e20 7365 6c66 2e5f 4d41 5053 2e69   in self._MAPS.i
+00002570: 7465 6d73 2829 2069 6620 6b20 696e 2064  tems() if k in d
+00002580: 735f 746f 706f 2e64 6174 615f 7661 7273  s_topo.data_vars
+00002590: 7d0a 2020 2020 2020 2020 7365 6c66 2e73  }.        self.s
+000025a0: 6574 5f73 7461 7469 636d 6170 7328 6473  et_staticmaps(ds
+000025b0: 5f74 6f70 6f2e 7265 6e61 6d65 2872 6d64  _topo.rename(rmd
+000025c0: 6963 7429 290a 2020 2020 2020 2020 2320  ict)).        # 
+000025d0: 7365 7420 6261 7369 6e20 6765 6f6d 6574  set basin geomet
+000025e0: 7279 0a20 2020 2020 2020 2073 656c 662e  ry.        self.
+000025f0: 6c6f 6767 6572 2e64 6562 7567 2866 2241  logger.debug(f"A
+00002600: 6464 696e 6720 7265 6769 6f6e 2076 6563  dding region vec
+00002610: 746f 7220 746f 2073 7461 7469 6367 656f  tor to staticgeo
+00002620: 6d73 2e22 290a 2020 2020 2020 2020 7365  ms.").        se
+00002630: 6c66 2e73 6574 5f73 7461 7469 6367 656f  lf.set_staticgeo
+00002640: 6d73 2873 656c 662e 7265 6769 6f6e 2c20  ms(self.region, 
+00002650: 6e61 6d65 3d22 7265 6769 6f6e 2229 0a0a  name="region")..
+00002660: 2020 2020 2020 2020 2320 7570 6461 7465          # update
+00002670: 2074 6f6d 6c20 666f 7220 6465 6772 6565   toml for degree
+00002680: 2f6d 6574 6572 7320 6966 206e 6565 6465  /meters if neede
+00002690: 640a 2020 2020 2020 2020 6966 2064 735f  d.        if ds_
+000026a0: 6261 7365 2e72 6173 7465 722e 6372 732e  base.raster.crs.
+000026b0: 6973 5f70 726f 6a65 6374 6564 3a0a 2020  is_projected:.  
+000026c0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000026d0: 6574 5f63 6f6e 6669 6728 226d 6f64 656c  et_config("model
+000026e0: 2e73 697a 6569 6e6d 6574 7265 7322 2c20  .sizeinmetres", 
+000026f0: 5472 7565 290a 0a20 2020 2064 6566 2073  True)..    def s
+00002700: 6574 7570 5f72 6976 6572 7328 0a20 2020  etup_rivers(.   
+00002710: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00002720: 2020 2068 7964 726f 6772 6170 6879 5f66     hydrography_f
+00002730: 6e2c 0a20 2020 2020 2020 2072 6976 6572  n,.        river
+00002740: 5f67 656f 6d5f 666e 3d4e 6f6e 652c 0a20  _geom_fn=None,. 
+00002750: 2020 2020 2020 2072 6976 6572 5f75 7061         river_upa
+00002760: 3a20 666c 6f61 7420 3d20 3330 2c0a 2020  : float = 30,.  
+00002770: 2020 2020 2020 7269 7664 7068 5f6d 6574        rivdph_met
+00002780: 686f 643a 2073 7472 203d 2022 706f 776c  hod: str = "powl
+00002790: 6177 222c 0a20 2020 2020 2020 2073 6c6f  aw",.        slo
+000027a0: 7065 5f6c 656e 3a20 666c 6f61 7420 3d20  pe_len: float = 
+000027b0: 3265 332c 0a20 2020 2020 2020 206d 696e  2e3,.        min
+000027c0: 5f72 6976 6c65 6e5f 7261 7469 6f3d 302e  _rivlen_ratio=0.
+000027d0: 302c 0a20 2020 2020 2020 206d 696e 5f72  0,.        min_r
+000027e0: 6976 6470 683a 2066 6c6f 6174 203d 2031  ivdph: float = 1
+000027f0: 2c0a 2020 2020 2020 2020 6d69 6e5f 7269  ,.        min_ri
+00002800: 7677 7468 3a20 666c 6f61 7420 3d20 3330  vwth: float = 30
+00002810: 2c0a 2020 2020 2020 2020 736d 6f6f 7468  ,.        smooth
+00002820: 5f6c 656e 3a20 666c 6f61 7420 3d20 3565  _len: float = 5e
+00002830: 332c 0a20 2020 2020 2020 2072 6976 6d61  3,.        rivma
+00002840: 6e5f 6d61 7070 696e 675f 666e 3a20 7374  n_mapping_fn: st
+00002850: 7220 3d20 2272 6f75 6768 6e65 7373 5f72  r = "roughness_r
+00002860: 6976 6572 5f6d 6170 7069 6e67 5f64 6566  iver_mapping_def
+00002870: 6175 6c74 222c 0a20 2020 2020 2020 2065  ault",.        e
+00002880: 6c65 7674 6e5f 6d61 703a 2073 7472 203d  levtn_map: str =
+00002890: 2022 7766 6c6f 775f 6465 6d22 2c0a 2020   "wflow_dem",.  
+000028a0: 2020 2020 2020 7269 7665 725f 726f 7574        river_rout
+000028b0: 696e 673a 2073 7472 203d 2022 6b69 6e65  ing: str = "kine
+000028c0: 6d61 7469 632d 7761 7665 222c 0a20 2020  matic-wave",.   
+000028d0: 2020 2020 2063 6f6e 6e65 6374 6976 6974       connectivit
+000028e0: 793a 2069 6e74 203d 2038 2c0a 2020 2020  y: int = 8,.    
+000028f0: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+00002900: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00002910: 0a20 2020 2020 2020 2054 6869 7320 636f  .        This co
+00002920: 6d70 6f6e 656e 7420 7365 7473 2074 6865  mponent sets the
+00002930: 2061 6c6c 2072 6976 6572 2070 6172 616d   all river param
+00002940: 6574 6572 206d 6170 732e 0a0a 2020 2020  eter maps...    
+00002950: 2020 2020 5468 6520 7269 7665 7220 6d61      The river ma
+00002960: 736b 2069 7320 6465 6669 6e65 6420 6279  sk is defined by
+00002970: 2061 6c6c 2063 656c 6c73 2077 6974 6820   all cells with 
+00002980: 6120 6d69 6d69 6d75 6d20 7570 7374 7265  a mimimum upstre
+00002990: 616d 2061 7265 6120 7468 7265 7368 6f6c  am area threshol
+000029a0: 640a 2020 2020 2020 2020 6060 7269 7665  d.        ``rive
+000029b0: 725f 7570 6160 6020 5b6b 6d32 5d2e 0a0a  r_upa`` [km2]...
+000029c0: 2020 2020 2020 2020 5468 6520 7269 7665          The rive
+000029d0: 7220 6c65 6e67 7468 2069 7320 6465 6669  r length is defi
+000029e0: 6e65 6420 6173 2074 6865 2064 6973 7461  ned as the dista
+000029f0: 6e63 6520 6672 6f6d 2074 6865 2073 7562  nce from the sub
+00002a00: 6772 6964 206f 7574 6c65 7420 7069 7865  grid outlet pixe
+00002a10: 6c20 746f 0a20 2020 2020 2020 2074 6865  l to.        the
+00002a20: 206e 6578 7420 7570 7374 7265 616d 2073   next upstream s
+00002a30: 7562 6772 6964 206f 7574 6c65 7420 7069  ubgrid outlet pi
+00002a40: 7865 6c2e 2054 6865 2060 606d 696e 5f72  xel. The ``min_r
+00002a50: 6976 6c65 6e5f 7261 7469 6f60 6020 6973  ivlen_ratio`` is
+00002a60: 2074 6865 206d 696e 696d 756d 0a20 2020   the minimum.   
+00002a70: 2020 2020 2067 6c6f 6261 6c20 7269 7665       global rive
+00002a80: 7220 6c65 6e67 7468 2074 6f20 6176 672e  r length to avg.
+00002a90: 2063 656c 6c20 7265 736f 6c75 7469 6f6e   cell resolution
+00002aa0: 2072 6174 696f 2061 6e64 2069 7320 7573   ratio and is us
+00002ab0: 6564 2061 7320 6120 7468 7265 7368 6f6c  ed as a threshol
+00002ac0: 6420 696e 0a20 2020 2020 2020 2077 696e  d in.        win
+00002ad0: 646f 7720 6261 7365 6420 736d 6f6f 7468  dow based smooth
+00002ae0: 696e 6720 6f66 2072 6976 6572 206c 656e  ing of river len
+00002af0: 6774 682e 0a0a 2020 2020 2020 2020 5468  gth...        Th
+00002b00: 6520 7269 7665 7220 736c 6f70 6520 6973  e river slope is
+00002b10: 2064 6572 6976 6564 2066 726f 6d20 7468   derived from th
+00002b20: 6520 7375 6267 7269 6420 656c 6576 6174  e subgrid elevat
+00002b30: 696f 6e20 6469 6666 6572 656e 6365 2062  ion difference b
+00002b40: 6574 7765 656e 2070 6978 656c 7320 6174  etween pixels at
+00002b50: 2061 0a20 2020 2020 2020 2068 616c 6620   a.        half 
+00002b60: 6469 7374 616e 6365 2060 6073 6c6f 7065  distance ``slope
+00002b70: 5f6c 656e 6060 205b 6d5d 2075 702d 2061  _len`` [m] up- a
+00002b80: 6e64 2064 6f77 6e73 7472 6561 6d20 6672  nd downstream fr
+00002b90: 6f6d 2074 6865 2073 7562 6772 6964 206f  om the subgrid o
+00002ba0: 7574 6c65 7420 7069 7865 6c2e 0a0a 2020  utlet pixel...  
+00002bb0: 2020 2020 2020 5468 6520 7269 7665 7220        The river 
+00002bc0: 6d61 6e6e 696e 6720 726f 7567 686e 6573  manning roughnes
+00002bd0: 7320 636f 6566 6669 6369 656e 7420 6973  s coefficient is
+00002be0: 2064 6572 6976 6564 2062 6173 6564 206f   derived based o
+00002bf0: 6e20 7265 636c 6173 7369 6669 6361 7469  n reclassificati
+00002c00: 6f6e 0a20 2020 2020 2020 206f 6620 7468  on.        of th
+00002c10: 6520 7374 7265 616d 6f72 6465 7220 6d61  e streamorder ma
+00002c20: 7020 7573 696e 6720 6120 6c6f 6f6b 7570  p using a lookup
+00002c30: 2074 6162 6c65 2060 6072 6976 6d61 6e5f   table ``rivman_
+00002c40: 6d61 7070 696e 675f 666e 6060 2e0a 0a20  mapping_fn``... 
+00002c50: 2020 2020 2020 2054 6865 2072 6976 6572         The river
+00002c60: 2077 6964 7468 2069 7320 6465 7269 7665   width is derive
+00002c70: 6420 6672 6f6d 2074 6865 206e 6561 7265  d from the neare
+00002c80: 7374 2072 6976 6572 2073 6567 6d65 6e74  st river segment
+00002c90: 2069 6e20 6060 7269 7665 725f 6765 6f6d   in ``river_geom
+00002ca0: 5f66 6e60 602e 0a20 2020 2020 2020 2044  _fn``..        D
+00002cb0: 6174 6120 6761 7073 2061 7265 2066 696c  ata gaps are fil
+00002cc0: 6c65 6420 6279 2074 6865 206e 6561 7265  led by the neare
+00002cd0: 7374 2076 616c 6964 2075 7073 7472 6561  st valid upstrea
+00002ce0: 6d20 7661 6c75 6520 616e 6420 6176 6572  m value and aver
+00002cf0: 6167 6564 2061 6c6f 6e67 0a20 2020 2020  aged along.     
+00002d00: 2020 2074 6865 2066 6c6f 7720 6469 7265     the flow dire
+00002d10: 6374 696f 6e73 206f 7665 7220 6120 6c65  ctions over a le
+00002d20: 6e67 7468 2060 6073 6d6f 6f74 685f 6c65  ngth ``smooth_le
+00002d30: 6e60 6020 5b6d 5d0a 0a20 2020 2020 2020  n`` [m]..       
+00002d40: 2054 6865 2072 6976 6572 2064 6570 7468   The river depth
+00002d50: 2069 7320 6361 6c63 756c 6174 6564 2075   is calculated u
+00002d60: 7369 6e67 2074 6865 2060 6072 6976 6470  sing the ``rivdp
+00002d70: 685f 6d65 7468 6f64 6060 2c20 6279 2064  h_method``, by d
+00002d80: 6566 6175 6c74 2070 6f77 6c61 773a 0a20  efault powlaw:. 
+00002d90: 2020 2020 2020 2068 203d 2068 632a 5162         h = hc*Qb
+00002da0: 662a 2a68 702c 2077 6869 6368 2069 7320  f**hp, which is 
+00002db0: 6261 7365 6420 6f6e 2071 6261 6e6b 6675  based on qbankfu
+00002dc0: 6c6c 2064 6973 6368 6172 6765 2066 726f  ll discharge fro
+00002dd0: 6d20 7468 6520 6e65 6172 6573 7420 7269  m the nearest ri
+00002de0: 7665 720a 2020 2020 2020 2020 7365 676d  ver.        segm
+00002df0: 656e 7420 696e 2060 6072 6976 6572 5f67  ent in ``river_g
+00002e00: 656f 6d5f 666e 6060 2061 6e64 2074 616b  eom_fn`` and tak
+00002e10: 6573 206f 7074 696f 6e61 6c20 6172 6775  es optional argu
+00002e20: 6d65 6e74 7320 666f 7220 7468 6520 6863  ments for the hc
+00002e30: 0a20 2020 2020 2020 2028 6465 6661 756c  .        (defaul
+00002e40: 7420 3d20 302e 3237 2920 616e 6420 6870  t = 0.27) and hp
+00002e50: 2028 6465 6661 756c 7420 3d20 302e 3330   (default = 0.30
+00002e60: 2920 7061 7261 6d65 7465 7273 2e20 466f  ) parameters. Fo
+00002e70: 7220 6f74 6865 7220 6d65 7468 6f64 7320  r other methods 
+00002e80: 7365 650a 2020 2020 2020 2020 3a70 793a  see.        :py:
+00002e90: 6d65 7468 3a60 6879 6472 6f6d 742e 776f  meth:`hydromt.wo
+00002ea0: 726b 666c 6f77 732e 7269 7665 725f 6465  rkflows.river_de
+00002eb0: 7074 6860 2e0a 0a20 2020 2020 2020 2049  pth`...        I
+00002ec0: 6620 6060 7269 7665 725f 726f 7574 696e  f ``river_routin
+00002ed0: 6760 6020 6973 2073 6574 2074 6f20 226c  g`` is set to "l
+00002ee0: 6f63 616c 2d69 6e65 7274 6961 6c22 2c20  ocal-inertial", 
+00002ef0: 7468 6520 6261 6e6b 6675 6c6c 2065 6c65  the bankfull ele
+00002f00: 7661 6e74 696f 6e20 6d61 7020 6361 6e20  vantion map can 
+00002f10: 6265 0a20 2020 2020 2020 2063 6f6e 6469  be.        condi
+00002f20: 7469 6f6e 6564 2062 6173 6564 206f 6e20  tioned based on 
+00002f30: 7468 6520 6176 6572 6167 6520 6365 6c6c  the average cell
+00002f40: 2065 6c65 7661 7469 6f6e 2028 2277 666c   elevation ("wfl
+00002f50: 6f77 5f64 656d 2229 206f 7220 7375 6267  ow_dem") or subg
+00002f60: 7269 6420 6f75 746c 6574 2070 6978 656c  rid outlet pixel
+00002f70: 0a20 2020 2020 2020 2065 6c65 7661 7469  .        elevati
+00002f80: 6f6e 2028 2264 656d 5f73 7562 6772 6964  on ("dem_subgrid
+00002f90: 2229 2e20 5468 6520 7375 6267 7269 6420  "). The subgrid 
+00002fa0: 656c 6576 6174 696f 6e20 6d69 6768 7420  elevation might 
+00002fb0: 7072 6f76 6964 6520 6120 6265 7474 6572  provide a better
+00002fc0: 2072 6570 7265 7365 6e74 6174 696f 6e0a   representation.
+00002fd0: 2020 2020 2020 2020 6f66 2074 6865 2072          of the r
+00002fe0: 6976 6572 2065 6c65 7661 7469 6f6e 2070  iver elevation p
+00002ff0: 726f 6669 6c65 2c20 686f 7765 7665 7220  rofile, however 
+00003000: 696e 2063 6f6d 6269 6e61 7469 6f6e 2077  in combination w
+00003010: 6974 6820 6c6f 6361 6c2d 696e 6572 7469  ith local-inerti
+00003020: 616c 206c 616e 6420 726f 7574 696e 670a  al land routing.
+00003030: 2020 2020 2020 2020 2873 6565 203a 7079          (see :py
+00003040: 3a6d 6574 683a 6073 6574 7570 5f66 6c6f  :meth:`setup_flo
+00003050: 6f64 706c 6169 6e73 6029 2074 6865 2073  odplains`) the s
+00003060: 7562 6772 6964 2065 6c65 7661 7469 6f6e  ubgrid elevation
+00003070: 2077 696c 6c20 6c69 6b65 6c79 206f 7665   will likely ove
+00003080: 7265 7374 696d 6174 6520 7468 650a 2020  restimate the.  
+00003090: 2020 2020 2020 666c 6f6f 6470 6c61 696e        floodplain
+000030a0: 2073 746f 7261 6765 2063 6170 6163 6974   storage capacit
+000030b0: 792e 204e 6f74 6520 7468 6174 2074 6865  y. Note that the
+000030c0: 2073 616d 6520 696e 7075 7420 656c 6576   same input elev
+000030d0: 6174 696f 6e20 6d61 7020 7368 6f75 6c64  ation map should
+000030e0: 2062 6520 7573 6564 2066 6f72 0a20 2020   be used for.   
+000030f0: 2020 2020 2072 6976 6572 2062 616e 6b66       river bankf
+00003100: 756c 6c20 656c 6576 6174 696f 6e20 616e  ull elevation an
+00003110: 6420 6c61 6e64 2065 6c65 7661 7469 6f6e  d land elevation
+00003120: 2077 6865 6e20 7573 696e 6720 6c6f 6361   when using loca
+00003130: 6c2d 696e 6572 7469 616c 206c 616e 6420  l-inertial land 
+00003140: 726f 7574 696e 672e 0a0a 2020 2020 2020  routing...      
+00003150: 2020 4164 6473 206d 6f64 656c 206c 6179    Adds model lay
+00003160: 6572 733a 0a0a 2020 2020 2020 2020 2a20  ers:..        * 
+00003170: 2a2a 7766 6c6f 775f 7269 7665 722a 2a20  **wflow_river** 
+00003180: 6d61 703a 2072 6976 6572 206d 6173 6b20  map: river mask 
+00003190: 5b2d 5d0a 2020 2020 2020 2020 2a20 2a2a  [-].        * **
+000031a0: 7766 6c6f 775f 7269 7665 726c 656e 6774  wflow_riverlengt
+000031b0: 682a 2a20 6d61 703a 2072 6976 6572 206c  h** map: river l
+000031c0: 656e 6774 6820 5b6d 5d0a 2020 2020 2020  ength [m].      
+000031d0: 2020 2a20 2a2a 7766 6c6f 775f 7269 7665    * **wflow_rive
+000031e0: 7277 6964 7468 2a2a 206d 6170 3a20 7269  rwidth** map: ri
+000031f0: 7665 7220 7769 6474 6820 5b6d 5d0a 2020  ver width [m].  
+00003200: 2020 2020 2020 2a20 2a2a 5269 7665 7244        * **RiverD
+00003210: 6570 7468 2a2a 206d 6170 3a20 6261 6e6b  epth** map: bank
+00003220: 6675 6c6c 2072 6976 6572 2064 6570 7468  full river depth
+00003230: 205b 6d5d 0a20 2020 2020 2020 202a 202a   [m].        * *
+00003240: 2a52 6976 6572 536c 6f70 652a 2a20 6d61  *RiverSlope** ma
+00003250: 703a 2072 6976 6572 2073 6c6f 7065 205b  p: river slope [
+00003260: 6d2f 6d5d 0a20 2020 2020 2020 202a 202a  m/m].        * *
+00003270: 2a4e 5f52 6976 6572 2a2a 206d 6170 3a20  *N_River** map: 
+00003280: 4d61 6e6e 696e 6720 636f 6566 6669 6369  Manning coeffici
+00003290: 656e 7420 666f 7220 7269 7665 7220 6365  ent for river ce
+000032a0: 6c6c 7320 5b73 2e6d 5e31 2f33 5d0a 2020  lls [s.m^1/3].  
+000032b0: 2020 2020 2020 2a20 2a2a 7269 7665 7273        * **rivers
+000032c0: 2a2a 2067 656f 6d3a 2072 6976 6572 2076  ** geom: river v
+000032d0: 6563 746f 7220 6261 7365 6420 6f6e 2077  ector based on w
+000032e0: 666c 6f77 5f72 6976 6572 206d 6173 6b0a  flow_river mask.
+000032f0: 2020 2020 2020 2020 2a20 2a2a 6879 6472          * **hydr
+00003300: 6f64 656d 2a2a 206d 6170 3a20 6879 6472  odem** map: hydr
+00003310: 6f6c 6f67 6963 616c 6c79 2063 6f6e 6469  ologically condi
+00003320: 7469 6f6e 6564 2065 6c65 7661 7469 6f6e  tioned elevation
+00003330: 205b 6d2b 5245 465d 0a0a 2020 2020 2020   [m+REF]..      
+00003340: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00003350: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00003360: 2020 2020 2020 2020 6879 6472 6f67 7261          hydrogra
+00003370: 7068 795f 666e 203a 2073 7472 2c20 5061  phy_fn : str, Pa
+00003380: 7468 0a20 2020 2020 2020 2020 2020 204e  th.            N
+00003390: 616d 6520 6f66 2064 6174 6120 736f 7572  ame of data sour
+000033a0: 6365 2066 6f72 2068 7964 726f 6772 6170  ce for hydrograp
+000033b0: 6879 2064 6174 612e 0a20 2020 2020 2020  hy data..       
+000033c0: 2020 2020 204d 7573 7420 6265 2073 616d       Must be sam
+000033d0: 6520 6173 2073 6574 7570 5f62 6173 656d  e as setup_basem
+000033e0: 6170 7320 666f 7220 636f 6e73 6973 7465  aps for consiste
+000033f0: 6e74 2072 6573 756c 7473 2e0a 0a20 2020  nt results...   
+00003400: 2020 2020 2020 2020 202a 2052 6571 7569           * Requi
+00003410: 7265 6420 7661 7269 6162 6c65 733a 205b  red variables: [
+00003420: 2766 6c77 6469 7227 2c20 2775 7061 7265  'flwdir', 'upare
+00003430: 6127 2c20 2765 6c65 7674 6e27 5d0a 2020  a', 'elevtn'].  
+00003440: 2020 2020 2020 2020 2020 2a20 4f70 7469            * Opti
+00003450: 6f6e 616c 2076 6172 6961 626c 6573 3a20  onal variables: 
+00003460: 5b27 7269 7677 7468 272c 2027 7162 616e  ['rivwth', 'qban
+00003470: 6b66 756c 6c27 5d0a 2020 2020 2020 2020  kfull'].        
+00003480: 7269 7665 725f 6765 6f6d 5f66 6e20 3a20  river_geom_fn : 
+00003490: 7374 722c 2050 6174 682c 206f 7074 696f  str, Path, optio
+000034a0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+000034b0: 4e61 6d65 206f 6620 6461 7461 2073 6f75  Name of data sou
+000034c0: 7263 6520 666f 7220 7269 7665 7220 6461  rce for river da
+000034d0: 7461 2e0a 0a20 2020 2020 2020 2020 2020  ta...           
+000034e0: 202a 2052 6571 7569 7265 6420 7661 7269   * Required vari
+000034f0: 6162 6c65 733a 205b 2772 6976 7774 6827  ables: ['rivwth'
+00003500: 2c20 2771 6261 6e6b 6675 6c6c 275d 0a20  , 'qbankfull']. 
+00003510: 2020 2020 2020 2072 6976 6572 5f75 7061         river_upa
+00003520: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
+00003530: 2020 2020 206d 696e 696d 756d 2075 7073       minimum ups
+00003540: 7472 6561 6d20 6172 6561 2074 6872 6573  tream area thres
+00003550: 686f 6c64 2066 6f72 2074 6865 2072 6976  hold for the riv
+00003560: 6572 206d 6170 205b 6b6d 325d 0a20 2020  er map [km2].   
+00003570: 2020 2020 2073 6c6f 7065 5f6c 656e 203a       slope_len :
+00003580: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00003590: 2020 206c 656e 6774 6820 6f76 6572 2077     length over w
+000035a0: 6869 6368 2074 6865 2072 6976 6572 2073  hich the river s
+000035b0: 6c6f 7065 2069 7320 6361 6c63 756c 6174  lope is calculat
+000035c0: 6564 205b 6b6d 5d0a 2020 2020 2020 2020  ed [km].        
+000035d0: 6d69 6e5f 7269 766c 656e 5f72 6174 696f  min_rivlen_ratio
+000035e0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+000035f0: 2020 2020 5261 7469 6f20 6f66 2063 656c      Ratio of cel
+00003600: 6c20 7265 736f 6c75 7469 6f6e 2075 7365  l resolution use
+00003610: 6420 6d69 6e69 6d75 6d20 6c65 6e67 7468  d minimum length
+00003620: 2074 6872 6573 686f 6c64 2069 6e20 6120   threshold in a 
+00003630: 6d6f 7669 6e67 0a20 2020 2020 2020 2020  moving.         
+00003640: 2020 2077 696e 646f 7720 6261 7365 6420     window based 
+00003650: 736d 6f6f 7468 696e 6720 6f66 2072 6976  smoothing of riv
+00003660: 6572 206c 656e 6774 682c 2062 7920 6465  er length, by de
+00003670: 6661 756c 7420 302e 300a 2020 2020 2020  fault 0.0.      
+00003680: 2020 2020 2020 5468 6520 7269 7665 7220        The river 
+00003690: 6c65 6e67 7468 2073 6d6f 6f74 6869 6e67  length smoothing
+000036a0: 2069 7320 736b 6970 7065 6420 6966 206d   is skipped if m
+000036b0: 696e 5f72 6976 6572 6c65 6e5f 7261 7469  in_riverlen_rati
+000036c0: 6f20 3d20 302e 0a20 2020 2020 2020 2020  o = 0..         
+000036d0: 2020 2046 6f72 2064 6574 6169 6c73 2061     For details a
+000036e0: 626f 7574 2074 6865 2072 6976 6572 206c  bout the river l
+000036f0: 656e 6774 6820 736d 6f6f 7468 696e 672c  ength smoothing,
+00003700: 2073 6565 203a 7079 3a6d 6574 683a 6070   see :py:meth:`p
+00003710: 7966 6c77 6469 722e 466c 7764 6972 5261  yflwdir.FlwdirRa
+00003720: 7374 6572 2e73 6d6f 6f74 685f 7269 766c  ster.smooth_rivl
+00003730: 656e 600a 2020 2020 2020 2020 7269 7664  en`.        rivd
+00003740: 7068 5f6d 6574 686f 6420 3a20 7b27 6776  ph_method : {'gv
+00003750: 6627 2c20 276d 616e 6e69 6e67 272c 2027  f', 'manning', '
+00003760: 706f 776c 6177 277d 0a20 2020 2020 2020  powlaw'}.       
+00003770: 2020 2020 2073 6565 2070 793a 6d65 7468       see py:meth
+00003780: 3a60 6879 6472 6f6d 742e 776f 726b 666c  :`hydromt.workfl
+00003790: 6f77 732e 7269 7665 725f 6465 7074 6860  ows.river_depth`
+000037a0: 2066 6f72 2064 6574 6169 6c73 2c20 6279   for details, by
+000037b0: 2064 6566 6175 6c74 2022 706f 776c 6177   default "powlaw
+000037c0: 220a 2020 2020 2020 2020 7269 7665 725f  ".        river_
+000037d0: 726f 7574 696e 6720 3a20 7b27 6b69 6e65  routing : {'kine
+000037e0: 6d61 7469 632d 7761 7665 272c 2027 6c6f  matic-wave', 'lo
+000037f0: 6361 6c2d 696e 6572 7469 616c 277d 0a20  cal-inertial'}. 
+00003800: 2020 2020 2020 2020 2020 2052 6f75 7469             Routi
+00003810: 6e67 206d 6574 686f 646f 6c6f 6779 2074  ng methodology t
+00003820: 6f20 6265 2075 7365 642c 2062 7920 6465  o be used, by de
+00003830: 6661 756c 7420 226b 696e 656d 6174 6963  fault "kinematic
+00003840: 2d77 6176 6522 2e0a 2020 2020 2020 2020  -wave"..        
+00003850: 736d 6f6f 7468 5f6c 656e 203a 2066 6c6f  smooth_len : flo
+00003860: 6174 2c20 6f70 7469 6f6e 616c 0a20 2020  at, optional.   
+00003870: 2020 2020 2020 2020 204c 656e 6774 6820           Length 
+00003880: 5b6d 5d20 6f76 6572 2077 6869 6368 2074  [m] over which t
+00003890: 6f20 736d 6f6f 7468 2074 6865 206f 7574  o smooth the out
+000038a0: 7075 7420 7269 7665 7220 7769 6474 6820  put river width 
+000038b0: 616e 6420 6465 7074 682c 2062 7920 6465  and depth, by de
+000038c0: 6661 756c 7420 3565 330a 2020 2020 2020  fault 5e3.      
+000038d0: 2020 6d69 6e5f 7269 7664 7068 203a 2066    min_rivdph : f
+000038e0: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0a20  loat, optional. 
+000038f0: 2020 2020 2020 2020 2020 204d 696e 696d             Minim
+00003900: 756d 2072 6976 6572 2064 6570 7468 205b  um river depth [
+00003910: 6d5d 2c20 6279 2064 6566 6175 6c74 2031  m], by default 1
+00003920: 2e30 0a20 2020 2020 2020 206d 696e 5f72  .0.        min_r
+00003930: 6976 7774 6820 3a20 666c 6f61 742c 206f  ivwth : float, o
+00003940: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00003950: 2020 2020 4d69 6e69 6d75 6d20 7269 7665      Minimum rive
+00003960: 7220 7769 6474 6820 5b6d 5d2c 2062 7920  r width [m], by 
+00003970: 6465 6661 756c 7420 3330 2e30 0a20 2020  default 30.0.   
+00003980: 2020 2020 2065 6c65 7674 6e5f 6d61 7020       elevtn_map 
+00003990: 3a20 7374 722c 206f 7074 696f 6e61 6c0a  : str, optional.
+000039a0: 2020 2020 2020 2020 2020 2020 6279 2064              by d
+000039b0: 6566 6175 6c74 2022 7766 6c6f 775f 6465  efault "wflow_de
+000039c0: 6d22 2c0a 0a20 2020 2020 2020 2053 6565  m",..        See
+000039d0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+000039e0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2077  ------.        w
+000039f0: 6f72 6b66 6c6f 7773 2e72 6976 6572 5f62  orkflows.river_b
+00003a00: 6174 6879 6d65 7472 790a 2020 2020 2020  athymetry.      
+00003a10: 2020 6879 6472 6f6d 742e 776f 726b 666c    hydromt.workfl
+00003a20: 6f77 732e 7269 7665 725f 6465 7074 680a  ows.river_depth.
+00003a30: 2020 2020 2020 2020 7079 666c 7764 6972          pyflwdir
+00003a40: 2e46 6c77 6469 7252 6173 7465 722e 7269  .FlwdirRaster.ri
+00003a50: 7665 725f 6465 7074 680a 2020 2020 2020  ver_depth.      
+00003a60: 2020 7365 7475 705f 666c 6f6f 6470 6c61    setup_floodpla
+00003a70: 696e 730a 2020 2020 2020 2020 2222 220a  ins.        """.
+00003a80: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00003a90: 6765 722e 696e 666f 2866 2250 7265 7061  ger.info(f"Prepa
+00003aa0: 7269 6e67 2072 6976 6572 206d 6170 732e  ring river maps.
+00003ab0: 2229 0a0a 2020 2020 2020 2020 7269 7664  ")..        rivd
+00003ac0: 7068 5f6d 6574 686f 6473 203d 205b 2267  ph_methods = ["g
+00003ad0: 7666 222c 2022 6d61 6e6e 696e 6722 2c20  vf", "manning", 
+00003ae0: 2270 6f77 6c61 7722 5d0a 2020 2020 2020  "powlaw"].      
+00003af0: 2020 6966 2072 6976 6470 685f 6d65 7468    if rivdph_meth
+00003b00: 6f64 206e 6f74 2069 6e20 7269 7664 7068  od not in rivdph
+00003b10: 5f6d 6574 686f 6473 3a0a 2020 2020 2020  _methods:.      
+00003b20: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00003b30: 6545 7272 6f72 2866 2722 7b72 6976 6470  eError(f'"{rivdp
+00003b40: 685f 6d65 7468 6f64 7d22 2075 6e6b 6e6f  h_method}" unkno
+00003b50: 776e 2e20 5365 6c65 6374 2066 726f 6d20  wn. Select from 
+00003b60: 7b72 6976 6470 685f 6d65 7468 6f64 737d  {rivdph_methods}
+00003b70: 2729 0a0a 2020 2020 2020 2020 726f 7574  ')..        rout
+00003b80: 696e 675f 6f70 7469 6f6e 7320 3d20 5b22  ing_options = ["
+00003b90: 6b69 6e65 6d61 7469 632d 7761 7665 222c  kinematic-wave",
+00003ba0: 2022 6c6f 6361 6c2d 696e 6572 7469 616c   "local-inertial
+00003bb0: 225d 0a20 2020 2020 2020 2069 6620 7269  "].        if ri
+00003bc0: 7665 725f 726f 7574 696e 6720 6e6f 7420  ver_routing not 
+00003bd0: 696e 2072 6f75 7469 6e67 5f6f 7074 696f  in routing_optio
+00003be0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00003bf0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00003c00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00003c10: 2020 6627 7269 7665 725f 726f 7574 696e    f'river_routin
+00003c20: 673d 227b 7269 7665 725f 726f 7574 696e  g="{river_routin
+00003c30: 677d 2220 756e 6b6e 6f77 6e2e 2053 656c  g}" unknown. Sel
+00003c40: 6563 7420 6672 6f6d 207b 726f 7574 696e  ect from {routin
+00003c50: 675f 6f70 7469 6f6e 737d 2e27 0a20 2020  g_options}.'.   
+00003c60: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00003c70: 2020 2020 2320 7265 6164 2064 6174 610a      # read data.
+00003c80: 2020 2020 2020 2020 6473 5f68 7964 726f          ds_hydro
+00003c90: 203d 2073 656c 662e 6461 7461 5f63 6174   = self.data_cat
+00003ca0: 616c 6f67 2e67 6574 5f72 6173 7465 7264  alog.get_rasterd
+00003cb0: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
+00003cc0: 2020 2020 6879 6472 6f67 7261 7068 795f      hydrography_
+00003cd0: 666e 2c20 6765 6f6d 3d73 656c 662e 7265  fn, geom=self.re
+00003ce0: 6769 6f6e 2c20 6275 6666 6572 3d31 300a  gion, buffer=10.
+00003cf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00003d00: 2020 6473 5f68 7964 726f 2e63 6f6f 7264    ds_hydro.coord
+00003d10: 735b 226d 6173 6b22 5d20 3d20 6473 5f68  s["mask"] = ds_h
+00003d20: 7964 726f 2e72 6173 7465 722e 6765 6f6d  ydro.raster.geom
+00003d30: 6574 7279 5f6d 6173 6b28 7365 6c66 2e72  etry_mask(self.r
+00003d40: 6567 696f 6e29 0a0a 2020 2020 2020 2020  egion)..        
+00003d50: 2320 6765 7420 7269 766d 736b 2c20 7269  # get rivmsk, ri
+00003d60: 766c 656e 2c20 7269 7673 6c70 0a20 2020  vlen, rivslp.   
+00003d70: 2020 2020 2023 2072 6561 6420 6d6f 6465       # read mode
+00003d80: 6c20 6d61 7073 2061 6e64 2072 6576 6572  l maps and rever
+00003d90: 7420 7766 6c6f 7720 746f 2068 7964 726f  t wflow to hydro
+00003da0: 6d74 206d 6170 206e 616d 6573 0a20 2020  mt map names.   
+00003db0: 2020 2020 2069 6e76 5f72 656e 616d 6520       inv_rename 
+00003dc0: 3d20 7b76 3a20 6b20 666f 7220 6b2c 2076  = {v: k for k, v
+00003dd0: 2069 6e20 7365 6c66 2e5f 4d41 5053 2e69   in self._MAPS.i
+00003de0: 7465 6d73 2829 2069 6620 7620 696e 2073  tems() if v in s
+00003df0: 656c 662e 7374 6174 6963 6d61 7073 7d0a  elf.staticmaps}.
+00003e00: 2020 2020 2020 2020 6473 5f72 6976 203d          ds_riv =
+00003e10: 2077 6f72 6b66 6c6f 7773 2e72 6976 6572   workflows.river
+00003e20: 280a 2020 2020 2020 2020 2020 2020 6473  (.            ds
+00003e30: 3d64 735f 6879 6472 6f2c 0a20 2020 2020  =ds_hydro,.     
+00003e40: 2020 2020 2020 2064 735f 6d6f 6465 6c3d         ds_model=
+00003e50: 7365 6c66 2e73 7461 7469 636d 6170 732e  self.staticmaps.
+00003e60: 7265 6e61 6d65 2869 6e76 5f72 656e 616d  rename(inv_renam
+00003e70: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+00003e80: 7269 7665 725f 7570 613d 7269 7665 725f  river_upa=river_
+00003e90: 7570 612c 0a20 2020 2020 2020 2020 2020  upa,.           
+00003ea0: 2073 6c6f 7065 5f6c 656e 3d73 6c6f 7065   slope_len=slope
+00003eb0: 5f6c 656e 2c0a 2020 2020 2020 2020 2020  _len,.          
+00003ec0: 2020 6368 616e 6e65 6c5f 6469 723d 2275    channel_dir="u
+00003ed0: 7022 2c0a 2020 2020 2020 2020 2020 2020  p",.            
+00003ee0: 6d69 6e5f 7269 766c 656e 5f72 6174 696f  min_rivlen_ratio
+00003ef0: 3d6d 696e 5f72 6976 6c65 6e5f 7261 7469  =min_rivlen_rati
+00003f00: 6f2c 0a20 2020 2020 2020 2020 2020 206c  o,.            l
+00003f10: 6f67 6765 723d 7365 6c66 2e6c 6f67 6765  ogger=self.logge
+00003f20: 722c 0a20 2020 2020 2020 2029 5b30 5d0a  r,.        )[0].
+00003f30: 0a20 2020 2020 2020 2064 735f 7269 765b  .        ds_riv[
+00003f40: 2272 6976 6d73 6b22 5d20 3d20 6473 5f72  "rivmsk"] = ds_r
+00003f50: 6976 5b22 7269 766d 736b 225d 2e61 7373  iv["rivmsk"].ass
+00003f60: 6967 6e5f 6174 7472 7328 0a20 2020 2020  ign_attrs(.     
+00003f70: 2020 2020 2020 2072 6976 6572 5f75 7061         river_upa
+00003f80: 3d72 6976 6572 5f75 7061 2c20 736c 6f70  =river_upa, slop
+00003f90: 655f 6c65 6e3d 736c 6f70 655f 6c65 6e2c  e_len=slope_len,
+00003fa0: 206d 696e 5f72 6976 6c65 6e5f 7261 7469   min_rivlen_rati
+00003fb0: 6f3d 6d69 6e5f 7269 766c 656e 5f72 6174  o=min_rivlen_rat
+00003fc0: 696f 0a20 2020 2020 2020 2029 0a20 2020  io.        ).   
+00003fd0: 2020 2020 2064 7661 7273 203d 205b 2272       dvars = ["r
+00003fe0: 6976 6d73 6b22 2c20 2272 6976 6c65 6e22  ivmsk", "rivlen"
+00003ff0: 2c20 2272 6976 736c 7022 5d0a 2020 2020  , "rivslp"].    
+00004000: 2020 2020 726d 6469 6374 203d 207b 6b3a      rmdict = {k:
+00004010: 2073 656c 662e 5f4d 4150 532e 6765 7428   self._MAPS.get(
+00004020: 6b2c 206b 2920 666f 7220 6b20 696e 2064  k, k) for k in d
+00004030: 7661 7273 7d0a 2020 2020 2020 2020 7365  vars}.        se
+00004040: 6c66 2e73 6574 5f73 7461 7469 636d 6170  lf.set_staticmap
+00004050: 7328 6473 5f72 6976 5b64 7661 7273 5d2e  s(ds_riv[dvars].
+00004060: 7265 6e61 6d65 2872 6d64 6963 7429 290a  rename(rmdict)).
+00004070: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
+00004080: 6d61 6b65 2073 6570 6172 6174 6520 776f  make separate wo
+00004090: 726b 666c 6f77 732e 7269 7665 725f 6d61  rkflows.river_ma
+000040a0: 6e6e 696e 6720 206d 6574 686f 640a 2020  nning  method.  
+000040b0: 2020 2020 2020 2320 4d61 6b65 204e 5f52        # Make N_R
+000040c0: 6976 6572 206d 6170 2066 726f 6d20 6373  iver map from cs
+000040d0: 7620 6669 6c65 2077 6974 6820 6d61 7070  v file with mapp
+000040e0: 696e 6720 6265 7477 6565 6e20 7374 7265  ing between stre
+000040f0: 616d 6f72 6465 7220 616e 6420 4e5f 5269  amorder and N_Ri
+00004100: 7665 7220 7661 6c75 650a 2020 2020 2020  ver value.      
+00004110: 2020 7374 726f 7264 203d 2073 656c 662e    strord = self.
+00004120: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
+00004130: 5f4d 4150 535b 2273 7472 6f72 6422 5d5d  _MAPS["strord"]]
+00004140: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00004150: 6466 203d 2073 656c 662e 6461 7461 5f63  df = self.data_c
+00004160: 6174 616c 6f67 2e67 6574 5f64 6174 6166  atalog.get_dataf
+00004170: 7261 6d65 2872 6976 6d61 6e5f 6d61 7070  rame(rivman_mapp
+00004180: 696e 675f 666e 290a 2020 2020 2020 2020  ing_fn).        
+00004190: 2320 6d61 7820 7374 7265 616d 6f72 6465  # max streamorde
+000041a0: 7220 7661 6c75 6520 6162 6f76 6520 7768  r value above wh
+000041b0: 6963 6820 7661 6c75 6573 2067 6574 2074  ich values get t
+000041c0: 6865 2073 616d 6520 4e5f 5269 7665 7220  he same N_River 
+000041d0: 7661 6c75 650a 2020 2020 2020 2020 6d61  value.        ma
+000041e0: 785f 7374 7220 3d20 6466 2e69 6e64 6578  x_str = df.index
+000041f0: 5b2d 325d 0a20 2020 2020 2020 2023 2069  [-2].        # i
+00004200: 6620 7374 7265 616d 6f72 6465 7220 7661  f streamorder va
+00004210: 6c75 6520 6c61 7267 6572 2074 6861 6e20  lue larger than 
+00004220: 6d61 785f 7374 722c 2061 7373 6967 6e20  max_str, assign 
+00004230: 6c61 7374 2076 616c 7565 0a20 2020 2020  last value.     
+00004240: 2020 2073 7472 6f72 6420 3d20 7374 726f     strord = stro
+00004250: 7264 2e77 6865 7265 2873 7472 6f72 6420  rd.where(strord 
+00004260: 3c3d 206d 6178 5f73 7472 2c20 6d61 785f  <= max_str, max_
+00004270: 7374 7229 0a20 2020 2020 2020 2023 2068  str).        # h
+00004280: 616e 646c 6520 6d69 7373 696e 6720 7661  andle missing va
+00004290: 6c75 6520 286c 6173 7420 726f 7720 6f66  lue (last row of
+000042a0: 2063 7376 2069 7320 6d61 7070 696e 6720   csv is mapping 
+000042b0: 6f66 206d 6973 7369 6e67 2076 616c 7565  of missing value
+000042c0: 7329 0a20 2020 2020 2020 2073 7472 6f72  s).        stror
+000042d0: 6420 3d20 7374 726f 7264 2e77 6865 7265  d = strord.where
+000042e0: 2873 7472 6f72 6420 213d 2073 7472 6f72  (strord != stror
+000042f0: 642e 7261 7374 6572 2e6e 6f64 6174 612c  d.raster.nodata,
+00004300: 202d 3939 3929 0a20 2020 2020 2020 2073   -999).        s
+00004310: 7472 6f72 642e 7261 7374 6572 2e73 6574  trord.raster.set
+00004320: 5f6e 6f64 6174 6128 2d39 3939 290a 2020  _nodata(-999).  
+00004330: 2020 2020 2020 6473 5f6e 7269 7665 7220        ds_nriver 
+00004340: 3d20 776f 726b 666c 6f77 732e 6c61 6e64  = workflows.land
+00004350: 7573 6528 0a20 2020 2020 2020 2020 2020  use(.           
+00004360: 2064 613d 7374 726f 7264 2c0a 2020 2020   da=strord,.    
+00004370: 2020 2020 2020 2020 6473 5f6c 696b 653d          ds_like=
+00004380: 7365 6c66 2e73 7461 7469 636d 6170 732c  self.staticmaps,
+00004390: 0a20 2020 2020 2020 2020 2020 2064 663d  .            df=
+000043a0: 6466 2c0a 2020 2020 2020 2020 2020 2020  df,.            
+000043b0: 6c6f 6767 6572 3d73 656c 662e 6c6f 6767  logger=self.logg
+000043c0: 6572 2c0a 2020 2020 2020 2020 290a 2020  er,.        ).  
+000043d0: 2020 2020 2020 7365 6c66 2e73 6574 5f73        self.set_s
+000043e0: 7461 7469 636d 6170 7328 6473 5f6e 7269  taticmaps(ds_nri
+000043f0: 7665 7229 0a0a 2020 2020 2020 2020 2320  ver)..        # 
+00004400: 6765 7420 7269 7664 7068 2c20 7269 7677  get rivdph, rivw
+00004410: 7468 0a20 2020 2020 2020 2023 2077 6869  th.        # whi
+00004420: 6c65 2077 6520 7374 696c 6c20 6861 7665  le we still have
+00004430: 2073 6574 7570 5f72 6976 6572 7769 6474   setup_riverwidt
+00004440: 6820 6f6e 6520 6361 6e20 736b 6970 2072  h one can skip r
+00004450: 6976 6572 5f62 6174 6879 6d65 7472 7920  iver_bathymetry 
+00004460: 6865 7265 0a20 2020 2020 2020 2023 2054  here.        # T
+00004470: 4f44 4f20 6d61 6b65 2072 6976 6572 5f67  ODO make river_g
+00004480: 656f 6d5f 666e 2072 6571 7569 7265 6420  eom_fn required 
+00004490: 6166 7465 7220 7265 6d6f 7669 6e67 2073  after removing s
+000044a0: 6574 7570 5f72 6976 6572 7769 6474 680a  etup_riverwidth.
+000044b0: 2020 2020 2020 2020 6966 2072 6976 6572          if river
+000044c0: 5f67 656f 6d5f 666e 2069 7320 6e6f 7420  _geom_fn is not 
+000044d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000044e0: 2020 6764 665f 7269 7620 3d20 7365 6c66    gdf_riv = self
+000044f0: 2e64 6174 615f 6361 7461 6c6f 672e 6765  .data_catalog.ge
+00004500: 745f 6765 6f64 6174 6166 7261 6d65 280a  t_geodataframe(.
+00004510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004520: 7269 7665 725f 6765 6f6d 5f66 6e2c 2067  river_geom_fn, g
+00004530: 656f 6d3d 7365 6c66 2e72 6567 696f 6e0a  eom=self.region.
+00004540: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004550: 2020 2020 2020 2020 2020 2320 7265 7265            # rere
+00004560: 6164 206d 6f64 656c 2064 6174 6120 746f  ad model data to
+00004570: 2067 6574 2072 6976 6572 206d 6170 730a   get river maps.
+00004580: 2020 2020 2020 2020 2020 2020 696e 765f              inv_
+00004590: 7265 6e61 6d65 203d 207b 763a 206b 2066  rename = {v: k f
+000045a0: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+000045b0: 5f4d 4150 532e 6974 656d 7328 2920 6966  _MAPS.items() if
+000045c0: 2076 2069 6e20 7365 6c66 2e73 7461 7469   v in self.stati
+000045d0: 636d 6170 737d 0a20 2020 2020 2020 2020  cmaps}.         
+000045e0: 2020 2064 735f 7269 7631 203d 2077 6f72     ds_riv1 = wor
+000045f0: 6b66 6c6f 7773 2e72 6976 6572 5f62 6174  kflows.river_bat
+00004600: 6879 6d65 7472 7928 0a20 2020 2020 2020  hymetry(.       
+00004610: 2020 2020 2020 2020 2064 735f 6d6f 6465           ds_mode
+00004620: 6c3d 7365 6c66 2e73 7461 7469 636d 6170  l=self.staticmap
+00004630: 732e 7265 6e61 6d65 2869 6e76 5f72 656e  s.rename(inv_ren
+00004640: 616d 6529 2c0a 2020 2020 2020 2020 2020  ame),.          
+00004650: 2020 2020 2020 6764 665f 7269 763d 6764        gdf_riv=gd
+00004660: 665f 7269 762c 0a20 2020 2020 2020 2020  f_riv,.         
+00004670: 2020 2020 2020 206d 6574 686f 643d 7269         method=ri
+00004680: 7664 7068 5f6d 6574 686f 642c 0a20 2020  vdph_method,.   
+00004690: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
+000046a0: 6f74 685f 6c65 6e3d 736d 6f6f 7468 5f6c  oth_len=smooth_l
+000046b0: 656e 2c0a 2020 2020 2020 2020 2020 2020  en,.            
+000046c0: 2020 2020 6d69 6e5f 7269 7664 7068 3d6d      min_rivdph=m
+000046d0: 696e 5f72 6976 6470 682c 0a20 2020 2020  in_rivdph,.     
+000046e0: 2020 2020 2020 2020 2020 206d 696e 5f72             min_r
+000046f0: 6976 7774 683d 6d69 6e5f 7269 7677 7468  ivwth=min_rivwth
+00004700: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004710: 2020 6c6f 6767 6572 3d73 656c 662e 6c6f    logger=self.lo
+00004720: 6767 6572 2c0a 2020 2020 2020 2020 2020  gger,.          
+00004730: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+00004740: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004750: 2020 2020 2020 2020 2020 726d 6469 6374            rmdict
+00004760: 203d 207b 6b3a 2076 2066 6f72 206b 2c20   = {k: v for k, 
+00004770: 7620 696e 2073 656c 662e 5f4d 4150 532e  v in self._MAPS.
+00004780: 6974 656d 7328 2920 6966 206b 2069 6e20  items() if k in 
+00004790: 6473 5f72 6976 312e 6461 7461 5f76 6172  ds_riv1.data_var
+000047a0: 737d 0a20 2020 2020 2020 2020 2020 2073  s}.            s
+000047b0: 656c 662e 7365 745f 7374 6174 6963 6d61  elf.set_staticma
+000047c0: 7073 2864 735f 7269 7631 2e72 656e 616d  ps(ds_riv1.renam
+000047d0: 6528 726d 6469 6374 2929 0a20 2020 2020  e(rmdict)).     
+000047e0: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
+000047f0: 636f 6e66 6967 0a20 2020 2020 2020 2020  config.         
+00004800: 2020 2073 656c 662e 7365 745f 636f 6e66     self.set_conf
+00004810: 6967 2822 696e 7075 742e 6c61 7465 7261  ig("input.latera
+00004820: 6c2e 7269 7665 722e 6261 6e6b 6675 6c6c  l.river.bankfull
+00004830: 5f64 6570 7468 222c 2073 656c 662e 5f4d  _depth", self._M
+00004840: 4150 535b 2272 6976 6470 6822 5d29 0a0a  APS["rivdph"])..
+00004850: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00004860: 6765 722e 6465 6275 6728 6622 4164 6469  ger.debug(f"Addi
+00004870: 6e67 2072 6976 6572 7320 7665 6374 6f72  ng rivers vector
+00004880: 2074 6f20 7374 6174 6963 6765 6f6d 732e   to staticgeoms.
+00004890: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+000048a0: 7374 6174 6963 6765 6f6d 732e 706f 7028  staticgeoms.pop(
+000048b0: 2272 6976 6572 7322 2c20 4e6f 6e65 2920  "rivers", None) 
+000048c0: 2023 2072 656d 6f76 6520 6f6c 6420 7269   # remove old ri
+000048d0: 7665 7273 2069 6620 696e 2073 7461 7469  vers if in stati
+000048e0: 6367 656f 6d73 0a20 2020 2020 2020 2073  cgeoms.        s
+000048f0: 656c 662e 7269 7665 7273 2020 2320 6164  elf.rivers  # ad
+00004900: 6420 6e65 7720 7269 7665 7273 2074 6f20  d new rivers to 
+00004910: 7374 6174 6963 6765 6f6d 730a 0a20 2020  staticgeoms..   
+00004920: 2020 2020 2023 2041 6464 2068 7964 726f       # Add hydro
+00004930: 6c6f 6769 6361 6c6c 7920 636f 6e64 6974  logically condit
+00004940: 696f 6e65 6420 656c 6576 6174 696f 6e20  ioned elevation 
+00004950: 6d61 7020 666f 7220 7468 6520 7269 7665  map for the rive
+00004960: 722c 2069 6620 7265 7175 6972 6564 0a20  r, if required. 
+00004970: 2020 2020 2020 2069 6620 7269 7665 725f         if river_
+00004980: 726f 7574 696e 6720 3d3d 2022 6c6f 6361  routing == "loca
+00004990: 6c2d 696e 6572 7469 616c 223a 0a20 2020  l-inertial":.   
+000049a0: 2020 2020 2020 2020 2070 6f73 7466 6978           postfix
+000049b0: 203d 207b 2277 666c 6f77 5f64 656d 223a   = {"wflow_dem":
+000049c0: 2022 5f61 7667 222c 2022 6465 6d5f 7375   "_avg", "dem_su
+000049d0: 6267 7269 6422 3a20 225f 7375 6267 7269  bgrid": "_subgri
+000049e0: 6422 7d2e 6765 7428 0a20 2020 2020 2020  d"}.get(.       
+000049f0: 2020 2020 2020 2020 2065 6c65 7674 6e5f           elevtn_
+00004a00: 6d61 702c 2022 220a 2020 2020 2020 2020  map, "".        
+00004a10: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00004a20: 2020 6e61 6d65 203d 2066 2268 7964 726f    name = f"hydro
+00004a30: 6465 6d7b 706f 7374 6669 787d 220a 0a20  dem{postfix}".. 
+00004a40: 2020 2020 2020 2020 2020 2064 735f 6f75             ds_ou
+00004a50: 7420 3d20 666c 772e 6465 6d5f 6164 6a75  t = flw.dem_adju
+00004a60: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
+00004a70: 2020 2020 6461 5f66 6c77 6469 723d 7365      da_flwdir=se
+00004a80: 6c66 2e73 7461 7469 636d 6170 735b 7365  lf.staticmaps[se
+00004a90: 6c66 2e5f 4d41 5053 5b22 666c 7764 6972  lf._MAPS["flwdir
+00004aa0: 225d 5d2c 0a20 2020 2020 2020 2020 2020  "]],.           
+00004ab0: 2020 2020 2064 615f 656c 6576 746e 3d73       da_elevtn=s
+00004ac0: 656c 662e 7374 6174 6963 6d61 7073 5b65  elf.staticmaps[e
+00004ad0: 6c65 7674 6e5f 6d61 705d 2c0a 2020 2020  levtn_map],.    
+00004ae0: 2020 2020 2020 2020 2020 2020 6461 5f72              da_r
+00004af0: 6976 6d73 6b3d 7365 6c66 2e73 7461 7469  ivmsk=self.stati
+00004b00: 636d 6170 735b 7365 6c66 2e5f 4d41 5053  cmaps[self._MAPS
+00004b10: 5b22 7269 766d 736b 225d 5d2c 0a20 2020  ["rivmsk"]],.   
+00004b20: 2020 2020 2020 2020 2020 2020 2066 6c77               flw
+00004b30: 6469 723d 7365 6c66 2e66 6c77 6469 722c  dir=self.flwdir,
+00004b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004b50: 2063 6f6e 6e65 6374 6976 6974 793d 636f   connectivity=co
+00004b60: 6e6e 6563 7469 7669 7479 2c0a 2020 2020  nnectivity,.    
+00004b70: 2020 2020 2020 2020 2020 2020 7269 7665              rive
+00004b80: 725f 6438 3d54 7275 652c 0a20 2020 2020  r_d8=True,.     
+00004b90: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00004ba0: 723d 7365 6c66 2e6c 6f67 6765 722c 0a20  r=self.logger,. 
+00004bb0: 2020 2020 2020 2020 2020 2029 2e72 656e             ).ren
+00004bc0: 616d 6528 6e61 6d65 290a 2020 2020 2020  ame(name).      
+00004bd0: 2020 2020 2020 7365 6c66 2e73 6574 5f73        self.set_s
+00004be0: 7461 7469 636d 6170 7328 6473 5f6f 7574  taticmaps(ds_out
+00004bf0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00004c00: 2075 7064 6174 6520 746f 6d6c 206d 6f64   update toml mod
+00004c10: 656c 2e72 6976 6572 5f72 6f75 7469 6e67  el.river_routing
+00004c20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004c30: 662e 6c6f 6767 6572 2e64 6562 7567 280a  f.logger.debug(.
+00004c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c50: 6627 5570 6461 7465 2077 666c 6f77 2063  f'Update wflow c
+00004c60: 6f6e 6669 6720 6d6f 6465 6c2e 7269 7665  onfig model.rive
+00004c70: 725f 726f 7574 696e 673d 227b 7269 7665  r_routing="{rive
+00004c80: 725f 726f 7574 696e 677d 2227 0a20 2020  r_routing}"'.   
+00004c90: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00004ca0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+00004cb0: 636f 6e66 6967 2822 6d6f 6465 6c2e 7269  config("model.ri
+00004cc0: 7665 725f 726f 7574 696e 6722 2c20 7269  ver_routing", ri
+00004cd0: 7665 725f 726f 7574 696e 6729 0a0a 2020  ver_routing)..  
+00004ce0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00004cf0: 6574 5f63 6f6e 6669 6728 2269 6e70 7574  et_config("input
+00004d00: 2e6c 6174 6572 616c 2e72 6976 6572 2e62  .lateral.river.b
+00004d10: 616e 6b66 756c 6c5f 6465 7074 6822 2c20  ankfull_depth", 
+00004d20: 7365 6c66 2e5f 4d41 5053 5b22 7269 7664  self._MAPS["rivd
+00004d30: 7068 225d 290a 2020 2020 2020 2020 2020  ph"]).          
+00004d40: 2020 7365 6c66 2e73 6574 5f63 6f6e 6669    self.set_confi
+00004d50: 6728 2269 6e70 7574 2e6c 6174 6572 616c  g("input.lateral
+00004d60: 2e72 6976 6572 2e62 616e 6b66 756c 6c5f  .river.bankfull_
+00004d70: 656c 6576 6174 696f 6e22 2c20 6e61 6d65  elevation", name
+00004d80: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00004d90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004da0: 2e73 6574 5f63 6f6e 6669 6728 226d 6f64  .set_config("mod
+00004db0: 656c 2e72 6976 6572 5f72 6f75 7469 6e67  el.river_routing
+00004dc0: 222c 2072 6976 6572 5f72 6f75 7469 6e67  ", river_routing
+00004dd0: 290a 0a20 2020 2064 6566 2073 6574 7570  )..    def setup
+00004de0: 5f66 6c6f 6f64 706c 6169 6e73 280a 2020  _floodplains(.  
+00004df0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00004e00: 2020 2020 6879 6472 6f67 7261 7068 795f      hydrography_
+00004e10: 666e 2c0a 2020 2020 2020 2020 666c 6f6f  fn,.        floo
+00004e20: 6470 6c61 696e 5f74 7970 653a 2073 7472  dplain_type: str
+00004e30: 2c0a 2020 2020 2020 2020 2323 2320 4f70  ,.        ### Op
+00004e40: 7469 6f6e 7320 666f 7220 3144 2066 6c6f  tions for 1D flo
+00004e50: 6f64 706c 6169 6e73 0a20 2020 2020 2020  odplains.       
+00004e60: 2072 6976 6572 5f75 7061 3a20 4f70 7469   river_upa: Opti
+00004e70: 6f6e 616c 5b66 6c6f 6174 5d20 3d20 4e6f  onal[float] = No
+00004e80: 6e65 2c0a 2020 2020 2020 2020 666c 6f6f  ne,.        floo
+00004e90: 645f 6465 7074 6873 3a20 4c69 7374 203d  d_depths: List =
+00004ea0: 205b 302e 352c 2031 2e30 2c20 312e 352c   [0.5, 1.0, 1.5,
+00004eb0: 2032 2e30 2c20 322e 352c 2033 2e30 2c20   2.0, 2.5, 3.0, 
+00004ec0: 342e 302c 2035 2e30 5d2c 0a20 2020 2020  4.0, 5.0],.     
+00004ed0: 2020 2023 2323 204f 7074 696f 6e73 2066     ### Options f
+00004ee0: 6f72 2032 4420 666c 6f6f 6470 6c61 696e  or 2D floodplain
+00004ef0: 730a 2020 2020 2020 2020 656c 6576 746e  s.        elevtn
+00004f00: 5f6d 6170 3a20 7374 7220 3d20 2277 666c  _map: str = "wfl
+00004f10: 6f77 5f64 656d 222c 0a20 2020 2020 2020  ow_dem",.       
+00004f20: 2063 6f6e 6e65 6374 6976 6974 793a 2069   connectivity: i
+00004f30: 6e74 203d 2034 2c0a 2020 2020 293a 0a20  nt = 4,.    ):. 
+00004f40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00004f50: 2020 2054 6869 7320 636f 6d70 6f6e 656e     This componen
+00004f60: 7473 2061 6464 7320 666c 6f6f 6470 6c61  ts adds floodpla
+00004f70: 696e 2069 6e66 6f72 6d61 7469 6f6e 2074  in information t
+00004f80: 6f20 7468 6520 6d6f 6465 6c20 7363 6865  o the model sche
+00004f90: 6d61 7469 7374 6174 696f 6e2e 2054 6865  matistation. The
+00004fa0: 2075 7365 7220 6361 6e0a 2020 2020 2020   user can.      
+00004fb0: 2020 6465 6669 6e65 2077 6861 7420 7479    define what ty
+00004fc0: 7065 206f 6620 666c 6f6f 6470 6c61 696e  pe of floodplain
+00004fd0: 7320 6172 6520 7265 7175 6972 6564 2028  s are required (
+00004fe0: 3144 206f 7220 3244 292c 2074 6872 6f75  1D or 2D), throu
+00004ff0: 6768 2074 6865 2060 6066 6c6f 6f64 706c  gh the ``floodpl
+00005000: 6169 6e5f 7479 7065 6060 0a20 2020 2020  ain_type``.     
+00005010: 2020 2061 7267 756d 656e 742e 0a0a 2020     argument...  
+00005020: 2020 2020 2020 4966 2060 6066 6c6f 6f64        If ``flood
+00005030: 706c 6169 6e5f 7479 7065 6060 2069 7320  plain_type`` is 
+00005040: 7365 7420 746f 2022 3164 222c 2061 2066  set to "1d", a f
+00005050: 6c6f 6f64 706c 6169 6e20 7072 6f66 696c  loodplain profil
+00005060: 6520 6973 2064 6572 6976 6564 2066 6f72  e is derived for
+00005070: 2065 7665 7279 2072 6976 6572 0a20 2020   every river.   
+00005080: 2020 2020 2063 656c 6c2e 2049 7420 6164       cell. It ad
+00005090: 6473 2061 206d 6170 2077 6974 6820 666c  ds a map with fl
+000050a0: 6f6f 6470 6c61 696e 2076 6f6c 756d 6520  oodplain volume 
+000050b0: 7065 7220 666c 6f6f 6420 6465 7074 682c  per flood depth,
+000050c0: 2077 6869 6368 2069 7320 7573 6564 2069   which is used i
+000050d0: 6e20 7468 6520 7766 6c6f 770a 2020 2020  n the wflow.    
+000050e0: 2020 2020 3144 2066 6c6f 6f64 706c 6169      1D floodplai
+000050f0: 6e20 7363 6865 6d61 7469 7361 7469 6f6e  n schematisation
+00005100: 2e0a 0a20 2020 2020 2020 204e 6f74 652c  ...        Note,
+00005110: 2069 7420 6973 2069 6d70 6f72 7461 6e74   it is important
+00005120: 2074 6f20 7573 6520 7468 6520 7361 6d65   to use the same
+00005130: 2072 6976 6572 2075 7061 7265 6120 7661   river uparea va
+00005140: 6c75 6520 6173 2075 7365 6420 696e 2074  lue as used in t
+00005150: 6865 203a 7079 3a6d 6574 683a 6073 6574  he :py:meth:`set
+00005160: 7570 5f72 6976 6572 7360 0a20 2020 2020  up_rivers`.     
+00005170: 2020 206d 6574 686f 642e 0a0a 2020 2020     method...    
+00005180: 2020 2020 4966 2060 6066 6c6f 6f64 706c      If ``floodpl
+00005190: 6169 6e5f 7479 7065 6060 2069 7320 7365  ain_type`` is se
+000051a0: 7420 746f 2022 3264 222c 2074 6869 7320  t to "2d", this 
+000051b0: 636f 6d70 6f6e 656e 7420 6164 6473 2061  component adds a
+000051c0: 2068 7964 726f 6c6f 6769 6361 6c6c 7920   hydrologically 
+000051d0: 636f 6e64 6974 696f 6e65 640a 2020 2020  conditioned.    
+000051e0: 2020 2020 656c 6576 6174 696f 6e20 2868      elevation (h
+000051f0: 7964 726f 6465 6d29 206d 6170 2066 6f72  ydrodem) map for
+00005200: 206c 616e 6420 726f 7574 696e 6720 286c   land routing (l
+00005210: 6f63 616c 2d69 6e65 7274 6961 6c29 2e20  ocal-inertial). 
+00005220: 466f 7220 7468 6973 206f 7074 696f 6e73  For this options
+00005230: 2c20 6c61 6e64 6365 6c6c 730a 2020 2020  , landcells.    
+00005240: 2020 2020 6e65 6564 2074 6f20 6265 2063      need to be c
+00005250: 6f6e 6469 7469 6f6e 6564 2074 6f20 4434  onditioned to D4
+00005260: 2066 6c6f 7720 6469 7265 6374 696f 6e73   flow directions
+00005270: 206f 7468 6572 7769 7365 2070 6974 7320   otherwise pits 
+00005280: 6d61 7920 7265 6d61 696e 2069 6e20 7468  may remain in th
+00005290: 6520 6c61 6e64 0a20 2020 2020 2020 2063  e land.        c
+000052a0: 656c 6c73 2e0a 0a20 2020 2020 2020 2054  ells...        T
+000052b0: 6865 2063 6f6e 6469 7469 6f6e 6564 2065  he conditioned e
+000052c0: 6c65 7661 7469 6f6e 2063 616e 2062 6520  levation can be 
+000052d0: 6261 7365 6420 6f6e 2074 6865 2061 7665  based on the ave
+000052e0: 7261 6765 2063 656c 6c20 656c 6576 6174  rage cell elevat
+000052f0: 696f 6e20 2822 7766 6c6f 775f 6465 6d22  ion ("wflow_dem"
+00005300: 2920 6f72 0a20 2020 2020 2020 2073 7562  ) or.        sub
+00005310: 6772 6964 206f 7574 6c65 7420 7069 7865  grid outlet pixe
+00005320: 6c20 656c 6576 6174 696f 6e20 2822 6465  l elevation ("de
+00005330: 6d5f 7375 6267 7269 6422 292e 204e 6f74  m_subgrid"). Not
+00005340: 6520 7468 6174 2074 6865 2073 7562 6772  e that the subgr
+00005350: 6964 2065 6c65 7661 7469 6f6e 2077 696c  id elevation wil
+00005360: 6c0a 2020 2020 2020 2020 6c69 6b65 6c79  l.        likely
+00005370: 206f 7665 7265 7374 696d 6174 6520 7468   overestimate th
+00005380: 6520 666c 6f6f 6470 6c61 696e 2073 746f  e floodplain sto
+00005390: 7261 6765 2063 6170 6163 6974 792e 0a0a  rage capacity...
+000053a0: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
+000053b0: 616c 6c79 2c20 6e6f 7465 2074 6861 7420  ally, note that 
+000053c0: 7468 6520 7361 6d65 2069 6e70 7574 2065  the same input e
+000053d0: 6c65 7661 7469 6f6e 206d 6170 2073 686f  levation map sho
+000053e0: 756c 6420 6265 2075 7365 6420 666f 7220  uld be used for 
+000053f0: 7269 7665 7220 6261 6e6b 6675 6c6c 0a20  river bankfull. 
+00005400: 2020 2020 2020 2065 6c65 7661 7469 6f6e         elevation
+00005410: 2061 6e64 206c 616e 6420 656c 6576 6174   and land elevat
+00005420: 696f 6e20 7768 656e 2075 7369 6e67 206c  ion when using l
+00005430: 6f63 616c 2d69 6e65 7274 6961 6c20 6c61  ocal-inertial la
+00005440: 6e64 2072 6f75 7469 6e67 2e0a 0a20 2020  nd routing...   
+00005450: 2020 2020 2052 6571 7569 7265 7320 3a70       Requires :p
+00005460: 793a 6d65 7468 3a60 7365 7475 705f 7269  y:meth:`setup_ri
+00005470: 7665 7273 6020 746f 2062 6520 6578 6563  vers` to be exec
+00005480: 7574 6564 2062 6566 6f72 6568 616e 6420  uted beforehand 
+00005490: 2877 6974 6820 6060 7269 7665 725f 726f  (with ``river_ro
+000054a0: 7574 696e 6760 6020 7365 7420 746f 0a20  uting`` set to. 
+000054b0: 2020 2020 2020 2022 6c6f 6361 6c2d 696e         "local-in
+000054c0: 6572 7469 616c 2229 2e0a 0a20 2020 2020  ertial")...     
+000054d0: 2020 2041 6464 7320 6d6f 6465 6c20 6c61     Adds model la
+000054e0: 7965 7273 3a0a 0a20 2020 2020 2020 202a  yers:..        *
+000054f0: 202a 2a66 6c6f 6f64 706c 6169 6e5f 766f   **floodplain_vo
+00005500: 6c75 6d65 2a2a 206d 6170 3a20 6d61 7020  lume** map: map 
+00005510: 7769 7468 2066 6c6f 6f64 706c 6169 6e20  with floodplain 
+00005520: 766f 6c75 6d65 732c 2068 6173 2066 6c6f  volumes, has flo
+00005530: 6f64 2064 6570 7468 2061 7320 7468 6972  od depth as thir
+00005540: 640a 2020 2020 2020 2020 2020 6469 6d65  d.          dime
+00005550: 6e73 696f 6e20 5b6d 335d 2028 666f 7220  nsion [m3] (for 
+00005560: 3144 2066 6c6f 6f64 706c 6169 6e73 290a  1D floodplains).
+00005570: 2020 2020 2020 2020 2a20 2a2a 6879 6472          * **hydr
+00005580: 6f64 656d 2a2a 206d 6170 3a20 6879 6472  odem** map: hydr
+00005590: 6f6c 6f67 6963 616c 6c79 2063 6f6e 6469  ologically condi
+000055a0: 7469 6f6e 6564 2065 6c65 7661 7469 6f6e  tioned elevation
+000055b0: 205b 6d2b 5245 465d 2028 666f 7220 3244   [m+REF] (for 2D
+000055c0: 2066 6c6f 6f64 706c 6169 6e73 290a 0a20   floodplains).. 
+000055d0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+000055e0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+000055f0: 2d2d 2d2d 0a20 2020 2020 2020 2066 6c6f  ----.        flo
+00005600: 6f64 706c 6169 6e5f 7479 7065 3a20 7b22  odplain_type: {"
+00005610: 3164 222c 2022 3264 227d 0a20 2020 2020  1d", "2d"}.     
+00005620: 2020 2020 2020 204f 7074 696f 6e20 6465         Option de
+00005630: 6669 6e69 6e67 2074 6865 2074 7970 6520  fining the type 
+00005640: 6f66 2066 6c6f 6f64 706c 6169 6e73 2c20  of floodplains, 
+00005650: 7365 6520 6265 6c6f 7720 7768 6174 2061  see below what a
+00005660: 7267 756d 656e 7473 2061 7265 2072 656c  rguments are rel
+00005670: 6174 6564 2074 6f0a 2020 2020 2020 2020  ated to.        
+00005680: 2020 2020 7468 6520 6469 6666 6572 656e      the differen
+00005690: 7420 666c 6f6f 6470 6c61 696e 2074 7970  t floodplain typ
+000056a0: 6573 0a20 2020 2020 2020 2068 7964 726f  es.        hydro
+000056b0: 6772 6170 6879 5f66 6e20 3a20 7374 722c  graphy_fn : str,
+000056c0: 2050 6174 680a 2020 2020 2020 2020 2020   Path.          
+000056d0: 2020 4e61 6d65 206f 6620 6461 7461 2073    Name of data s
+000056e0: 6f75 7263 6520 666f 7220 6879 6472 6f67  ource for hydrog
+000056f0: 7261 7068 7920 6461 7461 2e20 4d75 7374  raphy data. Must
+00005700: 2062 6520 7361 6d65 2061 7320 7365 7475   be same as setu
+00005710: 705f 6261 7365 6d61 7073 2066 6f72 0a20  p_basemaps for. 
+00005720: 2020 2020 2020 2020 2020 2063 6f6e 7369             consi
+00005730: 7374 656e 7420 7265 7375 6c74 732e 0a0a  stent results...
+00005740: 2020 2020 2020 2020 2020 2020 2a20 5265              * Re
+00005750: 7175 6972 6564 2076 6172 6961 626c 6573  quired variables
+00005760: 3a20 5b27 666c 7764 6972 272c 2027 7570  : ['flwdir', 'up
+00005770: 6172 6561 272c 2027 656c 6576 746e 275d  area', 'elevtn']
+00005780: 0a20 2020 2020 2020 2072 6976 6572 5f75  .        river_u
+00005790: 7061 203a 2066 6c6f 6174 2c20 6f70 7469  pa : float, opti
+000057a0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+000057b0: 2028 3144 2066 6c6f 6f64 706c 6169 6e73   (1D floodplains
+000057c0: 2920 6d69 6e69 6d75 6d20 7570 7374 7265  ) minimum upstre
+000057d0: 616d 2061 7265 6120 7468 7265 7368 6f6c  am area threshol
+000057e0: 6420 666f 7220 6472 6169 6e20 696e 2074  d for drain in t
+000057f0: 6865 2048 414e 442e 204f 7074 696f 6e61  he HAND. Optiona
+00005800: 6c0a 2020 2020 2020 2020 2020 2020 7661  l.            va
+00005810: 6c75 652c 2061 7320 6974 2069 7320 696e  lue, as it is in
+00005820: 6665 7272 6564 2066 726f 6d20 7468 6520  ferred from the 
+00005830: 7374 6174 6963 6d61 7073 206d 6574 6164  staticmaps metad
+00005840: 6174 612c 2074 6f20 6265 2063 6f6e 7369  ata, to be consi
+00005850: 7374 656e 7420 7769 7468 0a20 2020 2020  stent with.     
+00005860: 2020 2020 2020 2073 6574 7570 5f72 6976         setup_riv
+00005870: 6572 732e 0a20 2020 2020 2020 2066 6c6f  ers..        flo
+00005880: 6f64 5f64 6570 7468 7320 3a20 7475 706c  od_depths : tupl
+00005890: 6520 6f66 2066 6c6f 6174 2c20 6f70 7469  e of float, opti
+000058a0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+000058b0: 2028 3144 2066 6c6f 6f64 706c 6169 6e73   (1D floodplains
+000058c0: 2920 666c 6f6f 6420 6465 7074 6873 2061  ) flood depths a
+000058d0: 7420 7768 6963 6820 6120 766f 6c75 6d65  t which a volume
+000058e0: 2069 7320 6465 7269 7665 642c 2062 7920   is derived, by 
+000058f0: 6465 6661 756c 740a 2020 2020 2020 2020  default.        
+00005900: 2020 2020 5b30 2e35 2c20 312e 302c 2031      [0.5, 1.0, 1
+00005910: 2e35 2c20 322e 302c 2032 2e35 2c20 332e  .5, 2.0, 2.5, 3.
+00005920: 302c 2034 2e30 2c20 352e 305d 0a0a 2020  0, 4.0, 5.0]..  
+00005930: 2020 2020 2020 656c 6576 746e 5f6d 6170        elevtn_map
+00005940: 3a20 7b22 7766 6c6f 775f 6465 6d22 2c20  : {"wflow_dem", 
+00005950: 2264 656d 5f73 7562 6772 6964 227d 0a20  "dem_subgrid"}. 
+00005960: 2020 2020 2020 2020 2020 2028 3244 2066             (2D f
+00005970: 6c6f 6f64 706c 6169 6e73 2920 4e61 6d65  loodplains) Name
+00005980: 206f 6620 7374 6174 6963 6d61 7020 746f   of staticmap to
+00005990: 2068 7964 726f 6c6f 6769 6361 6c6c 7920   hydrologically 
+000059a0: 636f 6e64 6974 696f 6e2c 2062 7920 6465  condition, by de
+000059b0: 6661 756c 740a 2020 2020 2020 2020 2020  fault.          
+000059c0: 2020 2277 666c 6f77 5f64 656d 220a 0a20    "wflow_dem".. 
+000059d0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+000059e0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000059f0: 0a20 2020 2020 2020 2077 6f72 6b66 6c6f  .        workflo
+00005a00: 7773 2e72 6976 6572 5f66 6c6f 6f64 706c  ws.river_floodpl
+00005a10: 6169 6e5f 766f 6c75 6d65 0a20 2020 2020  ain_volume.     
+00005a20: 2020 2068 7964 726f 6d74 2e66 6c77 2e64     hydromt.flw.d
+00005a30: 656d 5f61 646a 7573 740a 2020 2020 2020  em_adjust.      
+00005a40: 2020 7079 666c 7764 6972 2e46 6c77 6469    pyflwdir.Flwdi
+00005a50: 7252 6173 7465 722e 6465 6d5f 6164 6a75  rRaster.dem_adju
+00005a60: 7374 0a20 2020 2020 2020 2073 6574 7570  st.        setup
+00005a70: 5f72 6976 6572 730a 2020 2020 2020 2020  _rivers.        
+00005a80: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+00005a90: 656c 662e 6765 745f 636f 6e66 6967 2822  elf.get_config("
+00005aa0: 6d6f 6465 6c2e 7269 7665 725f 726f 7574  model.river_rout
+00005ab0: 696e 6722 2920 213d 2022 6c6f 6361 6c2d  ing") != "local-
+00005ac0: 696e 6572 7469 616c 223a 0a20 2020 2020  inertial":.     
+00005ad0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00005ae0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00005af0: 2020 2020 2020 2020 2066 2246 6c6f 6f64           f"Flood
+00005b00: 706c 6169 6e73 2028 3164 206f 7220 3264  plains (1d or 2d
+00005b10: 2920 6172 6520 6375 7272 656e 746c 7920  ) are currently 
+00005b20: 6f6e 6c79 2073 7570 706f 7274 6564 2077  only supported w
+00005b30: 6974 6820 6c6f 6361 6c20 696e 7465 7274  ith local intert
+00005b40: 6961 6c20 7269 7665 7220 726f 7574 696e  ial river routin
+00005b50: 6722 0a20 2020 2020 2020 2020 2020 2029  g".            )
+00005b60: 0a0a 2020 2020 2020 2020 725f 6c69 7374  ..        r_list
+00005b70: 203d 205b 2231 6422 2c20 2232 6422 5d0a   = ["1d", "2d"].
+00005b80: 2020 2020 2020 2020 6966 2066 6c6f 6f64          if flood
+00005b90: 706c 6169 6e5f 7479 7065 206e 6f74 2069  plain_type not i
+00005ba0: 6e20 725f 6c69 7374 3a0a 2020 2020 2020  n r_list:.      
+00005bb0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00005bc0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00005bd0: 2020 2020 2020 2020 6627 7269 7665 725f          f'river_
+00005be0: 726f 7574 696e 673d 227b 666c 6f6f 6470  routing="{floodp
+00005bf0: 6c61 696e 5f74 7970 657d 2220 756e 6b6e  lain_type}" unkn
+00005c00: 6f77 6e2e 2053 656c 6563 7420 6672 6f6d  own. Select from
+00005c10: 207b 725f 6c69 7374 7d2e 270a 2020 2020   {r_list}.'.    
+00005c20: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00005c30: 2020 2023 2041 646a 7573 7420 7365 7474     # Adjust sett
+00005c40: 696e 6773 2062 6173 6564 206f 6e20 666c  ings based on fl
+00005c50: 6f6f 6470 6c61 696e 5f74 7970 6520 7365  oodplain_type se
+00005c60: 6c65 6374 696f 6e0a 2020 2020 2020 2020  lection.        
+00005c70: 6966 2066 6c6f 6f64 706c 6169 6e5f 7479  if floodplain_ty
+00005c80: 7065 203d 3d20 2231 6422 3a0a 2020 2020  pe == "1d":.    
+00005c90: 2020 2020 2020 2020 666c 6f6f 6470 6c61          floodpla
+00005ca0: 696e 5f31 6420 3d20 5472 7565 0a20 2020  in_1d = True.   
+00005cb0: 2020 2020 2020 2020 206c 616e 645f 726f           land_ro
+00005cc0: 7574 696e 6720 3d20 226b 696e 656d 6174  uting = "kinemat
+00005cd0: 6963 2d77 6176 6522 0a0a 2020 2020 2020  ic-wave"..      
+00005ce0: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
+00005cf0: 6174 7472 2870 7966 6c77 6469 722e 466c  attr(pyflwdir.Fl
+00005d00: 7764 6972 5261 7374 6572 2c20 2275 6361  wdirRaster, "uca
+00005d10: 745f 766f 6c75 6d65 2229 3a0a 2020 2020  t_volume"):.    
+00005d20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005d30: 2e6c 6f67 6765 722e 7761 726e 696e 6728  .logger.warning(
+00005d40: 2254 6869 7320 6d65 7468 6f64 2072 6571  "This method req
+00005d50: 7569 7265 7320 7079 666c 7764 6972 203e  uires pyflwdir >
+00005d60: 3d20 302e 352e 3622 290a 2020 2020 2020  = 0.5.6").      
+00005d70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00005d80: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00005d90: 6c66 2e6c 6f67 6765 722e 696e 666f 2822  lf.logger.info("
+00005da0: 5072 6570 6172 696e 6720 3144 2072 6976  Preparing 1D riv
+00005db0: 6572 2066 6c6f 6f64 706c 6169 6e5f 766f  er floodplain_vo
+00005dc0: 6c75 6d65 206d 6170 2e22 290a 0a20 2020  lume map.")..   
+00005dd0: 2020 2020 2020 2020 2023 2072 6561 6420           # read 
+00005de0: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
+00005df0: 2064 735f 6879 6472 6f20 3d20 7365 6c66   ds_hydro = self
+00005e00: 2e64 6174 615f 6361 7461 6c6f 672e 6765  .data_catalog.ge
+00005e10: 745f 7261 7374 6572 6461 7461 7365 7428  t_rasterdataset(
+00005e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005e30: 2068 7964 726f 6772 6170 6879 5f66 6e2c   hydrography_fn,
+00005e40: 2067 656f 6d3d 7365 6c66 2e72 6567 696f   geom=self.regio
+00005e50: 6e2c 2062 7566 6665 723d 3130 0a20 2020  n, buffer=10.   
+00005e60: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00005e70: 2020 2020 2020 2064 735f 6879 6472 6f2e         ds_hydro.
+00005e80: 636f 6f72 6473 5b22 6d61 736b 225d 203d  coords["mask"] =
+00005e90: 2064 735f 6879 6472 6f2e 7261 7374 6572   ds_hydro.raster
+00005ea0: 2e67 656f 6d65 7472 795f 6d61 736b 2873  .geometry_mask(s
+00005eb0: 656c 662e 7265 6769 6f6e 290a 0a20 2020  elf.region)..   
+00005ec0: 2020 2020 2020 2020 2023 2074 7279 2074           # try t
+00005ed0: 6f20 6765 7420 7269 7665 7220 7570 6172  o get river upar
+00005ee0: 6561 2066 726f 6d20 7374 6174 6963 6d61  ea from staticma
+00005ef0: 7073 2c20 7468 726f 7720 6572 726f 7220  ps, throw error 
+00005f00: 6966 206e 6f74 2073 7065 6369 6669 6564  if not specified
+00005f10: 206f 7220 7768 656e 2066 6f75 6e64 2062   or when found b
+00005f20: 7574 2064 6966 6665 7265 6e74 2066 726f  ut different fro
+00005f30: 6d20 7370 6563 6966 6965 6420 7661 6c75  m specified valu
+00005f40: 650a 2020 2020 2020 2020 2020 2020 6e65  e.            ne
+00005f50: 775f 7269 7665 725f 7570 6120 3d20 7365  w_river_upa = se
+00005f60: 6c66 2e73 7461 7469 636d 6170 735b 7365  lf.staticmaps[se
+00005f70: 6c66 2e5f 4d41 5053 5b22 7269 766d 736b  lf._MAPS["rivmsk
+00005f80: 225d 5d2e 6174 7472 732e 6765 7428 0a20  "]].attrs.get(. 
+00005f90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00005fa0: 7269 7665 725f 7570 6122 2c20 7269 7665  river_upa", rive
+00005fb0: 725f 7570 610a 2020 2020 2020 2020 2020  r_upa.          
+00005fc0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00005fd0: 6966 206e 6577 5f72 6976 6572 5f75 7061  if new_river_upa
+00005fe0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00005ff0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00006000: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00006010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006020: 224e 6f20 7661 6c75 6520 666f 7220 6072  "No value for `r
+00006030: 6976 6572 5f75 7061 6020 7370 6563 6966  iver_upa` specif
+00006040: 6965 642c 2061 6e64 2074 6865 2076 616c  ied, and the val
+00006050: 7565 2063 616e 6e6f 7420 6265 2069 6e66  ue cannot be inf
+00006060: 6572 7265 6420 6672 6f6d 2074 6865 2073  erred from the s
+00006070: 7461 7469 636d 6170 7320 6174 7472 6962  taticmaps attrib
+00006080: 7574 6573 220a 2020 2020 2020 2020 2020  utes".          
+00006090: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000060a0: 2020 2020 656c 6966 206e 6577 5f72 6976      elif new_riv
+000060b0: 6572 5f75 7061 2021 3d20 7269 7665 725f  er_upa != river_
+000060c0: 7570 6120 616e 6420 7269 7665 725f 7570  upa and river_up
+000060d0: 6120 6973 206e 6f74 204e 6f6e 653a 0a20  a is not None:. 
+000060e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000060f0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00006100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006110: 2020 2020 2066 2256 616c 7565 2073 7065       f"Value spe
+00006120: 6369 6669 6564 2066 6f72 2072 6976 6572  cified for river
+00006130: 5f75 7061 2028 7b72 6976 6572 5f75 7061  _upa ({river_upa
+00006140: 7d29 2069 7320 6469 6666 6572 656e 7420  }) is different 
+00006150: 6672 6f6d 2074 6865 2076 616c 7565 2066  from the value f
+00006160: 6f75 6e64 2069 6e20 7468 6520 7374 6174  ound in the stat
+00006170: 6963 6d61 7073 2028 7b6e 6577 5f72 6976  icmaps ({new_riv
+00006180: 6572 5f75 7061 7d29 220a 2020 2020 2020  er_upa})".      
+00006190: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000061a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000061b0: 6765 722e 6465 6275 6728 6622 5573 696e  ger.debug(f"Usin
+000061c0: 6720 7269 7665 725f 7570 6120 7661 6c75  g river_upa valu
+000061d0: 6520 7661 6c75 6520 6f66 3a20 7b6e 6577  e value of: {new
+000061e0: 5f72 6976 6572 5f75 7061 7d22 290a 0a20  _river_upa}").. 
+000061f0: 2020 2020 2020 2020 2020 2023 2067 6574             # get
+00006200: 2072 6976 6572 2066 6c6f 6f64 706c 6169   river floodplai
+00006210: 6e20 766f 6c75 6d65 0a20 2020 2020 2020  n volume.       
+00006220: 2020 2020 2069 6e76 5f72 656e 616d 6520       inv_rename 
+00006230: 3d20 7b76 3a20 6b20 666f 7220 6b2c 2076  = {v: k for k, v
+00006240: 2069 6e20 7365 6c66 2e5f 4d41 5053 2e69   in self._MAPS.i
+00006250: 7465 6d73 2829 2069 6620 7620 696e 2073  tems() if v in s
+00006260: 656c 662e 7374 6174 6963 6d61 7073 7d0a  elf.staticmaps}.
+00006270: 2020 2020 2020 2020 2020 2020 6461 5f66              da_f
+00006280: 6c64 706c 6e20 3d20 776f 726b 666c 6f77  ldpln = workflow
+00006290: 732e 7269 7665 725f 666c 6f6f 6470 6c61  s.river_floodpla
+000062a0: 696e 5f76 6f6c 756d 6528 0a20 2020 2020  in_volume(.     
+000062b0: 2020 2020 2020 2020 2020 2064 733d 6473             ds=ds
+000062c0: 5f68 7964 726f 2c0a 2020 2020 2020 2020  _hydro,.        
+000062d0: 2020 2020 2020 2020 6473 5f6d 6f64 656c          ds_model
+000062e0: 3d73 656c 662e 7374 6174 6963 6d61 7073  =self.staticmaps
+000062f0: 2e72 656e 616d 6528 696e 765f 7265 6e61  .rename(inv_rena
+00006300: 6d65 292c 0a20 2020 2020 2020 2020 2020  me),.           
+00006310: 2020 2020 2072 6976 6572 5f75 7061 3d6e       river_upa=n
+00006320: 6577 5f72 6976 6572 5f75 7061 2c0a 2020  ew_river_upa,.  
+00006330: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+00006340: 6f6f 645f 6465 7074 6873 3d66 6c6f 6f64  ood_depths=flood
+00006350: 5f64 6570 7468 732c 0a20 2020 2020 2020  _depths,.       
+00006360: 2020 2020 2020 2020 206c 6f67 6765 723d           logger=
+00006370: 7365 6c66 2e6c 6f67 6765 722c 0a20 2020  self.logger,.   
+00006380: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00006390: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+000063a0: 6966 2074 6865 206c 6179 6572 2061 6c72  if the layer alr
+000063b0: 6561 6479 2065 7869 7374 732c 2073 696e  eady exists, sin
+000063c0: 6365 206f 7665 7277 7269 7469 6e67 2077  ce overwriting w
+000063d0: 6974 6820 6469 6666 6572 656e 7420 666c  ith different fl
+000063e0: 6f6f 645f 6465 7074 6820 7661 6c75 6573  ood_depth values
+000063f0: 2069 7320 6e6f 7420 776f 726b 696e 6720   is not working 
+00006400: 7072 6f70 6572 6c79 2069 6620 7468 6973  properly if this
+00006410: 2069 7320 7468 6520 6361 7365 0a20 2020   is the case.   
+00006420: 2020 2020 2020 2020 2069 6620 2266 6c6f           if "flo
+00006430: 6f64 706c 6169 6e5f 766f 6c75 6d65 2220  odplain_volume" 
+00006440: 696e 2073 656c 662e 7374 6174 6963 6d61  in self.staticma
+00006450: 7073 3a0a 2020 2020 2020 2020 2020 2020  ps:.            
+00006460: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00006470: 7761 726e 696e 6728 0a20 2020 2020 2020  warning(.       
+00006480: 2020 2020 2020 2020 2020 2020 2022 4c61               "La
+00006490: 7965 7220 6066 6c6f 6f64 706c 6169 6e5f  yer `floodplain_
+000064a0: 766f 6c75 6d65 6020 616c 7265 6164 7920  volume` already 
+000064b0: 696e 2073 7461 7469 636d 6170 732c 2072  in staticmaps, r
+000064c0: 656d 6f76 696e 6720 6c61 7965 7220 616e  emoving layer an
+000064d0: 6420 6066 6c6f 6f64 5f64 6570 7468 6020  d `flood_depth` 
+000064e0: 6469 6d65 6e73 696f 6e20 746f 2065 6e73  dimension to ens
+000064f0: 7572 6520 636f 7272 6563 746c 7920 7365  ure correctly se
+00006500: 7474 696e 6720 6e65 7720 666c 6f6f 645f  tting new flood_
+00006510: 6465 7074 6820 6469 6d65 6e73 696f 6e73  depth dimensions
+00006520: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00006530: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00006540: 2020 2020 7365 6c66 2e5f 7374 6174 6963      self._static
+00006550: 6d61 7073 203d 2073 656c 662e 5f73 7461  maps = self._sta
+00006560: 7469 636d 6170 732e 6472 6f70 5f64 696d  ticmaps.drop_dim
+00006570: 7328 2266 6c6f 6f64 5f64 6570 7468 2229  s("flood_depth")
+00006580: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00006590: 6c66 2e73 6574 5f73 7461 7469 636d 6170  lf.set_staticmap
+000065a0: 7328 6461 5f66 6c64 706c 6e2c 2022 666c  s(da_fldpln, "fl
+000065b0: 6f6f 6470 6c61 696e 5f76 6f6c 756d 6522  oodplain_volume"
+000065c0: 290a 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+000065d0: 666c 6f6f 6470 6c61 696e 5f74 7970 6520  floodplain_type 
+000065e0: 3d3d 2022 3264 223a 0a20 2020 2020 2020  == "2d":.       
+000065f0: 2020 2020 2066 6c6f 6f64 706c 6169 6e5f       floodplain_
+00006600: 3164 203d 2046 616c 7365 0a20 2020 2020  1d = False.     
+00006610: 2020 2020 2020 206c 616e 645f 726f 7574         land_rout
+00006620: 696e 6720 3d20 226c 6f63 616c 2d69 6e65  ing = "local-ine
+00006630: 7274 6961 6c22 0a0a 2020 2020 2020 2020  rtial"..        
+00006640: 2020 2020 6966 206e 6f74 2065 6c65 7674      if not elevt
+00006650: 6e5f 6d61 7020 696e 2073 656c 662e 7374  n_map in self.st
+00006660: 6174 6963 6d61 7073 3a0a 2020 2020 2020  aticmaps:.      
+00006670: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00006680: 5661 6c75 6545 7272 6f72 2866 2722 7b65  ValueError(f'"{e
+00006690: 6c65 7674 6e5f 6d61 707d 2220 6e6f 7420  levtn_map}" not 
+000066a0: 666f 756e 6420 696e 2073 7461 7469 636d  found in staticm
+000066b0: 6170 7327 290a 0a20 2020 2020 2020 2020  aps')..         
+000066c0: 2020 2070 6f73 7466 6978 203d 207b 2277     postfix = {"w
+000066d0: 666c 6f77 5f64 656d 223a 2022 5f61 7667  flow_dem": "_avg
+000066e0: 222c 2022 6465 6d5f 7375 6267 7269 6422  ", "dem_subgrid"
+000066f0: 3a20 225f 7375 6267 7269 6422 7d2e 6765  : "_subgrid"}.ge
+00006700: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00006710: 2020 2065 6c65 7674 6e5f 6d61 702c 2022     elevtn_map, "
+00006720: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00006730: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00006740: 203d 2066 2268 7964 726f 6465 6d7b 706f   = f"hydrodem{po
+00006750: 7374 6669 787d 220a 0a20 2020 2020 2020  stfix}"..       
+00006760: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00006770: 2e69 6e66 6f28 6622 5072 6570 6172 696e  .info(f"Preparin
+00006780: 6720 7b6e 616d 657d 206d 6170 2066 6f72  g {name} map for
+00006790: 206c 616e 6420 726f 7574 696e 672e 2229   land routing.")
+000067a0: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
+000067b0: 6520 3d20 6622 6879 6472 6f64 656d 7b70  e = f"hydrodem{p
+000067c0: 6f73 7466 6978 7d5f 447b 636f 6e6e 6563  ostfix}_D{connec
+000067d0: 7469 7669 7479 7d22 0a20 2020 2020 2020  tivity}".       
+000067e0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+000067f0: 2e69 6e66 6f28 6622 5072 6570 6172 696e  .info(f"Preparin
+00006800: 6720 7b6e 616d 657d 206d 6170 2066 6f72  g {name} map for
+00006810: 206c 616e 6420 726f 7574 696e 672e 2229   land routing.")
+00006820: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
+00006830: 6f75 7420 3d20 666c 772e 6465 6d5f 6164  out = flw.dem_ad
+00006840: 6a75 7374 280a 2020 2020 2020 2020 2020  just(.          
+00006850: 2020 2020 2020 6461 5f66 6c77 6469 723d        da_flwdir=
+00006860: 7365 6c66 2e73 7461 7469 636d 6170 735b  self.staticmaps[
+00006870: 7365 6c66 2e5f 4d41 5053 5b22 666c 7764  self._MAPS["flwd
+00006880: 6972 225d 5d2c 0a20 2020 2020 2020 2020  ir"]],.         
+00006890: 2020 2020 2020 2064 615f 656c 6576 746e         da_elevtn
+000068a0: 3d73 656c 662e 7374 6174 6963 6d61 7073  =self.staticmaps
+000068b0: 5b65 6c65 7674 6e5f 6d61 705d 2c0a 2020  [elevtn_map],.  
+000068c0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+000068d0: 5f72 6976 6d73 6b3d 7365 6c66 2e73 7461  _rivmsk=self.sta
+000068e0: 7469 636d 6170 735b 7365 6c66 2e5f 4d41  ticmaps[self._MA
+000068f0: 5053 5b22 7269 766d 736b 225d 5d2c 0a20  PS["rivmsk"]],. 
+00006900: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00006910: 6c77 6469 723d 7365 6c66 2e66 6c77 6469  lwdir=self.flwdi
+00006920: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00006930: 2020 2063 6f6e 6e65 6374 6976 6974 793d     connectivity=
+00006940: 636f 6e6e 6563 7469 7669 7479 2c0a 2020  connectivity,.  
+00006950: 2020 2020 2020 2020 2020 2020 2020 7269                ri
+00006960: 7665 725f 6438 3d54 7275 652c 0a20 2020  ver_d8=True,.   
+00006970: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+00006980: 6765 723d 7365 6c66 2e6c 6f67 6765 722c  ger=self.logger,
+00006990: 0a20 2020 2020 2020 2020 2020 2029 2e72  .            ).r
+000069a0: 656e 616d 6528 6e61 6d65 290a 0a20 2020  ename(name)..   
+000069b0: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+000069c0: 745f 7374 6174 6963 6d61 7073 2864 735f  t_staticmaps(ds_
+000069d0: 6f75 7429 0a0a 2020 2020 2020 2020 2320  out)..        # 
+000069e0: 5570 6461 7465 2063 6f6e 6669 670a 2020  Update config.  
+000069f0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00006a00: 722e 6465 6275 6728 6627 5570 6461 7465  r.debug(f'Update
+00006a10: 2077 666c 6f77 2063 6f6e 6669 6720 6d6f   wflow config mo
+00006a20: 6465 6c2e 666c 6f6f 6470 6c61 696e 5f31  del.floodplain_1
+00006a30: 643d 227b 666c 6f6f 6470 6c61 696e 5f31  d="{floodplain_1
+00006a40: 647d 2227 290a 2020 2020 2020 2020 7365  d}"').        se
+00006a50: 6c66 2e73 6574 5f63 6f6e 6669 6728 226d  lf.set_config("m
+00006a60: 6f64 656c 2e66 6c6f 6f64 706c 6169 6e5f  odel.floodplain_
+00006a70: 3164 222c 2066 6c6f 6f64 706c 6169 6e5f  1d", floodplain_
+00006a80: 3164 290a 2020 2020 2020 2020 7365 6c66  1d).        self
+00006a90: 2e6c 6f67 6765 722e 6465 6275 6728 6627  .logger.debug(f'
+00006aa0: 5570 6461 7465 2077 666c 6f77 2063 6f6e  Update wflow con
+00006ab0: 6669 6720 6d6f 6465 6c2e 6c61 6e64 5f72  fig model.land_r
+00006ac0: 6f75 7469 6e67 3d22 7b6c 616e 645f 726f  outing="{land_ro
+00006ad0: 7574 696e 677d 2227 290a 2020 2020 2020  uting}"').      
+00006ae0: 2020 7365 6c66 2e73 6574 5f63 6f6e 6669    self.set_confi
+00006af0: 6728 226d 6f64 656c 2e6c 616e 645f 726f  g("model.land_ro
+00006b00: 7574 696e 6722 2c20 6c61 6e64 5f72 6f75  uting", land_rou
+00006b10: 7469 6e67 290a 0a20 2020 2020 2020 2069  ting)..        i
+00006b20: 6620 666c 6f6f 6470 6c61 696e 5f74 7970  f floodplain_typ
+00006b30: 6520 3d3d 2022 3164 223a 0a20 2020 2020  e == "1d":.     
+00006b40: 2020 2020 2020 2023 2069 6e63 6c75 6465         # include
+00006b50: 206e 6577 2069 6e70 7574 2064 6174 610a   new input data.
+00006b60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006b70: 2e73 6574 5f63 6f6e 6669 6728 0a20 2020  .set_config(.   
+00006b80: 2020 2020 2020 2020 2020 2020 2022 696e               "in
+00006b90: 7075 742e 6c61 7465 7261 6c2e 7269 7665  put.lateral.rive
+00006ba0: 722e 666c 6f6f 6470 6c61 696e 2e76 6f6c  r.floodplain.vol
+00006bb0: 756d 6522 2c20 2266 6c6f 6f64 706c 6169  ume", "floodplai
+00006bc0: 6e5f 766f 6c75 6d65 220a 2020 2020 2020  n_volume".      
+00006bd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006be0: 2020 2020 2320 4164 6420 7374 6174 6573      # Add states
+00006bf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006c00: 662e 7365 745f 636f 6e66 6967 2822 7374  f.set_config("st
+00006c10: 6174 652e 6c61 7465 7261 6c2e 7269 7665  ate.lateral.rive
+00006c20: 722e 666c 6f6f 6470 6c61 696e 2e71 222c  r.floodplain.q",
+00006c30: 2022 715f 666c 6f6f 6470 6c61 696e 2229   "q_floodplain")
+00006c40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006c50: 662e 7365 745f 636f 6e66 6967 2822 7374  f.set_config("st
+00006c60: 6174 652e 6c61 7465 7261 6c2e 7269 7665  ate.lateral.rive
+00006c70: 722e 666c 6f6f 6470 6c61 696e 2e68 222c  r.floodplain.h",
+00006c80: 2022 685f 666c 6f6f 6470 6c61 696e 2229   "h_floodplain")
+00006c90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006ca0: 662e 7365 745f 636f 6e66 6967 2822 7374  f.set_config("st
+00006cb0: 6174 652e 6c61 7465 7261 6c2e 6c61 6e64  ate.lateral.land
+00006cc0: 2e71 222c 2022 715f 6c61 6e64 2229 0a20  .q", "q_land"). 
+00006cd0: 2020 2020 2020 2020 2020 2023 2052 656d             # Rem
+00006ce0: 6f76 6520 6c6f 6361 6c2d 696e 6572 7469  ove local-inerti
+00006cf0: 616c 206c 616e 6420 7374 6174 6573 0a20  al land states. 
+00006d00: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00006d10: 6c66 2e67 6574 5f63 6f6e 6669 6728 2273  lf.get_config("s
+00006d20: 7461 7465 2e6c 6174 6572 616c 2e6c 616e  tate.lateral.lan
+00006d30: 642e 7178 2229 2069 7320 6e6f 7420 4e6f  d.qx") is not No
+00006d40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006d50: 2020 2020 7365 6c66 2e63 6f6e 6669 675b      self.config[
+00006d60: 2273 7461 7465 225d 5b22 6c61 7465 7261  "state"]["latera
+00006d70: 6c22 5d5b 226c 616e 6422 5d2e 706f 7028  l"]["land"].pop(
+00006d80: 2271 7822 2c20 4e6f 6e65 290a 2020 2020  "qx", None).    
+00006d90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00006da0: 6765 745f 636f 6e66 6967 2822 7374 6174  get_config("stat
+00006db0: 652e 6c61 7465 7261 6c2e 6c61 6e64 2e71  e.lateral.land.q
+00006dc0: 7922 2920 6973 206e 6f74 204e 6f6e 653a  y") is not None:
+00006dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006de0: 2073 656c 662e 636f 6e66 6967 5b22 7374   self.config["st
+00006df0: 6174 6522 5d5b 226c 6174 6572 616c 225d  ate"]["lateral"]
+00006e00: 5b22 6c61 6e64 225d 2e70 6f70 2822 7179  ["land"].pop("qy
+00006e10: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+00006e20: 2020 2020 2069 6620 7365 6c66 2e67 6574       if self.get
+00006e30: 5f63 6f6e 6669 6728 226f 7574 7075 742e  _config("output.
+00006e40: 6c61 7465 7261 6c2e 6c61 6e64 2e71 7822  lateral.land.qx"
+00006e50: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
+00006e60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00006e70: 656c 662e 636f 6e66 6967 5b22 6f75 7470  elf.config["outp
+00006e80: 7574 225d 5b22 6c61 7465 7261 6c22 5d5b  ut"]["lateral"][
+00006e90: 226c 616e 6422 5d2e 706f 7028 2271 7822  "land"].pop("qx"
+00006ea0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+00006eb0: 2020 2020 6966 2073 656c 662e 6765 745f      if self.get_
+00006ec0: 636f 6e66 6967 2822 6f75 7470 7574 2e6c  config("output.l
+00006ed0: 6174 6572 616c 2e6c 616e 642e 7179 2229  ateral.land.qy")
+00006ee0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00006ef0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00006f00: 6c66 2e63 6f6e 6669 675b 226f 7574 7075  lf.config["outpu
+00006f10: 7422 5d5b 226c 6174 6572 616c 225d 5b22  t"]["lateral"]["
+00006f20: 6c61 6e64 225d 2e70 6f70 2822 7179 222c  land"].pop("qy",
+00006f30: 204e 6f6e 6529 0a0a 2020 2020 2020 2020   None)..        
+00006f40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00006f50: 2020 2320 696e 636c 7564 6520 6e65 7720    # include new 
+00006f60: 696e 7075 7420 6461 7461 0a20 2020 2020  input data.     
+00006f70: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+00006f80: 636f 6e66 6967 2822 696e 7075 742e 6c61  config("input.la
+00006f90: 7465 7261 6c2e 7269 7665 722e 6261 6e6b  teral.river.bank
+00006fa0: 6675 6c6c 5f65 6c65 7661 7469 6f6e 222c  full_elevation",
+00006fb0: 206e 616d 6529 0a20 2020 2020 2020 2020   name).         
+00006fc0: 2020 2073 656c 662e 7365 745f 636f 6e66     self.set_conf
+00006fd0: 6967 2822 696e 7075 742e 6c61 7465 7261  ig("input.latera
+00006fe0: 6c2e 6c61 6e64 2e65 6c65 7661 7469 6f6e  l.land.elevation
+00006ff0: 222c 206e 616d 6529 0a20 2020 2020 2020  ", name).       
+00007000: 2020 2020 2023 2041 6464 206c 6f63 616c       # Add local
+00007010: 2d69 6e65 7274 6961 6c20 6c61 6e64 2072  -inertial land r
+00007020: 6f75 7469 6e67 2073 7461 7465 730a 2020  outing states.  
+00007030: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00007040: 6574 5f63 6f6e 6669 6728 2273 7461 7465  et_config("state
+00007050: 2e6c 6174 6572 616c 2e6c 616e 642e 7178  .lateral.land.qx
+00007060: 222c 2022 7178 5f6c 616e 6422 290a 2020  ", "qx_land").  
+00007070: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00007080: 6574 5f63 6f6e 6669 6728 2273 7461 7465  et_config("state
+00007090: 2e6c 6174 6572 616c 2e6c 616e 642e 7179  .lateral.land.qy
+000070a0: 222c 2022 7179 5f6c 616e 6422 290a 2020  ", "qy_land").  
+000070b0: 2020 2020 2020 2020 2020 2320 5265 6d6f            # Remo
+000070c0: 7665 206b 696e 656d 6174 6963 2d77 6176  ve kinematic-wav
+000070d0: 6520 616e 6420 3164 2066 6c6f 6f64 706c  e and 1d floodpl
+000070e0: 6169 6e20 7374 6174 6573 0a20 2020 2020  ain states.     
+000070f0: 2020 2020 2020 2069 6620 7365 6c66 2e67         if self.g
+00007100: 6574 5f63 6f6e 6669 6728 2273 7461 7465  et_config("state
+00007110: 2e6c 6174 6572 616c 2e6c 616e 642e 7122  .lateral.land.q"
+00007120: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
+00007130: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007140: 656c 662e 636f 6e66 6967 5b22 7374 6174  elf.config["stat
+00007150: 6522 5d5b 226c 6174 6572 616c 225d 5b22  e"]["lateral"]["
+00007160: 6c61 6e64 225d 2e70 6f70 2822 7122 2c20  land"].pop("q", 
+00007170: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+00007180: 2020 6966 2073 656c 662e 6765 745f 636f    if self.get_co
+00007190: 6e66 6967 2822 7374 6174 652e 6c61 7465  nfig("state.late
+000071a0: 7261 6c2e 7269 7665 722e 666c 6f6f 6470  ral.river.floodp
+000071b0: 6c61 696e 2e71 2229 2069 7320 6e6f 7420  lain.q") is not 
+000071c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000071d0: 2020 2020 2020 7365 6c66 2e63 6f6e 6669        self.confi
+000071e0: 675b 2273 7461 7465 225d 5b22 6c61 7465  g["state"]["late
+000071f0: 7261 6c22 5d5b 2272 6976 6572 225d 5b22  ral"]["river"]["
+00007200: 666c 6f6f 6470 6c61 696e 225d 2e70 6f70  floodplain"].pop
+00007210: 2822 7122 2c20 4e6f 6e65 290a 2020 2020  ("q", None).    
+00007220: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00007230: 6765 745f 636f 6e66 6967 2822 7374 6174  get_config("stat
+00007240: 652e 6c61 7465 7261 6c2e 7269 7665 722e  e.lateral.river.
+00007250: 666c 6f6f 6470 6c61 696e 2e68 2229 2069  floodplain.h") i
+00007260: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00007270: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007280: 2e63 6f6e 6669 675b 2273 7461 7465 225d  .config["state"]
+00007290: 5b22 6c61 7465 7261 6c22 5d5b 2272 6976  ["lateral"]["riv
+000072a0: 6572 225d 5b22 666c 6f6f 6470 6c61 696e  er"]["floodplain
+000072b0: 225d 2e70 6f70 2822 6822 2c20 4e6f 6e65  "].pop("h", None
+000072c0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000072d0: 2073 656c 662e 6765 745f 636f 6e66 6967   self.get_config
+000072e0: 2822 6f75 7470 7574 2e6c 6174 6572 616c  ("output.lateral
+000072f0: 2e6c 616e 642e 7122 2920 6973 206e 6f74  .land.q") is not
+00007300: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00007310: 2020 2020 2020 2073 656c 662e 636f 6e66         self.conf
+00007320: 6967 5b22 6f75 7470 7574 225d 5b22 6c61  ig["output"]["la
+00007330: 7465 7261 6c22 5d5b 226c 616e 6422 5d2e  teral"]["land"].
+00007340: 706f 7028 2271 222c 204e 6f6e 6529 0a0a  pop("q", None)..
+00007350: 2020 2020 6465 6620 7365 7475 705f 7269      def setup_ri
+00007360: 7665 7277 6964 7468 280a 2020 2020 2020  verwidth(.      
+00007370: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00007380: 7072 6564 6963 746f 723d 2264 6973 6368  predictor="disch
+00007390: 6172 6765 222c 0a20 2020 2020 2020 2066  arge",.        f
+000073a0: 696c 6c3d 4661 6c73 652c 0a20 2020 2020  ill=False,.     
+000073b0: 2020 2066 6974 3d46 616c 7365 2c0a 2020     fit=False,.  
+000073c0: 2020 2020 2020 6d69 6e5f 7774 683d 312e        min_wth=1.
+000073d0: 302c 0a20 2020 2020 2020 2070 7265 6369  0,.        preci
+000073e0: 705f 666e 3d22 6368 656c 7361 222c 0a20  p_fn="chelsa",. 
+000073f0: 2020 2020 2020 2063 6c69 6d61 7465 5f66         climate_f
+00007400: 6e3d 226b 6f70 7065 6e5f 6765 6967 6572  n="koppen_geiger
+00007410: 222c 0a20 2020 2020 2020 202a 2a6b 7761  ",.        **kwa
+00007420: 7267 732c 0a20 2020 2029 3a0a 2020 2020  rgs,.    ):.    
+00007430: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00007440: 5468 6973 2063 6f6d 706f 6e65 6e74 2073  This component s
+00007450: 6574 7320 7468 6520 7269 7665 7220 7769  ets the river wi
+00007460: 6474 6820 7061 7261 6d65 7465 7220 6261  dth parameter ba
+00007470: 7365 6420 6f6e 2061 2070 6f77 6572 2d6c  sed on a power-l
+00007480: 6179 2072 656c 6174 696f 6e73 6869 7020  ay relationship 
+00007490: 7769 7468 2061 2070 7265 6469 6374 6f72  with a predictor
+000074a0: 2e0a 0a20 2020 2020 2020 2042 7920 6465  ...        By de
+000074b0: 6661 756c 7420 7468 6520 7269 7665 7277  fault the riverw
+000074c0: 6964 7468 2069 7320 6573 7469 6d61 7465  idth is estimate
+000074d0: 6420 6261 7365 6420 6f6e 2064 6973 6368  d based on disch
+000074e0: 6172 6765 2061 7320 6060 7072 6564 6963  arge as ``predic
+000074f0: 746f 7260 6020 616e 6420 7573 6564 2074  tor`` and used t
+00007500: 6f0a 2020 2020 2020 2020 7365 7420 7468  o.        set th
+00007510: 6520 7269 7665 7277 6964 7468 2067 6c6f  e riverwidth glo
+00007520: 6261 6c6c 7920 6261 7365 6420 6f6e 2070  bally based on p
+00007530: 7265 2d64 6566 696e 6564 2070 6f77 6572  re-defined power
+00007540: 2d6c 6177 2070 6172 616d 6574 6572 7320  -law parameters 
+00007550: 7065 7220 636c 696d 6174 6520 636c 6173  per climate clas
+00007560: 732e 0a20 2020 2020 2020 2057 6974 6820  s..        With 
+00007570: 6060 6669 7460 6020 7365 7420 746f 2054  ``fit`` set to T
+00007580: 7275 652c 2074 6865 2070 6f77 6572 2d6c  rue, the power-l
+00007590: 6177 2072 656c 6174 696f 6e73 7368 6970  aw relationsship
+000075a0: 2070 6172 616d 7465 7273 2061 7265 2073   paramters are s
+000075b0: 6574 206f 6e2d 7468 652d 666c 792e 0a20  et on-the-fly.. 
+000075c0: 2020 2020 2020 2057 6974 6820 6060 6669         With ``fi
+000075d0: 6c6c 6060 2073 6574 2074 6f20 5472 7565  ll`` set to True
+000075e0: 2c20 7468 6520 6573 7469 6d61 7465 6420  , the estimated 
+000075f0: 7269 7665 7220 7769 6474 6873 2061 7265  river widths are
+00007600: 206f 6e6c 7920 7573 6564 2066 696c 6c20   only used fill 
+00007610: 6761 7073 2069 6e20 7468 650a 2020 2020  gaps in the.    
+00007620: 2020 2020 6f62 7365 7276 6564 2064 6174      observed dat
+00007630: 612e 2041 6c74 6572 6e61 7469 7665 2060  a. Alternative `
+00007640: 6070 7265 6469 6374 6f72 6060 2076 616c  `predictor`` val
+00007650: 7565 7320 6172 6520 7072 6563 6970 2028  ues are precip (
+00007660: 6163 6375 6d75 6c61 7465 6420 7072 6563  accumulated prec
+00007670: 6970 6974 6174 696f 6e29 0a20 2020 2020  ipitation).     
+00007680: 2020 2061 6e64 2075 7061 7265 6120 2875     and uparea (u
+00007690: 7073 7472 6561 6d20 6172 6561 292e 2046  pstream area). F
+000076a0: 6f72 2074 6865 7365 2070 7265 6469 6374  or these predict
+000076b0: 6f72 7320 7661 6c75 6573 2060 6066 6974  ors values ``fit
+000076c0: 6060 2064 6566 6175 6c74 2074 6f20 5472  `` default to Tr
+000076d0: 7565 2e0a 2020 2020 2020 2020 4279 2064  ue..        By d
+000076e0: 6566 6175 6c74 2074 6865 2070 7265 6469  efault the predi
+000076f0: 6374 6f72 2069 7320 6261 7365 6420 6f6e  ctor is based on
+00007700: 2064 6973 6368 6172 6765 2077 6869 6368   discharge which
+00007710: 2069 7320 6573 7469 6d61 7465 6420 7468   is estimated th
+00007720: 726f 7567 6820 6d75 6c74 6970 6c65 206c  rough multiple l
+00007730: 696e 6561 720a 2020 2020 2020 2020 7265  inear.        re
+00007740: 6772 6573 7369 6f6e 2077 6974 6820 7072  gression with pr
+00007750: 6563 6970 6974 6174 696f 6e20 616e 6420  ecipitation and 
+00007760: 7570 7374 7265 616d 2061 7265 6120 7065  upstream area pe
+00007770: 7220 636c 696d 6174 6520 7a6f 6e65 2e0a  r climate zone..
+00007780: 0a20 2020 2020 2020 202a 202a 2a77 666c  .        * **wfl
+00007790: 6f77 5f72 6976 6572 7769 6474 682a 2a20  ow_riverwidth** 
+000077a0: 6d61 703a 2072 6976 6572 2077 6964 7468  map: river width
+000077b0: 205b 6d5d 0a0a 2020 2020 2020 2020 5061   [m]..        Pa
+000077c0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+000077d0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000077e0: 2020 2020 7072 6564 6963 746f 7220 3a20      predictor : 
+000077f0: 7b22 6469 7363 6861 7267 6522 2c20 2270  {"discharge", "p
+00007800: 7265 6369 7022 2c20 2275 7061 7265 6122  recip", "uparea"
+00007810: 7d0a 2020 2020 2020 2020 2020 2020 5072  }.            Pr
+00007820: 6564 6963 746f 7220 7573 6564 2069 6e20  edictor used in 
+00007830: 7468 6520 706f 7765 722d 6c61 7720 6571  the power-law eq
+00007840: 7561 7469 6f6e 3a20 7769 6474 6820 3d20  uation: width = 
+00007850: 6120 2a20 7072 6564 6963 746f 7220 5e20  a * predictor ^ 
+00007860: 622e 0a20 2020 2020 2020 2020 2020 2044  b..            D
+00007870: 6973 6368 6172 6765 2069 7320 6261 7365  ischarge is base
+00007880: 6420 6f6e 206d 756c 7469 706c 6520 6c69  d on multiple li
+00007890: 6e65 6172 2072 6567 7265 7373 696f 6e20  near regression 
+000078a0: 7065 7220 636c 696d 6174 6520 7a6f 6e65  per climate zone
+000078b0: 2e0a 2020 2020 2020 2020 2020 2020 5072  ..            Pr
+000078c0: 6563 6970 2069 7320 6261 7365 6420 6f6e  ecip is based on
+000078d0: 2074 6865 2031 3078 2074 6865 2064 6169   the 10x the dai
+000078e0: 6c79 2061 7665 7261 6765 2061 6363 756d  ly average accum
+000078f0: 756c 6174 6564 2070 7265 6369 7069 7461  ulated precipita
+00007900: 7469 6f6e 205b 6d33 2f73 5d2e 0a20 2020  tion [m3/s]..   
+00007910: 2020 2020 2020 2020 2055 7061 7265 6120           Uparea 
+00007920: 6973 2062 6173 6564 206f 6e20 7468 6520  is based on the 
+00007930: 7570 7374 7265 616d 2061 7265 6120 6772  upstream area gr
+00007940: 6964 205b 6b6d 325d 2e0a 2020 2020 2020  id [km2]..      
+00007950: 2020 2020 2020 4f74 6865 7220 7661 7269        Other vari
+00007960: 6162 6c65 732c 2065 2e67 2e20 6261 6e6b  ables, e.g. bank
+00007970: 6675 6c6c 2064 6973 6368 6172 6765 2c20  full discharge, 
+00007980: 6361 6e20 616c 736f 2062 6520 7072 6f76  can also be prov
+00007990: 6964 6564 2069 6620 7072 6573 656e 7420  ided if present 
+000079a0: 696e 2074 6865 2073 7461 7469 636d 6170  in the staticmap
+000079b0: 730a 2020 2020 2020 2020 6669 6c6c 203a  s.        fill :
+000079c0: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c0a   bool, optional.
+000079d0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+000079e0: 7275 6520 2864 6566 6175 6c74 292c 2075  rue (default), u
+000079f0: 7365 2065 7374 696d 6174 6520 746f 2066  se estimate to f
+00007a00: 696c 6c20 6761 7073 2c20 6f75 746c 6965  ill gaps, outlie
+00007a10: 7273 2061 6e64 206c 616b 652f 7265 7320  rs and lake/res 
+00007a20: 6172 6561 7320 696e 206f 6273 6572 7665  areas in observe
+00007a30: 6420 7769 6474 6820 6461 7461 2028 6966  d width data (if
+00007a40: 2070 7265 7365 6e74 293b 0a20 2020 2020   present);.     
+00007a50: 2020 2020 2020 2069 6620 4661 6c73 652c         if False,
+00007a60: 2073 6574 2061 6c6c 2072 6976 6572 7769   set all riverwi
+00007a70: 6474 6873 2062 6173 6564 206f 6e20 7072  dths based on pr
+00007a80: 6564 6963 746f 7220 2861 7574 6f6d 6174  edictor (automat
+00007a90: 6963 2063 686f 6963 6520 6966 206e 6f20  ic choice if no 
+00007aa0: 6f62 7365 7276 6174 696f 6e73 2066 6f75  observations fou
+00007ab0: 6e64 290a 2020 2020 2020 2020 6669 7420  nd).        fit 
+00007ac0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
+00007ad0: 206b 7761 7267 0a20 2020 2020 2020 2020   kwarg.         
+00007ae0: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
+00007af0: 706f 7765 722d 6c61 7720 7061 7261 6d65  power-law parame
+00007b00: 7465 7273 2061 7265 2066 6974 7465 6420  ters are fitted 
+00007b10: 6f6e 2074 6865 2066 6c79 0a20 2020 2020  on the fly.     
+00007b20: 2020 2020 2020 2042 7920 6465 6661 756c         By defaul
+00007b30: 7420 5472 7565 2066 6f72 2061 6c6c 2062  t True for all b
+00007b40: 7574 2022 6469 7363 6861 7267 6522 2070  ut "discharge" p
+00007b50: 7265 6469 6374 6f72 2e0a 2020 2020 2020  redictor..      
+00007b60: 2020 2020 2020 412d 7072 696f 7269 2064        A-priori d
+00007b70: 6572 6976 6564 2070 6172 616d 6574 6572  erived parameter
+00007b80: 7320 7769 6c6c 2062 6520 6f76 6572 7772  s will be overwr
+00007b90: 6974 7465 6e20 6966 2054 7275 652e 0a20  itten if True.. 
+00007ba0: 2020 2020 2020 2061 2c20 6220 3a20 666c         a, b : fl
+00007bb0: 6f61 742c 206f 7074 696f 6e61 6c20 6b77  oat, optional kw
+00007bc0: 6172 670a 2020 2020 2020 2020 2020 2020  arg.            
+00007bd0: 4d61 6e75 616c 2070 6f77 6572 2d6c 6177  Manual power-law
+00007be0: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
+00007bf0: 2020 2020 6d69 6e5f 7774 6820 3a20 666c      min_wth : fl
+00007c00: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00007c10: 6d69 6e69 6d75 6d20 7269 7665 7220 7769  minimum river wi
+00007c20: 6474 680a 2020 2020 2020 2020 7072 6563  dth.        prec
+00007c30: 6970 5f66 6e20 3a20 7b27 6368 656c 7361  ip_fn : {'chelsa
+00007c40: 277d 0a20 2020 2020 2020 2020 2020 2053  '}.            S
+00007c50: 6f75 7263 6520 6f66 206c 6f6e 6720 7465  ource of long te
+00007c60: 726d 2070 7265 6369 7069 7461 7469 6f6e  rm precipitation
+00007c70: 2067 7269 6420 6966 2074 6865 2070 7265   grid if the pre
+00007c80: 6469 6374 6f72 2069 7320 7365 7420 746f  dictor is set to
+00007c90: 2027 6469 7363 6861 7267 6527 206f 7220   'discharge' or 
+00007ca0: 2770 7265 6369 7027 2e0a 2020 2020 2020  'precip'..      
+00007cb0: 2020 636c 696d 6174 655f 666e 3a20 7b27    climate_fn: {'
+00007cc0: 6b6f 7070 656e 5f67 6569 6765 7227 7d0a  koppen_geiger'}.
+00007cd0: 2020 2020 2020 2020 2020 2020 536f 7572              Sour
+00007ce0: 6365 206f 6620 6c6f 6e67 2d74 6572 6d20  ce of long-term 
+00007cf0: 636c 696d 6174 6520 6772 6964 2069 6620  climate grid if 
+00007d00: 7468 6520 7072 6564 6963 746f 7220 6973  the predictor is
+00007d10: 2073 6574 2074 6f20 2764 6973 6368 6172   set to 'dischar
+00007d20: 6765 272e 0a20 2020 2020 2020 2022 2222  ge'..        """
+00007d30: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00007d40: 6767 6572 2e77 6172 6e69 6e67 280a 2020  gger.warning(.  
+00007d50: 2020 2020 2020 2020 2020 2754 6865 2022            'The "
+00007d60: 7365 7475 705f 7269 7665 7277 6964 7468  setup_riverwidth
+00007d70: 2220 6d65 7468 6f64 2068 6173 2062 6565  " method has bee
+00007d80: 6e20 6465 7072 6563 6174 6564 2061 6e64  n deprecated and
+00007d90: 2077 696c 6c20 736f 6f6e 2062 6520 7265   will soon be re
+00007da0: 6d6f 7665 642e 2027 0a20 2020 2020 2020  moved. '.       
+00007db0: 2020 2020 2027 596f 7520 6361 6e20 6e6f       'You can no
+00007dc0: 7720 7573 6520 7468 6520 2273 6574 7570  w use the "setup
+00007dd0: 5f72 6976 6572 2220 6d65 7468 6f64 2066  _river" method f
+00007de0: 6f72 2061 6c6c 2072 6976 6572 2070 6172  or all river par
+00007df0: 616d 6574 6572 732e 270a 2020 2020 2020  ameters.'.      
+00007e00: 2020 290a 2020 2020 2020 2020 6966 206e    ).        if n
+00007e10: 6f74 2073 656c 662e 5f4d 4150 535b 2272  ot self._MAPS["r
+00007e20: 6976 6d73 6b22 5d20 696e 2073 656c 662e  ivmsk"] in self.
+00007e30: 7374 6174 6963 6d61 7073 3a0a 2020 2020  staticmaps:.    
+00007e40: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00007e50: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00007e60: 2020 2020 2020 2020 2020 2754 6865 2022            'The "
+00007e70: 7365 7475 705f 7269 7665 7277 6964 7468  setup_riverwidth
+00007e80: 2220 6d65 7468 6f64 2072 6571 7569 7265  " method require
+00007e90: 7320 746f 2072 756e 2073 6574 7570 5f72  s to run setup_r
+00007ea0: 6976 6572 206d 6574 686f 6420 6669 7273  iver method firs
+00007eb0: 742e 270a 2020 2020 2020 2020 2020 2020  t.'.            
+00007ec0: 290a 0a20 2020 2020 2020 2023 2064 6572  )..        # der
+00007ed0: 6976 6520 7269 7665 7220 7769 6474 680a  ive river width.
+00007ee0: 2020 2020 2020 2020 6461 7461 203d 207b          data = {
+00007ef0: 7d0a 2020 2020 2020 2020 6966 2070 7265  }.        if pre
+00007f00: 6469 6374 6f72 2069 6e20 5b22 6469 7363  dictor in ["disc
+00007f10: 6861 7267 6522 2c20 2270 7265 6369 7022  harge", "precip"
+00007f20: 5d3a 0a20 2020 2020 2020 2020 2020 2064  ]:.            d
+00007f30: 615f 7072 6563 6970 203d 2073 656c 662e  a_precip = self.
+00007f40: 6461 7461 5f63 6174 616c 6f67 2e67 6574  data_catalog.get
+00007f50: 5f72 6173 7465 7264 6174 6173 6574 280a  _rasterdataset(.
+00007f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f70: 7072 6563 6970 5f66 6e2c 2067 656f 6d3d  precip_fn, geom=
+00007f80: 7365 6c66 2e72 6567 696f 6e2c 2062 7566  self.region, buf
+00007f90: 6665 723d 320a 2020 2020 2020 2020 2020  fer=2.          
+00007fa0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00007fb0: 6461 5f70 7265 6369 702e 6e61 6d65 203d  da_precip.name =
+00007fc0: 2070 7265 6369 705f 666e 0a20 2020 2020   precip_fn.     
+00007fd0: 2020 2020 2020 2064 6174 615b 2264 615f         data["da_
+00007fe0: 7072 6563 6970 225d 203d 2064 615f 7072  precip"] = da_pr
+00007ff0: 6563 6970 0a20 2020 2020 2020 2069 6620  ecip.        if 
+00008000: 7072 6564 6963 746f 7220 3d3d 2022 6469  predictor == "di
+00008010: 7363 6861 7267 6522 3a0a 2020 2020 2020  scharge":.      
+00008020: 2020 2020 2020 6461 5f63 6c69 6d61 7465        da_climate
+00008030: 203d 2073 656c 662e 6461 7461 5f63 6174   = self.data_cat
+00008040: 616c 6f67 2e67 6574 5f72 6173 7465 7264  alog.get_rasterd
+00008050: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
+00008060: 2020 2020 2020 2020 636c 696d 6174 655f          climate_
+00008070: 666e 2c20 6765 6f6d 3d73 656c 662e 7265  fn, geom=self.re
+00008080: 6769 6f6e 2c20 6275 6666 6572 3d32 0a20  gion, buffer=2. 
+00008090: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000080a0: 2020 2020 2020 2020 2064 615f 636c 696d           da_clim
+000080b0: 6174 652e 6e61 6d65 203d 2063 6c69 6d61  ate.name = clima
+000080c0: 7465 5f66 6e0a 2020 2020 2020 2020 2020  te_fn.          
+000080d0: 2020 6461 7461 5b22 6461 5f63 6c69 6d61    data["da_clima
+000080e0: 7465 225d 203d 2064 615f 636c 696d 6174  te"] = da_climat
+000080f0: 650a 0a20 2020 2020 2020 2069 6e76 5f72  e..        inv_r
+00008100: 656e 616d 6520 3d20 7b76 3a20 6b20 666f  ename = {v: k fo
+00008110: 7220 6b2c 2076 2069 6e20 7365 6c66 2e5f  r k, v in self._
+00008120: 4d41 5053 2e69 7465 6d73 2829 2069 6620  MAPS.items() if 
+00008130: 7620 696e 2073 656c 662e 7374 6174 6963  v in self.static
+00008140: 6d61 7073 7d0a 2020 2020 2020 2020 6461  maps}.        da
+00008150: 5f72 6976 7774 6820 3d20 776f 726b 666c  _rivwth = workfl
+00008160: 6f77 732e 7269 7665 725f 7769 6474 6828  ows.river_width(
+00008170: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
+00008180: 6c69 6b65 3d73 656c 662e 7374 6174 6963  like=self.static
+00008190: 6d61 7073 2e72 656e 616d 6528 696e 765f  maps.rename(inv_
+000081a0: 7265 6e61 6d65 292c 0a20 2020 2020 2020  rename),.       
+000081b0: 2020 2020 2066 6c77 6469 723d 7365 6c66       flwdir=self
+000081c0: 2e66 6c77 6469 722c 0a20 2020 2020 2020  .flwdir,.       
+000081d0: 2020 2020 2064 6174 613d 6461 7461 2c0a       data=data,.
+000081e0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
+000081f0: 3d66 696c 6c2c 0a20 2020 2020 2020 2020  =fill,.         
+00008200: 2020 2066 696c 6c5f 6f75 746c 6965 7273     fill_outliers
+00008210: 3d6b 7761 7267 732e 706f 7028 2266 696c  =kwargs.pop("fil
+00008220: 6c5f 6f75 746c 6965 7273 222c 2066 696c  l_outliers", fil
+00008230: 6c29 2c0a 2020 2020 2020 2020 2020 2020  l),.            
+00008240: 6d69 6e5f 7774 683d 6d69 6e5f 7774 682c  min_wth=min_wth,
+00008250: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+00008260: 6b5f 6e61 6d65 733d 5b22 6c61 6b65 6172  k_names=["lakear
+00008270: 6561 7322 2c20 2272 6573 6172 6561 7322  eas", "resareas"
+00008280: 2c20 2267 6c61 6361 7265 6173 225d 2c0a  , "glacareas"],.
+00008290: 2020 2020 2020 2020 2020 2020 7072 6564              pred
+000082a0: 6963 746f 723d 7072 6564 6963 746f 722c  ictor=predictor,
+000082b0: 0a20 2020 2020 2020 2020 2020 2061 3d6b  .            a=k
+000082c0: 7761 7267 732e 6765 7428 2261 222c 204e  wargs.get("a", N
+000082d0: 6f6e 6529 2c0a 2020 2020 2020 2020 2020  one),.          
+000082e0: 2020 623d 6b77 6172 6773 2e67 6574 2822    b=kwargs.get("
+000082f0: 6222 2c20 4e6f 6e65 292c 0a20 2020 2020  b", None),.     
+00008300: 2020 2020 2020 206c 6f67 6765 723d 7365         logger=se
+00008310: 6c66 2e6c 6f67 6765 722c 0a20 2020 2020  lf.logger,.     
+00008320: 2020 2020 2020 2066 6974 3d66 6974 2c0a         fit=fit,.
+00008330: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+00008340: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
+00008350: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
+00008360: 745f 7374 6174 6963 6d61 7073 2864 615f  t_staticmaps(da_
+00008370: 7269 7677 7468 2c20 6e61 6d65 3d73 656c  rivwth, name=sel
+00008380: 662e 5f4d 4150 535b 2272 6976 7774 6822  f._MAPS["rivwth"
+00008390: 5d29 0a0a 2020 2020 6465 6620 7365 7475  ])..    def setu
+000083a0: 705f 6c75 6c63 6d61 7073 280a 2020 2020  p_lulcmaps(.    
+000083b0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000083c0: 2020 6c75 6c63 5f66 6e3d 2267 6c6f 6263    lulc_fn="globc
+000083d0: 6f76 6572 222c 0a20 2020 2020 2020 206c  over",.        l
+000083e0: 756c 635f 6d61 7070 696e 675f 666e 3d4e  ulc_mapping_fn=N
+000083f0: 6f6e 652c 0a20 2020 2020 2020 206c 756c  one,.        lul
+00008400: 635f 7661 7273 3d5b 0a20 2020 2020 2020  c_vars=[.       
+00008410: 2020 2020 2022 6c61 6e64 7573 6522 2c0a       "landuse",.
+00008420: 2020 2020 2020 2020 2020 2020 224b 6578              "Kex
+00008430: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00008440: 224e 222c 0a20 2020 2020 2020 2020 2020  "N",.           
+00008450: 2022 5061 7468 4672 6163 222c 0a20 2020   "PathFrac",.   
+00008460: 2020 2020 2020 2020 2022 526f 6f74 696e           "Rootin
+00008470: 6744 6570 7468 222c 0a20 2020 2020 2020  gDepth",.       
+00008480: 2020 2020 2022 536c 222c 0a20 2020 2020       "Sl",.     
+00008490: 2020 2020 2020 2022 5377 6f6f 6422 2c0a         "Swood",.
+000084a0: 2020 2020 2020 2020 2020 2020 2257 6174              "Wat
+000084b0: 6572 4672 6163 222c 0a20 2020 2020 2020  erFrac",.       
+000084c0: 205d 2c0a 2020 2020 293a 0a20 2020 2020   ],.    ):.     
+000084d0: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+000084e0: 6869 7320 636f 6d70 6f6e 656e 7420 6465  his component de
+000084f0: 7269 7665 7320 7365 7665 7261 6c20 7766  rives several wf
+00008500: 6c6f 7720 6d61 7073 2061 7265 2064 6572  low maps are der
+00008510: 6976 6564 2062 6173 6564 206f 6e20 6c61  ived based on la
+00008520: 6e64 7573 652d 0a20 2020 2020 2020 206c  nduse-.        l
+00008530: 616e 6463 6f76 6572 2028 4c55 4c43 2920  andcover (LULC) 
+00008540: 6461 7461 2e0a 0a20 2020 2020 2020 2043  data...        C
+00008550: 7572 7265 6e74 6c79 2c20 6060 6c75 6c63  urrently, ``lulc
+00008560: 5f66 6e60 6020 6361 6e20 6265 2073 6574  _fn`` can be set
+00008570: 2074 6f20 7468 6520 2276 6974 6f22 2c20   to the "vito", 
+00008580: 2267 6c6f 6263 6f76 6572 222c 2022 6573  "globcover", "es
+00008590: 615f 776f 726c 6463 6f76 6572 220a 2020  a_worldcover".  
+000085a0: 2020 2020 2020 6f72 2022 636f 7269 6e65        or "corine
+000085b0: 222c 206f 6620 7768 6963 6820 6c6f 6f6b  ", of which look
+000085c0: 7570 2074 6162 6c65 7320 6172 6520 636f  up tables are co
+000085d0: 6e73 7472 7563 7465 6420 746f 2063 6f6e  nstructed to con
+000085e0: 7665 7274 206c 756c 6320 636c 6173 7373  vert lulc classs
+000085f0: 6573 2074 6f0a 2020 2020 2020 2020 6d6f  es to.        mo
+00008600: 6465 6c20 7061 7261 6d65 7465 7273 2062  del parameters b
+00008610: 6173 6564 206f 6e20 6c69 7465 7261 7475  ased on literatu
+00008620: 7265 2e20 5468 6520 6461 7461 2069 7320  re. The data is 
+00008630: 7265 6d61 7070 6564 2061 7420 6974 7320  remapped at its 
+00008640: 6f72 6967 696e 616c 0a20 2020 2020 2020  original.       
+00008650: 2072 6573 6f6c 7574 696f 6e20 616e 6420   resolution and 
+00008660: 7468 656e 2072 6573 616d 706c 6564 2074  then resampled t
+00008670: 6f20 7468 6520 6d6f 6465 6c20 7265 736f  o the model reso
+00008680: 6c75 7469 6f6e 2075 7369 6e67 2074 6865  lution using the
+00008690: 2061 7665 7261 6765 0a20 2020 2020 2020   average.       
+000086a0: 2076 616c 7565 2c20 756e 6c65 7373 206e   value, unless n
+000086b0: 6f74 6564 2064 6966 6665 7265 6e74 6c79  oted differently
+000086c0: 2e0a 0a20 2020 2020 2020 2041 6464 7320  ...        Adds 
+000086d0: 6d6f 6465 6c20 6c61 7965 7273 3a0a 0a20  model layers:.. 
+000086e0: 2020 2020 2020 202a 202a 2a6c 616e 6475         * **landu
+000086f0: 7365 2a2a 206d 6170 3a20 4c61 6e64 7573  se** map: Landus
+00008700: 6520 636c 6173 7320 5b2d 5d0a 2020 2020  e class [-].    
+00008710: 2020 2020 2a20 2a2a 4b65 7874 2a2a 206d      * **Kext** m
+00008720: 6170 3a20 4578 7469 6e63 7469 6f6e 2063  ap: Extinction c
+00008730: 6f65 6666 6963 6965 6e74 2069 6e20 7468  oefficient in th
+00008740: 6520 6361 6e6f 7079 2067 6170 2066 7261  e canopy gap fra
+00008750: 6374 696f 6e20 6571 7561 7469 6f6e 205b  ction equation [
+00008760: 2d5d 0a20 2020 2020 2020 202a 202a 2a53  -].        * **S
+00008770: 6c2a 2a20 6d61 703a 2053 7065 6369 6669  l** map: Specifi
+00008780: 6320 6c65 6166 2073 746f 7261 6765 205b  c leaf storage [
+00008790: 6d6d 5d0a 2020 2020 2020 2020 2a20 2a2a  mm].        * **
+000087a0: 5377 6f6f 642a 2a20 6d61 703a 2046 7261  Swood** map: Fra
+000087b0: 6374 696f 6e20 6f66 2077 6f6f 6420 696e  ction of wood in
+000087c0: 2074 6865 2076 6567 6574 6174 696f 6e2f   the vegetation/
+000087d0: 706c 616e 7420 5b2d 5d0a 2020 2020 2020  plant [-].      
+000087e0: 2020 2a20 2a2a 526f 6f74 696e 6744 6570    * **RootingDep
+000087f0: 7468 2a2a 206d 6170 3a20 4c65 6e67 7468  th** map: Length
+00008800: 206f 6620 7665 6765 7461 7469 6f6e 2072   of vegetation r
+00008810: 6f6f 7473 205b 6d6d 5d0a 2020 2020 2020  oots [mm].      
+00008820: 2020 2a20 2a2a 5061 7468 4672 6163 2a2a    * **PathFrac**
+00008830: 206d 6170 3a20 5468 6520 6672 6163 7469   map: The fracti
+00008840: 6f6e 206f 6620 636f 6d70 6163 7465 6420  on of compacted 
+00008850: 6f72 2075 7262 616e 2061 7265 6120 7065  or urban area pe
+00008860: 7220 6772 6964 2063 656c 6c20 5b2d 5d0a  r grid cell [-].
+00008870: 2020 2020 2020 2020 2a20 2a2a 5761 7465          * **Wate
+00008880: 7246 7261 632a 2a20 6d61 703a 2054 6865  rFrac** map: The
+00008890: 2066 7261 6374 696f 6e20 6f66 206f 7065   fraction of ope
+000088a0: 6e20 7761 7465 7220 7065 7220 6772 6964  n water per grid
+000088b0: 2063 656c 6c20 5b2d 5d0a 2020 2020 2020   cell [-].      
+000088c0: 2020 2a20 2a2a 4e2a 2a20 6d61 703a 204d    * **N** map: M
+000088d0: 616e 6e69 6e67 2052 6f75 6768 6e65 7373  anning Roughness
+000088e0: 205b 2d5d 0a0a 2020 2020 2020 2020 5061   [-]..        Pa
+000088f0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00008900: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00008910: 2020 2020 6c75 6c63 5f66 6e20 3a20 7b22      lulc_fn : {"
+00008920: 676c 6f62 636f 7665 7222 2c20 2276 6974  globcover", "vit
+00008930: 6f22 2c20 2263 6f72 696e 6522 7d0a 2020  o", "corine"}.  
+00008940: 2020 2020 2020 2020 2020 4e61 6d65 206f            Name o
+00008950: 6620 6461 7461 2073 6f75 7263 6520 696e  f data source in
+00008960: 2064 6174 615f 736f 7572 6365 732e 796d   data_sources.ym
+00008970: 6c20 6669 6c65 2e0a 2020 2020 2020 2020  l file..        
+00008980: 6c75 6c63 5f6d 6170 7069 6e67 5f66 6e20  lulc_mapping_fn 
+00008990: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+000089a0: 2020 5061 7468 2074 6f20 6120 6d61 7070    Path to a mapp
+000089b0: 696e 6720 6373 7620 6669 6c65 2066 726f  ing csv file fro
+000089c0: 6d20 6c61 6e64 7573 6520 696e 2073 6f75  m landuse in sou
+000089d0: 7263 6520 6e61 6d65 2074 6f20 7061 7261  rce name to para
+000089e0: 6d65 7465 7220 7661 6c75 6573 2069 6e20  meter values in 
+000089f0: 6c75 6c63 5f76 6172 732e 0a20 2020 2020  lulc_vars..     
+00008a00: 2020 206c 756c 635f 7661 7273 203a 206c     lulc_vars : l
+00008a10: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+00008a20: 4c69 7374 206f 6620 6c61 6e64 7573 6520  List of landuse 
+00008a30: 7061 7261 6d65 7465 7273 2074 6f20 6b65  parameters to ke
+00008a40: 6570 2e5c 0a20 2020 2020 2020 2020 2020  ep.\.           
+00008a50: 2042 7920 6465 6661 756c 7420 5b22 6c61   By default ["la
+00008a60: 6e64 7573 6522 2c22 4b65 7874 222c 224e  nduse","Kext","N
+00008a70: 222c 2250 6174 6846 7261 6322 2c22 526f  ","PathFrac","Ro
+00008a80: 6f74 696e 6744 6570 7468 222c 2253 6c22  otingDepth","Sl"
+00008a90: 2c22 5377 6f6f 6422 2c22 5761 7465 7246  ,"Swood","WaterF
+00008aa0: 7261 6322 5d0a 2020 2020 2020 2020 2222  rac"].        ""
+00008ab0: 220a 2020 2020 2020 2020 7365 6c66 2e6c  ".        self.l
+00008ac0: 6f67 6765 722e 696e 666f 2822 5072 6570  ogger.info("Prep
+00008ad0: 6172 696e 6720 4c55 4c43 2070 6172 616d  aring LULC param
+00008ae0: 6574 6572 206d 6170 732e 2229 0a20 2020  eter maps.").   
+00008af0: 2020 2020 2069 6620 6c75 6c63 5f6d 6170       if lulc_map
+00008b00: 7069 6e67 5f66 6e20 6973 204e 6f6e 653a  ping_fn is None:
+00008b10: 0a20 2020 2020 2020 2020 2020 2066 6e5f  .            fn_
+00008b20: 6d61 7020 3d20 6622 7b6c 756c 635f 666e  map = f"{lulc_fn
+00008b30: 7d5f 6d61 7070 696e 675f 6465 6661 756c  }_mapping_defaul
+00008b40: 7422 0a20 2020 2020 2020 2065 6c73 653a  t".        else:
+00008b50: 0a20 2020 2020 2020 2020 2020 2066 6e5f  .            fn_
+00008b60: 6d61 7020 3d20 6c75 6c63 5f6d 6170 7069  map = lulc_mappi
+00008b70: 6e67 5f66 6e0a 2020 2020 2020 2020 6966  ng_fn.        if
+00008b80: 206e 6f74 2069 7366 696c 6528 666e 5f6d   not isfile(fn_m
+00008b90: 6170 2920 616e 6420 666e 5f6d 6170 206e  ap) and fn_map n
+00008ba0: 6f74 2069 6e20 7365 6c66 2e64 6174 615f  ot in self.data_
+00008bb0: 6361 7461 6c6f 673a 0a20 2020 2020 2020  catalog:.       
+00008bc0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00008bd0: 4572 726f 7228 6622 4c55 4c43 206d 6170  Error(f"LULC map
+00008be0: 7069 6e67 2066 696c 6520 6e6f 7420 666f  ping file not fo
+00008bf0: 756e 643a 207b 666e 5f6d 6170 7d22 290a  und: {fn_map}").
+00008c00: 2020 2020 2020 2020 2320 7265 6164 206c          # read l
+00008c10: 616e 6475 7365 206d 6170 2074 6f20 4461  anduse map to Da
+00008c20: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
+00008c30: 6461 203d 2073 656c 662e 6461 7461 5f63  da = self.data_c
+00008c40: 6174 616c 6f67 2e67 6574 5f72 6173 7465  atalog.get_raste
+00008c50: 7264 6174 6173 6574 280a 2020 2020 2020  rdataset(.      
+00008c60: 2020 2020 2020 6c75 6c63 5f66 6e2c 2067        lulc_fn, g
+00008c70: 656f 6d3d 7365 6c66 2e72 6567 696f 6e2c  eom=self.region,
+00008c80: 2062 7566 6665 723d 322c 2076 6172 6961   buffer=2, varia
+00008c90: 626c 6573 3d5b 226c 616e 6475 7365 225d  bles=["landuse"]
+00008ca0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00008cb0: 2020 2064 665f 6d61 7020 3d20 7365 6c66     df_map = self
+00008cc0: 2e64 6174 615f 6361 7461 6c6f 672e 6765  .data_catalog.ge
+00008cd0: 745f 6461 7461 6672 616d 6528 0a20 2020  t_dataframe(.   
+00008ce0: 2020 2020 2020 2020 2066 6e5f 6d61 702c           fn_map,
+00008cf0: 0a20 2020 2020 2020 2020 2020 2064 7269  .            dri
+00008d00: 7665 725f 6b77 6172 6773 3d7b 2269 6e64  ver_kwargs={"ind
+00008d10: 6578 5f63 6f6c 223a 2030 7d2c 2020 2320  ex_col": 0},  # 
+00008d20: 6f6e 6c79 2075 7365 6420 6966 2066 6e5f  only used if fn_
+00008d30: 6d61 7020 6973 2061 2066 696c 6520 7061  map is a file pa
+00008d40: 7468 0a20 2020 2020 2020 2029 0a20 2020  th.        ).   
+00008d50: 2020 2020 2023 2070 726f 6365 7373 206c       # process l
+00008d60: 616e 6475 7365 0a20 2020 2020 2020 2064  anduse.        d
+00008d70: 735f 6c75 6c63 5f6d 6170 7320 3d20 776f  s_lulc_maps = wo
+00008d80: 726b 666c 6f77 732e 6c61 6e64 7573 6528  rkflows.landuse(
+00008d90: 0a20 2020 2020 2020 2020 2020 2064 613d  .            da=
+00008da0: 6461 2c0a 2020 2020 2020 2020 2020 2020  da,.            
+00008db0: 6473 5f6c 696b 653d 7365 6c66 2e73 7461  ds_like=self.sta
+00008dc0: 7469 636d 6170 732c 0a20 2020 2020 2020  ticmaps,.       
+00008dd0: 2020 2020 2064 663d 6466 5f6d 6170 2c0a       df=df_map,.
+00008de0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00008df0: 6d73 3d6c 756c 635f 7661 7273 2c0a 2020  ms=lulc_vars,.  
+00008e00: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00008e10: 3d73 656c 662e 6c6f 6767 6572 2c0a 2020  =self.logger,.  
+00008e20: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00008e30: 726d 6469 6374 203d 207b 6b3a 2076 2066  rmdict = {k: v f
+00008e40: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+00008e50: 5f4d 4150 532e 6974 656d 7328 2920 6966  _MAPS.items() if
+00008e60: 206b 2069 6e20 6473 5f6c 756c 635f 6d61   k in ds_lulc_ma
+00008e70: 7073 2e64 6174 615f 7661 7273 7d0a 2020  ps.data_vars}.  
+00008e80: 2020 2020 2020 7365 6c66 2e73 6574 5f73        self.set_s
+00008e90: 7461 7469 636d 6170 7328 6473 5f6c 756c  taticmaps(ds_lul
+00008ea0: 635f 6d61 7073 2e72 656e 616d 6528 726d  c_maps.rename(rm
+00008eb0: 6469 6374 2929 0a0a 2020 2020 6465 6620  dict))..    def 
+00008ec0: 7365 7475 705f 6c61 696d 6170 7328 7365  setup_laimaps(se
+00008ed0: 6c66 2c20 6c61 695f 666e 3d22 6d6f 6469  lf, lai_fn="modi
+00008ee0: 735f 6c61 6922 293a 0a20 2020 2020 2020  s_lai"):.       
+00008ef0: 2022 2222 0a20 2020 2020 2020 2054 6869   """.        Thi
+00008f00: 7320 636f 6d70 6f6e 656e 7420 7365 7473  s component sets
+00008f10: 206c 6561 6620 6172 6561 2069 6e64 6578   leaf area index
+00008f20: 2028 4c41 4929 2063 6c69 6d61 746f 6c6f   (LAI) climatolo
+00008f30: 6779 206d 6170 7320 7065 7220 6d6f 6e74  gy maps per mont
+00008f40: 682e 0a0a 2020 2020 2020 2020 5468 6520  h...        The 
+00008f50: 7661 6c75 6573 2061 7265 2072 6573 616d  values are resam
+00008f60: 706c 6564 2074 6f20 7468 6520 6d6f 6465  pled to the mode
+00008f70: 6c20 7265 736f 6c75 7469 6f6e 2075 7369  l resolution usi
+00008f80: 6e67 2074 6865 2061 7665 7261 6765 2076  ng the average v
+00008f90: 616c 7565 2e0a 2020 2020 2020 2020 5468  alue..        Th
+00008fa0: 6520 6f6e 6c79 2060 606c 6169 5f66 6e60  e only ``lai_fn`
+00008fb0: 6020 6375 7272 656e 746c 7920 7375 7070  ` currently supp
+00008fc0: 6f72 7465 6420 6973 2022 6d6f 6469 735f  orted is "modis_
+00008fd0: 6c61 6922 2062 6173 6564 206f 6e20 4d4f  lai" based on MO
+00008fe0: 4449 5320 6461 7461 2e0a 0a20 2020 2020  DIS data...     
+00008ff0: 2020 2041 6464 7320 6d6f 6465 6c20 6c61     Adds model la
+00009000: 7965 7273 3a0a 0a20 2020 2020 2020 202a  yers:..        *
+00009010: 202a 2a4c 4149 2a2a 206d 6170 3a20 4c65   **LAI** map: Le
+00009020: 6166 2041 7265 6120 496e 6465 7820 636c  af Area Index cl
+00009030: 696d 6174 6f6c 6f67 7920 5b2d 5d0a 2020  imatology [-].  
+00009040: 2020 2020 2020 2020 2020 5265 7361 6d70            Resamp
+00009050: 6c65 6420 6672 6f6d 2073 6f75 7263 6520  led from source 
+00009060: 6461 7461 2075 7369 6e67 2061 7665 7261  data using avera
+00009070: 6765 2e20 4173 7375 6d69 6e67 2074 6861  ge. Assuming tha
+00009080: 7420 6d69 7373 696e 6720 7661 6c75 6573  t missing values
+00009090: 0a20 2020 2020 2020 2020 2020 2063 6f72  .            cor
+000090a0: 7265 7370 6f6e 6420 746f 2062 6172 6520  respond to bare 
+000090b0: 736f 696c 2c20 7468 6573 6520 6172 6520  soil, these are 
+000090c0: 7365 7420 746f 207a 6572 6f20 6265 666f  set to zero befo
+000090d0: 7265 2072 6573 616d 706c 696e 672e 0a0a  re resampling...
+000090e0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000090f0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00009100: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6c61  -----.        la
+00009110: 695f 666e 203a 207b 276d 6f64 6973 5f6c  i_fn : {'modis_l
+00009120: 6169 277d 0a20 2020 2020 2020 2020 2020  ai'}.           
+00009130: 204e 616d 6520 6f66 2064 6174 6120 736f   Name of data so
+00009140: 7572 6365 2066 6f72 204c 4149 2070 6172  urce for LAI par
+00009150: 616d 6574 6572 732c 2073 6565 2064 6174  ameters, see dat
+00009160: 612f 6461 7461 5f73 6f75 7263 6573 2e79  a/data_sources.y
+00009170: 6d6c 2e0a 0a20 2020 2020 2020 2020 2020  ml...           
+00009180: 202a 2052 6571 7569 7265 6420 7661 7269   * Required vari
+00009190: 6162 6c65 733a 205b 274c 4149 275d 0a20  ables: ['LAI']. 
+000091a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000091b0: 2020 2069 6620 6c61 695f 666e 206e 6f74     if lai_fn not
+000091c0: 2069 6e20 7365 6c66 2e64 6174 615f 6361   in self.data_ca
+000091d0: 7461 6c6f 673a 0a20 2020 2020 2020 2020  talog:.         
+000091e0: 2020 2073 656c 662e 6c6f 6767 6572 2e77     self.logger.w
+000091f0: 6172 6e69 6e67 2866 2249 6e76 616c 6964  arning(f"Invalid
+00009200: 2073 6f75 7263 6520 277b 6c61 695f 666e   source '{lai_fn
+00009210: 7d27 2c20 736b 6970 7069 6e67 2073 6574  }', skipping set
+00009220: 7570 5f6c 6169 6d61 7073 2e22 290a 2020  up_laimaps.").  
+00009230: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009240: 0a20 2020 2020 2020 2023 2072 6574 7269  .        # retri
+00009250: 6576 6520 6461 7461 2066 6f72 2072 6567  eve data for reg
+00009260: 696f 6e0a 2020 2020 2020 2020 7365 6c66  ion.        self
+00009270: 2e6c 6f67 6765 722e 696e 666f 2866 2250  .logger.info(f"P
+00009280: 7265 7061 7269 6e67 204c 4149 206d 6170  reparing LAI map
+00009290: 732e 2229 0a20 2020 2020 2020 2064 6120  s.").        da 
+000092a0: 3d20 7365 6c66 2e64 6174 615f 6361 7461  = self.data_cata
+000092b0: 6c6f 672e 6765 745f 7261 7374 6572 6461  log.get_rasterda
+000092c0: 7461 7365 7428 6c61 695f 666e 2c20 6765  taset(lai_fn, ge
+000092d0: 6f6d 3d73 656c 662e 7265 6769 6f6e 2c20  om=self.region, 
+000092e0: 6275 6666 6572 3d32 290a 2020 2020 2020  buffer=2).      
+000092f0: 2020 6461 5f6c 6169 203d 2077 6f72 6b66    da_lai = workf
+00009300: 6c6f 7773 2e6c 6169 280a 2020 2020 2020  lows.lai(.      
+00009310: 2020 2020 2020 6461 3d64 612c 0a20 2020        da=da,.   
+00009320: 2020 2020 2020 2020 2064 735f 6c69 6b65           ds_like
+00009330: 3d73 656c 662e 7374 6174 6963 6d61 7073  =self.staticmaps
+00009340: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+00009350: 6767 6572 3d73 656c 662e 6c6f 6767 6572  gger=self.logger
+00009360: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00009370: 2020 2020 2320 5265 6e61 6d65 2074 6865      # Rename the
+00009380: 2066 6972 7374 2064 696d 656e 7369 6f6e   first dimension
+00009390: 2074 6f20 7469 6d65 0a20 2020 2020 2020   to time.       
+000093a0: 2072 6d64 6963 7420 3d20 7b64 615f 6c61   rmdict = {da_la
+000093b0: 692e 6469 6d73 5b30 5d3a 2022 7469 6d65  i.dims[0]: "time
+000093c0: 227d 0a20 2020 2020 2020 2073 656c 662e  "}.        self.
+000093d0: 7365 745f 7374 6174 6963 6d61 7073 2864  set_staticmaps(d
+000093e0: 615f 6c61 692e 7265 6e61 6d65 2872 6d64  a_lai.rename(rmd
+000093f0: 6963 7429 2c20 6e61 6d65 3d22 4c41 4922  ict), name="LAI"
+00009400: 290a 0a20 2020 2064 6566 2073 6574 7570  )..    def setup
+00009410: 5f63 6f6e 6669 675f 6f75 7470 7574 5f74  _config_output_t
+00009420: 696d 6573 6572 6965 7328 0a20 2020 2020  imeseries(.     
+00009430: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00009440: 206d 6170 6e61 6d65 3a20 7374 722c 0a20   mapname: str,. 
+00009450: 2020 2020 2020 2074 6f6d 6c5f 6f75 7470         toml_outp
+00009460: 7574 3a20 4f70 7469 6f6e 616c 5b73 7472  ut: Optional[str
+00009470: 5d20 3d20 2263 7376 222c 0a20 2020 2020  ] = "csv",.     
+00009480: 2020 2068 6561 6465 723a 204f 7074 696f     header: Optio
+00009490: 6e61 6c5b 4c69 7374 5b73 7472 5d5d 203d  nal[List[str]] =
+000094a0: 205b 2251 225d 2c0a 2020 2020 2020 2020   ["Q"],.        
+000094b0: 7061 7261 6d3a 204f 7074 696f 6e61 6c5b  param: Optional[
+000094c0: 4c69 7374 5b73 7472 5d5d 203d 205b 226c  List[str]] = ["l
+000094d0: 6174 6572 616c 2e72 6976 6572 2e71 5f61  ateral.river.q_a
+000094e0: 7622 5d2c 0a20 2020 2020 2020 2072 6564  v"],.        red
+000094f0: 7563 6572 3a20 4f70 7469 6f6e 616c 5b4c  ucer: Optional[L
+00009500: 6973 745b 7374 725d 5d20 3d20 4e6f 6e65  ist[str]] = None
+00009510: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+00009520: 2022 2222 5468 6973 2063 6f6d 706f 6e65   """This compone
+00009530: 6e74 7320 7365 7473 2074 6865 2064 6566  nts sets the def
+00009540: 6175 6c74 2067 6175 6765 206d 6170 2062  ault gauge map b
+00009550: 6173 6564 206f 6e20 6261 7369 6e20 6f75  ased on basin ou
+00009560: 746c 6574 732e 0a0a 2020 2020 2020 2020  tlets...        
+00009570: 4164 6473 206d 6f64 656c 206c 6179 6572  Adds model layer
+00009580: 733a 0a0a 2020 2020 2020 2020 2a20 2a2a  s:..        * **
+00009590: 6373 762e 636f 6c75 6d6e 2a2a 2063 6f6e  csv.column** con
+000095a0: 6669 673a 2063 7376 2074 696d 6573 6572  fig: csv timeser
+000095b0: 6965 7320 746f 2073 6176 6520 6261 7365  ies to save base
+000095c0: 6420 6f6e 206d 6170 6e61 6d65 206c 6f63  d on mapname loc
+000095d0: 6174 696f 6e73 0a20 2020 2020 2020 202a  ations.        *
+000095e0: 202a 2a6e 6574 6364 662e 7661 7269 6162   **netcdf.variab
+000095f0: 6c65 2a2a 2063 6f6e 6669 673a 206e 6574  le** config: net
+00009600: 6364 6620 7469 6d65 7365 7269 6573 2074  cdf timeseries t
+00009610: 6f20 7361 7665 2062 6173 6564 206f 6e20  o save based on 
+00009620: 6d61 706e 616d 6520 6c6f 6361 7469 6f6e  mapname location
+00009630: 730a 0a20 2020 2020 2020 2050 6172 616d  s..        Param
+00009640: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00009650: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00009660: 206d 6170 6e61 6d65 203a 2073 7472 0a20   mapname : str. 
+00009670: 2020 2020 2020 2020 2020 204e 616d 6520             Name 
+00009680: 6f66 2074 6865 2067 6175 6765 206d 6170  of the gauge map
+00009690: 2028 696e 2073 7461 7469 636d 6170 732e   (in staticmaps.
+000096a0: 6e63 2920 746f 2075 7365 2066 6f72 2073  nc) to use for s
+000096b0: 6361 6c61 7220 6f75 7470 7574 2e0a 2020  calar output..  
+000096c0: 2020 2020 2020 746f 6d6c 5f6f 7574 7075        toml_outpu
+000096d0: 7420 3a20 7374 722c 206f 7074 696f 6e61  t : str, optiona
+000096e0: 6c0a 2020 2020 2020 2020 2020 2020 4f6e  l.            On
+000096f0: 6520 6f66 205b 2763 7376 272c 2027 6e65  e of ['csv', 'ne
+00009700: 7463 6466 272c 204e 6f6e 655d 2074 6f20  tcdf', None] to 
+00009710: 7570 6461 7465 205b 6373 765d 206f 7220  update [csv] or 
+00009720: 5b6e 6574 6364 665d 2073 6563 7469 6f6e  [netcdf] section
+00009730: 206f 6620 7766 6c6f 7720 746f 6d6c 2066   of wflow toml f
+00009740: 696c 6520 6f72 2064 6f20 6e6f 7468 696e  ile or do nothin
+00009750: 672e 2042 7920 6465 6661 756c 742c 2027  g. By default, '
+00009760: 6373 7627 2e0a 2020 2020 2020 2020 6865  csv'..        he
+00009770: 6164 6572 203a 206c 6973 742c 206f 7074  ader : list, opt
+00009780: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00009790: 2020 5361 7665 2073 7065 6369 6669 6320    Save specific 
+000097a0: 6d6f 6465 6c20 7061 7261 6d65 7465 7273  model parameters
+000097b0: 2069 6e20 6373 7620 7365 6374 696f 6e2e   in csv section.
+000097c0: 2054 6869 7320 6f70 7469 6f6e 2064 6566   This option def
+000097d0: 696e 6573 2074 6865 2068 6561 6465 7220  ines the header 
+000097e0: 6f66 2074 6865 2063 7376 2066 696c 652e  of the csv file.
+000097f0: 2f0a 2020 2020 2020 2020 2020 2020 4279  /.            By
+00009800: 2064 6566 6175 6c74 2073 6176 6573 2051   default saves Q
+00009810: 2028 666f 7220 6c61 7465 7261 6c2e 7269   (for lateral.ri
+00009820: 7665 722e 715f 6176 292e 0a20 2020 2020  ver.q_av)..     
+00009830: 2020 2070 6172 616d 3a20 6c69 7374 2c20     param: list, 
+00009840: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00009850: 2020 2020 2053 6176 6520 7370 6563 6966       Save specif
+00009860: 6963 206d 6f64 656c 2070 6172 616d 6574  ic model paramet
+00009870: 6572 7320 696e 2063 7376 2073 6563 7469  ers in csv secti
+00009880: 6f6e 2e20 5468 6973 206f 7074 696f 6e20  on. This option 
+00009890: 6465 6669 6e65 7320 7468 6520 7766 6c6f  defines the wflo
+000098a0: 7720 7661 7269 6162 6c65 2063 6f72 7265  w variable corre
+000098b0: 7370 6f6e 6469 6e67 2074 6f20 7468 652f  sponding to the/
+000098c0: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
+000098d0: 6573 2069 6e20 6761 7567 655f 746f 6d6c  es in gauge_toml
+000098e0: 5f68 6561 6465 722e 2042 7920 6465 6661  _header. By defa
+000098f0: 756c 7420 7361 7665 7320 6c61 7465 7261  ult saves latera
+00009900: 6c2e 7269 7665 722e 715f 6176 2028 666f  l.river.q_av (fo
+00009910: 7220 5129 2e0a 2020 2020 2020 2020 7265  r Q)..        re
+00009920: 6475 6365 723a 206c 6973 742c 206f 7074  ducer: list, opt
+00009930: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00009940: 2020 4966 206d 6170 2069 7320 616e 2061    If map is an a
+00009950: 7265 6120 7261 7468 6572 2074 6861 6e20  rea rather than 
+00009960: 6120 706f 696e 7420 6c6f 6361 7469 6f6e  a point location
+00009970: 2c20 7072 6f76 6964 6573 2074 6865 2072  , provides the r
+00009980: 6564 7563 6572 2066 6f72 2074 6865 2070  educer for the p
+00009990: 6172 616d 6574 6572 7320 746f 2073 6176  arameters to sav
+000099a0: 652e 2042 7920 6465 6661 756c 7420 4e6f  e. By default No
+000099b0: 6e65 2e0a 2020 2020 2020 2020 2222 220a  ne..        """.
+000099c0: 0a20 2020 2020 2020 2023 2023 2041 6464  .        # # Add
+000099d0: 206e 6577 206f 7574 7075 7463 7376 2073   new outputcsv s
+000099e0: 6563 7469 6f6e 2069 6e20 7468 6520 636f  ection in the co
+000099f0: 6e66 6967 0a20 2020 2020 2020 2069 6620  nfig.        if 
+00009a00: 746f 6d6c 5f6f 7574 7075 7420 3d3d 2022  toml_output == "
+00009a10: 6373 7622 206f 7220 746f 6d6c 5f6f 7574  csv" or toml_out
+00009a20: 7075 7420 3d3d 2022 6e65 7463 6466 223a  put == "netcdf":
+00009a30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009a40: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
+00009a50: 4164 6469 6e67 207b 7061 7261 6d7d 2074  Adding {param} t
+00009a60: 6f20 7b74 6f6d 6c5f 6f75 7470 7574 7d20  o {toml_output} 
+00009a70: 7365 6374 696f 6e20 6f66 2074 6f6d 6c2e  section of toml.
+00009a80: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
+00009a90: 2041 6464 206d 6170 2074 6f20 7468 6520   Add map to the 
+00009aa0: 696e 7075 7420 7365 6374 696f 6e20 6f66  input section of
+00009ab0: 2063 6f6e 6669 670a 2020 2020 2020 2020   config.        
+00009ac0: 2020 2020 6261 7365 6e61 6d65 203d 2028      basename = (
+00009ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009ae0: 206d 6170 6e61 6d65 0a20 2020 2020 2020   mapname.       
+00009af0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00009b00: 6d61 706e 616d 652e 7374 6172 7473 7769  mapname.startswi
+00009b10: 7468 2822 7766 6c6f 7722 290a 2020 2020  th("wflow").    
+00009b20: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00009b30: 206d 6170 6e61 6d65 2e72 6570 6c61 6365   mapname.replace
+00009b40: 2822 7766 6c6f 775f 222c 2022 2229 0a20  ("wflow_", ""). 
+00009b50: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00009b60: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+00009b70: 745f 636f 6e66 6967 2866 2269 6e70 7574  t_config(f"input
+00009b80: 2e7b 6261 7365 6e61 6d65 7d22 2c20 6d61  .{basename}", ma
+00009b90: 706e 616d 6529 0a20 2020 2020 2020 2020  pname).         
+00009ba0: 2020 2023 2053 6574 7469 6e67 7320 616e     # Settings an
+00009bb0: 6420 6164 6420 6373 7620 6f72 206e 6574  d add csv or net
+00009bc0: 6364 6620 7365 6374 696f 6e73 2069 6620  cdf sections if 
+00009bd0: 6e6f 7420 616c 7265 6164 7920 696e 2063  not already in c
+00009be0: 6f6e 6669 670a 2020 2020 2020 2020 2020  onfig.          
+00009bf0: 2020 2320 6373 760a 2020 2020 2020 2020    # csv.        
+00009c00: 2020 2020 6966 2074 6f6d 6c5f 6f75 7470      if toml_outp
+00009c10: 7574 203d 3d20 2263 7376 223a 0a20 2020  ut == "csv":.   
+00009c20: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+00009c30: 6465 725f 6e61 6d65 203d 2022 6865 6164  der_name = "head
+00009c40: 6572 220a 2020 2020 2020 2020 2020 2020  er".            
+00009c50: 2020 2020 7661 725f 6e61 6d65 203d 2022      var_name = "
+00009c60: 636f 6c75 6d6e 220a 2020 2020 2020 2020  column".        
+00009c70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00009c80: 6765 745f 636f 6e66 6967 2822 6373 7622  get_config("csv"
+00009c90: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
+00009ca0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009cb0: 656c 662e 7365 745f 636f 6e66 6967 2822  elf.set_config("
+00009cc0: 6373 762e 7061 7468 222c 2022 6f75 7470  csv.path", "outp
+00009cd0: 7574 2e63 7376 2229 0a20 2020 2020 2020  ut.csv").       
+00009ce0: 2020 2020 2023 206e 6574 6364 660a 2020       # netcdf.  
+00009cf0: 2020 2020 2020 2020 2020 6966 2074 6f6d            if tom
+00009d00: 6c5f 6f75 7470 7574 203d 3d20 226e 6574  l_output == "net
+00009d10: 6364 6622 3a0a 2020 2020 2020 2020 2020  cdf":.          
+00009d20: 2020 2020 2020 6865 6164 6572 5f6e 616d        header_nam
+00009d30: 6520 3d20 226e 616d 6522 0a20 2020 2020  e = "name".     
+00009d40: 2020 2020 2020 2020 2020 2076 6172 5f6e             var_n
+00009d50: 616d 6520 3d20 2276 6172 6961 626c 6522  ame = "variable"
+00009d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009d70: 2069 6620 7365 6c66 2e67 6574 5f63 6f6e   if self.get_con
+00009d80: 6669 6728 226e 6574 6364 6622 2920 6973  fig("netcdf") is
+00009d90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00009da0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009db0: 7365 745f 636f 6e66 6967 2822 6e65 7463  set_config("netc
+00009dc0: 6466 2e70 6174 6822 2c20 226f 7574 7075  df.path", "outpu
+00009dd0: 745f 7363 616c 6172 2e6e 6322 290a 2020  t_scalar.nc").  
+00009de0: 2020 2020 2020 2020 2020 2320 696e 6974            # init
+00009df0: 6961 6c69 7365 2063 6f6c 756d 6e20 2f20  ialise column / 
+00009e00: 7661 7269 6261 6c65 2073 6563 7469 6f6e  varibale section
+00009e10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009e20: 7365 6c66 2e67 6574 5f63 6f6e 6669 6728  self.get_config(
+00009e30: 6622 7b74 6f6d 6c5f 6f75 7470 7574 7d2e  f"{toml_output}.
+00009e40: 7b76 6172 5f6e 616d 657d 2229 2069 7320  {var_name}") is 
+00009e50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00009e60: 2020 2020 2020 7365 6c66 2e73 6574 5f63        self.set_c
+00009e70: 6f6e 6669 6728 6622 7b74 6f6d 6c5f 6f75  onfig(f"{toml_ou
+00009e80: 7470 7574 7d2e 7b76 6172 5f6e 616d 657d  tput}.{var_name}
+00009e90: 222c 205b 5d29 0a0a 2020 2020 2020 2020  ", [])..        
+00009ea0: 2020 2020 2320 4164 6420 6e65 7720 6f75      # Add new ou
+00009eb0: 7470 7574 2063 6f6c 756d 6e2f 7661 7269  tput column/vari
+00009ec0: 6162 6c65 2074 6f20 636f 6e66 6967 0a20  able to config. 
+00009ed0: 2020 2020 2020 2020 2020 2066 6f72 206f             for o
+00009ee0: 2069 6e20 7261 6e67 6528 6c65 6e28 7061   in range(len(pa
+00009ef0: 7261 6d29 293a 0a20 2020 2020 2020 2020  ram)):.         
+00009f00: 2020 2020 2020 2067 6175 6765 5f74 6f6d         gauge_tom
+00009f10: 6c5f 6469 6374 203d 207b 0a20 2020 2020  l_dict = {.     
+00009f20: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00009f30: 6561 6465 725f 6e61 6d65 3a20 6865 6164  eader_name: head
+00009f40: 6572 5b6f 5d2c 0a20 2020 2020 2020 2020  er[o],.         
+00009f50: 2020 2020 2020 2020 2020 2022 6d61 7022             "map"
+00009f60: 3a20 6261 7365 6e61 6d65 2c0a 2020 2020  : basename,.    
+00009f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f80: 2270 6172 616d 6574 6572 223a 2070 6172  "parameter": par
+00009f90: 616d 5b6f 5d2c 0a20 2020 2020 2020 2020  am[o],.         
+00009fa0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00009fb0: 2020 2020 2020 2020 2069 6620 7265 6475           if redu
+00009fc0: 6365 7220 6973 206e 6f74 204e 6f6e 653a  cer is not None:
+00009fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009fe0: 2020 2020 2067 6175 6765 5f74 6f6d 6c5f       gauge_toml_
+00009ff0: 6469 6374 5b22 7265 6475 6365 7222 5d3a  dict["reducer"]:
+0000a000: 2072 6564 7563 6572 5b6f 5d0a 2020 2020   reducer[o].    
+0000a010: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+0000a020: 2074 6865 2067 6175 6765 2063 6f6c 756d   the gauge colum
+0000a030: 6e2f 7661 7269 6162 6c65 2061 6c72 6561  n/variable alrea
+0000a040: 6479 2065 7869 7374 7320 736b 6970 2077  dy exists skip w
+0000a050: 7269 7474 696e 6720 7477 6963 650a 2020  ritting twice.  
+0000a060: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000a070: 2067 6175 6765 5f74 6f6d 6c5f 6469 6374   gauge_toml_dict
+0000a080: 206e 6f74 2069 6e20 7365 6c66 2e63 6f6e   not in self.con
+0000a090: 6669 675b 746f 6d6c 5f6f 7574 7075 745d  fig[toml_output]
+0000a0a0: 5b76 6172 5f6e 616d 655d 3a0a 2020 2020  [var_name]:.    
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 7365 6c66 2e63 6f6e 6669 675b 746f 6d6c  self.config[toml
+0000a0d0: 5f6f 7574 7075 745d 5b76 6172 5f6e 616d  _output][var_nam
+0000a0e0: 655d 2e61 7070 656e 6428 6761 7567 655f  e].append(gauge_
+0000a0f0: 746f 6d6c 5f64 6963 7429 0a20 2020 2020  toml_dict).     
+0000a100: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a110: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000a120: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+0000a130: 2020 2020 2020 2066 2274 6f6d 6c5f 6f75         f"toml_ou
+0000a140: 7470 7574 2073 6574 2074 6f20 7b74 6f6d  tput set to {tom
+0000a150: 6c5f 6f75 7470 7574 7d2c 2073 6b69 7070  l_output}, skipp
+0000a160: 696e 6720 6164 6469 6e67 2067 6175 6765  ing adding gauge
+0000a170: 2073 7065 6369 6669 6320 6f75 7470 7574   specific output
+0000a180: 7320 746f 2074 6865 2074 6f6d 6c2e 220a  s to the toml.".
+0000a190: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000a1a0: 2020 2064 6566 2073 6574 7570 5f6f 7574     def setup_out
+0000a1b0: 6c65 7473 280a 2020 2020 2020 2020 7365  lets(.        se
+0000a1c0: 6c66 2c0a 2020 2020 2020 2020 7269 7665  lf,.        rive
+0000a1d0: 725f 6f6e 6c79 3d54 7275 652c 0a20 2020  r_only=True,.   
+0000a1e0: 2020 2020 2074 6f6d 6c5f 6f75 7470 7574       toml_output
+0000a1f0: 3d22 6373 7622 2c0a 2020 2020 2020 2020  ="csv",.        
+0000a200: 6761 7567 655f 746f 6d6c 5f68 6561 6465  gauge_toml_heade
+0000a210: 723d 5b22 5122 5d2c 0a20 2020 2020 2020  r=["Q"],.       
+0000a220: 2067 6175 6765 5f74 6f6d 6c5f 7061 7261   gauge_toml_para
+0000a230: 6d3d 5b22 6c61 7465 7261 6c2e 7269 7665  m=["lateral.rive
+0000a240: 722e 715f 6176 225d 2c0a 2020 2020 293a  r.q_av"],.    ):
+0000a250: 0a20 2020 2020 2020 2022 2222 5468 6973  .        """This
+0000a260: 2063 6f6d 706f 6e65 6e74 7320 7365 7473   components sets
+0000a270: 2074 6865 2064 6566 6175 6c74 2067 6175   the default gau
+0000a280: 6765 206d 6170 2062 6173 6564 206f 6e20  ge map based on 
+0000a290: 6261 7369 6e20 6f75 746c 6574 732e 0a0a  basin outlets...
+0000a2a0: 2020 2020 2020 2020 4164 6473 206d 6f64          Adds mod
+0000a2b0: 656c 206c 6179 6572 733a 0a0a 2020 2020  el layers:..    
+0000a2c0: 2020 2020 2a20 2a2a 7766 6c6f 775f 6761      * **wflow_ga
+0000a2d0: 7567 6573 2a2a 206d 6170 3a20 6761 7567  uges** map: gaug
+0000a2e0: 6520 4944 7320 6d61 7020 6672 6f6d 2063  e IDs map from c
+0000a2f0: 6174 6368 6d65 6e74 206f 7574 6c65 7473  atchment outlets
+0000a300: 205b 2d5d 0a20 2020 2020 2020 202a 202a   [-].        * *
+0000a310: 2a67 6175 6765 732a 2a20 6765 6f6d 3a20  *gauges** geom: 
+0000a320: 706f 6c79 676f 6e20 6f66 2063 6174 6368  polygon of catch
+0000a330: 6d65 6e74 206f 7574 6c65 7473 0a0a 2020  ment outlets..  
+0000a340: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0000a350: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0000a360: 2d2d 2d0a 2020 2020 2020 2020 7269 7665  ---.        rive
+0000a370: 725f 6f6e 6c79 203a 2062 6f6f 6c2c 206f  r_only : bool, o
+0000a380: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0000a390: 2020 2020 4f6e 6c79 2064 6572 6976 6520      Only derive 
+0000a3a0: 6f75 746c 6574 206c 6f63 6174 696f 6e73  outlet locations
+0000a3b0: 2069 6620 7468 6579 2061 7265 206c 6f63   if they are loc
+0000a3c0: 6174 6564 206f 6e20 6120 7269 7665 7220  ated on a river 
+0000a3d0: 696e 7374 6561 6420 6f66 206c 6f63 6174  instead of locat
+0000a3e0: 696f 6e73 2066 6f72 2061 6c6c 2063 6174  ions for all cat
+0000a3f0: 6368 6d65 6e74 732c 2062 7920 6465 6661  chments, by defa
+0000a400: 756c 7420 5472 7565 2e0a 2020 2020 2020  ult True..      
+0000a410: 2020 746f 6d6c 5f6f 7574 7075 7420 3a20    toml_output : 
+0000a420: 7374 722c 206f 7074 696f 6e61 6c0a 2020  str, optional.  
+0000a430: 2020 2020 2020 2020 2020 4f6e 6520 6f66            One of
+0000a440: 205b 2763 7376 272c 2027 6e65 7463 6466   ['csv', 'netcdf
+0000a450: 272c 204e 6f6e 655d 2074 6f20 7570 6461  ', None] to upda
+0000a460: 7465 205b 6373 765d 206f 7220 5b6e 6574  te [csv] or [net
+0000a470: 6364 665d 2073 6563 7469 6f6e 206f 6620  cdf] section of 
+0000a480: 7766 6c6f 7720 746f 6d6c 2066 696c 6520  wflow toml file 
+0000a490: 6f72 2064 6f20 6e6f 7468 696e 672e 2042  or do nothing. B
+0000a4a0: 7920 6465 6661 756c 742c 2027 6373 7627  y default, 'csv'
+0000a4b0: 2e0a 2020 2020 2020 2020 6761 7567 655f  ..        gauge_
+0000a4c0: 746f 6d6c 5f68 6561 6465 7220 3a20 6c69  toml_header : li
+0000a4d0: 7374 2c20 6f70 7469 6f6e 616c 0a20 2020  st, optional.   
+0000a4e0: 2020 2020 2020 2020 2053 6176 6520 7370           Save sp
+0000a4f0: 6563 6966 6963 206d 6f64 656c 2070 6172  ecific model par
+0000a500: 616d 6574 6572 7320 696e 2063 7376 2073  ameters in csv s
+0000a510: 6563 7469 6f6e 2e20 5468 6973 206f 7074  ection. This opt
+0000a520: 696f 6e20 6465 6669 6e65 7320 7468 6520  ion defines the 
+0000a530: 6865 6164 6572 206f 6620 7468 6520 6373  header of the cs
+0000a540: 7620 6669 6c65 2e2f 0a20 2020 2020 2020  v file./.       
+0000a550: 2020 2020 2042 7920 6465 6661 756c 7420       By default 
+0000a560: 7361 7665 7320 5120 2866 6f72 206c 6174  saves Q (for lat
+0000a570: 6572 616c 2e72 6976 6572 2e71 5f61 7629  eral.river.q_av)
+0000a580: 2e0a 2020 2020 2020 2020 6761 7567 655f  ..        gauge_
+0000a590: 746f 6d6c 5f70 6172 616d 3a20 6c69 7374  toml_param: list
+0000a5a0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0000a5b0: 2020 2020 2020 2053 6176 6520 7370 6563         Save spec
+0000a5c0: 6966 6963 206d 6f64 656c 2070 6172 616d  ific model param
+0000a5d0: 6574 6572 7320 696e 2063 7376 2073 6563  eters in csv sec
+0000a5e0: 7469 6f6e 2e20 5468 6973 206f 7074 696f  tion. This optio
+0000a5f0: 6e20 6465 6669 6e65 7320 7468 6520 7766  n defines the wf
+0000a600: 6c6f 7720 7661 7269 6162 6c65 2063 6f72  low variable cor
+0000a610: 7265 7370 6f6e 6469 6e67 2074 6f20 7468  responding to th
+0000a620: 652f 0a20 2020 2020 2020 2020 2020 206e  e/.            n
+0000a630: 616d 6573 2069 6e20 6761 7567 655f 746f  ames in gauge_to
+0000a640: 6d6c 5f68 6561 6465 722e 2042 7920 6465  ml_header. By de
+0000a650: 6661 756c 7420 7361 7665 7320 6c61 7465  fault saves late
+0000a660: 7261 6c2e 7269 7665 722e 715f 6176 2028  ral.river.q_av (
+0000a670: 666f 7220 5129 2e0a 2020 2020 2020 2020  for Q)..        
+0000a680: 2222 220a 2020 2020 2020 2020 2320 7265  """.        # re
+0000a690: 6164 2065 7869 7374 696e 6720 7374 6174  ad existing stat
+0000a6a0: 6963 6765 6f6d 733b 2069 6d70 6f72 7461  icgeoms; importa
+0000a6b0: 6e74 2074 6f20 6765 7420 7468 6520 7269  nt to get the ri
+0000a6c0: 6768 7420 6261 7369 6e20 7768 656e 2075  ght basin when u
+0000a6d0: 7064 6174 696e 670a 2020 2020 2020 2020  pdating.        
+0000a6e0: 2320 6669 7820 696e 2073 6574 5f73 7461  # fix in set_sta
+0000a6f0: 7469 6367 656f 6d73 202f 2073 6574 5f67  ticgeoms / set_g
+0000a700: 656f 6d73 206d 6574 686f 640a 2020 2020  eoms method.    
+0000a710: 2020 2020 7365 6c66 2e73 7461 7469 6367      self.staticg
+0000a720: 656f 6d73 0a0a 2020 2020 2020 2020 7365  eoms..        se
+0000a730: 6c66 2e6c 6f67 6765 722e 696e 666f 2866  lf.logger.info(f
+0000a740: 2247 6175 6765 7320 6c6f 6361 7469 6f6e  "Gauges location
+0000a750: 7320 7365 7420 6261 7365 6420 6f6e 2072  s set based on r
+0000a760: 6976 6572 206f 7574 6c65 7473 2e22 290a  iver outlets.").
+0000a770: 2020 2020 2020 2020 6964 7873 5f6f 7574          idxs_out
+0000a780: 203d 2073 656c 662e 666c 7764 6972 2e69   = self.flwdir.i
+0000a790: 6478 735f 7069 740a 2020 2020 2020 2020  dxs_pit.        
+0000a7a0: 2320 4f6e 6c79 206b 6565 7020 7269 7665  # Only keep rive
+0000a7b0: 7220 6f75 746c 6574 7320 666f 7220 6761  r outlets for ga
+0000a7c0: 7567 6573 0a20 2020 2020 2020 2069 6620  uges.        if 
+0000a7d0: 7269 7665 725f 6f6e 6c79 3a0a 2020 2020  river_only:.    
+0000a7e0: 2020 2020 2020 2020 6964 7873 5f6f 7574          idxs_out
+0000a7f0: 203d 2069 6478 735f 6f75 745b 0a20 2020   = idxs_out[.   
+0000a800: 2020 2020 2020 2020 2020 2020 2028 7365               (se
+0000a810: 6c66 2e73 7461 7469 636d 6170 735b 7365  lf.staticmaps[se
+0000a820: 6c66 2e5f 4d41 5053 5b22 7269 766d 736b  lf._MAPS["rivmsk
+0000a830: 225d 5d20 3e20 3029 2e76 616c 7565 732e  "]] > 0).values.
+0000a840: 666c 6174 5b69 6478 735f 6f75 745d 0a20  flat[idxs_out]. 
+0000a850: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
+0000a860: 2020 2020 2064 615f 6f75 742c 2069 6478       da_out, idx
+0000a870: 735f 6f75 742c 2069 6473 5f6f 7574 203d  s_out, ids_out =
+0000a880: 2066 6c77 2e67 6175 6765 5f6d 6170 280a   flw.gauge_map(.
+0000a890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000a8a0: 2e73 7461 7469 636d 6170 732c 0a20 2020  .staticmaps,.   
+0000a8b0: 2020 2020 2020 2020 2069 6478 733d 6964           idxs=id
+0000a8c0: 7873 5f6f 7574 2c0a 2020 2020 2020 2020  xs_out,.        
+0000a8d0: 2020 2020 666c 7764 6972 3d73 656c 662e      flwdir=self.
+0000a8e0: 666c 7764 6972 2c0a 2020 2020 2020 2020  flwdir,.        
+0000a8f0: 2020 2020 6c6f 6767 6572 3d73 656c 662e      logger=self.
+0000a900: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
+0000a910: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+0000a920: 6574 5f73 7461 7469 636d 6170 7328 6461  et_staticmaps(da
+0000a930: 5f6f 7574 2c20 6e61 6d65 3d73 656c 662e  _out, name=self.
+0000a940: 5f4d 4150 535b 2267 6175 6765 7322 5d29  _MAPS["gauges"])
+0000a950: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
+0000a960: 3d20 6770 642e 706f 696e 7473 5f66 726f  = gpd.points_fro
+0000a970: 6d5f 7879 282a 7365 6c66 2e73 7461 7469  m_xy(*self.stati
+0000a980: 636d 6170 732e 7261 7374 6572 2e69 6478  cmaps.raster.idx
+0000a990: 5f74 6f5f 7879 2869 6478 735f 6f75 7429  _to_xy(idxs_out)
+0000a9a0: 290a 2020 2020 2020 2020 6764 6620 3d20  ).        gdf = 
+0000a9b0: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
+0000a9c0: 280a 2020 2020 2020 2020 2020 2020 696e  (.            in
+0000a9d0: 6465 783d 6964 735f 6f75 742e 6173 7479  dex=ids_out.asty
+0000a9e0: 7065 286e 702e 696e 7433 3229 2c20 6765  pe(np.int32), ge
+0000a9f0: 6f6d 6574 7279 3d70 6f69 6e74 732c 2063  ometry=points, c
+0000aa00: 7273 3d73 656c 662e 6372 730a 2020 2020  rs=self.crs.    
+0000aa10: 2020 2020 290a 2020 2020 2020 2020 6764      ).        gd
+0000aa20: 665b 2266 6964 225d 203d 2069 6473 5f6f  f["fid"] = ids_o
+0000aa30: 7574 2e61 7374 7970 6528 6e70 2e69 6e74  ut.astype(np.int
+0000aa40: 3332 290a 2020 2020 2020 2020 7365 6c66  32).        self
+0000aa50: 2e73 6574 5f73 7461 7469 6367 656f 6d73  .set_staticgeoms
+0000aa60: 2867 6466 2c20 6e61 6d65 3d22 6761 7567  (gdf, name="gaug
+0000aa70: 6573 2229 0a20 2020 2020 2020 2073 656c  es").        sel
+0000aa80: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
+0000aa90: 4761 7567 6573 206d 6170 2062 6173 6564  Gauges map based
+0000aaa0: 206f 6e20 6361 7463 686d 656e 7420 7269   on catchment ri
+0000aab0: 7665 7220 6f75 746c 6574 7320 6164 6465  ver outlets adde
+0000aac0: 642e 2229 0a0a 2020 2020 2020 2020 7365  d.")..        se
+0000aad0: 6c66 2e73 6574 7570 5f63 6f6e 6669 675f  lf.setup_config_
+0000aae0: 6f75 7470 7574 5f74 696d 6573 6572 6965  output_timeserie
+0000aaf0: 7328 0a20 2020 2020 2020 2020 2020 206d  s(.            m
+0000ab00: 6170 6e61 6d65 3d22 7766 6c6f 775f 6761  apname="wflow_ga
+0000ab10: 7567 6573 222c 0a20 2020 2020 2020 2020  uges",.         
+0000ab20: 2020 2074 6f6d 6c5f 6f75 7470 7574 3d74     toml_output=t
+0000ab30: 6f6d 6c5f 6f75 7470 7574 2c0a 2020 2020  oml_output,.    
+0000ab40: 2020 2020 2020 2020 6865 6164 6572 3d67          header=g
+0000ab50: 6175 6765 5f74 6f6d 6c5f 6865 6164 6572  auge_toml_header
+0000ab60: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+0000ab70: 7261 6d3d 6761 7567 655f 746f 6d6c 5f70  ram=gauge_toml_p
+0000ab80: 6172 616d 2c0a 2020 2020 2020 2020 290a  aram,.        ).
+0000ab90: 0a20 2020 2064 6566 2073 6574 7570 5f67  .    def setup_g
+0000aba0: 6175 6765 7328 0a20 2020 2020 2020 2073  auges(.        s
+0000abb0: 656c 662c 0a20 2020 2020 2020 2067 6175  elf,.        gau
+0000abc0: 6765 735f 666e 3a20 556e 696f 6e5b 7374  ges_fn: Union[st
+0000abd0: 722c 2050 6174 682c 2067 7064 2e47 656f  r, Path, gpd.Geo
+0000abe0: 4461 7461 4672 616d 655d 2c0a 2020 2020  DataFrame],.    
+0000abf0: 2020 2020 696e 6465 785f 636f 6c3a 204f      index_col: O
+0000ac00: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+0000ac10: 6f6e 652c 0a20 2020 2020 2020 2073 6e61  one,.        sna
+0000ac20: 705f 746f 5f72 6976 6572 3a20 4f70 7469  p_to_river: Opti
+0000ac30: 6f6e 616c 5b62 6f6f 6c5d 203d 2054 7275  onal[bool] = Tru
+0000ac40: 652c 0a20 2020 2020 2020 206d 6173 6b3a  e,.        mask:
+0000ac50: 204f 7074 696f 6e61 6c5b 6e70 2e6e 6461   Optional[np.nda
+0000ac60: 7272 6179 5d20 3d20 4e6f 6e65 2c0a 2020  rray] = None,.  
+0000ac70: 2020 2020 2020 736e 6170 5f75 7061 7265        snap_upare
+0000ac80: 613a 204f 7074 696f 6e61 6c5b 626f 6f6c  a: Optional[bool
+0000ac90: 5d20 3d20 4661 6c73 652c 0a20 2020 2020  ] = False,.     
+0000aca0: 2020 206d 6178 5f64 6973 743a 204f 7074     max_dist: Opt
+0000acb0: 696f 6e61 6c5b 666c 6f61 745d 203d 2031  ional[float] = 1
+0000acc0: 3065 332c 0a20 2020 2020 2020 2077 6477  0e3,.        wdw
+0000acd0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+0000ace0: 3d20 332c 0a20 2020 2020 2020 2072 656c  = 3,.        rel
+0000acf0: 5f65 7272 6f72 3a20 4f70 7469 6f6e 616c  _error: Optional
+0000ad00: 5b66 6c6f 6174 5d20 3d20 302e 3035 2c0a  [float] = 0.05,.
+0000ad10: 2020 2020 2020 2020 6465 7269 7665 5f73          derive_s
+0000ad20: 7562 6361 7463 683a 204f 7074 696f 6e61  ubcatch: Optiona
+0000ad30: 6c5b 626f 6f6c 5d20 3d20 4661 6c73 652c  l[bool] = False,
+0000ad40: 0a20 2020 2020 2020 2062 6173 656e 616d  .        basenam
+0000ad50: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
+0000ad60: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000ad70: 2074 6f6d 6c5f 6f75 7470 7574 3a20 4f70   toml_output: Op
+0000ad80: 7469 6f6e 616c 5b73 7472 5d20 3d20 2263  tional[str] = "c
+0000ad90: 7376 222c 0a20 2020 2020 2020 2067 6175  sv",.        gau
+0000ada0: 6765 5f74 6f6d 6c5f 6865 6164 6572 3a20  ge_toml_header: 
+0000adb0: 4f70 7469 6f6e 616c 5b4c 6973 745b 7374  Optional[List[st
+0000adc0: 725d 5d20 3d20 5b22 5122 2c20 2250 225d  r]] = ["Q", "P"]
+0000add0: 2c0a 2020 2020 2020 2020 6761 7567 655f  ,.        gauge_
+0000ade0: 746f 6d6c 5f70 6172 616d 3a20 4f70 7469  toml_param: Opti
+0000adf0: 6f6e 616c 5b4c 6973 745b 7374 725d 5d20  onal[List[str]] 
+0000ae00: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+0000ae10: 226c 6174 6572 616c 2e72 6976 6572 2e71  "lateral.river.q
+0000ae20: 5f61 7622 2c0a 2020 2020 2020 2020 2020  _av",.          
+0000ae30: 2020 2276 6572 7469 6361 6c2e 7072 6563    "vertical.prec
+0000ae40: 6970 6974 6174 696f 6e22 2c0a 2020 2020  ipitation",.    
+0000ae50: 2020 2020 5d2c 0a20 2020 2020 2020 202a      ],.        *
+0000ae60: 2a6b 7761 7267 732c 0a20 2020 2029 3a0a  *kwargs,.    ):.
+0000ae70: 2020 2020 2020 2020 2222 2254 6869 7320          """This 
+0000ae80: 636f 6d70 6f6e 656e 7473 2073 6574 7320  components sets 
+0000ae90: 6120 6761 7567 6520 6d61 7020 6261 7365  a gauge map base
+0000aea0: 6420 6f6e 2060 6067 6175 6765 735f 666e  d on ``gauges_fn
+0000aeb0: 6060 2064 6174 612e 0a0a 2020 2020 2020  `` data...      
+0000aec0: 2020 5375 7070 6f72 7465 6420 6761 7567    Supported gaug
+0000aed0: 6520 6461 7461 7365 7473 2069 6e63 6c75  e datasets inclu
+0000aee0: 6465 2022 6772 6463 220a 2020 2020 2020  de "grdc".      
+0000aef0: 2020 6f72 2022 3c70 6174 685f 746f 5f73    or "<path_to_s
+0000af00: 6f75 7263 653e 2220 666f 7220 7573 6572  ource>" for user
+0000af10: 2073 7570 706c 6965 6420 6373 7620 6f72   supplied csv or
+0000af20: 2067 656f 6d65 7472 7920 6669 6c65 7320   geometry files 
+0000af30: 7769 7468 2067 6175 6765 206c 6f63 6174  with gauge locat
+0000af40: 696f 6e73 2e0a 2020 2020 2020 2020 4966  ions..        If
+0000af50: 2061 2063 7376 2066 696c 6520 6973 2070   a csv file is p
+0000af60: 726f 7669 6465 642c 2061 2022 7822 206f  rovided, a "x" o
+0000af70: 7220 226c 6f6e 2220 616e 6420 2279 2220  r "lon" and "y" 
+0000af80: 6f72 2022 6c61 7422 2063 6f6c 756d 6e20  or "lat" column 
+0000af90: 6973 2072 6571 7569 7265 640a 2020 2020  is required.    
+0000afa0: 2020 2020 616e 6420 7468 6520 6669 7273      and the firs
+0000afb0: 7420 636f 6c75 6d6e 2077 696c 6c20 6265  t column will be
+0000afc0: 2075 7365 6420 6173 2049 4473 2069 6e20   used as IDs in 
+0000afd0: 7468 6520 6d61 702e 0a0a 2020 2020 2020  the map...      
+0000afe0: 2020 5468 6572 6520 6172 6520 7468 7265    There are thre
+0000aff0: 6520 6176 6169 6c61 626c 6520 6d65 7468  e available meth
+0000b000: 6f64 7320 746f 2070 7265 7061 7265 2074  ods to prepare t
+0000b010: 6865 2067 6175 6765 206d 6170 3a0a 0a20  he gauge map:.. 
+0000b020: 2020 2020 2020 202a 206e 6f20 736e 6170         * no snap
+0000b030: 7069 6e67 3a20 6060 6d61 736b 3d4e 6f6e  ping: ``mask=Non
+0000b040: 6560 602c 2060 6073 6e61 705f 746f 5f72  e``, ``snap_to_r
+0000b050: 6976 6572 3d46 616c 7365 6060 2c20 6060  iver=False``, ``
+0000b060: 736e 6170 5f75 7061 7265 613d 4661 6c73  snap_uparea=Fals
+0000b070: 6560 602e 0a20 2020 2020 2020 2020 2054  e``..          T
+0000b080: 6865 2067 6175 6765 206c 6f63 6174 696f  he gauge locatio
+0000b090: 6e73 2061 7265 2075 7365 6420 6173 2069  ns are used as i
+0000b0a0: 732e 0a20 2020 2020 2020 202a 2073 6e61  s..        * sna
+0000b0b0: 7070 696e 6720 746f 206d 6173 6b3a 2074  pping to mask: t
+0000b0c0: 6865 2067 6175 6765 206c 6f63 6174 696f  he gauge locatio
+0000b0d0: 6e73 2061 7265 2073 6e61 7070 6564 2074  ns are snapped t
+0000b0e0: 6f20 6120 626f 6f6c 6561 6e20 6d61 736b  o a boolean mask
+0000b0f0: 206d 6170 3a20 6569 7468 6572 2070 726f   map: either pro
+0000b100: 7669 6465 0a20 2020 2020 2020 2020 2060  vide.          `
+0000b110: 606d 6173 6b60 6020 6f72 2073 6574 2060  `mask`` or set `
+0000b120: 6073 6e61 705f 746f 5f72 6976 6572 3d54  `snap_to_river=T
+0000b130: 7275 6560 6020 746f 2073 6e61 7020 746f  rue`` to snap to
+0000b140: 2074 6865 2072 6976 6572 2028 6465 6661   the river (defa
+0000b150: 756c 7429 2e20 6060 6d61 785f 6469 7374  ult). ``max_dist
+0000b160: 6060 2063 616e 2062 650a 2020 2020 2020  `` can be.      
+0000b170: 2020 2020 7573 6564 2074 6f20 7365 7420      used to set 
+0000b180: 7468 6520 6d61 7869 6d75 6d20 6469 7374  the maximum dist
+0000b190: 616e 6365 2074 6f20 736e 6170 2074 6f20  ance to snap to 
+0000b1a0: 7468 6520 6d61 736b 2e0a 2020 2020 2020  the mask..      
+0000b1b0: 2020 2a20 736e 6170 7069 6e67 2062 6173    * snapping bas
+0000b1c0: 6564 206f 6e20 7570 7374 7265 616d 2061  ed on upstream a
+0000b1d0: 7265 6120 6d61 7463 6869 6e67 3a20 3a20  rea matching: : 
+0000b1e0: 6060 736e 6170 5f75 7061 7265 613d 5472  ``snap_uparea=Tr
+0000b1f0: 7565 6060 2e20 5468 6520 6761 7567 6520  ue``. The gauge 
+0000b200: 6c6f 6361 7469 6f6e 730a 2020 2020 2020  locations.      
+0000b210: 2020 2020 6172 6520 736e 6170 7065 6420      are snapped 
+0000b220: 746f 2074 6865 2063 6c6f 7365 7374 206d  to the closest m
+0000b230: 6174 6368 696e 6720 7570 7374 7265 616d  atching upstream
+0000b240: 2061 7265 6120 7661 6c75 652e 2052 6571   area value. Req
+0000b250: 7569 7265 7320 6761 7567 6573 5f66 6e20  uires gauges_fn 
+0000b260: 746f 2068 6176 650a 2020 2020 2020 2020  to have.        
+0000b270: 2020 616e 2060 6075 7061 7265 6160 6020    an ``uparea`` 
+0000b280: 5b6b 6d32 5d20 636f 6c75 6d6e 2e20 5468  [km2] column. Th
+0000b290: 6520 636c 6f73 6573 7420 7661 6c75 6520  e closest value 
+0000b2a0: 7769 6c6c 2062 6520 6c6f 6f6b 6564 2066  will be looked f
+0000b2b0: 6f72 2069 6e20 6120 6365 6c6c 2077 696e  or in a cell win
+0000b2c0: 646f 7720 6f66 2073 697a 6520 6060 7764  dow of size ``wd
+0000b2d0: 7760 600a 2020 2020 2020 2020 2020 616e  w``.          an
+0000b2e0: 6420 7468 6520 6469 6666 6572 656e 6365  d the difference
+0000b2f0: 2062 6574 7765 656e 2074 6865 2067 6175   between the gau
+0000b300: 6765 2061 6e64 2074 6865 2063 6c6f 7365  ge and the close
+0000b310: 7374 2076 616c 7565 2073 686f 756c 6420  st value should 
+0000b320: 6265 2073 6d61 6c6c 6572 2074 6861 6e20  be smaller than 
+0000b330: 6060 7265 6c5f 6572 726f 7260 602e 0a0a  ``rel_error``...
+0000b340: 2020 2020 2020 2020 4966 2060 6064 6572          If ``der
+0000b350: 6976 655f 7375 6263 6174 6368 6060 2069  ive_subcatch`` i
+0000b360: 7320 7365 7420 746f 2054 7275 652c 2061  s set to True, a
+0000b370: 6e20 6164 6469 7469 6f6e 616c 2073 7562  n additional sub
+0000b380: 6361 7463 6820 6d61 7020 6973 2064 6572  catch map is der
+0000b390: 6976 6564 2066 726f 6d0a 2020 2020 2020  ived from.      
+0000b3a0: 2020 7468 6520 6761 7567 6520 6c6f 6361    the gauge loca
+0000b3b0: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
+0000b3c0: 4669 6e61 6c6c 7920 7468 6520 6f75 7470  Finally the outp
+0000b3d0: 7574 206c 6f63 6174 696f 6e73 2063 616e  ut locations can
+0000b3e0: 2062 6520 6164 6465 6420 746f 2077 666c   be added to wfl
+0000b3f0: 6f77 2054 4f4d 4c20 6669 6c65 2073 6563  ow TOML file sec
+0000b400: 7469 6f6e 7320 5b63 7376 5d20 6f72 205b  tions [csv] or [
+0000b410: 6e65 7463 6466 5d0a 2020 2020 2020 2020  netcdf].        
+0000b420: 7573 696e 6720 7468 6520 6060 746f 6d6c  using the ``toml
+0000b430: 5f6f 7574 7075 7460 6020 6f70 7469 6f6e  _output`` option
+0000b440: 2e20 5468 6520 6060 6761 7567 655f 746f  . The ``gauge_to
+0000b450: 6d6c 5f68 6561 6465 7260 6020 616e 6420  ml_header`` and 
+0000b460: 6060 6761 7567 655f 746f 6d6c 5f70 6172  ``gauge_toml_par
+0000b470: 616d 6060 206f 7074 696f 6e73 0a20 2020  am`` options.   
+0000b480: 2020 2020 2063 616e 2062 6520 7573 6564       can be used
+0000b490: 2074 6f20 6465 6669 6e65 2074 6865 2068   to define the h
+0000b4a0: 6561 6465 7220 616e 6420 636f 7272 6573  eader and corres
+0000b4b0: 706f 6e64 696e 6720 7766 6c6f 7720 7661  ponding wflow va
+0000b4c0: 7269 6162 6c65 206e 616d 6573 2069 6e20  riable names in 
+0000b4d0: 7468 6520 544f 4d4c 2066 696c 652e 0a0a  the TOML file...
+0000b4e0: 2020 2020 2020 2020 4164 6473 206d 6f64          Adds mod
+0000b4f0: 656c 206c 6179 6572 733a 0a0a 2020 2020  el layers:..    
+0000b500: 2020 2020 2a20 2a2a 7766 6c6f 775f 6761      * **wflow_ga
+0000b510: 7567 6573 5f73 6f75 7263 652a 2a20 6d61  uges_source** ma
+0000b520: 703a 2067 6175 6765 2049 4473 206d 6170  p: gauge IDs map
+0000b530: 2066 726f 6d20 736f 7572 6365 205b 2d5d   from source [-]
+0000b540: 2028 6966 2067 6175 6765 735f 666e 290a   (if gauges_fn).
+0000b550: 2020 2020 2020 2020 2a20 2a2a 7766 6c6f          * **wflo
+0000b560: 775f 7375 6263 6174 6368 5f73 6f75 7263  w_subcatch_sourc
+0000b570: 652a 2a20 6d61 703a 2073 7562 6361 7463  e** map: subcatc
+0000b580: 686d 656e 7420 6261 7365 6420 6f6e 2067  hment based on g
+0000b590: 6175 6765 206c 6f63 6174 696f 6e73 205b  auge locations [
+0000b5a0: 2d5d 2028 6966 2064 6572 6976 655f 7375  -] (if derive_su
+0000b5b0: 6263 6174 6368 290a 2020 2020 2020 2020  bcatch).        
+0000b5c0: 2a20 2a2a 6761 7567 6573 5f73 6f75 7263  * **gauges_sourc
+0000b5d0: 652a 2a20 6765 6f6d 3a20 706f 6c79 676f  e** geom: polygo
+0000b5e0: 6e20 6f66 2067 6175 6765 7320 6672 6f6d  n of gauges from
+0000b5f0: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
+0000b600: 2a20 2a2a 7375 6263 6174 6368 5f73 6f75  * **subcatch_sou
+0000b610: 7263 652a 2a20 6765 6f6d 3a20 706f 6c79  rce** geom: poly
+0000b620: 676f 6e20 6f66 2073 7562 6361 7463 686d  gon of subcatchm
+0000b630: 656e 7420 6261 7365 6420 6f6e 2067 6175  ent based on gau
+0000b640: 6765 206c 6f63 6174 696f 6e73 205b 2d5d  ge locations [-]
+0000b650: 2028 6966 2064 6572 6976 655f 7375 6263   (if derive_subc
+0000b660: 6174 6368 290a 0a20 2020 2020 2020 2050  atch)..        P
+0000b670: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000b680: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000b690: 2020 2020 2067 6175 6765 735f 666e 203a       gauges_fn :
+0000b6a0: 2073 7472 2c20 5061 7468 2c20 6770 642e   str, Path, gpd.
+0000b6b0: 4765 6f44 6174 6146 7261 6d65 2c20 6f70  GeoDataFrame, op
+0000b6c0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0000b6d0: 2020 204b 6e6f 776e 2073 6f75 7263 6520     Known source 
+0000b6e0: 6e61 6d65 206f 7220 7061 7468 2074 6f20  name or path to 
+0000b6f0: 6761 7567 6573 2066 696c 6520 6765 6f6d  gauges file geom
+0000b700: 6574 7279 2066 696c 652c 2062 7920 6465  etry file, by de
+0000b710: 6661 756c 7420 4e6f 6e65 2e0a 0a20 2020  fault None...   
+0000b720: 2020 2020 2020 2020 202a 2052 6571 7569           * Requi
+0000b730: 7265 6420 7661 7269 6162 6c65 7320 6966  red variables if
+0000b740: 2073 6e61 705f 7570 6172 6561 2069 7320   snap_uparea is 
+0000b750: 5472 7565 3a20 5b22 7570 6172 6561 225d  True: ["uparea"]
+0000b760: 0a20 2020 2020 2020 2069 6e64 6578 5f63  .        index_c
+0000b770: 6f6c 203a 2073 7472 2c20 6f70 7469 6f6e  ol : str, option
+0000b780: 616c 0a20 2020 2020 2020 2020 2020 2043  al.            C
+0000b790: 6f6c 756d 6e20 696e 2067 6175 6765 735f  olumn in gauges_
+0000b7a0: 666e 2074 6f20 7573 6520 666f 7220 4944  fn to use for ID
+0000b7b0: 2076 616c 7565 732c 2062 7920 6465 6661   values, by defa
+0000b7c0: 756c 7420 4e6f 6e65 2028 7573 6520 7468  ult None (use th
+0000b7d0: 6520 6465 6661 756c 7420 696e 6465 7820  e default index 
+0000b7e0: 636f 6c75 6d6e 290a 2020 2020 2020 2020  column).        
+0000b7f0: 6d61 736b 203a 206e 702e 626f 6f6c 6561  mask : np.boolea
+0000b800: 6e2c 206f 7074 696f 6e61 6c0a 2020 2020  n, optional.    
+0000b810: 2020 2020 2020 2020 4966 2070 726f 7669          If provi
+0000b820: 6465 6420 736e 6170 7320 746f 2074 6865  ded snaps to the
+0000b830: 206d 6173 6b2c 2065 6c73 6520 736e 6170   mask, else snap
+0000b840: 7320 746f 2074 6865 2072 6976 6572 2028  s to the river (
+0000b850: 6465 6661 756c 7429 2e0a 2020 2020 2020  default)..      
+0000b860: 2020 736e 6170 5f74 6f5f 7269 7665 7220    snap_to_river 
+0000b870: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
+0000b880: 0a20 2020 2020 2020 2020 2020 2053 6e61  .            Sna
+0000b890: 7020 706f 696e 7420 6c6f 6361 7469 6f6e  p point location
+0000b8a0: 7320 746f 2074 6865 2063 6c6f 7365 7374  s to the closest
+0000b8b0: 2064 6f77 6e73 7472 6561 6d20 7269 7665   downstream rive
+0000b8c0: 7220 6365 6c6c 2c20 6279 2064 6566 6175  r cell, by defau
+0000b8d0: 6c74 2054 7275 650a 2020 2020 2020 2020  lt True.        
+0000b8e0: 736e 6170 5f75 7061 7265 613a 2062 6f6f  snap_uparea: boo
+0000b8f0: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
+0000b900: 2020 2020 2020 2020 536e 6170 2067 6175          Snap gau
+0000b910: 6765 7320 6261 7365 6420 6f6e 2075 7073  ges based on ups
+0000b920: 7472 6561 6d20 6172 6561 2e20 4761 7567  tream area. Gaug
+0000b930: 6573 5f66 6e20 7368 6f75 6c64 2068 6176  es_fn should hav
+0000b940: 6520 2275 7061 7265 6122 2069 6e20 6974  e "uparea" in it
+0000b950: 7320 6174 7472 6962 7574 6573 2e0a 2020  s attributes..  
+0000b960: 2020 2020 2020 6d61 785f 6469 7374 203a        max_dist :
+0000b970: 2066 6c6f 6174 2c20 6f70 7469 6f6e 616c   float, optional
+0000b980: 0a20 2020 2020 2020 2020 2020 204d 6178  .            Max
+0000b990: 696d 756d 2064 6973 7461 6e63 6520 5b6d  imum distance [m
+0000b9a0: 5d20 6265 7477 6565 6e20 6f72 6967 696e  ] between origin
+0000b9b0: 616c 2061 6e64 2073 6e61 7070 6564 2070  al and snapped p
+0000b9c0: 6f69 6e74 206c 6f63 6174 696f 6e2e 0a20  oint location.. 
+0000b9d0: 2020 2020 2020 2020 2020 2041 2077 6172             A war
+0000b9e0: 6e69 6e67 2069 7320 6c6f 6767 6564 2069  ning is logged i
+0000b9f0: 6620 6578 6365 6564 6564 2e20 4279 2064  f exceeded. By d
+0000ba00: 6566 6175 6c74 2031 3020 3030 306d 2e0a  efault 10 000m..
+0000ba10: 2020 2020 2020 2020 7764 773a 2069 6e74          wdw: int
+0000ba20: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0000ba30: 2020 2020 2020 2057 696e 646f 7720 7369         Window si
+0000ba40: 7a65 2069 6e20 6e75 6d62 6572 206f 6620  ze in number of 
+0000ba50: 6365 6c6c 7320 6172 6f75 6e64 2074 6865  cells around the
+0000ba60: 2067 6175 6765 206c 6f63 6174 696f 6e73   gauge locations
+0000ba70: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+0000ba80: 736e 6170 2075 7061 7265 6120 746f 2c20  snap uparea to, 
+0000ba90: 6f6e 6c79 2075 7365 6420 6966 2060 6073  only used if ``s
+0000baa0: 6e61 705f 7570 6172 6561 6060 2069 7320  nap_uparea`` is 
+0000bab0: 5472 7565 2e20 4279 2064 6566 6175 6c74  True. By default
+0000bac0: 2033 2e0a 2020 2020 2020 2020 7265 6c5f   3..        rel_
+0000bad0: 6572 726f 723a 2066 6c6f 6174 2c20 6f70  error: float, op
+0000bae0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0000baf0: 2020 204d 6178 696d 756d 2072 656c 6174     Maximum relat
+0000bb00: 6976 6520 6572 726f 7220 2864 6566 6175  ive error (defau
+0000bb10: 6c74 2030 2e30 3529 0a20 2020 2020 2020  lt 0.05).       
+0000bb20: 2020 2020 2062 6574 7765 656e 2074 6865       between the
+0000bb30: 2067 6175 6765 206c 6f63 6174 696f 6e20   gauge location 
+0000bb40: 7570 7374 7265 616d 2061 7265 6120 616e  upstream area an
+0000bb50: 6420 7468 6520 7570 7374 7265 616d 2061  d the upstream a
+0000bb60: 7265 6120 6f66 0a20 2020 2020 2020 2020  rea of.         
+0000bb70: 2020 2074 6865 2062 6573 7420 6669 7420     the best fit 
+0000bb80: 6772 6964 2063 656c 6c2c 206f 6e6c 7920  grid cell, only 
+0000bb90: 7573 6564 2069 6620 736e 6170 5f61 7265  used if snap_are
+0000bba0: 6120 6973 2054 7275 652e 0a20 2020 2020  a is True..     
+0000bbb0: 2020 2064 6572 6976 655f 7375 6263 6174     derive_subcat
+0000bbc0: 6368 203a 2062 6f6f 6c2c 206f 7074 696f  ch : bool, optio
+0000bbd0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0000bbe0: 4465 7269 7665 2073 7562 6361 7463 6820  Derive subcatch 
+0000bbf0: 6d61 7020 666f 7220 6761 7567 6573 2c20  map for gauges, 
+0000bc00: 6279 2064 6566 6175 6c74 2046 616c 7365  by default False
+0000bc10: 0a20 2020 2020 2020 2062 6173 656e 616d  .        basenam
+0000bc20: 6520 3a20 7374 722c 206f 7074 696f 6e61  e : str, optiona
+0000bc30: 6c0a 2020 2020 2020 2020 2020 2020 4d61  l.            Ma
+0000bc40: 7020 6e61 6d65 2069 6e20 7374 6174 6963  p name in static
+0000bc50: 6d61 7073 2028 7766 6c6f 775f 6761 7567  maps (wflow_gaug
+0000bc60: 6573 5f62 6173 656e 616d 6529 2c20 6966  es_basename), if
+0000bc70: 204e 6f6e 6520 7573 6520 7468 6520 6761   None use the ga
+0000bc80: 7567 6573 5f66 6e20 6261 7365 6e61 6d65  uges_fn basename
+0000bc90: 2e0a 2020 2020 2020 2020 746f 6d6c 5f6f  ..        toml_o
+0000bca0: 7574 7075 7420 3a20 7374 722c 206f 7074  utput : str, opt
+0000bcb0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+0000bcc0: 2020 4f6e 6520 6f66 205b 2763 7376 272c    One of ['csv',
+0000bcd0: 2027 6e65 7463 6466 272c 204e 6f6e 655d   'netcdf', None]
+0000bce0: 2074 6f20 7570 6461 7465 205b 6373 765d   to update [csv]
+0000bcf0: 206f 7220 5b6e 6574 6364 665d 2073 6563   or [netcdf] sec
+0000bd00: 7469 6f6e 206f 6620 7766 6c6f 7720 746f  tion of wflow to
+0000bd10: 6d6c 2066 696c 6520 6f72 2064 6f20 6e6f  ml file or do no
+0000bd20: 7468 696e 672e 2042 7920 6465 6661 756c  thing. By defaul
+0000bd30: 742c 2027 6373 7627 2e0a 2020 2020 2020  t, 'csv'..      
+0000bd40: 2020 6761 7567 655f 746f 6d6c 5f68 6561    gauge_toml_hea
+0000bd50: 6465 7220 3a20 6c69 7374 2c20 6f70 7469  der : list, opti
+0000bd60: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0000bd70: 2053 6176 6520 7370 6563 6966 6963 206d   Save specific m
+0000bd80: 6f64 656c 2070 6172 616d 6574 6572 7320  odel parameters 
+0000bd90: 696e 2063 7376 2073 6563 7469 6f6e 2e20  in csv section. 
+0000bda0: 5468 6973 206f 7074 696f 6e20 6465 6669  This option defi
+0000bdb0: 6e65 7320 7468 6520 6865 6164 6572 206f  nes the header o
+0000bdc0: 6620 7468 6520 6373 7620 6669 6c65 2e2f  f the csv file./
+0000bdd0: 0a20 2020 2020 2020 2020 2020 2042 7920  .            By 
+0000bde0: 6465 6661 756c 7420 7361 7665 7320 5120  default saves Q 
+0000bdf0: 2866 6f72 206c 6174 6572 616c 2e72 6976  (for lateral.riv
+0000be00: 6572 2e71 5f61 7629 2061 6e64 2050 2028  er.q_av) and P (
+0000be10: 666f 7220 7665 7274 6963 616c 2e70 7265  for vertical.pre
+0000be20: 6369 7069 7461 7469 6f6e 292e 0a20 2020  cipitation)..   
+0000be30: 2020 2020 2067 6175 6765 5f74 6f6d 6c5f       gauge_toml_
+0000be40: 7061 7261 6d3a 206c 6973 742c 206f 7074  param: list, opt
+0000be50: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+0000be60: 2020 5361 7665 2073 7065 6369 6669 6320    Save specific 
+0000be70: 6d6f 6465 6c20 7061 7261 6d65 7465 7273  model parameters
+0000be80: 2069 6e20 6373 7620 7365 6374 696f 6e2e   in csv section.
+0000be90: 2054 6869 7320 6f70 7469 6f6e 2064 6566   This option def
+0000bea0: 696e 6573 2074 6865 2077 666c 6f77 2076  ines the wflow v
+0000beb0: 6172 6961 626c 6520 636f 7272 6573 706f  ariable correspo
+0000bec0: 6e64 696e 6720 746f 2074 6865 2f0a 2020  nding to the/.  
+0000bed0: 2020 2020 2020 2020 2020 6e61 6d65 7320            names 
+0000bee0: 696e 2067 6175 6765 5f74 6f6d 6c5f 6865  in gauge_toml_he
+0000bef0: 6164 6572 2e20 4279 2064 6566 6175 6c74  ader. By default
+0000bf00: 2073 6176 6573 206c 6174 6572 616c 2e72   saves lateral.r
+0000bf10: 6976 6572 2e71 5f61 7620 2866 6f72 2051  iver.q_av (for Q
+0000bf20: 2920 616e 6420 7665 7274 6963 616c 2e70  ) and vertical.p
+0000bf30: 7265 6369 7069 7461 7469 6f6e 2028 666f  recipitation (fo
+0000bf40: 7220 5029 2e0a 2020 2020 2020 2020 2222  r P)..        ""
+0000bf50: 220a 2020 2020 2020 2020 2320 5265 6164  ".        # Read
+0000bf60: 2064 6174 610a 2020 2020 2020 2020 6b77   data.        kw
+0000bf70: 6172 6773 203d 207b 7d0a 2020 2020 2020  args = {}.      
+0000bf80: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000bf90: 6761 7567 6573 5f66 6e2c 2067 7064 2e47  gauges_fn, gpd.G
+0000bfa0: 656f 4461 7461 4672 616d 6529 3a0a 2020  eoDataFrame):.  
+0000bfb0: 2020 2020 2020 2020 2020 6764 665f 6761            gdf_ga
+0000bfc0: 7567 6573 203d 2067 6175 6765 735f 666e  uges = gauges_fn
+0000bfd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000bfe0: 6e6f 7420 6e70 2e61 6c6c 286e 702e 6973  not np.all(np.is
+0000bff0: 696e 2867 6466 5f67 6175 6765 732e 6765  in(gdf_gauges.ge
+0000c000: 6f6d 6574 7279 2e74 7970 652c 2022 506f  ometry.type, "Po
+0000c010: 696e 7422 2929 3a0a 2020 2020 2020 2020  int")):.        
+0000c020: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000c030: 6c75 6545 7272 6f72 2866 227b 6761 7567  lueError(f"{gaug
+0000c040: 6573 5f66 6e7d 2063 6f6e 7461 696e 7320  es_fn} contains 
+0000c050: 6f74 6865 7220 6765 6f6d 6574 7269 6573  other geometries
+0000c060: 2074 6861 6e20 506f 696e 7422 290a 2020   than Point").  
+0000c070: 2020 2020 2020 656c 6966 2069 7366 696c        elif isfil
+0000c080: 6528 6761 7567 6573 5f66 6e29 3a0a 2020  e(gauges_fn):.  
+0000c090: 2020 2020 2020 2020 2020 2320 7472 7920            # try 
+0000c0a0: 746f 2067 6574 2065 7073 6720 6e75 6d62  to get epsg numb
+0000c0b0: 6572 2064 6972 6563 746c 792c 2069 6d70  er directly, imp
+0000c0c0: 6f72 7461 6e74 2077 6865 6e20 7772 6974  ortant when writ
+0000c0d0: 7469 6e67 2062 6163 6b20 6461 7461 5f63  ting back data_c
+0000c0e0: 6174 616c 6f67 0a20 2020 2020 2020 2020  atalog.         
+0000c0f0: 2020 2069 6620 6861 7361 7474 7228 7365     if hasattr(se
+0000c100: 6c66 2e63 7273 2c20 2274 6f5f 6570 7367  lf.crs, "to_epsg
+0000c110: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0000c120: 2020 2020 636f 6465 203d 2073 656c 662e      code = self.
+0000c130: 6372 732e 746f 5f65 7073 6728 290a 2020  crs.to_epsg().  
+0000c140: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c160: 636f 6465 203d 2073 656c 662e 6372 730a  code = self.crs.
+0000c170: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000c180: 6773 2e75 7064 6174 6528 6372 733d 636f  gs.update(crs=co
+0000c190: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+0000c1a0: 6764 665f 6761 7567 6573 203d 2073 656c  gdf_gauges = sel
+0000c1b0: 662e 6461 7461 5f63 6174 616c 6f67 2e67  f.data_catalog.g
+0000c1c0: 6574 5f67 656f 6461 7461 6672 616d 6528  et_geodataframe(
+0000c1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c1e0: 2067 6175 6765 735f 666e 2c20 6765 6f6d   gauges_fn, geom
+0000c1f0: 3d73 656c 662e 6261 7369 6e73 2c20 6173  =self.basins, as
+0000c200: 7365 7274 5f67 7479 7065 3d22 506f 696e  sert_gtype="Poin
+0000c210: 7422 2c20 2a2a 6b77 6172 6773 0a20 2020  t", **kwargs.   
+0000c220: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000c230: 2020 2065 6c69 6620 7365 6c66 2e64 6174     elif self.dat
+0000c240: 615f 6361 7461 6c6f 675b 6761 7567 6573  a_catalog[gauges
+0000c250: 5f66 6e5d 2e64 6174 615f 7479 7065 203d  _fn].data_type =
+0000c260: 3d20 2247 656f 4461 7461 4672 616d 6522  = "GeoDataFrame"
+0000c270: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
+0000c280: 665f 6761 7567 6573 203d 2073 656c 662e  f_gauges = self.
+0000c290: 6461 7461 5f63 6174 616c 6f67 2e67 6574  data_catalog.get
+0000c2a0: 5f67 656f 6461 7461 6672 616d 6528 0a20  _geodataframe(. 
+0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0000c2c0: 6175 6765 735f 666e 2c20 6765 6f6d 3d73  auges_fn, geom=s
+0000c2d0: 656c 662e 6261 7369 6e73 2c20 6173 7365  elf.basins, asse
+0000c2e0: 7274 5f67 7479 7065 3d22 506f 696e 7422  rt_gtype="Point"
+0000c2f0: 2c20 2a2a 6b77 6172 6773 0a20 2020 2020  , **kwargs.     
+0000c300: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000c310: 2065 6c69 6620 7365 6c66 2e64 6174 615f   elif self.data_
+0000c320: 6361 7461 6c6f 675b 6761 7567 6573 5f66  catalog[gauges_f
+0000c330: 6e5d 2e64 6174 615f 7479 7065 203d 3d20  n].data_type == 
+0000c340: 2247 656f 4461 7461 7365 7422 3a0a 2020  "GeoDataset":.  
+0000c350: 2020 2020 2020 2020 2020 6461 203d 2073            da = s
+0000c360: 656c 662e 6461 7461 5f63 6174 616c 6f67  elf.data_catalog
+0000c370: 2e67 6574 5f67 656f 6461 7461 7365 7428  .get_geodataset(
+0000c380: 6761 7567 6573 5f66 6e2c 2067 656f 6d3d  gauges_fn, geom=
+0000c390: 7365 6c66 2e62 6173 696e 732c 202a 2a6b  self.basins, **k
+0000c3a0: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
+0000c3b0: 2020 2067 6466 5f67 6175 6765 7320 3d20     gdf_gauges = 
+0000c3c0: 6461 2e76 6563 746f 722e 746f 5f67 6466  da.vector.to_gdf
+0000c3d0: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
+0000c3e0: 2043 6865 636b 2066 6f72 2070 6f69 6e74   Check for point
+0000c3f0: 2067 656f 6d65 7472 790a 2020 2020 2020   geometry.      
+0000c400: 2020 2020 2020 6966 206e 6f74 206e 702e        if not np.
+0000c410: 616c 6c28 6e70 2e69 7369 6e28 6764 665f  all(np.isin(gdf_
+0000c420: 6761 7567 6573 2e67 656f 6d65 7472 792e  gauges.geometry.
+0000c430: 7479 7065 2c20 2250 6f69 6e74 2229 293a  type, "Point")):
+0000c440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c450: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000c460: 7228 6622 7b67 6175 6765 735f 666e 7d20  r(f"{gauges_fn} 
+0000c470: 636f 6e74 6169 6e73 206f 7468 6572 2067  contains other g
+0000c480: 656f 6d65 7472 6965 7320 7468 616e 2050  eometries than P
+0000c490: 6f69 6e74 2229 0a20 2020 2020 2020 2065  oint").        e
+0000c4a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c4b0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000c4c0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000c4d0: 2020 2066 227b 6761 7567 6573 5f66 6e7d     f"{gauges_fn}
+0000c4e0: 2064 6174 6120 736f 7572 6365 206e 6f74   data source not
+0000c4f0: 2066 6f75 6e64 206f 7220 696e 636f 7272   found or incorr
+0000c500: 6563 7420 6461 7461 5f74 7970 6520 2847  ect data_type (G
+0000c510: 656f 4461 7461 4672 616d 6520 6f72 2047  eoDataFrame or G
+0000c520: 656f 4461 7461 7365 7429 2e22 0a20 2020  eoDataset).".   
+0000c530: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000c540: 2020 2020 2320 4372 6561 7465 2062 6173      # Create bas
+0000c550: 656e 616d 650a 2020 2020 2020 2020 6966  ename.        if
+0000c560: 2062 6173 656e 616d 6520 6973 204e 6f6e   basename is Non
+0000c570: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
+0000c580: 6173 656e 616d 6520 3d20 6f73 2e70 6174  asename = os.pat
+0000c590: 682e 6261 7365 6e61 6d65 2867 6175 6765  h.basename(gauge
+0000c5a0: 735f 666e 292e 7370 6c69 7428 222e 2229  s_fn).split(".")
+0000c5b0: 5b30 5d2e 7265 706c 6163 6528 225f 222c  [0].replace("_",
+0000c5c0: 2022 2d22 290a 0a20 2020 2020 2020 2023   "-")..        #
+0000c5d0: 2043 7265 6174 6520 6761 7567 6520 6d61   Create gauge ma
+0000c5e0: 702c 2073 7562 6361 7463 6820 6d61 7020  p, subcatch map 
+0000c5f0: 616e 6420 7570 6461 7465 2074 6f6d 6c0a  and update toml.
+0000c600: 2020 2020 2020 2020 6966 2067 6466 5f67          if gdf_g
+0000c610: 6175 6765 732e 696e 6465 782e 7369 7a65  auges.index.size
+0000c620: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000c630: 2020 2073 656c 662e 6c6f 6767 6572 2e77     self.logger.w
+0000c640: 6172 6e69 6e67 2866 224e 6f20 7b67 6175  arning(f"No {gau
+0000c650: 6765 735f 666e 7d20 6761 7567 6520 6c6f  ges_fn} gauge lo
+0000c660: 6361 7469 6f6e 7320 666f 756e 6420 7769  cations found wi
+0000c670: 7468 696e 2064 6f6d 6169 6e22 290a 0a20  thin domain").. 
+0000c680: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000c690: 6e0a 0a20 2020 2020 2020 2023 2043 7265  n..        # Cre
+0000c6a0: 6174 6520 7468 6520 6761 7567 6573 206d  ate the gauges m
+0000c6b0: 6170 0a20 2020 2020 2020 2073 656c 662e  ap.        self.
+0000c6c0: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
+0000c6d0: 2020 2020 2020 2020 2066 227b 6764 665f           f"{gdf_
+0000c6e0: 6761 7567 6573 2e69 6e64 6578 2e73 697a  gauges.index.siz
+0000c6f0: 657d 207b 6261 7365 6e61 6d65 7d20 6761  e} {basename} ga
+0000c700: 7567 6520 6c6f 6361 7469 6f6e 7320 666f  uge locations fo
+0000c710: 756e 6420 7769 7468 696e 2064 6f6d 6169  und within domai
+0000c720: 6e22 0a20 2020 2020 2020 2029 0a0a 2020  n".        )..  
+0000c730: 2020 2020 2020 2320 7265 6164 2065 7869        # read exi
+0000c740: 7374 696e 6720 7374 6174 6963 6765 6f6d  sting staticgeom
+0000c750: 733b 2069 6d70 6f72 7461 6e74 2074 6f20  s; important to 
+0000c760: 6765 7420 7468 6520 7269 6768 7420 6261  get the right ba
+0000c770: 7369 6e20 7768 656e 2075 7064 6174 696e  sin when updatin
+0000c780: 670a 2020 2020 2020 2020 7365 6c66 2e73  g.        self.s
+0000c790: 7461 7469 6367 656f 6d73 0a20 2020 2020  taticgeoms.     
+0000c7a0: 2020 2023 2052 6570 726f 6a65 6374 2074     # Reproject t
+0000c7b0: 6f20 6d6f 6465 6c20 6372 730a 2020 2020  o model crs.    
+0000c7c0: 2020 2020 6764 665f 6761 7567 6573 203d      gdf_gauges =
+0000c7d0: 2067 6466 5f67 6175 6765 732e 746f 5f63   gdf_gauges.to_c
+0000c7e0: 7273 2873 656c 662e 6372 7329 2e63 6f70  rs(self.crs).cop
+0000c7f0: 7928 290a 0a20 2020 2020 2020 2023 2047  y()..        # G
+0000c800: 6574 2063 6f6f 7264 732c 2069 6e64 6578  et coords, index
+0000c810: 2061 6e64 2049 440a 2020 2020 2020 2020   and ID.        
+0000c820: 7873 2c20 7973 203d 206e 702e 7665 6374  xs, ys = np.vect
+0000c830: 6f72 697a 6528 6c61 6d62 6461 2070 3a20  orize(lambda p: 
+0000c840: 2870 2e78 795b 305d 5b30 5d2c 2070 2e78  (p.xy[0][0], p.x
+0000c850: 795b 315d 5b30 5d29 2928 0a20 2020 2020  y[1][0]))(.     
+0000c860: 2020 2020 2020 2067 6466 5f67 6175 6765         gdf_gauge
+0000c870: 735b 2267 656f 6d65 7472 7922 5d0a 2020  s["geometry"].  
+0000c880: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000c890: 6964 7873 203d 2073 656c 662e 7374 6174  idxs = self.stat
+0000c8a0: 6963 6d61 7073 2e72 6173 7465 722e 7879  icmaps.raster.xy
+0000c8b0: 5f74 6f5f 6964 7828 7873 2c20 7973 290a  _to_idx(xs, ys).
+0000c8c0: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
+0000c8d0: 5f63 6f6c 2069 7320 6e6f 7420 4e6f 6e65  _col is not None
+0000c8e0: 2061 6e64 2069 6e64 6578 5f63 6f6c 2069   and index_col i
+0000c8f0: 6e20 6764 665f 6761 7567 6573 2e63 6f6c  n gdf_gauges.col
+0000c900: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
+0000c910: 2020 6764 665f 6761 7567 6573 203d 2067    gdf_gauges = g
+0000c920: 6466 5f67 6175 6765 732e 7365 745f 696e  df_gauges.set_in
+0000c930: 6465 7828 696e 6465 785f 636f 6c29 0a20  dex(index_col). 
+0000c940: 2020 2020 2020 2069 6620 6e70 2e61 6e79         if np.any
+0000c950: 2867 6466 5f67 6175 6765 732e 696e 6465  (gdf_gauges.inde
+0000c960: 7820 3d3d 2030 293a 0a20 2020 2020 2020  x == 0):.       
+0000c970: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000c980: 2e77 6172 6e69 6e67 2822 4761 7567 6520  .warning("Gauge 
+0000c990: 4944 2030 2069 7320 6e6f 7420 616c 6c6f  ID 0 is not allo
+0000c9a0: 7765 642c 2073 6574 7469 6e67 2074 6f20  wed, setting to 
+0000c9b0: 3122 290a 2020 2020 2020 2020 2020 2020  1").            
+0000c9c0: 6764 665f 6761 7567 6573 2e69 6e64 6578  gdf_gauges.index
+0000c9d0: 203d 2067 6466 5f67 6175 6765 732e 696e   = gdf_gauges.in
+0000c9e0: 6465 782e 7661 6c75 6573 202b 2031 0a20  dex.values + 1. 
+0000c9f0: 2020 2020 2020 2069 6473 203d 2067 6466         ids = gdf
+0000ca00: 5f67 6175 6765 732e 696e 6465 782e 7661  _gauges.index.va
+0000ca10: 6c75 6573 0a0a 2020 2020 2020 2020 2320  lues..        # 
+0000ca20: 6966 2073 6e61 705f 746f 5f72 6976 6572  if snap_to_river
+0000ca30: 2075 7365 2072 6976 6572 206d 6170 2061   use river map a
+0000ca40: 7320 7468 6520 6d61 736b 0a20 2020 2020  s the mask.     
+0000ca50: 2020 2069 6620 736e 6170 5f74 6f5f 7269     if snap_to_ri
+0000ca60: 7665 7220 616e 6420 6d61 736b 2069 7320  ver and mask is 
+0000ca70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000ca80: 2020 6d61 736b 203d 2073 656c 662e 5f4d    mask = self._M
+0000ca90: 4150 535b 2272 6976 6d73 6b22 5d0a 2020  APS["rivmsk"].  
+0000caa0: 2020 2020 2020 6966 206d 6173 6b20 6973        if mask is
+0000cab0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000cac0: 2020 2020 2020 206d 6173 6b20 3d20 7365         mask = se
+0000cad0: 6c66 2e73 7461 7469 636d 6170 735b 6d61  lf.staticmaps[ma
+0000cae0: 736b 5d2e 7661 6c75 6573 0a20 2020 2020  sk].values.     
+0000caf0: 2020 2069 6620 736e 6170 5f75 7061 7265     if snap_upare
+0000cb00: 6120 616e 6420 2275 7061 7265 6122 2069  a and "uparea" i
+0000cb10: 6e20 6764 665f 6761 7567 6573 2e63 6f6c  n gdf_gauges.col
+0000cb20: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
+0000cb30: 2020 2320 4465 7269 7665 2067 6175 6765    # Derive gauge
+0000cb40: 206d 6170 2062 6173 6564 206f 6e20 7570   map based on up
+0000cb50: 7374 7265 616d 2061 7265 6120 736e 6170  stream area snap
+0000cb60: 7069 6e67 0a20 2020 2020 2020 2020 2020  ping.           
+0000cb70: 2064 612c 2069 6478 732c 2069 6473 203d   da, idxs, ids =
+0000cb80: 2077 6f72 6b66 6c6f 7773 2e67 6175 6765   workflows.gauge
+0000cb90: 5f6d 6170 5f75 7061 7265 6128 0a20 2020  _map_uparea(.   
+0000cba0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000cbb0: 662e 7374 6174 6963 6d61 7073 2c0a 2020  f.staticmaps,.  
+0000cbc0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+0000cbd0: 665f 6761 7567 6573 2c0a 2020 2020 2020  f_gauges,.      
+0000cbe0: 2020 2020 2020 2020 2020 7570 6172 6561            uparea
+0000cbf0: 5f6e 616d 653d 2277 666c 6f77 5f75 7061  _name="wflow_upa
+0000cc00: 7265 6122 2c0a 2020 2020 2020 2020 2020  rea",.          
+0000cc10: 2020 2020 2020 7764 773d 7764 772c 0a20        wdw=wdw,. 
+0000cc20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000cc30: 656c 5f65 7272 6f72 3d72 656c 5f65 7272  el_error=rel_err
+0000cc40: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0000cc50: 2020 2020 6c6f 6767 6572 3d73 656c 662e      logger=self.
+0000cc60: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
+0000cc70: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+0000cc80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000cc90: 2320 4465 7269 7665 2067 6175 6765 206d  # Derive gauge m
+0000cca0: 6170 0a20 2020 2020 2020 2020 2020 2064  ap.            d
+0000ccb0: 612c 2069 6478 732c 2069 6473 203d 2066  a, idxs, ids = f
+0000ccc0: 6c77 2e67 6175 6765 5f6d 6170 280a 2020  lw.gauge_map(.  
+0000ccd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000cce0: 6c66 2e73 7461 7469 636d 6170 732c 0a20  lf.staticmaps,. 
+0000ccf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cd00: 6478 733d 6964 7873 2c0a 2020 2020 2020  dxs=idxs,.      
+0000cd10: 2020 2020 2020 2020 2020 6964 733d 6964            ids=id
+0000cd20: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000cd30: 2020 2073 7472 6561 6d3d 6d61 736b 2c0a     stream=mask,.
+0000cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd50: 666c 7764 6972 3d73 656c 662e 666c 7764  flwdir=self.flwd
+0000cd60: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+0000cd70: 2020 2020 6d61 785f 6469 7374 3d6d 6178      max_dist=max
+0000cd80: 5f64 6973 742c 0a20 2020 2020 2020 2020  _dist,.         
+0000cd90: 2020 2020 2020 206c 6f67 6765 723d 7365         logger=se
+0000cda0: 6c66 2e6c 6f67 6765 722c 0a20 2020 2020  lf.logger,.     
+0000cdb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000cdc0: 2020 2020 2023 2046 696c 7465 7220 6761       # Filter ga
+0000cdd0: 7567 6573 2074 6861 7420 636f 756c 6420  uges that could 
+0000cde0: 6e6f 7420 6265 2073 6e61 7070 6564 2074  not be snapped t
+0000cdf0: 6f20 7269 7665 7273 0a20 2020 2020 2020  o rivers.       
+0000ce00: 2020 2020 2069 6620 736e 6170 5f74 6f5f       if snap_to_
+0000ce10: 7269 7665 723a 0a20 2020 2020 2020 2020  river:.         
+0000ce20: 2020 2020 2020 2069 6473 5f6f 6c64 203d         ids_old =
+0000ce30: 2069 6473 2e63 6f70 7928 290a 2020 2020   ids.copy().    
+0000ce40: 2020 2020 2020 2020 2020 2020 6461 203d              da =
+0000ce50: 2064 612e 7768 6572 6528 0a20 2020 2020   da.where(.     
+0000ce60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ce70: 656c 662e 7374 6174 6963 6d61 7073 5b73  elf.staticmaps[s
+0000ce80: 656c 662e 5f4d 4150 535b 2272 6976 6d73  elf._MAPS["rivms
+0000ce90: 6b22 5d5d 2021 3d20 302c 2064 612e 7261  k"]] != 0, da.ra
+0000cea0: 7374 6572 2e6e 6f64 6174 610a 2020 2020  ster.nodata.    
+0000ceb0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000cec0: 2020 2020 2020 2020 2020 2020 2020 6964                id
+0000ced0: 735f 6e65 7720 3d20 6e70 2e75 6e69 7175  s_new = np.uniqu
+0000cee0: 6528 6461 2e76 616c 7565 735b 6461 2e76  e(da.values[da.v
+0000cef0: 616c 7565 7320 3e20 305d 290a 2020 2020  alues > 0]).    
+0000cf00: 2020 2020 2020 2020 2020 2020 6964 7873              idxs
+0000cf10: 203d 2069 6478 735b 6e70 2e69 7369 6e28   = idxs[np.isin(
+0000cf20: 6964 735f 6f6c 642c 2069 6473 5f6e 6577  ids_old, ids_new
+0000cf30: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+0000cf40: 2020 2069 6473 203d 2064 612e 7661 6c75     ids = da.valu
+0000cf50: 6573 2e66 6c61 745b 6964 7873 5d0a 0a20  es.flat[idxs].. 
+0000cf60: 2020 2020 2020 2023 2041 6464 2074 6f20         # Add to 
+0000cf70: 7374 6174 6963 6d61 7073 0a20 2020 2020  staticmaps.     
+0000cf80: 2020 206d 6170 6e61 6d65 203d 2066 277b     mapname = f'{
+0000cf90: 7374 7228 7365 6c66 2e5f 4d41 5053 5b22  str(self._MAPS["
+0000cfa0: 6761 7567 6573 225d 297d 5f7b 6261 7365  gauges"])}_{base
+0000cfb0: 6e61 6d65 7d27 0a20 2020 2020 2020 2073  name}'.        s
+0000cfc0: 656c 662e 7365 745f 7374 6174 6963 6d61  elf.set_staticma
+0000cfd0: 7073 2864 612c 206e 616d 653d 6d61 706e  ps(da, name=mapn
+0000cfe0: 616d 6529 0a0a 2020 2020 2020 2020 2320  ame)..        # 
+0000cff0: 6765 6f6d 730a 2020 2020 2020 2020 706f  geoms.        po
+0000d000: 696e 7473 203d 2067 7064 2e70 6f69 6e74  ints = gpd.point
+0000d010: 735f 6672 6f6d 5f78 7928 2a73 656c 662e  s_from_xy(*self.
+0000d020: 7374 6174 6963 6d61 7073 2e72 6173 7465  staticmaps.raste
+0000d030: 722e 6964 785f 746f 5f78 7928 6964 7873  r.idx_to_xy(idxs
+0000d040: 2929 0a20 2020 2020 2020 2023 2069 6620  )).        # if 
+0000d050: 6373 7620 636f 6e74 6169 6e73 2061 6464  csv contains add
+0000d060: 6974 696f 6e61 6c20 636f 6c75 6d6e 732c  itional columns,
+0000d070: 2074 6865 7365 2061 7265 2061 6c73 6f20   these are also 
+0000d080: 7772 6974 7465 6e20 696e 2074 6865 2073  written in the s
+0000d090: 7461 7469 6367 656f 6d73 0a20 2020 2020  taticgeoms.     
+0000d0a0: 2020 2067 6466 5f73 6e61 7070 6564 203d     gdf_snapped =
+0000d0b0: 2067 7064 2e47 656f 4461 7461 4672 616d   gpd.GeoDataFram
+0000d0c0: 6528 0a20 2020 2020 2020 2020 2020 2069  e(.            i
+0000d0d0: 6e64 6578 3d69 6473 2e61 7374 7970 6528  ndex=ids.astype(
+0000d0e0: 6e70 2e69 6e74 3332 292c 2067 656f 6d65  np.int32), geome
+0000d0f0: 7472 793d 706f 696e 7473 2c20 6372 733d  try=points, crs=
+0000d100: 7365 6c66 2e63 7273 0a20 2020 2020 2020  self.crs.       
+0000d110: 2029 0a20 2020 2020 2020 2023 2053 6574   ).        # Set
+0000d120: 2074 6865 2069 6e64 6578 206e 616d 6520   the index name 
+0000d130: 6f66 2067 6466 2073 6e61 7070 6564 2062  of gdf snapped b
+0000d140: 6173 6564 206f 6e20 6f72 6967 696e 616c  ased on original
+0000d150: 2067 6466 0a20 2020 2020 2020 2069 6620   gdf.        if 
+0000d160: 6764 665f 6761 7567 6573 2e69 6e64 6578  gdf_gauges.index
+0000d170: 2e6e 616d 6520 6973 206e 6f74 204e 6f6e  .name is not Non
+0000d180: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+0000d190: 6466 5f73 6e61 7070 6564 2e69 6e64 6578  df_snapped.index
+0000d1a0: 2e6e 616d 6520 3d20 6764 665f 6761 7567  .name = gdf_gaug
+0000d1b0: 6573 2e69 6e64 6578 2e6e 616d 650a 2020  es.index.name.  
+0000d1c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000d1d0: 2020 2020 2020 2020 6764 665f 736e 6170          gdf_snap
+0000d1e0: 7065 642e 696e 6465 782e 6e61 6d65 203d  ped.index.name =
+0000d1f0: 2022 6669 6422 0a20 2020 2020 2020 2020   "fid".         
+0000d200: 2020 2067 6466 5f67 6175 6765 732e 696e     gdf_gauges.in
+0000d210: 6465 782e 6e61 6d65 203d 2022 6669 6422  dex.name = "fid"
+0000d220: 0a20 2020 2020 2020 2023 2041 6464 2067  .        # Add g
+0000d230: 6466 2061 7474 7269 6275 7465 7320 746f  df attributes to
+0000d240: 2067 6466 5f73 6e61 7070 6564 2028 6669   gdf_snapped (fi
+0000d250: 6c74 6572 206f 6e20 736e 6170 7065 6420  lter on snapped 
+0000d260: 696e 6465 7820 6265 666f 7265 206d 6572  index before mer
+0000d270: 6769 6e67 290a 2020 2020 2020 2020 6466  ging).        df
+0000d280: 5f61 7474 7273 203d 2070 642e 4461 7461  _attrs = pd.Data
+0000d290: 4672 616d 6528 6764 665f 6761 7567 6573  Frame(gdf_gauges
+0000d2a0: 2e64 726f 7028 636f 6c75 6d6e 733d 2267  .drop(columns="g
+0000d2b0: 656f 6d65 7472 7922 2929 0a20 2020 2020  eometry")).     
+0000d2c0: 2020 2064 665f 6174 7472 7320 3d20 6466     df_attrs = df
+0000d2d0: 5f61 7474 7273 5b6e 702e 6973 696e 2864  _attrs[np.isin(d
+0000d2e0: 665f 6174 7472 732e 696e 6465 782c 2067  f_attrs.index, g
+0000d2f0: 6466 5f73 6e61 7070 6564 2e69 6e64 6578  df_snapped.index
+0000d300: 295d 0a20 2020 2020 2020 2067 6466 5f73  )].        gdf_s
+0000d310: 6e61 7070 6564 203d 2067 6466 5f73 6e61  napped = gdf_sna
+0000d320: 7070 6564 2e6d 6572 6765 2864 665f 6174  pped.merge(df_at
+0000d330: 7472 732c 2068 6f77 3d22 696e 6e65 7222  trs, how="inner"
+0000d340: 2c20 6f6e 3d67 6466 5f67 6175 6765 732e  , on=gdf_gauges.
+0000d350: 696e 6465 782e 6e61 6d65 290a 2020 2020  index.name).    
+0000d360: 2020 2020 2320 4164 6420 6764 665f 736e      # Add gdf_sn
+0000d370: 6170 7065 6420 746f 2073 7461 7469 6367  apped to staticg
+0000d380: 656f 6d73 0a20 2020 2020 2020 2073 656c  eoms.        sel
+0000d390: 662e 7365 745f 7374 6174 6963 6765 6f6d  f.set_staticgeom
+0000d3a0: 7328 6764 665f 736e 6170 7065 642c 206e  s(gdf_snapped, n
+0000d3b0: 616d 653d 6d61 706e 616d 652e 7265 706c  ame=mapname.repl
+0000d3c0: 6163 6528 2277 666c 6f77 5f22 2c20 2222  ace("wflow_", ""
+0000d3d0: 2929 0a0a 2020 2020 2020 2020 2320 4164  ))..        # Ad
+0000d3e0: 6420 6f75 7470 7574 2074 696d 6573 6572  d output timeser
+0000d3f0: 6965 7320 666f 7220 6761 7567 6573 2069  ies for gauges i
+0000d400: 6e20 7468 6520 746f 6d6c 0a20 2020 2020  n the toml.     
+0000d410: 2020 2073 656c 662e 7365 7475 705f 636f     self.setup_co
+0000d420: 6e66 6967 5f6f 7574 7075 745f 7469 6d65  nfig_output_time
+0000d430: 7365 7269 6573 280a 2020 2020 2020 2020  series(.        
+0000d440: 2020 2020 6d61 706e 616d 653d 6d61 706e      mapname=mapn
+0000d450: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+0000d460: 2074 6f6d 6c5f 6f75 7470 7574 3d74 6f6d   toml_output=tom
+0000d470: 6c5f 6f75 7470 7574 2c0a 2020 2020 2020  l_output,.      
+0000d480: 2020 2020 2020 6865 6164 6572 3d67 6175        header=gau
+0000d490: 6765 5f74 6f6d 6c5f 6865 6164 6572 2c0a  ge_toml_header,.
+0000d4a0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+0000d4b0: 6d3d 6761 7567 655f 746f 6d6c 5f70 6172  m=gauge_toml_par
+0000d4c0: 616d 2c0a 2020 2020 2020 2020 290a 0a20  am,.        ).. 
+0000d4d0: 2020 2020 2020 2023 2061 6464 2073 7562         # add sub
+0000d4e0: 6361 7463 680a 2020 2020 2020 2020 6966  catch.        if
+0000d4f0: 2064 6572 6976 655f 7375 6263 6174 6368   derive_subcatch
+0000d500: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
+0000d510: 5f62 6173 696e 7320 3d20 666c 772e 6261  _basins = flw.ba
+0000d520: 7369 6e5f 6d61 7028 7365 6c66 2e73 7461  sin_map(self.sta
+0000d530: 7469 636d 6170 732c 2073 656c 662e 666c  ticmaps, self.fl
+0000d540: 7764 6972 2c20 6964 7873 3d69 6478 732c  wdir, idxs=idxs,
+0000d550: 2069 6473 3d69 6473 295b 0a20 2020 2020   ids=ids)[.     
+0000d560: 2020 2020 2020 2020 2020 2030 0a20 2020             0.   
+0000d570: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0000d580: 2020 2020 2020 206d 6170 6e61 6d65 203d         mapname =
+0000d590: 2073 656c 662e 5f4d 4150 535b 2262 6173   self._MAPS["bas
+0000d5a0: 696e 7322 5d20 2b20 225f 2220 2b20 6261  ins"] + "_" + ba
+0000d5b0: 7365 6e61 6d65 0a20 2020 2020 2020 2020  sename.         
+0000d5c0: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+0000d5d0: 6963 6d61 7073 2864 615f 6261 7369 6e73  icmaps(da_basins
+0000d5e0: 2c20 6e61 6d65 3d6d 6170 6e61 6d65 290a  , name=mapname).
+0000d5f0: 2020 2020 2020 2020 2020 2020 6764 665f              gdf_
+0000d600: 6261 7369 6e73 203d 2073 656c 662e 7374  basins = self.st
+0000d610: 6174 6963 6d61 7073 5b6d 6170 6e61 6d65  aticmaps[mapname
+0000d620: 5d2e 7261 7374 6572 2e76 6563 746f 7269  ].raster.vectori
+0000d630: 7a65 2829 0a20 2020 2020 2020 2020 2020  ze().           
+0000d640: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
+0000d650: 6765 6f6d 7328 6764 665f 6261 7369 6e73  geoms(gdf_basins
+0000d660: 2c20 6e61 6d65 3d6d 6170 6e61 6d65 2e72  , name=mapname.r
+0000d670: 6570 6c61 6365 2822 7766 6c6f 775f 222c  eplace("wflow_",
+0000d680: 2022 2229 290a 0a20 2020 2064 6566 2073   ""))..    def s
+0000d690: 6574 7570 5f61 7265 616d 6170 280a 2020  etup_areamap(.  
+0000d6a0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000d6b0: 2020 2020 6172 6561 5f66 6e3a 2073 7472      area_fn: str
+0000d6c0: 2c0a 2020 2020 2020 2020 636f 6c32 7261  ,.        col2ra
+0000d6d0: 7374 6572 3a20 7374 722c 0a20 2020 2020  ster: str,.     
+0000d6e0: 2020 206e 6f64 6174 613a 2055 6e69 6f6e     nodata: Union
+0000d6f0: 5b69 6e74 2c20 666c 6f61 745d 203d 202d  [int, float] = -
+0000d700: 312c 0a20 2020 2029 3a0a 2020 2020 2020  1,.    ):.      
+0000d710: 2020 2222 2253 6574 7570 2061 7265 6120    """Setup area 
+0000d720: 6d61 7020 6672 6f6d 2076 6563 746f 7220  map from vector 
+0000d730: 6461 7461 2074 6f20 7361 7665 2077 666c  data to save wfl
+0000d740: 6f77 206f 7574 7075 7473 2066 6f72 2073  ow outputs for s
+0000d750: 7065 6369 6669 6320 6172 6561 2e0a 0a20  pecific area... 
+0000d760: 2020 2020 2020 2041 6464 7320 6d6f 6465         Adds mode
+0000d770: 6c20 6c61 7965 723a 0a0a 2020 2020 2020  l layer:..      
+0000d780: 2020 2a20 2a2a 636f 6c32 7261 7374 6572    * **col2raster
+0000d790: 2a2a 206d 6170 3a20 206f 7574 7075 7420  ** map:  output 
+0000d7a0: 6172 6561 2064 6174 6120 6d61 700a 0a20  area data map.. 
+0000d7b0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0000d7c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0000d7d0: 2d2d 2d2d 0a20 2020 2020 2020 2061 7265  ----.        are
+0000d7e0: 615f 666e 203a 2073 7472 0a20 2020 2020  a_fn : str.     
+0000d7f0: 2020 2020 2020 204e 616d 6520 6f66 2076         Name of v
+0000d800: 6563 746f 7220 6461 7461 2063 6f72 7265  ector data corre
+0000d810: 7370 6f6e 6469 6e67 2074 6f20 7766 6c6f  sponding to wflo
+0000d820: 7720 6f75 7470 7574 2061 7265 612e 0a20  w output area.. 
+0000d830: 2020 2020 2020 2063 6f6c 3272 6173 7465         col2raste
+0000d840: 7220 3a20 7374 720a 2020 2020 2020 2020  r : str.        
+0000d850: 2020 2020 4e61 6d65 206f 6620 7468 6520      Name of the 
+0000d860: 636f 6c75 6d6e 2066 726f 6d20 7468 6520  column from the 
+0000d870: 7665 6374 6f72 2066 696c 6520 746f 2072  vector file to r
+0000d880: 6173 7465 7269 7a65 2e0a 2020 2020 2020  asterize..      
+0000d890: 2020 6e6f 6461 7461 203a 2069 6e74 2f66    nodata : int/f
+0000d8a0: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0a20  loat, optional. 
+0000d8b0: 2020 2020 2020 2020 2020 204e 6f64 6174             Nodat
+0000d8c0: 6120 7661 6c75 6520 746f 2075 7365 2077  a value to use w
+0000d8d0: 6865 6e20 7261 7374 6572 697a 696e 672e  hen rasterizing.
+0000d8e0: 2053 686f 756c 6420 6d61 7463 6820 7468   Should match th
+0000d8f0: 6520 6474 7970 6520 6f66 2063 6f6c 3272  e dtype of col2r
+0000d900: 6173 7465 722e 2042 7920 6465 6661 756c  aster. By defaul
+0000d910: 7420 2d31 2e0a 2020 2020 2020 2020 2222  t -1..        ""
+0000d920: 220a 2020 2020 2020 2020 6966 2061 7265  ".        if are
+0000d930: 615f 666e 206e 6f74 2069 6e20 7365 6c66  a_fn not in self
+0000d940: 2e64 6174 615f 6361 7461 6c6f 673a 0a20  .data_catalog:. 
+0000d950: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d960: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
+0000d970: 2249 6e76 616c 6964 2073 6f75 7263 6520  "Invalid source 
+0000d980: 277b 6172 6561 5f66 6e7d 272c 2073 6b69  '{area_fn}', ski
+0000d990: 7070 696e 6720 7365 7475 705f 6172 6561  pping setup_area
+0000d9a0: 6d61 702e 2229 0a20 2020 2020 2020 2020  map.").         
+0000d9b0: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0000d9c0: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
+0000d9d0: 6e66 6f28 6622 5072 6570 6172 696e 6720  nfo(f"Preparing 
+0000d9e0: 277b 636f 6c32 7261 7374 6572 7d27 206d  '{col2raster}' m
+0000d9f0: 6170 2066 726f 6d20 277b 6172 6561 5f66  ap from '{area_f
+0000da00: 6e7d 272e 2229 0a20 2020 2020 2020 2067  n}'.").        g
+0000da10: 6466 5f6f 7267 203d 2073 656c 662e 6461  df_org = self.da
+0000da20: 7461 5f63 6174 616c 6f67 2e67 6574 5f67  ta_catalog.get_g
+0000da30: 656f 6461 7461 6672 616d 6528 0a20 2020  eodataframe(.   
+0000da40: 2020 2020 2020 2020 2061 7265 615f 666e           area_fn
+0000da50: 2c20 6765 6f6d 3d73 656c 662e 6261 7369  , geom=self.basi
+0000da60: 6e73 2c20 6473 745f 6372 733d 7365 6c66  ns, dst_crs=self
+0000da70: 2e63 7273 0a20 2020 2020 2020 2029 0a20  .crs.        ). 
+0000da80: 2020 2020 2020 2069 6620 6764 665f 6f72         if gdf_or
+0000da90: 672e 656d 7074 793a 0a20 2020 2020 2020  g.empty:.       
+0000daa0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000dab0: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+0000dac0: 2020 2020 2020 2020 2020 6622 4e6f 2073            f"No s
+0000dad0: 6861 7065 7320 6f66 207b 6172 6561 5f66  hapes of {area_f
+0000dae0: 6e7d 2066 6f75 6e64 2077 6974 6869 6e20  n} found within 
+0000daf0: 7265 6769 6f6e 2c20 736b 6970 7069 6e67  region, skipping
+0000db00: 2061 7265 616d 6170 2e22 0a20 2020 2020   areamap.".     
+0000db10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000db20: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+0000db30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000db40: 2020 2020 2020 6461 5f61 7265 6120 3d20        da_area = 
+0000db50: 7365 6c66 2e73 7461 7469 636d 6170 732e  self.staticmaps.
+0000db60: 7261 7374 6572 2e72 6173 7465 7269 7a65  raster.rasterize
+0000db70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000db80: 2020 6764 663d 6764 665f 6f72 672c 0a20    gdf=gdf_org,. 
+0000db90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000dba0: 6f6c 5f6e 616d 653d 636f 6c32 7261 7374  ol_name=col2rast
+0000dbb0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0000dbc0: 2020 2020 6e6f 6461 7461 3d6e 6f64 6174      nodata=nodat
+0000dbd0: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+0000dbe0: 2020 2061 6c6c 5f74 6f75 6368 6564 3d54     all_touched=T
+0000dbf0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0000dc00: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
+0000dc10: 7365 745f 7374 6174 6963 6d61 7073 2864  set_staticmaps(d
+0000dc20: 615f 6172 6561 2e72 656e 616d 6528 636f  a_area.rename(co
+0000dc30: 6c32 7261 7374 6572 2929 0a0a 2020 2020  l2raster))..    
+0000dc40: 6465 6620 7365 7475 705f 6c61 6b65 7328  def setup_lakes(
+0000dc50: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0000dc60: 2020 2020 2020 206c 616b 6573 5f66 6e3a         lakes_fn:
+0000dc70: 2055 6e69 6f6e 5b73 7472 2c20 5061 7468   Union[str, Path
+0000dc80: 5d2c 0a20 2020 2020 2020 2072 6174 696e  ],.        ratin
+0000dc90: 675f 6375 7276 655f 666e 733a 204c 6973  g_curve_fns: Lis
+0000dca0: 745b 556e 696f 6e5b 7374 722c 2050 6174  t[Union[str, Pat
+0000dcb0: 685d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  h]] = None,.    
+0000dcc0: 2020 2020 6d69 6e5f 6172 6561 3a20 666c      min_area: fl
+0000dcd0: 6f61 7420 3d20 3130 2e30 2c0a 2020 2020  oat = 10.0,.    
+0000dce0: 2020 2020 6164 645f 6d61 7873 746f 7261      add_maxstora
+0000dcf0: 6765 3a20 626f 6f6c 203d 2046 616c 7365  ge: bool = False
+0000dd00: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+0000dd10: 2022 2222 5468 6973 2063 6f6d 706f 6e65   """This compone
+0000dd20: 6e74 2067 656e 6572 6174 6573 206d 6170  nt generates map
+0000dd30: 7320 6f66 206c 616b 6520 6172 6561 7320  s of lake areas 
+0000dd40: 616e 6420 6f75 746c 6574 7320 6173 2077  and outlets as w
+0000dd50: 656c 6c20 6173 2070 6172 616d 6574 6572  ell as parameter
+0000dd60: 730a 2020 2020 2020 2020 7769 7468 2061  s.        with a
+0000dd70: 7665 7261 6765 206c 616b 6520 6172 6561  verage lake area
+0000dd80: 2c20 6465 7074 6820 616e 6420 6469 7363  , depth and disc
+0000dd90: 6861 7267 6520 7661 6c75 6573 2e0a 0a20  harge values... 
+0000dda0: 2020 2020 2020 2054 6865 2064 6174 6120         The data 
+0000ddb0: 6973 2067 656e 6572 6174 6564 2066 726f  is generated fro
+0000ddc0: 6d20 6665 6174 7572 6573 2077 6974 6820  m features with 
+0000ddd0: 6060 6d69 6e5f 6172 6561 6060 205b 6b6d  ``min_area`` [km
+0000dde0: 325d 2028 6465 6661 756c 7420 3120 6b6d  2] (default 1 km
+0000ddf0: 3229 2066 726f 6d20 6120 6461 7461 6261  2) from a databa
+0000de00: 7365 2077 6974 680a 2020 2020 2020 2020  se with.        
+0000de10: 6c61 6b65 2067 656f 6d65 7472 792c 2049  lake geometry, I
+0000de20: 4473 2061 6e64 206d 6574 6164 6174 612e  Ds and metadata.
+0000de30: 2044 6174 6120 7265 7175 6972 6564 2061   Data required a
+0000de40: 7265 206c 616b 6520 4944 2027 7761 7465  re lake ID 'wate
+0000de50: 7262 6f64 795f 6964 272c 2061 7665 7261  rbody_id', avera
+0000de60: 6765 2061 7265 6120 2741 7265 615f 6176  ge area 'Area_av
+0000de70: 6727 205b 6d32 5d2c 0a20 2020 2020 2020  g' [m2],.       
+0000de80: 2061 7665 7261 6765 2076 6f6c 756d 6520   average volume 
+0000de90: 2756 6f6c 5f61 7667 2720 5b6d 335d 2c20  'Vol_avg' [m3], 
+0000dea0: 6176 6572 6167 6520 6465 7074 6820 2744  average depth 'D
+0000deb0: 6570 7468 5f61 7667 2720 5b6d 5d20 616e  epth_avg' [m] an
+0000dec0: 6420 6176 6572 6167 6520 6469 7363 6861  d average discha
+0000ded0: 7267 6520 2744 6973 5f61 7667 2720 5b6d  rge 'Dis_avg' [m
+0000dee0: 332f 735d 2e0a 0a20 2020 2020 2020 2049  3/s]...        I
+0000def0: 6620 7261 7469 6e67 2063 7572 7665 2064  f rating curve d
+0000df00: 6174 6120 6973 2061 7661 696c 6162 6c65  ata is available
+0000df10: 2066 6f72 2073 746f 7261 6765 2061 6e64   for storage and
+0000df20: 2064 6973 6368 6172 6765 2074 6865 7920   discharge they 
+0000df30: 6361 6e20 6265 2070 7265 7061 7265 6420  can be prepared 
+0000df40: 7669 6120 6060 7261 7469 6e67 5f63 7572  via ``rating_cur
+0000df50: 7665 5f66 6e73 6060 0a20 2020 2020 2020  ve_fns``.       
+0000df60: 2028 7365 6520 6265 6c6f 7720 666f 7220   (see below for 
+0000df70: 7379 6e74 6178 2061 6e64 2072 6571 7569  syntax and requi
+0000df80: 7265 6d65 6e74 7329 2e20 456c 7365 2074  rements). Else t
+0000df90: 6865 2070 6172 616d 6574 6572 7320 274c  he parameters 'L
+0000dfa0: 616b 655f 6227 2061 6e64 2027 4c61 6b65  ake_b' and 'Lake
+0000dfb0: 5f65 2720 7769 6c6c 2062 6520 7573 6564  _e' will be used
+0000dfc0: 2066 6f72 0a20 2020 2020 2020 2064 6973   for.        dis
+0000dfd0: 6368 6172 6765 2061 6e64 2066 6f72 2073  charge and for s
+0000dfe0: 746f 7261 6765 2061 2072 6563 7461 6e67  torage a rectang
+0000dff0: 756c 6172 2070 726f 6669 6c65 206c 616b  ular profile lak
+0000e000: 6520 6973 2061 7373 756d 6564 2e0a 2020  e is assumed..  
+0000e010: 2020 2020 2020 5365 6520 5766 6c6f 7720        See Wflow 
+0000e020: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
+0000e030: 7220 6d6f 7265 2069 6e66 6f72 6d61 7469  r more informati
+0000e040: 6f6e 2e0a 0a20 2020 2020 2020 2049 6620  on...        If 
+0000e050: 6060 6164 645f 6d61 7873 746f 7261 6765  ``add_maxstorage
+0000e060: 6060 2069 7320 5472 7565 2c20 7468 6520  `` is True, the 
+0000e070: 6d61 7869 6d75 6d20 7374 6f72 6167 6520  maximum storage 
+0000e080: 6f66 2074 6865 206c 616b 6520 6973 2061  of the lake is a
+0000e090: 6464 6564 2074 6f20 7468 6520 6f75 7470  dded to the outp
+0000e0a0: 7574 2028 636f 6e74 726f 6c6c 6564 206c  ut (controlled l
+0000e0b0: 616b 6529 2062 6173 6564 206f 6e0a 2020  ake) based on.  
+0000e0c0: 2020 2020 2020 2756 6f6c 5f6d 6178 2720        'Vol_max' 
+0000e0d0: 5b6d 335d 2063 6f6c 756d 6e20 6f66 206c  [m3] column of l
+0000e0e0: 616b 6573 5f66 6e2e 0a0a 2020 2020 2020  akes_fn...      
+0000e0f0: 2020 4164 6473 206d 6f64 656c 206c 6179    Adds model lay
+0000e100: 6572 733a 0a0a 2020 2020 2020 2020 2a20  ers:..        * 
+0000e110: 2a2a 7766 6c6f 775f 6c61 6b65 6172 6561  **wflow_lakearea
+0000e120: 732a 2a20 6d61 703a 206c 616b 6520 4944  s** map: lake ID
+0000e130: 7320 5b2d 5d0a 2020 2020 2020 2020 2a20  s [-].        * 
+0000e140: 2a2a 7766 6c6f 775f 6c61 6b65 6c6f 6373  **wflow_lakelocs
+0000e150: 2a2a 206d 6170 3a20 6c61 6b65 2049 4473  ** map: lake IDs
+0000e160: 2061 7420 6f75 746c 6574 206c 6f63 6174   at outlet locat
+0000e170: 696f 6e73 205b 2d5d 0a20 2020 2020 2020  ions [-].       
+0000e180: 202a 202a 2a4c 616b 6541 7265 612a 2a20   * **LakeArea** 
+0000e190: 6d61 703a 206c 616b 6520 6172 6561 205b  map: lake area [
+0000e1a0: 6d32 5d0a 2020 2020 2020 2020 2a20 2a2a  m2].        * **
+0000e1b0: 4c61 6b65 4176 674c 6576 656c 2a2a 206d  LakeAvgLevel** m
+0000e1c0: 6170 3a20 6c61 6b65 2061 7665 7261 6765  ap: lake average
+0000e1d0: 2077 6174 6572 206c 6576 656c 205b 6d5d   water level [m]
+0000e1e0: 0a20 2020 2020 2020 202a 202a 2a4c 616b  .        * **Lak
+0000e1f0: 6541 7667 4f75 742a 2a20 6d61 703a 206c  eAvgOut** map: l
+0000e200: 616b 6520 6176 6572 6167 6520 6469 7363  ake average disc
+0000e210: 6861 7267 6520 5b6d 332f 735d 0a20 2020  harge [m3/s].   
+0000e220: 2020 2020 202a 202a 2a4c 616b 655f 622a       * **Lake_b*
+0000e230: 2a20 6d61 703a 206c 616b 6520 7261 7469  * map: lake rati
+0000e240: 6e67 2063 7572 7665 2063 6f65 6666 6963  ng curve coeffic
+0000e250: 6965 6e74 205b 2d5d 0a20 2020 2020 2020  ient [-].       
+0000e260: 202a 202a 2a4c 616b 654f 7574 666c 6f77   * **LakeOutflow
+0000e270: 4675 6e63 2a2a 206d 6170 3a20 6f70 7469  Func** map: opti
+0000e280: 6f6e 2074 6f20 636f 6d70 7574 6520 7261  on to compute ra
+0000e290: 7469 6e67 2063 7572 7665 205b 2d5d 0a20  ting curve [-]. 
+0000e2a0: 2020 2020 2020 202a 202a 2a4c 616b 6553         * **LakeS
+0000e2b0: 746f 7246 756e 632a 2a20 6d61 703a 206f  torFunc** map: o
+0000e2c0: 7074 696f 6e20 746f 2063 6f6d 7075 7465  ption to compute
+0000e2d0: 2073 746f 7261 6765 2063 7572 7665 205b   storage curve [
+0000e2e0: 2d5d 0a20 2020 2020 2020 202a 202a 2a4c  -].        * **L
+0000e2f0: 616b 654d 6178 5374 6f72 6167 652a 2a20  akeMaxStorage** 
+0000e300: 6d61 703a 206f 7074 696f 6e61 6c2c 206d  map: optional, m
+0000e310: 6178 696d 756d 2073 746f 7261 6765 206f  aximum storage o
+0000e320: 6620 6c61 6b65 205b 6d33 5d0a 2020 2020  f lake [m3].    
+0000e330: 2020 2020 2a20 2a2a 6c61 6b65 732a 2a20      * **lakes** 
+0000e340: 6765 6f6d 3a20 706f 6c79 676f 6e20 7769  geom: polygon wi
+0000e350: 7468 206c 616b 6573 2061 6e64 2077 666c  th lakes and wfl
+0000e360: 6f77 206c 616b 6520 7061 7261 6d65 7465  ow lake paramete
+0000e370: 7273 0a0a 2020 2020 2020 2020 5061 7261  rs..        Para
+0000e380: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+0000e390: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0000e3a0: 2020 6c61 6b65 735f 666e 203a 0a20 2020    lakes_fn :.   
+0000e3b0: 2020 2020 2020 2020 204e 616d 6520 6f66           Name of
+0000e3c0: 2064 6174 6120 736f 7572 6365 2066 6f72   data source for
+0000e3d0: 206c 616b 6520 7061 7261 6d65 7465 7273   lake parameters
+0000e3e0: 2c20 7365 6520 6461 7461 2f64 6174 615f  , see data/data_
+0000e3f0: 736f 7572 6365 732e 796d 6c2e 0a0a 2020  sources.yml...  
+0000e400: 2020 2020 2020 2020 2020 2a20 5265 7175            * Requ
+0000e410: 6972 6564 2076 6172 6961 626c 6573 2066  ired variables f
+0000e420: 6f72 2064 6972 6563 7420 7573 653a 205b  or direct use: [
+0000e430: 2777 6174 6572 626f 6479 5f69 6427 2c20  'waterbody_id', 
+0000e440: 2741 7265 615f 6176 6727 2c20 2744 6570  'Area_avg', 'Dep
+0000e450: 7468 5f61 7667 272c 2027 4469 735f 6176  th_avg', 'Dis_av
+0000e460: 6727 2c20 274c 616b 655f 6227 2c20 274c  g', 'Lake_b', 'L
+0000e470: 616b 655f 6527 2c20 274c 616b 654f 7574  ake_e', 'LakeOut
+0000e480: 666c 6f77 4675 6e63 272c 2027 4c61 6b65  flowFunc', 'Lake
+0000e490: 5374 6f72 4675 6e63 272c 2027 4c61 6b65  StorFunc', 'Lake
+0000e4a0: 5468 7265 7368 6f6c 6427 2c20 274c 696e  Threshold', 'Lin
+0000e4b0: 6b65 644c 616b 654c 6f63 7327 5d0a 0a20  kedLakeLocs'].. 
+0000e4c0: 2020 2020 2020 2020 2020 202a 2052 6571             * Req
+0000e4d0: 7569 7265 6420 7661 7269 6162 6c65 7320  uired variables 
+0000e4e0: 666f 7220 7061 7261 6d65 7465 7220 6573  for parameter es
+0000e4f0: 7469 6d61 7469 6f6e 3a20 5b27 7761 7465  timation: ['wate
+0000e500: 7262 6f64 795f 6964 272c 2027 4172 6561  rbody_id', 'Area
+0000e510: 5f61 7667 272c 2027 566f 6c5f 6176 6727  _avg', 'Vol_avg'
+0000e520: 2c20 2744 6570 7468 5f61 7667 272c 2027  , 'Depth_avg', '
+0000e530: 4469 735f 6176 6727 5d0a 2020 2020 2020  Dis_avg'].      
+0000e540: 2020 7261 7469 6e67 5f63 7572 7665 5f66    rating_curve_f
+0000e550: 6e73 3a20 7374 722c 2050 6174 682c 204c  ns: str, Path, L
+0000e560: 6973 745b 7374 725d 2c20 4c69 7374 5b50  ist[str], List[P
+0000e570: 6174 685d 2c20 6f70 7469 6f6e 616c 0a20  ath], optional. 
+0000e580: 2020 2020 2020 2020 2020 2044 6174 6120             Data 
+0000e590: 6361 7461 6c6f 6720 656e 7472 792f 656e  catalog entry/en
+0000e5a0: 7472 6965 7320 6f72 2070 6174 6828 7329  tries or path(s)
+0000e5b0: 2063 6f6e 7461 696e 696e 6720 7261 7469   containing rati
+0000e5c0: 6e67 2063 7572 7665 2076 616c 7565 7320  ng curve values 
+0000e5d0: 666f 7220 6c61 6b65 732e 2049 6620 4e6f  for lakes. If No
+0000e5e0: 6e65 2074 6865 6e20 7769 6c6c 2062 6520  ne then will be 
+0000e5f0: 6465 7269 7665 6420 6672 6f6d 0a20 2020  derived from.   
+0000e600: 2020 2020 2020 2020 2070 726f 7065 7274           propert
+0000e610: 6965 7320 6f66 206c 616b 6573 5f66 6e2e  ies of lakes_fn.
+0000e620: 2041 7373 756d 6573 206f 6e65 2066 696c   Assumes one fil
+0000e630: 6520 7065 7220 6c61 6b65 2028 7769 7468  e per lake (with
+0000e640: 2061 6c6c 2076 6172 6961 626c 6573 2920   all variables) 
+0000e650: 616e 6420 7468 6174 2074 6865 206c 616b  and that the lak
+0000e660: 6520 4944 2069 7320 6569 7468 6572 2069  e ID is either i
+0000e670: 6e20 7468 6520 6669 6c65 6e61 6d65 0a20  n the filename. 
+0000e680: 2020 2020 2020 2020 2020 206f 7220 6461             or da
+0000e690: 7461 2063 6174 616c 6f67 2065 6e74 7279  ta catalog entry
+0000e6a0: 206e 616d 6520 2865 6720 7573 696e 6720   name (eg using 
+0000e6b0: 706c 6163 6568 6f6c 6465 7229 2e20 5468  placeholder). Th
+0000e6c0: 6520 4944 2073 686f 756c 6420 6265 2070  e ID should be p
+0000e6d0: 6c61 6365 6420 6174 2074 6865 2065 6e64  laced at the end
+0000e6e0: 2073 6570 6172 6174 6564 2062 7920 616e   separated by an
+0000e6f0: 2075 6e64 6572 7363 6f72 6520 2865 670a   underscore (eg.
+0000e700: 2020 2020 2020 2020 2020 2020 2772 6174              'rat
+0000e710: 696e 675f 6375 7276 655f 3132 2e63 7376  ing_curve_12.csv
+0000e720: 2720 6f72 2027 7261 7469 6e67 5f63 7572  ' or 'rating_cur
+0000e730: 7665 5f31 3227 290a 0a20 2020 2020 2020  ve_12')..       
+0000e740: 2020 2020 202a 2052 6571 7569 7265 6420       * Required 
+0000e750: 7661 7269 6162 6c65 733a 205b 2765 6c65  variables: ['ele
+0000e760: 7674 6e27 2c20 2776 6f6c 756d 6527 5d20  vtn', 'volume'] 
+0000e770: 666f 7220 7374 6f72 6167 6520 6375 7276  for storage curv
+0000e780: 6520 616e 6420 5b27 656c 6576 746e 272c  e and ['elevtn',
+0000e790: 2027 6469 7363 6861 7267 6527 5d20 666f   'discharge'] fo
+0000e7a0: 7220 6469 7363 6861 7267 6520 7261 7469  r discharge rati
+0000e7b0: 6e67 2063 7572 7665 0a20 2020 2020 2020  ng curve.       
+0000e7c0: 206d 696e 5f61 7265 6120 3a20 666c 6f61   min_area : floa
+0000e7d0: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
+0000e7e0: 2020 2020 2020 2020 4d69 6e69 6d75 6d20          Minimum 
+0000e7f0: 6c61 6b65 2061 7265 6120 7468 7265 7368  lake area thresh
+0000e800: 6f6c 6420 5b6b 6d32 5d2c 2062 7920 6465  old [km2], by de
+0000e810: 6661 756c 7420 3130 2e30 206b 6d32 2e0a  fault 10.0 km2..
+0000e820: 2020 2020 2020 2020 6164 645f 6d61 7873          add_maxs
+0000e830: 746f 7261 6765 203a 2062 6f6f 6c2c 206f  torage : bool, o
+0000e840: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0000e850: 2020 2020 4966 2054 7275 652c 206d 6178      If True, max
+0000e860: 696d 756d 2073 746f 7261 6765 206f 6620  imum storage of 
+0000e870: 7468 6520 6c61 6b65 2069 7320 6164 6465  the lake is adde
+0000e880: 6420 746f 2074 6865 206f 7574 7075 7420  d to the output 
+0000e890: 2863 6f6e 7472 6f6c 6c65 6420 6c61 6b65  (controlled lake
+0000e8a0: 2920 6261 7365 6420 6f6e 2027 566f 6c5f  ) based on 'Vol_
+0000e8b0: 6d61 7827 205b 6d33 5d20 636f 6c75 6d6e  max' [m3] column
+0000e8c0: 206f 6620 6c61 6b65 735f 666e 2c20 6279   of lakes_fn, by
+0000e8d0: 2064 6566 6175 6c74 2046 616c 7365 2028   default False (
+0000e8e0: 6e61 7475 7261 6c20 6c61 6b65 292e 0a20  natural lake).. 
+0000e8f0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000e900: 2020 2020 2320 4465 7269 7665 206c 616b      # Derive lak
+0000e910: 6520 6172 6520 616e 6420 6f75 746c 6574  e are and outlet
+0000e920: 206d 6170 730a 2020 2020 2020 2020 6764   maps.        gd
+0000e930: 665f 6f72 672c 2064 735f 6c61 6b65 7320  f_org, ds_lakes 
+0000e940: 3d20 7365 6c66 2e5f 7365 7475 705f 7761  = self._setup_wa
+0000e950: 7465 7262 6f64 6965 7328 6c61 6b65 735f  terbodies(lakes_
+0000e960: 666e 2c20 226c 616b 6522 2c20 6d69 6e5f  fn, "lake", min_
+0000e970: 6172 6561 290a 2020 2020 2020 2020 6966  area).        if
+0000e980: 2064 735f 6c61 6b65 7320 6973 204e 6f6e   ds_lakes is Non
+0000e990: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000e9a0: 6574 7572 6e0a 2020 2020 2020 2020 726d  eturn.        rm
+0000e9b0: 6469 6374 203d 207b 6b3a 2076 2066 6f72  dict = {k: v for
+0000e9c0: 206b 2c20 7620 696e 2073 656c 662e 5f4d   k, v in self._M
+0000e9d0: 4150 532e 6974 656d 7328 2920 6966 206b  APS.items() if k
+0000e9e0: 2069 6e20 6473 5f6c 616b 6573 2e64 6174   in ds_lakes.dat
+0000e9f0: 615f 7661 7273 7d0a 2020 2020 2020 2020  a_vars}.        
+0000ea00: 6473 5f6c 616b 6573 203d 2064 735f 6c61  ds_lakes = ds_la
+0000ea10: 6b65 732e 7265 6e61 6d65 2872 6d64 6963  kes.rename(rmdic
+0000ea20: 7429 0a0a 2020 2020 2020 2020 2320 4966  t)..        # If
+0000ea30: 2072 6174 696e 675f 6375 7276 655f 666e   rating_curve_fn
+0000ea40: 2070 7265 7061 7265 2072 6174 696e 6720   prepare rating 
+0000ea50: 6375 7276 6520 6469 6374 0a20 2020 2020  curve dict.     
+0000ea60: 2020 2072 6174 696e 675f 6469 6374 203d     rating_dict =
+0000ea70: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
+0000ea80: 6966 2072 6174 696e 675f 6375 7276 655f  if rating_curve_
+0000ea90: 666e 7320 6973 206e 6f74 204e 6f6e 653a  fns is not None:
+0000eaa0: 0a20 2020 2020 2020 2020 2020 2072 6174  .            rat
+0000eab0: 696e 675f 6375 7276 655f 666e 7320 3d20  ing_curve_fns = 
+0000eac0: 6e70 2e61 746c 6561 7374 5f31 6428 7261  np.atleast_1d(ra
+0000ead0: 7469 6e67 5f63 7572 7665 5f66 6e73 290a  ting_curve_fns).
+0000eae0: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
+0000eaf0: 6e64 2069 6473 2069 6e20 7261 7469 6e67  nd ids in rating
+0000eb00: 5f63 7572 7665 5f66 6e73 0a20 2020 2020  _curve_fns.     
+0000eb10: 2020 2020 2020 2066 6e73 5f69 6473 203d         fns_ids =
+0000eb20: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0000eb30: 666f 7220 666e 2069 6e20 7261 7469 6e67  for fn in rating
+0000eb40: 5f63 7572 7665 5f66 6e73 3a0a 2020 2020  _curve_fns:.    
+0000eb50: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000eb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eb70: 2020 2020 2066 6e73 5f69 6473 2e61 7070       fns_ids.app
+0000eb80: 656e 6428 696e 7428 666e 2e73 706c 6974  end(int(fn.split
+0000eb90: 2822 5f22 295b 2d31 5d2e 7370 6c69 7428  ("_")[-1].split(
+0000eba0: 222e 2229 5b30 5d29 290a 2020 2020 2020  ".")[0])).      
+0000ebb0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000ebc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ebd0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0000ebe0: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
+0000ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec00: 2020 2066 2243 6f75 6c64 206e 6f74 2070     f"Could not p
+0000ec10: 6172 7365 2069 6e74 6567 6572 206c 616b  arse integer lak
+0000ec20: 6520 696e 6465 7820 6672 6f6d 2072 6174  e index from rat
+0000ec30: 696e 6720 6375 7276 6520 666e 207b 666e  ing curve fn {fn
+0000ec40: 7d2e 2053 6b69 7070 696e 672e 220a 2020  }. Skipping.".  
+0000ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec60: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000ec70: 2320 6173 7375 6d65 206c 616b 6520 696e  # assume lake in
+0000ec80: 6465 7820 7769 6c6c 2062 6520 696e 2074  dex will be in t
+0000ec90: 6865 2070 6174 680a 2020 2020 2020 2020  he path.        
+0000eca0: 2020 2020 2320 4173 7375 6d65 206f 6e65      # Assume one
+0000ecb0: 2072 6174 696e 6720 6375 7276 6520 7065   rating curve pe
+0000ecc0: 7220 6c61 6b65 2069 6e64 6578 0a20 2020  r lake index.   
+0000ecd0: 2020 2020 2020 2020 2066 6f72 2069 6420           for id 
+0000ece0: 696e 2067 6466 5f6f 7267 5b22 7761 7465  in gdf_org["wate
+0000ecf0: 7262 6f64 795f 6964 225d 2e76 616c 7565  rbody_id"].value
+0000ed00: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000ed10: 2020 2069 6420 3d20 696e 7428 6964 290a     id = int(id).
+0000ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed30: 2320 4669 6e64 2069 6620 6964 2069 7320  # Find if id is 
+0000ed40: 6973 206f 6e65 206f 6620 7468 6520 7061  is one of the pa
+0000ed50: 7468 7320 696e 2072 6174 696e 675f 6375  ths in rating_cu
+0000ed60: 7276 655f 666e 730a 2020 2020 2020 2020  rve_fns.        
+0000ed70: 2020 2020 2020 2020 6966 2069 6420 696e          if id in
+0000ed80: 2066 6e73 5f69 6473 3a0a 2020 2020 2020   fns_ids:.      
+0000ed90: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000eda0: 5570 6461 7465 2070 6174 6820 6261 7365  Update path base
+0000edb0: 6420 6f6e 2063 7572 7265 6e74 2077 6174  d on current wat
+0000edc0: 6572 626f 6479 5f69 640a 2020 2020 2020  erbody_id.      
+0000edd0: 2020 2020 2020 2020 2020 2020 2020 6920                i 
+0000ede0: 3d20 666e 735f 6964 732e 696e 6465 7828  = fns_ids.index(
+0000edf0: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
+0000ee00: 2020 2020 2020 2020 7261 7469 6e67 5f66          rating_f
+0000ee10: 6e20 3d20 7261 7469 6e67 5f63 7572 7665  n = rating_curve
+0000ee20: 5f66 6e73 5b69 5d0a 2020 2020 2020 2020  _fns[i].        
+0000ee30: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
+0000ee40: 6164 2064 6174 610a 2020 2020 2020 2020  ad data.        
+0000ee50: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000ee60: 7366 696c 6528 7261 7469 6e67 5f66 6e29  sfile(rating_fn)
+0000ee70: 206f 7220 7261 7469 6e67 5f66 6e20 696e   or rating_fn in
+0000ee80: 2073 656c 662e 6461 7461 5f63 6174 616c   self.data_catal
+0000ee90: 6f67 3a0a 2020 2020 2020 2020 2020 2020  og:.            
+0000eea0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000eeb0: 2e6c 6f67 6765 722e 696e 666f 280a 2020  .logger.info(.  
+0000eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eed0: 2020 2020 2020 2020 2020 6622 5072 6570            f"Prep
+0000eee0: 6172 696e 6720 6c61 6b65 2072 6174 696e  aring lake ratin
+0000eef0: 6720 6375 7276 6520 6461 7461 2066 726f  g curve data fro
+0000ef00: 6d20 7b72 6174 696e 675f 666e 7d22 0a20  m {rating_fn}". 
+0000ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef40: 2064 665f 7261 7465 203d 2073 656c 662e   df_rate = self.
+0000ef50: 6461 7461 5f63 6174 616c 6f67 2e67 6574  data_catalog.get
+0000ef60: 5f64 6174 6166 7261 6d65 2872 6174 696e  _dataframe(ratin
+0000ef70: 675f 666e 290a 2020 2020 2020 2020 2020  g_fn).          
+0000ef80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000ef90: 4164 6420 746f 2064 6963 740a 2020 2020  Add to dict.    
+0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efb0: 2020 2020 7261 7469 6e67 5f64 6963 745b      rating_dict[
+0000efc0: 6964 5d20 3d20 6466 5f72 6174 650a 2020  id] = df_rate.  
+0000efd0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000efe0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000eff0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000f000: 6765 722e 7761 726e 696e 6728 0a20 2020  ger.warning(.   
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f020: 2020 2020 2066 2252 6174 696e 6720 6375       f"Rating cu
+0000f030: 7276 6520 6669 6c65 206e 6f74 2066 6f75  rve file not fou
+0000f040: 6e64 2066 6f72 206c 616b 6520 7769 7468  nd for lake with
+0000f050: 2069 6420 7b69 647d 2e20 5573 696e 6720   id {id}. Using 
+0000f060: 6465 6661 756c 7420 7374 6f72 6167 652f  default storage/
+0000f070: 6f75 7466 6c6f 7720 6675 6e63 7469 6f6e  outflow function
+0000f080: 2070 6172 616d 6574 6572 732e 220a 2020   parameters.".  
+0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0a0: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
+0000f0b0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000f0c0: 6c66 2e6c 6f67 6765 722e 696e 666f 280a  lf.logger.info(.
+0000f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0e0: 224e 6f20 7261 7469 6e67 2063 7572 7665  "No rating curve
+0000f0f0: 2064 6174 6120 7072 6f76 6964 6564 2e20   data provided. 
+0000f100: 5573 696e 6720 6465 6661 756c 7420 7374  Using default st
+0000f110: 6f72 6167 652f 6f75 7466 6c6f 7720 6675  orage/outflow fu
+0000f120: 6e63 7469 6f6e 2070 6172 616d 6574 6572  nction parameter
+0000f130: 732e 220a 2020 2020 2020 2020 2020 2020  s.".            
+0000f140: 290a 0a20 2020 2020 2020 2023 2061 6464  )..        # add
+0000f150: 2077 6174 6572 626f 6479 2070 6172 616d   waterbody param
+0000f160: 6574 6572 730a 2020 2020 2020 2020 6473  eters.        ds
+0000f170: 5f6c 616b 6573 2c20 6764 665f 6c61 6b65  _lakes, gdf_lake
+0000f180: 732c 2072 6174 696e 675f 6375 7276 6573  s, rating_curves
+0000f190: 203d 2077 6f72 6b66 6c6f 7773 2e77 6174   = workflows.wat
+0000f1a0: 6572 626f 6469 6573 2e6c 616b 6561 7474  erbodies.lakeatt
+0000f1b0: 7273 280a 2020 2020 2020 2020 2020 2020  rs(.            
+0000f1c0: 6473 5f6c 616b 6573 2c20 6764 665f 6f72  ds_lakes, gdf_or
+0000f1d0: 672c 2072 6174 696e 675f 6469 6374 2c20  g, rating_dict, 
+0000f1e0: 6164 645f 6d61 7873 746f 7261 6765 3d61  add_maxstorage=a
+0000f1f0: 6464 5f6d 6178 7374 6f72 6167 650a 2020  dd_maxstorage.  
+0000f200: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000f210: 2023 2061 6464 2074 6f20 7374 6174 6963   # add to static
+0000f220: 6d61 7073 0a20 2020 2020 2020 2073 656c  maps.        sel
+0000f230: 662e 7365 745f 7374 6174 6963 6d61 7073  f.set_staticmaps
+0000f240: 2864 735f 6c61 6b65 7329 0a20 2020 2020  (ds_lakes).     
+0000f250: 2020 2023 2077 7269 7465 206c 616b 6573     # write lakes
+0000f260: 2077 6974 6820 6174 7472 2074 6162 6c65   with attr table
+0000f270: 7320 746f 2073 7461 7469 6320 6765 6f6d  s to static geom
+0000f280: 732e 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+0000f290: 7365 745f 7374 6174 6963 6765 6f6d 7328  set_staticgeoms(
+0000f2a0: 6764 665f 6c61 6b65 732c 206e 616d 653d  gdf_lakes, name=
+0000f2b0: 226c 616b 6573 2229 0a20 2020 2020 2020  "lakes").       
+0000f2c0: 2023 2061 6464 2074 6865 2074 6162 6c65   # add the table
+0000f2d0: 730a 2020 2020 2020 2020 666f 7220 6b2c  s.        for k,
+0000f2e0: 2076 2069 6e20 7261 7469 6e67 5f63 7572   v in rating_cur
+0000f2f0: 7665 732e 6974 656d 7328 293a 0a20 2020  ves.items():.   
+0000f300: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+0000f310: 745f 7461 626c 6573 2876 2c20 6e61 6d65  t_tables(v, name
+0000f320: 3d6b 290a 0a20 2020 2020 2020 2023 2069  =k)..        # i
+0000f330: 6620 7468 6572 6520 6172 6520 6c61 6b65  f there are lake
+0000f340: 732c 2063 6861 6e67 6520 5472 7565 2069  s, change True i
+0000f350: 6e20 746f 6d6c 0a20 2020 2020 2020 2023  n toml.        #
+0000f360: 204c 616b 6520 7365 6574 696e 6773 2069   Lake seetings i
+0000f370: 6e20 7468 6520 746f 6d6c 2074 6f20 7570  n the toml to up
+0000f380: 6461 7465 0a20 2020 2020 2020 206c 616b  date.        lak
+0000f390: 6573 5f74 6f6d 6c20 3d20 7b0a 2020 2020  es_toml = {.    
+0000f3a0: 2020 2020 2020 2020 226d 6f64 656c 2e6c          "model.l
+0000f3b0: 616b 6573 223a 2054 7275 652c 0a20 2020  akes": True,.   
+0000f3c0: 2020 2020 2020 2020 2022 7374 6174 652e           "state.
+0000f3d0: 6c61 7465 7261 6c2e 7269 7665 722e 6c61  lateral.river.la
+0000f3e0: 6b65 2e77 6174 6572 6c65 7665 6c22 3a20  ke.waterlevel": 
+0000f3f0: 2277 6174 6572 6c65 7665 6c5f 6c61 6b65  "waterlevel_lake
+0000f400: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+0000f410: 696e 7075 742e 6c61 7465 7261 6c2e 7269  input.lateral.ri
+0000f420: 7665 722e 6c61 6b65 2e61 7265 6122 3a20  ver.lake.area": 
+0000f430: 224c 616b 6541 7265 6122 2c0a 2020 2020  "LakeArea",.    
+0000f440: 2020 2020 2020 2020 2269 6e70 7574 2e6c          "input.l
+0000f450: 6174 6572 616c 2e72 6976 6572 2e6c 616b  ateral.river.lak
+0000f460: 652e 6172 6561 7322 3a20 2277 666c 6f77  e.areas": "wflow
+0000f470: 5f6c 616b 6561 7265 6173 222c 0a20 2020  _lakeareas",.   
+0000f480: 2020 2020 2020 2020 2022 696e 7075 742e           "input.
+0000f490: 6c61 7465 7261 6c2e 7269 7665 722e 6c61  lateral.river.la
+0000f4a0: 6b65 2e62 223a 2022 4c61 6b65 5f62 222c  ke.b": "Lake_b",
+0000f4b0: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
+0000f4c0: 7075 742e 6c61 7465 7261 6c2e 7269 7665  put.lateral.rive
+0000f4d0: 722e 6c61 6b65 2e65 223a 2022 4c61 6b65  r.lake.e": "Lake
+0000f4e0: 5f65 222c 0a20 2020 2020 2020 2020 2020  _e",.           
+0000f4f0: 2022 696e 7075 742e 6c61 7465 7261 6c2e   "input.lateral.
+0000f500: 7269 7665 722e 6c61 6b65 2e6c 6f63 7322  river.lake.locs"
+0000f510: 3a20 2277 666c 6f77 5f6c 616b 656c 6f63  : "wflow_lakeloc
+0000f520: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+0000f530: 2269 6e70 7574 2e6c 6174 6572 616c 2e72  "input.lateral.r
+0000f540: 6976 6572 2e6c 616b 652e 6f75 7466 6c6f  iver.lake.outflo
+0000f550: 7766 756e 6322 3a20 224c 616b 654f 7574  wfunc": "LakeOut
+0000f560: 666c 6f77 4675 6e63 222c 0a20 2020 2020  flowFunc",.     
+0000f570: 2020 2020 2020 2022 696e 7075 742e 6c61         "input.la
+0000f580: 7465 7261 6c2e 7269 7665 722e 6c61 6b65  teral.river.lake
+0000f590: 2e73 746f 7266 756e 6322 3a20 224c 616b  .storfunc": "Lak
+0000f5a0: 6553 746f 7246 756e 6322 2c0a 2020 2020  eStorFunc",.    
+0000f5b0: 2020 2020 2020 2020 2269 6e70 7574 2e6c          "input.l
+0000f5c0: 6174 6572 616c 2e72 6976 6572 2e6c 616b  ateral.river.lak
+0000f5d0: 652e 7468 7265 7368 6f6c 6422 3a20 224c  e.threshold": "L
+0000f5e0: 616b 6554 6872 6573 686f 6c64 222c 0a20  akeThreshold",. 
+0000f5f0: 2020 2020 2020 2020 2020 2022 696e 7075             "inpu
+0000f600: 742e 6c61 7465 7261 6c2e 7269 7665 722e  t.lateral.river.
+0000f610: 6c61 6b65 2e6c 696e 6b65 646c 616b 656c  lake.linkedlakel
+0000f620: 6f63 7322 3a20 224c 696e 6b65 644c 616b  ocs": "LinkedLak
+0000f630: 654c 6f63 7322 2c0a 2020 2020 2020 2020  eLocs",.        
+0000f640: 2020 2020 2269 6e70 7574 2e6c 6174 6572      "input.later
+0000f650: 616c 2e72 6976 6572 2e6c 616b 652e 7761  al.river.lake.wa
+0000f660: 7465 726c 6576 656c 223a 2022 4c61 6b65  terlevel": "Lake
+0000f670: 4176 674c 6576 656c 222c 0a20 2020 2020  AvgLevel",.     
+0000f680: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
+0000f690: 224c 616b 654d 6178 5374 6f72 6167 6522  "LakeMaxStorage"
+0000f6a0: 2069 6e20 6473 5f6c 616b 6573 3a0a 2020   in ds_lakes:.  
+0000f6b0: 2020 2020 2020 2020 2020 6c61 6b65 735f            lakes_
+0000f6c0: 746f 6d6c 5b22 696e 7075 742e 6c61 7465  toml["input.late
+0000f6d0: 7261 6c2e 7269 7665 722e 6c61 6b65 2e6d  ral.river.lake.m
+0000f6e0: 6178 7374 6f72 6167 6522 5d20 3d20 224c  axstorage"] = "L
+0000f6f0: 616b 654d 6178 5374 6f72 6167 6522 0a20  akeMaxStorage". 
+0000f700: 2020 2020 2020 2066 6f72 206f 7074 696f         for optio
+0000f710: 6e20 696e 206c 616b 6573 5f74 6f6d 6c3a  n in lakes_toml:
+0000f720: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f730: 662e 7365 745f 636f 6e66 6967 286f 7074  f.set_config(opt
+0000f740: 696f 6e2c 206c 616b 6573 5f74 6f6d 6c5b  ion, lakes_toml[
+0000f750: 6f70 7469 6f6e 5d29 0a0a 2020 2020 6465  option])..    de
+0000f760: 6620 7365 7475 705f 7265 7365 7276 6f69  f setup_reservoi
+0000f770: 7273 280a 2020 2020 2020 2020 7365 6c66  rs(.        self
+0000f780: 2c0a 2020 2020 2020 2020 7265 7365 7276  ,.        reserv
+0000f790: 6f69 7273 5f66 6e3a 2073 7472 2c0a 2020  oirs_fn: str,.  
+0000f7a0: 2020 2020 2020 7469 6d65 7365 7269 6573        timeseries
+0000f7b0: 5f66 6e3a 2073 7472 203d 204e 6f6e 652c  _fn: str = None,
+0000f7c0: 0a20 2020 2020 2020 206d 696e 5f61 7265  .        min_are
+0000f7d0: 613a 2066 6c6f 6174 203d 2031 2e30 2c0a  a: float = 1.0,.
+0000f7e0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+0000f7f0: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+0000f800: 2022 2222 5468 6973 2063 6f6d 706f 6e65   """This compone
+0000f810: 6e74 2067 656e 6572 6174 6573 206d 6170  nt generates map
+0000f820: 7320 6f66 2072 6573 6572 766f 6972 2061  s of reservoir a
+0000f830: 7265 6173 2061 6e64 206f 7574 6c65 7473  reas and outlets
+0000f840: 2061 7320 7765 6c6c 2061 7320 7061 7261   as well as para
+0000f850: 6d65 7465 7273 0a20 2020 2020 2020 2077  meters.        w
+0000f860: 6974 6820 6176 6572 6167 6520 7265 7365  ith average rese
+0000f870: 7276 6f69 7220 6172 6561 2c20 6465 6d61  rvoir area, dema
+0000f880: 6e64 2c20 6d69 6e20 616e 6420 6d61 7820  nd, min and max 
+0000f890: 7461 7267 6574 2073 746f 7261 6765 2063  target storage c
+0000f8a0: 6170 6163 6974 6965 7320 616e 640a 2020  apacities and.  
+0000f8b0: 2020 2020 2020 6469 7363 6861 7267 6520        discharge 
+0000f8c0: 6361 7061 6369 7479 2076 616c 7565 732e  capacity values.
+0000f8d0: 0a0a 2020 2020 2020 2020 5468 6520 6461  ..        The da
+0000f8e0: 7461 2069 7320 6765 6e65 7261 7465 6420  ta is generated 
+0000f8f0: 6672 6f6d 2066 6561 7475 7265 7320 7769  from features wi
+0000f900: 7468 2060 606d 696e 5f61 7265 6160 6020  th ``min_area`` 
+0000f910: 5b6b 6d32 5d20 2864 6566 6175 6c74 2069  [km2] (default i
+0000f920: 7320 3120 6b6d 3229 0a20 2020 2020 2020  s 1 km2).       
+0000f930: 2066 726f 6d20 6120 6461 7461 6261 7365   from a database
+0000f940: 2077 6974 6820 7265 7365 7276 6f69 7220   with reservoir 
+0000f950: 6765 6f6d 6574 7279 2c20 4944 7320 616e  geometry, IDs an
+0000f960: 6420 6d65 7461 6461 7461 2e0a 0a20 2020  d metadata...   
+0000f970: 2020 2020 2044 6174 6120 7265 7175 6972       Data requir
+0000f980: 656d 656e 7473 2066 6f72 2064 6972 6563  ements for direc
+0000f990: 7420 7573 6520 2869 6520 7766 6c6f 7720  t use (ie wflow 
+0000f9a0: 7061 7261 6d65 7465 7273 2061 7265 2064  parameters are d
+0000f9b0: 6174 6120 616c 7265 6164 7920 7072 6573  ata already pres
+0000f9c0: 656e 7420 696e 2072 6573 6572 766f 6972  ent in reservoir
+0000f9d0: 735f 666e 290a 2020 2020 2020 2020 6172  s_fn).        ar
+0000f9e0: 6520 7265 7365 7276 6f69 7220 4944 2027  e reservoir ID '
+0000f9f0: 7761 7465 7262 6f64 795f 6964 272c 2061  waterbody_id', a
+0000fa00: 7265 6120 2752 6573 5369 6d70 6c65 4172  rea 'ResSimpleAr
+0000fa10: 6561 2720 5b6d 325d 2c20 6d61 7869 6d75  ea' [m2], maximu
+0000fa20: 6d20 766f 6c75 6d65 2027 5265 734d 6178  m volume 'ResMax
+0000fa30: 566f 6c75 6d65 2720 5b6d 335d 2c0a 2020  Volume' [m3],.  
+0000fa40: 2020 2020 2020 7468 6520 7461 7267 6574        the target
+0000fa50: 6564 206d 696e 696d 756d 2061 6e64 206d  ed minimum and m
+0000fa60: 6178 696d 756d 2066 7261 6374 696f 6e20  aximum fraction 
+0000fa70: 6f66 2077 6174 6572 2076 6f6c 756d 6520  of water volume 
+0000fa80: 696e 2074 6865 2072 6573 6572 766f 6972  in the reservoir
+0000fa90: 2027 5265 7354 6172 6765 744d 696e 4672   'ResTargetMinFr
+0000faa0: 6163 270a 2020 2020 2020 2020 616e 6420  ac'.        and 
+0000fab0: 2752 6573 5461 7267 6574 4d61 7846 7261  'ResTargetMaxFra
+0000fac0: 6327 205b 2d5d 2c20 7468 6520 6176 6572  c' [-], the aver
+0000fad0: 6167 6520 7761 7465 7220 6465 6d61 6e64  age water demand
+0000fae0: 2052 6573 4465 6d61 6e64 205b 6d33 2f73   ResDemand [m3/s
+0000faf0: 5d20 616e 6420 7468 6520 6d61 7869 6d75  ] and the maximu
+0000fb00: 6d20 7265 6c65 6173 6520 6f66 0a20 2020  m release of.   
+0000fb10: 2020 2020 2074 6865 2072 6573 6572 766f       the reservo
+0000fb20: 6972 2062 6566 6f72 6520 7370 696c 6c69  ir before spilli
+0000fb30: 6e67 2027 5265 734d 6178 5265 6c65 6173  ng 'ResMaxReleas
+0000fb40: 6527 205b 6d33 2f73 5d2e 0a0a 2020 2020  e' [m3/s]...    
+0000fb50: 2020 2020 496e 2063 6173 6520 7468 6520      In case the 
+0000fb60: 7766 6c6f 7720 7061 7261 6d65 7465 7273  wflow parameters
+0000fb70: 2061 7265 206e 6f74 2064 6972 6563 746c   are not directl
+0000fb80: 7920 6176 6169 6c61 626c 6520 7468 6579  y available they
+0000fb90: 2063 616e 2062 6520 636f 6d70 7574 6564   can be computed
+0000fba0: 2062 7920 4879 6472 6f4d 5420 6261 7365   by HydroMT base
+0000fbb0: 6420 6f6e 2074 696d 6520 7365 7269 6573  d on time series
+0000fbc0: 206f 6620 7265 7365 7276 6f69 7220 7375   of reservoir su
+0000fbd0: 7266 6163 6520 7761 7465 7220 6172 6561  rface water area
+0000fbe0: 2e0a 2020 2020 2020 2020 5468 6573 6520  ..        These 
+0000fbf0: 7469 6d65 2073 6572 6965 7320 6361 6e20  time series can 
+0000fc00: 6265 2072 6574 7265 6976 6564 2066 726f  be retreived fro
+0000fc10: 6d20 6569 7468 6572 2074 6865 2068 7964  m either the hyd
+0000fc20: 726f 656e 6769 6e65 206f 7220 7468 6520  roengine or the 
+0000fc30: 6777 7761 7069 2c20 6261 7365 6420 6f6e  gwwapi, based on
+0000fc40: 2074 6865 2048 796c 616b 5f69 6420 7468   the Hylak_id th
+0000fc50: 6520 7265 7365 7276 6f69 722c 2066 6f75  e reservoir, fou
+0000fc60: 6e64 2069 6e20 7468 6520 4772 616e 6444  nd in the GrandD
+0000fc70: 2064 6174 6162 6173 652e 0a0a 2020 2020   database...    
+0000fc80: 2020 2020 5468 6520 7265 7175 6972 6564      The required
+0000fc90: 2076 6172 6961 626c 6573 2066 6f72 2063   variables for c
+0000fca0: 6f6d 7075 7461 7469 6f6e 206f 6620 7468  omputation of th
+0000fcb0: 6520 7061 7261 6d65 7465 7273 2077 6974  e parameters wit
+0000fcc0: 6820 7469 6d65 2073 6572 6965 7320 6461  h time series da
+0000fcd0: 7461 2061 7265 2072 6573 6572 766f 6972  ta are reservoir
+0000fce0: 2049 4420 2777 6174 6572 626f 6479 5f69   ID 'waterbody_i
+0000fcf0: 6427 2c0a 2020 2020 2020 2020 7265 7365  d',.        rese
+0000fd00: 7276 6f69 7220 4944 2069 6e20 7468 6520  rvoir ID in the 
+0000fd10: 4879 6472 6f4c 414b 4553 2064 6174 6162  HydroLAKES datab
+0000fd20: 6173 6520 2748 796c 616b 5f69 6427 2c20  ase 'Hylak_id', 
+0000fd30: 6176 6572 6167 6520 766f 6c75 6d65 2027  average volume '
+0000fd40: 566f 6c5f 6176 6727 205b 6d33 5d2c 2061  Vol_avg' [m3], a
+0000fd50: 7665 7261 6765 2064 6570 7468 2027 4465  verage depth 'De
+0000fd60: 7074 685f 6176 6727 0a20 2020 2020 2020  pth_avg'.       
+0000fd70: 205b 6d5d 2c20 6176 6572 6167 6520 6469   [m], average di
+0000fd80: 7363 6861 7267 6520 2744 6973 5f61 7667  scharge 'Dis_avg
+0000fd90: 2720 5b6d 332f 735d 2061 6e64 2064 616d  ' [m3/s] and dam
+0000fda0: 2068 6569 6768 7420 2744 616d 5f68 6569   height 'Dam_hei
+0000fdb0: 6768 7427 205b 6d5d 2e0a 2020 2020 2020  ght' [m]..      
+0000fdc0: 2020 546f 2063 6f6d 7075 7465 2070 6172    To compute par
+0000fdd0: 616d 6574 6572 7320 7769 7468 6f75 7420  ameters without 
+0000fde0: 7573 696e 6720 7469 6d65 2073 6572 6965  using time serie
+0000fdf0: 7320 6461 7461 2c20 7468 6520 7265 7175  s data, the requ
+0000fe00: 6972 6564 2076 6172 6962 616c 6573 2069  ired varibales i
+0000fe10: 6e20 7265 7365 7276 6f69 7273 5f66 6e20  n reservoirs_fn 
+0000fe20: 6172 6520 7265 7365 7276 6f69 7220 4944  are reservoir ID
+0000fe30: 2027 7761 7465 7262 6f64 795f 6964 272c   'waterbody_id',
+0000fe40: 0a20 2020 2020 2020 2061 7665 7261 6765  .        average
+0000fe50: 2061 7265 6120 2741 7265 615f 6176 6727   area 'Area_avg'
+0000fe60: 205b 6d32 5d2c 2061 7665 7261 6765 2076   [m2], average v
+0000fe70: 6f6c 756d 6520 2756 6f6c 5f61 7667 2720  olume 'Vol_avg' 
+0000fe80: 5b6d 335d 2c20 6176 6572 6167 6520 6465  [m3], average de
+0000fe90: 7074 6820 2744 6570 7468 5f61 7667 2720  pth 'Depth_avg' 
+0000fea0: 5b6d 5d2c 2061 7665 7261 6765 2064 6973  [m], average dis
+0000feb0: 6368 6172 6765 2027 4469 735f 6176 6727  charge 'Dis_avg'
+0000fec0: 0a20 2020 2020 2020 205b 6d33 2f73 5d20  .        [m3/s] 
+0000fed0: 616e 6420 6461 6d20 6865 6967 6874 2027  and dam height '
+0000fee0: 4461 6d5f 6865 6967 6874 2720 5b6d 5d20  Dam_height' [m] 
+0000fef0: 616e 6420 6d69 6e69 6d75 6d20 2f20 6e6f  and minimum / no
+0000ff00: 726d 616c 202f 206d 6178 696d 756d 2073  rmal / maximum s
+0000ff10: 746f 7261 6765 2063 6170 6163 6974 7920  torage capacity 
+0000ff20: 6f66 2074 6865 2064 616d 2027 4361 7061  of the dam 'Capa
+0000ff30: 6369 7479 5f6d 696e 272c 0a20 2020 2020  city_min',.     
+0000ff40: 2020 2027 4361 7061 6369 7479 5f6e 6f72     'Capacity_nor
+0000ff50: 6d27 2c20 2743 6170 6163 6974 795f 6d61  m', 'Capacity_ma
+0000ff60: 7827 205b 6d33 5d2e 0a0a 2020 2020 2020  x' [m3]...      
+0000ff70: 2020 4164 6473 206d 6f64 656c 206c 6179    Adds model lay
+0000ff80: 6572 733a 0a0a 2020 2020 2020 2020 2a20  ers:..        * 
+0000ff90: 2a2a 7766 6c6f 775f 7265 7365 7276 6f69  **wflow_reservoi
+0000ffa0: 7261 7265 6173 2a2a 206d 6170 3a20 7265  rareas** map: re
+0000ffb0: 7365 7276 6f69 7220 4944 7320 5b2d 5d0a  servoir IDs [-].
+0000ffc0: 2020 2020 2020 2020 2a20 2a2a 7766 6c6f          * **wflo
+0000ffd0: 775f 7265 7365 7276 6f69 726c 6f63 732a  w_reservoirlocs*
+0000ffe0: 2a20 6d61 703a 2072 6573 6572 766f 6972  * map: reservoir
+0000fff0: 2049 4473 2061 7420 6f75 746c 6574 206c   IDs at outlet l
+00010000: 6f63 6174 696f 6e73 205b 2d5d 0a20 2020  ocations [-].   
+00010010: 2020 2020 202a 202a 2a52 6573 5369 6d70       * **ResSimp
+00010020: 6c65 4172 6561 2a2a 206d 6170 3a20 7265  leArea** map: re
+00010030: 7365 7276 6f69 7220 6172 6561 205b 6d32  servoir area [m2
+00010040: 5d0a 2020 2020 2020 2020 2a20 2a2a 5265  ].        * **Re
+00010050: 734d 6178 566f 6c75 6d65 2a2a 206d 6170  sMaxVolume** map
+00010060: 3a20 7265 7365 7276 6f69 7220 6d61 7820  : reservoir max 
+00010070: 766f 6c75 6d65 205b 6d33 5d0a 2020 2020  volume [m3].    
+00010080: 2020 2020 2a20 2a2a 5265 7354 6172 6765      * **ResTarge
+00010090: 744d 696e 4672 6163 2a2a 206d 6170 3a20  tMinFrac** map: 
+000100a0: 7265 7365 7276 6f69 7220 7461 7267 6574  reservoir target
+000100b0: 206d 696e 2066 7261 6320 5b6d 332f 6d33   min frac [m3/m3
+000100c0: 5d0a 2020 2020 2020 2020 2a20 2a2a 5265  ].        * **Re
+000100d0: 7354 6172 6765 7446 756c 6c46 7261 632a  sTargetFullFrac*
+000100e0: 2a20 6d61 703a 2072 6573 6572 766f 6972  * map: reservoir
+000100f0: 2074 6172 6765 7420 6675 6c6c 2066 7261   target full fra
+00010100: 6320 5b6d 332f 6d33 5d0a 2020 2020 2020  c [m3/m3].      
+00010110: 2020 2a20 2a2a 5265 7344 656d 616e 642a    * **ResDemand*
+00010120: 2a20 6d61 703a 2072 6573 6572 766f 6972  * map: reservoir
+00010130: 2064 656d 616e 6420 666c 6f77 205b 6d33   demand flow [m3
+00010140: 2f73 5d0a 2020 2020 2020 2020 2a20 2a2a  /s].        * **
+00010150: 5265 734d 6178 5265 6c65 6173 652a 2a20  ResMaxRelease** 
+00010160: 6d61 703a 2072 6573 6572 766f 6972 206d  map: reservoir m
+00010170: 6178 2072 656c 6561 7365 2066 6c6f 7720  ax release flow 
+00010180: 5b6d 332f 735d 0a20 2020 2020 2020 202a  [m3/s].        *
+00010190: 202a 2a72 6573 6572 766f 6972 732a 2a20   **reservoirs** 
+000101a0: 6765 6f6d 3a20 706f 6c79 676f 6e20 7769  geom: polygon wi
+000101b0: 7468 2072 6573 6572 766f 6972 7320 616e  th reservoirs an
+000101c0: 6420 7766 6c6f 7720 7265 7365 7276 6f69  d wflow reservoi
+000101d0: 7220 7061 7261 6d65 7465 7273 0a0a 2020  r parameters..  
+000101e0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+000101f0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00010200: 2d2d 2d0a 2020 2020 2020 2020 7265 7365  ---.        rese
+00010210: 7276 6f69 7273 5f66 6e20 3a20 7374 720a  rvoirs_fn : str.
+00010220: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
+00010230: 206f 6620 6461 7461 2073 6f75 7263 6520   of data source 
+00010240: 666f 7220 7265 7365 7276 6f69 7220 7061  for reservoir pa
+00010250: 7261 6d65 7465 7273 2c20 7365 6520 6461  rameters, see da
+00010260: 7461 2f64 6174 615f 736f 7572 6365 732e  ta/data_sources.
+00010270: 796d 6c2e 0a0a 2020 2020 2020 2020 2020  yml...          
+00010280: 2020 2a20 5265 7175 6972 6564 2076 6172    * Required var
+00010290: 6961 626c 6573 2066 6f72 2064 6972 6563  iables for direc
+000102a0: 7420 7573 653a 205b 2777 6174 6572 626f  t use: ['waterbo
+000102b0: 6479 5f69 6427 2c20 2752 6573 5369 6d70  dy_id', 'ResSimp
+000102c0: 6c65 4172 6561 272c 2027 5265 734d 6178  leArea', 'ResMax
+000102d0: 566f 6c75 6d65 272c 2027 5265 7354 6172  Volume', 'ResTar
+000102e0: 6765 744d 696e 4672 6163 272c 2027 5265  getMinFrac', 'Re
+000102f0: 7354 6172 6765 7446 756c 6c46 7261 6327  sTargetFullFrac'
+00010300: 2c20 2752 6573 4465 6d61 6e64 272c 2027  , 'ResDemand', '
+00010310: 5265 734d 6178 5265 6c65 6173 6527 5d0a  ResMaxRelease'].
+00010320: 0a20 2020 2020 2020 2020 2020 202a 2052  .            * R
+00010330: 6571 7569 7265 6420 7661 7269 6162 6c65  equired variable
+00010340: 7320 666f 7220 636f 6d70 7574 6174 696f  s for computatio
+00010350: 6e20 7769 7468 2074 696d 6573 6572 6965  n with timeserie
+00010360: 735f 666e 3a20 5b27 7761 7465 7262 6f64  s_fn: ['waterbod
+00010370: 795f 6964 272c 2027 4879 6c61 6b5f 6964  y_id', 'Hylak_id
+00010380: 272c 2027 566f 6c5f 6176 6727 2c20 2744  ', 'Vol_avg', 'D
+00010390: 6570 7468 5f61 7667 272c 2027 4469 735f  epth_avg', 'Dis_
+000103a0: 6176 6727 2c20 2744 616d 5f68 6569 6768  avg', 'Dam_heigh
+000103b0: 7427 5d0a 0a20 2020 2020 2020 2020 2020  t']..           
+000103c0: 202a 2052 6571 7569 7265 6420 7661 7269   * Required vari
+000103d0: 6162 6c65 7320 666f 7220 636f 6d70 7574  ables for comput
+000103e0: 6174 696f 6e20 7769 7468 6f75 7420 7469  ation without ti
+000103f0: 6d65 7365 7269 6573 5f66 6e3a 205b 2777  meseries_fn: ['w
+00010400: 6174 6572 626f 6479 5f69 6427 2c20 2741  aterbody_id', 'A
+00010410: 7265 615f 6176 6727 2c20 2756 6f6c 5f61  rea_avg', 'Vol_a
+00010420: 7667 272c 2027 4465 7074 685f 6176 6727  vg', 'Depth_avg'
+00010430: 2c20 2744 6973 5f61 7667 272c 2027 4361  , 'Dis_avg', 'Ca
+00010440: 7061 6369 7479 5f6d 6178 272c 2027 4361  pacity_max', 'Ca
+00010450: 7061 6369 7479 5f6e 6f72 6d27 2c20 2743  pacity_norm', 'C
+00010460: 6170 6163 6974 795f 6d69 6e27 2c20 2744  apacity_min', 'D
+00010470: 616d 5f68 6569 6768 7427 5d0a 2020 2020  am_height'].    
+00010480: 2020 2020 7469 6d65 7365 7269 6573 5f66      timeseries_f
+00010490: 6e20 3a20 7374 7220 7b27 6777 7727 2c20  n : str {'gww', 
+000104a0: 2768 7964 726f 656e 6769 6e65 272c 2027  'hydroengine', '
+000104b0: 6e6f 6e65 277d 2c20 6f70 7469 6f6e 616c  none'}, optional
+000104c0: 0a20 2020 2020 2020 2020 2020 2044 6f77  .            Dow
+000104d0: 6e6c 6f61 6420 616e 6420 7573 6520 7469  nload and use ti
+000104e0: 6d65 2073 6572 6965 7320 6f66 2072 6573  me series of res
+000104f0: 6572 766f 6972 2073 7572 6661 6365 2077  ervoir surface w
+00010500: 6174 6572 2061 7265 6120 746f 2063 616c  ater area to cal
+00010510: 6375 6c61 7465 2061 6e64 206f 7665 7277  culate and overw
+00010520: 7269 7465 2074 6865 2072 6573 6572 766f  rite the reservo
+00010530: 6972 2076 6f6c 756d 652f 6172 6561 7320  ir volume/areas 
+00010540: 6f66 2074 6865 2064 6174 6120 736f 7572  of the data sour
+00010550: 6365 2e20 5469 6d65 7365 7269 6573 2061  ce. Timeseries a
+00010560: 7265 0a20 2020 2020 2020 2020 2020 2065  re.            e
+00010570: 6974 6865 7220 646f 776e 6c6f 6164 6564  ither downloaded
+00010580: 2066 726f 6d20 476c 6f62 616c 2057 6174   from Global Wat
+00010590: 6572 2057 6174 6368 2027 6777 7727 2028  er Watch 'gww' (
+000105a0: 7573 696e 6720 6777 7761 7069 2070 6163  using gwwapi pac
+000105b0: 6b61 6765 2920 6f72 204a 5243 2027 6a72  kage) or JRC 'jr
+000105c0: 6327 2028 7573 696e 6720 6879 6472 6f65  c' (using hydroe
+000105d0: 6e67 696e 6520 7061 636b 6167 6529 2e20  ngine package). 
+000105e0: 4279 2064 6566 6175 6c74 204e 6f6e 652e  By default None.
+000105f0: 0a20 2020 2020 2020 206d 696e 5f61 7265  .        min_are
+00010600: 6120 3a20 666c 6f61 742c 206f 7074 696f  a : float, optio
+00010610: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00010620: 4d69 6e69 6d75 6d20 7265 7365 7276 6f69  Minimum reservoi
+00010630: 7220 6172 6561 2074 6872 6573 686f 6c64  r area threshold
+00010640: 205b 6b6d 325d 2c20 6279 2064 6566 6175   [km2], by defau
+00010650: 6c74 2031 2e30 206b 6d32 2e0a 0a20 2020  lt 1.0 km2...   
+00010660: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00010670: 2023 2072 656e 616d 6520 746f 2077 666c   # rename to wfl
+00010680: 6f77 206e 616d 696e 6720 636f 6e76 656e  ow naming conven
+00010690: 7469 6f6e 0a20 2020 2020 2020 2074 626c  tion.        tbl
+000106a0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+000106b0: 2020 2272 6573 6172 6561 223a 2022 5265    "resarea": "Re
+000106c0: 7353 696d 706c 6541 7265 6122 2c0a 2020  sSimpleArea",.  
+000106d0: 2020 2020 2020 2020 2020 2272 6573 6465            "resde
+000106e0: 6d61 6e64 223a 2022 5265 7344 656d 616e  mand": "ResDeman
+000106f0: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
+00010700: 2272 6573 6675 6c6c 6672 6163 223a 2022  "resfullfrac": "
+00010710: 5265 7354 6172 6765 7446 756c 6c46 7261  ResTargetFullFra
+00010720: 6322 2c0a 2020 2020 2020 2020 2020 2020  c",.            
+00010730: 2272 6573 6d69 6e66 7261 6322 3a20 2252  "resminfrac": "R
+00010740: 6573 5461 7267 6574 4d69 6e46 7261 6322  esTargetMinFrac"
+00010750: 2c0a 2020 2020 2020 2020 2020 2020 2272  ,.            "r
+00010760: 6573 6d61 7872 656c 6561 7365 223a 2022  esmaxrelease": "
+00010770: 5265 734d 6178 5265 6c65 6173 6522 2c0a  ResMaxRelease",.
+00010780: 2020 2020 2020 2020 2020 2020 2272 6573              "res
+00010790: 6d61 7876 6f6c 756d 6522 3a20 2252 6573  maxvolume": "Res
+000107a0: 4d61 7856 6f6c 756d 6522 2c0a 2020 2020  MaxVolume",.    
+000107b0: 2020 2020 2020 2020 2272 6573 6964 223a          "resid":
+000107c0: 2022 6578 7072 3122 2c0a 2020 2020 2020   "expr1",.      
+000107d0: 2020 7d0a 0a20 2020 2020 2020 2072 6573    }..        res
+000107e0: 5f74 6f6d 6c20 3d20 7b0a 2020 2020 2020  _toml = {.      
+000107f0: 2020 2020 2020 226d 6f64 656c 2e72 6573        "model.res
+00010800: 6572 766f 6972 7322 3a20 5472 7565 2c0a  ervoirs": True,.
+00010810: 2020 2020 2020 2020 2020 2020 2273 7461              "sta
+00010820: 7465 2e6c 6174 6572 616c 2e72 6976 6572  te.lateral.river
+00010830: 2e72 6573 6572 766f 6972 2e76 6f6c 756d  .reservoir.volum
+00010840: 6522 3a20 2276 6f6c 756d 655f 7265 7365  e": "volume_rese
+00010850: 7276 6f69 7222 2c0a 2020 2020 2020 2020  rvoir",.        
+00010860: 2020 2020 2269 6e70 7574 2e6c 6174 6572      "input.later
+00010870: 616c 2e72 6976 6572 2e72 6573 6572 766f  al.river.reservo
+00010880: 6972 2e61 7265 6122 3a20 2252 6573 5369  ir.area": "ResSi
+00010890: 6d70 6c65 4172 6561 222c 0a20 2020 2020  mpleArea",.     
+000108a0: 2020 2020 2020 2022 696e 7075 742e 6c61         "input.la
+000108b0: 7465 7261 6c2e 7269 7665 722e 7265 7365  teral.river.rese
+000108c0: 7276 6f69 722e 6172 6561 7322 3a20 2277  rvoir.areas": "w
+000108d0: 666c 6f77 5f72 6573 6572 766f 6972 6172  flow_reservoirar
+000108e0: 6561 7322 2c0a 2020 2020 2020 2020 2020  eas",.          
+000108f0: 2020 2269 6e70 7574 2e6c 6174 6572 616c    "input.lateral
+00010900: 2e72 6976 6572 2e72 6573 6572 766f 6972  .river.reservoir
+00010910: 2e64 656d 616e 6422 3a20 2252 6573 4465  .demand": "ResDe
+00010920: 6d61 6e64 222c 0a20 2020 2020 2020 2020  mand",.         
+00010930: 2020 2022 696e 7075 742e 6c61 7465 7261     "input.latera
+00010940: 6c2e 7269 7665 722e 7265 7365 7276 6f69  l.river.reservoi
+00010950: 722e 6c6f 6373 223a 2022 7766 6c6f 775f  r.locs": "wflow_
+00010960: 7265 7365 7276 6f69 726c 6f63 7322 2c0a  reservoirlocs",.
+00010970: 2020 2020 2020 2020 2020 2020 2269 6e70              "inp
+00010980: 7574 2e6c 6174 6572 616c 2e72 6976 6572  ut.lateral.river
+00010990: 2e72 6573 6572 766f 6972 2e6d 6178 7265  .reservoir.maxre
+000109a0: 6c65 6173 6522 3a20 2252 6573 4d61 7852  lease": "ResMaxR
+000109b0: 656c 6561 7365 222c 0a20 2020 2020 2020  elease",.       
+000109c0: 2020 2020 2022 696e 7075 742e 6c61 7465       "input.late
+000109d0: 7261 6c2e 7269 7665 722e 7265 7365 7276  ral.river.reserv
+000109e0: 6f69 722e 6d61 7876 6f6c 756d 6522 3a20  oir.maxvolume": 
+000109f0: 2252 6573 4d61 7856 6f6c 756d 6522 2c0a  "ResMaxVolume",.
+00010a00: 2020 2020 2020 2020 2020 2020 2269 6e70              "inp
+00010a10: 7574 2e6c 6174 6572 616c 2e72 6976 6572  ut.lateral.river
+00010a20: 2e72 6573 6572 766f 6972 2e74 6172 6765  .reservoir.targe
+00010a30: 7466 756c 6c66 7261 6322 3a20 2252 6573  tfullfrac": "Res
+00010a40: 5461 7267 6574 4675 6c6c 4672 6163 222c  TargetFullFrac",
+00010a50: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
+00010a60: 7075 742e 6c61 7465 7261 6c2e 7269 7665  put.lateral.rive
+00010a70: 722e 7265 7365 7276 6f69 722e 7461 7267  r.reservoir.targ
+00010a80: 6574 6d69 6e66 7261 6322 3a20 2252 6573  etminfrac": "Res
+00010a90: 5461 7267 6574 4d69 6e46 7261 6322 2c0a  TargetMinFrac",.
+00010aa0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+00010ab0: 2020 2067 6466 5f6f 7267 2c20 6473 5f72     gdf_org, ds_r
+00010ac0: 6573 203d 2073 656c 662e 5f73 6574 7570  es = self._setup
+00010ad0: 5f77 6174 6572 626f 6469 6573 2872 6573  _waterbodies(res
+00010ae0: 6572 766f 6972 735f 666e 2c20 2272 6573  ervoirs_fn, "res
+00010af0: 6572 766f 6972 222c 206d 696e 5f61 7265  ervoir", min_are
+00010b00: 6129 0a20 2020 2020 2020 2023 2054 4f44  a).        # TOD
+00010b10: 4f3a 2063 6865 636b 2069 6620 7468 6572  O: check if ther
+00010b20: 6520 6172 6520 6d69 7373 696e 6720 7661  e are missing va
+00010b30: 6c75 6573 2069 6e20 7468 6520 6162 6f76  lues in the abov
+00010b40: 6520 636f 6c75 6d6e 7320 6f66 2074 6865  e columns of the
+00010b50: 2070 6172 616d 6574 6572 7320 7462 6c73   parameters tbls
+00010b60: 203d 0a20 2020 2020 2020 2023 2069 6620   =.        # if 
+00010b70: 6576 6572 7974 6869 6e67 2069 7320 7072  everything is pr
+00010b80: 6573 656e 742c 2073 6b69 7020 6361 6c63  esent, skip calc
+00010b90: 756c 6174 6520 7265 7365 7276 6f69 7261  ulate reservoira
+00010ba0: 7474 7273 2829 2061 6e64 2064 6972 6563  ttrs() and direc
+00010bb0: 746c 7920 6d61 6b65 2074 6865 206d 6170  tly make the map
+00010bc0: 730a 2020 2020 2020 2020 6966 2064 735f  s.        if ds_
+00010bd0: 7265 7320 6973 206e 6f74 204e 6f6e 653a  res is not None:
+00010be0: 0a20 2020 2020 2020 2020 2020 2072 6d64  .            rmd
+00010bf0: 6963 7420 3d20 7b6b 3a20 7620 666f 7220  ict = {k: v for 
+00010c00: 6b2c 2076 2069 6e20 7365 6c66 2e5f 4d41  k, v in self._MA
+00010c10: 5053 2e69 7465 6d73 2829 2069 6620 6b20  PS.items() if k 
+00010c20: 696e 2064 735f 7265 732e 6461 7461 5f76  in ds_res.data_v
+00010c30: 6172 737d 0a20 2020 2020 2020 2020 2020  ars}.           
+00010c40: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
+00010c50: 6d61 7073 2864 735f 7265 732e 7265 6e61  maps(ds_res.rena
+00010c60: 6d65 2872 6d64 6963 7429 290a 0a20 2020  me(rmdict))..   
+00010c70: 2020 2020 2020 2020 2023 2061 6464 2061           # add a
+00010c80: 7474 7269 6275 7465 730a 2020 2020 2020  ttributes.      
+00010c90: 2020 2020 2020 2320 6966 2070 7265 7365        # if prese
+00010ca0: 6e74 2075 7365 2064 6972 6563 746c 790a  nt use directly.
+00010cb0: 2020 2020 2020 2020 2020 2020 7265 7361              resa
+00010cc0: 7474 7269 6275 7465 7320 3d20 5b0a 2020  ttributes = [.  
+00010cd0: 2020 2020 2020 2020 2020 2020 2020 2277                "w
+00010ce0: 6174 6572 626f 6479 5f69 6422 2c0a 2020  aterbody_id",.  
+00010cf0: 2020 2020 2020 2020 2020 2020 2020 2252                "R
+00010d00: 6573 5369 6d70 6c65 4172 6561 222c 0a20  esSimpleArea",. 
+00010d10: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00010d20: 5265 734d 6178 566f 6c75 6d65 222c 0a20  ResMaxVolume",. 
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00010d40: 5265 7354 6172 6765 744d 696e 4672 6163  ResTargetMinFrac
+00010d50: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00010d60: 2020 2022 5265 7354 6172 6765 7446 756c     "ResTargetFul
+00010d70: 6c46 7261 6322 2c0a 2020 2020 2020 2020  lFrac",.        
+00010d80: 2020 2020 2020 2020 2252 6573 4465 6d61          "ResDema
+00010d90: 6e64 222c 0a20 2020 2020 2020 2020 2020  nd",.           
+00010da0: 2020 2020 2022 5265 734d 6178 5265 6c65       "ResMaxRele
+00010db0: 6173 6522 2c0a 2020 2020 2020 2020 2020  ase",.          
+00010dc0: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
+00010dd0: 6966 206e 702e 616c 6c28 6e70 2e69 7369  if np.all(np.isi
+00010de0: 6e28 7265 7361 7474 7269 6275 7465 732c  n(resattributes,
+00010df0: 2067 6466 5f6f 7267 2e63 6f6c 756d 6e73   gdf_org.columns
+00010e00: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00010e10: 2020 2020 696e 7462 6c5f 7265 7365 7276      intbl_reserv
+00010e20: 6f69 7273 203d 2067 6466 5f6f 7267 5b72  oirs = gdf_org[r
+00010e30: 6573 6174 7472 6962 7574 6573 5d0a 2020  esattributes].  
+00010e40: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00010e50: 7365 7276 6f69 725f 6163 6375 7261 6379  servoir_accuracy
+00010e60: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00010e70: 2020 2020 2020 2020 7265 7365 7276 6f69          reservoi
+00010e80: 725f 7469 6d65 7365 7269 6573 203d 204e  r_timeseries = N
+00010e90: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00010ea0: 2320 656c 7365 2063 6f6d 7075 7465 0a20  # else compute. 
+00010eb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00010ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010ed0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00010ee0: 2020 2020 2020 2069 6e74 626c 5f72 6573         intbl_res
+00010ef0: 6572 766f 6972 732c 0a20 2020 2020 2020  ervoirs,.       
+00010f00: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00010f10: 6572 766f 6972 5f61 6363 7572 6163 792c  ervoir_accuracy,
+00010f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010f30: 2020 2020 2072 6573 6572 766f 6972 5f74       reservoir_t
+00010f40: 696d 6573 6572 6965 732c 0a20 2020 2020  imeseries,.     
+00010f50: 2020 2020 2020 2020 2020 2029 203d 2077             ) = w
+00010f60: 6f72 6b66 6c6f 7773 2e72 6573 6572 766f  orkflows.reservo
+00010f70: 6972 6174 7472 7328 0a20 2020 2020 2020  irattrs(.       
+00010f80: 2020 2020 2020 2020 2020 2020 2067 6466               gdf
+00010f90: 3d67 6466 5f6f 7267 2c20 7469 6d65 7365  =gdf_org, timese
+00010fa0: 7269 6573 5f66 6e3d 7469 6d65 7365 7269  ries_fn=timeseri
+00010fb0: 6573 5f66 6e2c 206c 6f67 6765 723d 7365  es_fn, logger=se
+00010fc0: 6c66 2e6c 6f67 6765 720a 2020 2020 2020  lf.logger.      
+00010fd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00010fe0: 2020 2020 2020 2020 2020 2020 696e 7462              intb
+00010ff0: 6c5f 7265 7365 7276 6f69 7273 203d 2069  l_reservoirs = i
+00011000: 6e74 626c 5f72 6573 6572 766f 6972 732e  ntbl_reservoirs.
+00011010: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d74  rename(columns=t
+00011020: 626c 7329 0a0a 2020 2020 2020 2020 2020  bls)..          
+00011030: 2020 2320 6372 6561 7465 2061 2067 656f    # create a geo
+00011040: 6466 2077 6974 6820 6964 206f 6620 7265  df with id of re
+00011050: 7365 7276 6f69 7220 616e 6420 6765 6d6f  servoir and gemo
+00011060: 6574 7279 2061 7420 6f75 7466 6c6f 7720  etry at outflow 
+00011070: 6c6f 6361 7469 6f6e 0a20 2020 2020 2020  location.       
+00011080: 2020 2020 2067 6466 5f6f 7267 5f70 6f69       gdf_org_poi
+00011090: 6e74 7320 3d20 6770 642e 4765 6f44 6174  nts = gpd.GeoDat
+000110a0: 6146 7261 6d65 280a 2020 2020 2020 2020  aFrame(.        
+000110b0: 2020 2020 2020 2020 6764 665f 6f72 675b          gdf_org[
+000110c0: 2277 6174 6572 626f 6479 5f69 6422 5d2c  "waterbody_id"],
+000110d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000110e0: 2067 656f 6d65 7472 793d 6770 642e 706f   geometry=gpd.po
+000110f0: 696e 7473 5f66 726f 6d5f 7879 2867 6466  ints_from_xy(gdf
+00011100: 5f6f 7267 2e78 6f75 742c 2067 6466 5f6f  _org.xout, gdf_o
+00011110: 7267 2e79 6f75 7429 2c0a 2020 2020 2020  rg.yout),.      
+00011120: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011130: 2020 2020 696e 7462 6c5f 7265 7365 7276      intbl_reserv
+00011140: 6f69 7273 203d 2069 6e74 626c 5f72 6573  oirs = intbl_res
+00011150: 6572 766f 6972 732e 7265 6e61 6d65 280a  ervoirs.rename(.
+00011160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011170: 636f 6c75 6d6e 733d 7b22 6578 7072 3122  columns={"expr1"
+00011180: 3a20 2277 6174 6572 626f 6479 5f69 6422  : "waterbody_id"
+00011190: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
+000111a0: 2020 2020 2020 2020 2020 2020 6764 665f              gdf_
+000111b0: 6f72 675f 706f 696e 7473 203d 2067 6466  org_points = gdf
+000111c0: 5f6f 7267 5f70 6f69 6e74 732e 6d65 7267  _org_points.merg
+000111d0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+000111e0: 2020 2069 6e74 626c 5f72 6573 6572 766f     intbl_reservo
+000111f0: 6972 732c 206f 6e3d 2277 6174 6572 626f  irs, on="waterbo
+00011200: 6479 5f69 6422 0a20 2020 2020 2020 2020  dy_id".         
+00011210: 2020 2029 2020 2320 6d65 7267 650a 2020     )  # merge.  
+00011220: 2020 2020 2020 2020 2020 2320 6164 6420            # add 
+00011230: 7061 7261 6d65 7465 7220 6174 7472 6962  parameter attrib
+00011240: 7574 6573 2074 6f20 706f 6c79 676f 6e65  utes to polygone
+00011250: 2067 6466 3a0a 2020 2020 2020 2020 2020   gdf:.          
+00011260: 2020 6764 665f 6f72 6720 3d20 6764 665f    gdf_org = gdf_
+00011270: 6f72 672e 6d65 7267 6528 696e 7462 6c5f  org.merge(intbl_
+00011280: 7265 7365 7276 6f69 7273 2c20 6f6e 3d22  reservoirs, on="
+00011290: 7761 7465 7262 6f64 795f 6964 2229 0a0a  waterbody_id")..
+000112a0: 2020 2020 2020 2020 2020 2020 2320 7772              # wr
+000112b0: 6974 6520 7265 7365 7276 6f69 7273 2077  ite reservoirs w
+000112c0: 6974 6820 7061 7261 6d20 7661 6c75 6573  ith param values
+000112d0: 2074 6f20 7374 6174 6963 6765 6f6d 730a   to staticgeoms.
+000112e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000112f0: 2e73 6574 5f73 7461 7469 6367 656f 6d73  .set_staticgeoms
+00011300: 2867 6466 5f6f 7267 2c20 6e61 6d65 3d22  (gdf_org, name="
+00011310: 7265 7365 7276 6f69 7273 2229 0a0a 2020  reservoirs")..  
+00011320: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
+00011330: 6d65 2069 6e20 6764 665f 6f72 675f 706f  me in gdf_org_po
+00011340: 696e 7473 2e63 6f6c 756d 6e73 5b32 3a5d  ints.columns[2:]
+00011350: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011360: 2020 6764 665f 6f72 675f 706f 696e 7473    gdf_org_points
+00011370: 5b6e 616d 655d 203d 2067 6466 5f6f 7267  [name] = gdf_org
+00011380: 5f70 6f69 6e74 735b 6e61 6d65 5d2e 6173  _points[name].as
+00011390: 7479 7065 2822 666c 6f61 7433 3222 290a  type("float32").
+000113a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113b0: 6461 5f72 6573 203d 2064 735f 7265 732e  da_res = ds_res.
+000113c0: 7261 7374 6572 2e72 6173 7465 7269 7a65  raster.rasterize
+000113d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000113e0: 2020 2020 2020 6764 665f 6f72 675f 706f        gdf_org_po
+000113f0: 696e 7473 2c20 636f 6c5f 6e61 6d65 3d6e  ints, col_name=n
+00011400: 616d 652c 2064 7479 7065 3d22 666c 6f61  ame, dtype="floa
+00011410: 7433 3222 2c20 6e6f 6461 7461 3d2d 3939  t32", nodata=-99
+00011420: 390a 2020 2020 2020 2020 2020 2020 2020  9.              
+00011430: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00011440: 2020 2020 7365 6c66 2e73 6574 5f73 7461      self.set_sta
+00011450: 7469 636d 6170 7328 6461 5f72 6573 290a  ticmaps(da_res).
+00011460: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00011470: 6176 6520 6163 6375 7261 6379 2069 6e66  ave accuracy inf
+00011480: 6f72 6d61 7469 6f6e 206f 6e20 7265 7365  ormation on rese
+00011490: 7276 6f69 7220 7061 7261 6d65 7465 7273  rvoir parameters
+000114a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000114b0: 7265 7365 7276 6f69 725f 6163 6375 7261  reservoir_accura
+000114c0: 6379 2069 7320 6e6f 7420 4e6f 6e65 3a0a  cy is not None:.
+000114d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114e0: 7265 7365 7276 6f69 725f 6163 6375 7261  reservoir_accura
+000114f0: 6379 2e74 6f5f 6373 7628 6a6f 696e 2873  cy.to_csv(join(s
+00011500: 656c 662e 726f 6f74 2c20 2272 6573 6572  elf.root, "reser
+00011510: 766f 6972 5f61 6363 7572 6163 792e 6373  voir_accuracy.cs
+00011520: 7622 2929 0a0a 2020 2020 2020 2020 2020  v"))..          
+00011530: 2020 6966 2072 6573 6572 766f 6972 5f74    if reservoir_t
+00011540: 696d 6573 6572 6965 7320 6973 206e 6f74  imeseries is not
+00011550: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00011560: 2020 2020 2020 2072 6573 6572 766f 6972         reservoir
+00011570: 5f74 696d 6573 6572 6965 732e 746f 5f63  _timeseries.to_c
+00011580: 7376 280a 2020 2020 2020 2020 2020 2020  sv(.            
+00011590: 2020 2020 2020 2020 6a6f 696e 2873 656c          join(sel
+000115a0: 662e 726f 6f74 2c20 6622 7265 7365 7276  f.root, f"reserv
+000115b0: 6f69 725f 7469 6d65 7365 7269 6573 5f7b  oir_timeseries_{
+000115c0: 7469 6d65 7365 7269 6573 5f66 6e7d 2e63  timeseries_fn}.c
+000115d0: 7376 2229 0a20 2020 2020 2020 2020 2020  sv").           
+000115e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+000115f0: 2020 2020 666f 7220 6f70 7469 6f6e 2069      for option i
+00011600: 6e20 7265 735f 746f 6d6c 3a0a 2020 2020  n res_toml:.    
+00011610: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011620: 2e73 6574 5f63 6f6e 6669 6728 6f70 7469  .set_config(opti
+00011630: 6f6e 2c20 7265 735f 746f 6d6c 5b6f 7074  on, res_toml[opt
+00011640: 696f 6e5d 290a 0a20 2020 2064 6566 205f  ion])..    def _
+00011650: 7365 7475 705f 7761 7465 7262 6f64 6965  setup_waterbodie
+00011660: 7328 7365 6c66 2c20 7761 7465 7262 6f64  s(self, waterbod
+00011670: 6965 735f 666e 2c20 7762 5f74 7970 652c  ies_fn, wb_type,
+00011680: 206d 696e 5f61 7265 613d 302e 3029 3a0a   min_area=0.0):.
+00011690: 2020 2020 2020 2020 2222 2248 656c 7065          """Helpe
+000116a0: 7220 6d65 7468 6f64 2077 6974 6820 7468  r method with th
+000116b0: 6520 636f 6d6d 6f6e 2077 6f72 6b66 6c6f  e common workflo
+000116c0: 7720 6f66 2073 6574 7570 5f6c 616b 6573  w of setup_lakes
+000116d0: 2061 6e64 2073 6574 7570 5f72 6573 6572   and setup_reser
+000116e0: 766f 6972 2e0a 2020 2020 2020 2020 5365  voir..        Se
+000116f0: 6520 7370 6563 6966 6963 206d 6574 686f  e specific metho
+00011700: 6473 2066 6f72 206d 6f72 6520 696e 666f  ds for more info
+00011710: 2061 626f 7574 2074 6865 2061 7267 756d   about the argum
+00011720: 656e 7473 2e22 2222 0a20 2020 2020 2020  ents.""".       
+00011730: 2023 2072 6574 7269 6576 6520 6461 7461   # retrieve data
+00011740: 2066 6f72 2062 6173 696e 0a20 2020 2020   for basin.     
+00011750: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
+00011760: 6e66 6f28 6622 5072 6570 6172 696e 6720  nfo(f"Preparing 
+00011770: 7b77 625f 7479 7065 7d20 6d61 7073 2e22  {wb_type} maps."
+00011780: 290a 2020 2020 2020 2020 6764 665f 6f72  ).        gdf_or
+00011790: 6720 3d20 7365 6c66 2e64 6174 615f 6361  g = self.data_ca
+000117a0: 7461 6c6f 672e 6765 745f 6765 6f64 6174  talog.get_geodat
+000117b0: 6166 7261 6d65 280a 2020 2020 2020 2020  aframe(.        
+000117c0: 2020 2020 7761 7465 7262 6f64 6965 735f      waterbodies_
+000117d0: 666e 2c20 6765 6f6d 3d73 656c 662e 6261  fn, geom=self.ba
+000117e0: 7369 6e73 2c20 7072 6564 6963 6174 653d  sins, predicate=
+000117f0: 2263 6f6e 7461 696e 7322 0a20 2020 2020  "contains".     
+00011800: 2020 2029 0a20 2020 2020 2020 2023 2073     ).        # s
+00011810: 6b69 7020 736d 616c 6c20 7369 7a65 2077  kip small size w
+00011820: 6174 6572 626f 6469 6573 0a20 2020 2020  aterbodies.     
+00011830: 2020 2069 6620 2241 7265 615f 6176 6722     if "Area_avg"
+00011840: 2069 6e20 6764 665f 6f72 672e 636f 6c75   in gdf_org.colu
+00011850: 6d6e 7320 616e 6420 6764 665f 6f72 672e  mns and gdf_org.
+00011860: 6765 6f6d 6574 7279 2e73 697a 6520 3e20  geometry.size > 
+00011870: 303a 0a20 2020 2020 2020 2020 2020 206d  0:.            m
+00011880: 696e 5f61 7265 615f 6d32 203d 206d 696e  in_area_m2 = min
+00011890: 5f61 7265 6120 2a20 3165 360a 2020 2020  _area * 1e6.    
+000118a0: 2020 2020 2020 2020 6764 665f 6f72 6720          gdf_org 
+000118b0: 3d20 6764 665f 6f72 675b 6764 665f 6f72  = gdf_org[gdf_or
+000118c0: 672e 4172 6561 5f61 7667 203e 3d20 6d69  g.Area_avg >= mi
+000118d0: 6e5f 6172 6561 5f6d 325d 0a20 2020 2020  n_area_m2].     
+000118e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000118f0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00011900: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+00011910: 2020 2020 2020 2020 2020 6622 7b77 625f            f"{wb_
+00011920: 7479 7065 7d27 7320 6461 7461 6261 7365  type}'s database
+00011930: 2068 6173 206e 6f20 6172 6561 2061 7474   has no area att
+00011940: 7269 6275 7465 2e20 220a 2020 2020 2020  ribute. ".      
+00011950: 2020 2020 2020 2020 2020 6622 416c 6c20            f"All 
+00011960: 7b77 625f 7479 7065 7d73 2077 696c 6c20  {wb_type}s will 
+00011970: 6265 2063 6f6e 7369 6465 7265 642e 220a  be considered.".
+00011980: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00011990: 2020 2020 2020 2320 6765 7420 7761 7465        # get wate
+000119a0: 7262 6f64 6965 7320 6d61 7073 2061 6e64  rbodies maps and
+000119b0: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
+000119c0: 2020 2020 6e62 5f77 6220 3d20 6764 665f      nb_wb = gdf_
+000119d0: 6f72 672e 6765 6f6d 6574 7279 2e73 697a  org.geometry.siz
+000119e0: 650a 2020 2020 2020 2020 6473 5f77 6174  e.        ds_wat
+000119f0: 6572 626f 6479 203d 204e 6f6e 650a 2020  erbody = None.  
+00011a00: 2020 2020 2020 6966 206e 625f 7762 203e        if nb_wb >
+00011a10: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00011a20: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
+00011a30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00011a40: 2020 6622 7b6e 625f 7762 7d20 7b77 625f    f"{nb_wb} {wb_
+00011a50: 7479 7065 7d28 7329 206f 6620 7375 6666  type}(s) of suff
+00011a60: 6963 6965 6e74 2073 697a 6520 666f 756e  icient size foun
+00011a70: 6420 7769 7468 696e 2072 6567 696f 6e2e  d within region.
+00011a80: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00011a90: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
+00011aa0: 6420 7761 7465 7262 6f64 7920 6d61 7073  d waterbody maps
+00011ab0: 0a20 2020 2020 2020 2020 2020 2075 7061  .            upa
+00011ac0: 7265 615f 6e61 6d65 203d 2073 656c 662e  rea_name = self.
+00011ad0: 5f4d 4150 535b 2275 7061 7265 6122 5d0a  _MAPS["uparea"].
+00011ae0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+00011af0: 7061 7265 615f 6e61 6d65 206e 6f74 2069  parea_name not i
+00011b00: 6e20 7365 6c66 2e73 7461 7469 636d 6170  n self.staticmap
+00011b10: 732e 6461 7461 5f76 6172 733a 0a20 2020  s.data_vars:.   
+00011b20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00011b30: 662e 6c6f 6767 6572 2e77 6172 6e69 6e67  f.logger.warning
+00011b40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00011b50: 2020 2020 2020 6622 5570 7374 7265 616d        f"Upstream
+00011b60: 2061 7265 6120 6d61 7020 666f 7220 7b77   area map for {w
+00011b70: 625f 7479 7065 7d20 6f75 746c 6574 2073  b_type} outlet s
+00011b80: 6574 7570 206e 6f74 2066 6f75 6e64 2e20  etup not found. 
+00011b90: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00011ba0: 2020 2020 2020 2244 6174 6162 6173 6520        "Database 
+00011bb0: 636f 6f72 6469 6e61 7465 7320 7573 6564  coordinates used
+00011bc0: 2069 6e73 7465 6164 220a 2020 2020 2020   instead".      
+00011bd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00011be0: 2020 2020 2020 2020 2020 2020 7570 6172              upar
+00011bf0: 6561 5f6e 616d 6520 3d20 4e6f 6e65 0a20  ea_name = None. 
+00011c00: 2020 2020 2020 2020 2020 2064 735f 7761             ds_wa
+00011c10: 7465 7262 6f64 792c 2067 6466 5f77 6174  terbody, gdf_wat
+00011c20: 6572 6f75 746c 6574 203d 2077 6f72 6b66  eroutlet = workf
+00011c30: 6c6f 7773 2e77 6174 6572 626f 6479 6d61  lows.waterbodyma
+00011c40: 7073 280a 2020 2020 2020 2020 2020 2020  ps(.            
+00011c50: 2020 2020 6764 663d 6764 665f 6f72 672c      gdf=gdf_org,
+00011c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011c70: 2064 735f 6c69 6b65 3d73 656c 662e 7374   ds_like=self.st
+00011c80: 6174 6963 6d61 7073 2c0a 2020 2020 2020  aticmaps,.      
+00011c90: 2020 2020 2020 2020 2020 7762 5f74 7970            wb_typ
+00011ca0: 653d 7762 5f74 7970 652c 0a20 2020 2020  e=wb_type,.     
+00011cb0: 2020 2020 2020 2020 2020 2075 7061 7265             upare
+00011cc0: 615f 6e61 6d65 3d75 7061 7265 615f 6e61  a_name=uparea_na
+00011cd0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00011ce0: 2020 2020 6c6f 6767 6572 3d73 656c 662e      logger=self.
+00011cf0: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
+00011d00: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00011d10: 2020 2320 7570 6461 7465 2078 6f75 7420    # update xout 
+00011d20: 616e 6420 796f 7574 2069 6e20 6764 665f  and yout in gdf_
+00011d30: 6f72 6720 6672 6f6d 2067 6466 5f77 6174  org from gdf_wat
+00011d40: 6572 6f75 746c 6574 3a0a 2020 2020 2020  eroutlet:.      
+00011d50: 2020 2020 2020 6966 2022 786f 7574 2220        if "xout" 
+00011d60: 696e 2067 6466 5f6f 7267 2e63 6f6c 756d  in gdf_org.colum
+00011d70: 6e73 2061 6e64 2022 796f 7574 2220 696e  ns and "yout" in
+00011d80: 2067 6466 5f6f 7267 2e63 6f6c 756d 6e73   gdf_org.columns
+00011d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011da0: 2020 6764 665f 6f72 672e 6c6f 635b 3a2c    gdf_org.loc[:,
+00011db0: 2022 786f 7574 225d 203d 2067 6466 5f77   "xout"] = gdf_w
+00011dc0: 6174 6572 6f75 746c 6574 5b22 786f 7574  ateroutlet["xout
+00011dd0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
+00011de0: 2020 2067 6466 5f6f 7267 2e6c 6f63 5b3a     gdf_org.loc[:
+00011df0: 2c20 2279 6f75 7422 5d20 3d20 6764 665f  , "yout"] = gdf_
+00011e00: 7761 7465 726f 7574 6c65 745b 2279 6f75  wateroutlet["you
+00011e10: 7422 5d0a 0a20 2020 2020 2020 2065 6c73  t"]..        els
+00011e20: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00011e30: 656c 662e 6c6f 6767 6572 2e77 6172 6e69  elf.logger.warni
+00011e40: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+00011e50: 2020 2020 6622 4e6f 207b 7762 5f74 7970      f"No {wb_typ
+00011e60: 657d 7320 6f66 2073 7566 6669 6369 656e  e}s of sufficien
+00011e70: 7420 7369 7a65 2066 6f75 6e64 2077 6974  t size found wit
+00011e80: 6869 6e20 7265 6769 6f6e 2120 220a 2020  hin region! ".  
+00011e90: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00011ea0: 536b 6970 7069 6e67 207b 7762 5f74 7970  Skipping {wb_typ
+00011eb0: 657d 2070 726f 6365 6475 7265 7321 220a  e} procedures!".
+00011ec0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00011ed0: 2020 2020 2020 2023 2072 6173 7465 7269         # rasteri
+00011ee0: 7a65 2070 6f69 6e74 7320 706f 6c79 676f  ze points polygo
+00011ef0: 6e73 2069 6e20 7261 7374 6572 2e72 6173  ns in raster.ras
+00011f00: 7465 7269 7a65 202d 2d20 796f 7520 6e65  terize -- you ne
+00011f10: 6564 2073 7461 7469 636d 6170 7320 746f  ed staticmaps to
+00011f20: 206e 6b6f 7720 7468 6520 6772 6964 0a20   nkow the grid. 
+00011f30: 2020 2020 2020 2072 6574 7572 6e20 6764         return gd
+00011f40: 665f 6f72 672c 2064 735f 7761 7465 7262  f_org, ds_waterb
+00011f50: 6f64 790a 0a20 2020 2064 6566 2073 6574  ody..    def set
+00011f60: 7570 5f73 6f69 6c6d 6170 7328 7365 6c66  up_soilmaps(self
+00011f70: 2c20 736f 696c 5f66 6e3d 2273 6f69 6c67  , soil_fn="soilg
+00011f80: 7269 6473 222c 2070 7466 5f6b 7361 7476  rids", ptf_ksatv
+00011f90: 6572 3d22 6272 616b 656e 7369 656b 2229  er="brakensiek")
+00011fa0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00011fb0: 2020 2020 2020 5468 6973 2063 6f6d 706f        This compo
+00011fc0: 6e65 6e74 2064 6572 6976 6573 2073 6576  nent derives sev
+00011fd0: 6572 616c 2028 6c61 7965 7265 6429 2073  eral (layered) s
+00011fe0: 6f69 6c20 7061 7261 6d65 7465 7273 2062  oil parameters b
+00011ff0: 6173 6564 206f 6e20 6120 6461 7461 6261  ased on a databa
+00012000: 7365 2077 6974 680a 2020 2020 2020 2020  se with.        
+00012010: 7068 7973 6963 616c 2073 6f69 6c20 7072  physical soil pr
+00012020: 6f70 6572 7469 6573 2075 7369 6e67 2061  operties using a
+00012030: 7661 696c 6162 6c65 2070 6f69 6e74 2d73  vailable point-s
+00012040: 6361 6c65 2028 7065 646f 2974 7261 6e73  cale (pedo)trans
+00012050: 6665 7220 6675 6e63 7469 6f6e 7320 2850  fer functions (P
+00012060: 5446 7329 0a20 2020 2020 2020 2066 726f  TFs).        fro
+00012070: 6d20 6c69 7465 7261 7475 7265 2077 6974  m literature wit
+00012080: 6820 7570 7363 616c 696e 6720 7275 6c65  h upscaling rule
+00012090: 7320 746f 2065 6e73 7572 6520 666c 7578  s to ensure flux
+000120a0: 206d 6174 6368 696e 6720 6163 726f 7373   matching across
+000120b0: 2073 6361 6c65 732e 0a0a 2020 2020 2020   scales...      
+000120c0: 2020 4375 7272 656e 746c 792c 2073 7570    Currently, sup
+000120d0: 706f 7274 6564 2060 6073 6f69 6c5f 666e  ported ``soil_fn
+000120e0: 6060 2069 7320 2273 6f69 6c67 7269 6473  `` is "soilgrids
+000120f0: 2220 616e 6420 2273 6f69 6c67 7269 6473  " and "soilgrids
+00012100: 5f32 3032 3022 2e0a 2020 2020 2020 2020  _2020"..        
+00012110: 6060 7074 665f 6b73 6174 7665 7260 6020  ``ptf_ksatver`` 
+00012120: 2850 5446 2066 6f72 2074 6865 2076 6572  (PTF for the ver
+00012130: 7469 6361 6c20 6879 6472 6175 6c69 6320  tical hydraulic 
+00012140: 636f 6e64 7563 7469 7669 7479 2920 6f70  conductivity) op
+00012150: 7469 6f6e 7320 6172 6520 2262 7261 6b65  tions are "brake
+00012160: 6e73 6965 6b22 2061 6e64 2022 636f 7362  nsiek" and "cosb
+00012170: 7922 2e0a 2020 2020 2020 2020 2273 6f69  y"..        "soi
+00012180: 6c67 7269 6473 2220 7072 6f76 6964 6573  lgrids" provides
+00012190: 2064 6174 6120 6174 2037 2073 7065 6369   data at 7 speci
+000121a0: 6669 6320 6465 7074 6873 2c20 7768 696c  fic depths, whil
+000121b0: 6520 2273 6f69 6c67 7269 6473 5f32 3032  e "soilgrids_202
+000121c0: 3022 2070 726f 7669 6465 7320 6461 7461  0" provides data
+000121d0: 2061 7665 7261 6765 6420 6f76 6572 2036   averaged over 6
+000121e0: 2064 6570 7468 2069 6e74 6572 7661 6c73   depth intervals
+000121f0: 2e0a 2020 2020 2020 2020 5468 6973 206c  ..        This l
+00012200: 6561 6473 2074 6f20 736d 616c 6c20 6368  eads to small ch
+00012210: 616e 6765 7320 696e 2074 6865 2077 6f72  anges in the wor
+00012220: 6b66 6c6f 773a 2028 3129 204d 2070 6172  kflow: (1) M par
+00012230: 616d 6574 6572 2075 7365 7320 6d69 6470  ameter uses midp
+00012240: 6f69 6e74 2064 6570 7468 7320 696e 2073  oint depths in s
+00012250: 6f69 6c67 7269 6473 5f32 3032 3020 7665  oilgrids_2020 ve
+00012260: 7273 7573 2073 7065 6369 6669 6320 6465  rsus specific de
+00012270: 7074 6873 2069 6e20 736f 696c 6772 6964  pths in soilgrid
+00012280: 732c 0a20 2020 2020 2020 2028 3229 2077  s,.        (2) w
+00012290: 6569 6768 7465 6420 6176 6572 6167 6520  eighted average 
+000122a0: 6f66 2073 6f69 6c20 7072 6f70 6572 7469  of soil properti
+000122b0: 6573 206f 7665 7220 736f 696c 2074 6869  es over soil thi
+000122c0: 636b 6e65 7373 2069 7320 646f 6e65 2077  ckness is done w
+000122d0: 6974 6820 7468 6520 7472 6170 657a 6f69  ith the trapezoi
+000122e0: 6461 6c20 7275 6c65 2069 6e20 736f 696c  dal rule in soil
+000122f0: 6772 6964 7320 7665 7273 7573 2073 696d  grids versus sim
+00012300: 706c 6520 626c 6f63 6b20 7765 6967 6874  ple block weight
+00012310: 6564 2061 7665 7261 6765 2069 6e20 736f  ed average in so
+00012320: 696c 6772 6964 735f 3230 3230 2c0a 2020  ilgrids_2020,.  
+00012330: 2020 2020 2020 2833 2920 7468 6520 6320        (3) the c 
+00012340: 7061 7261 6d65 7465 7220 6973 2063 6f6d  parameter is com
+00012350: 7075 7465 6420 6173 2077 6569 6768 7465  puted as weighte
+00012360: 6420 6176 6572 6167 6520 6f76 6572 2077  d average over w
+00012370: 666c 6f77 5f73 626d 2073 6f69 6c20 6c61  flow_sbm soil la
+00012380: 7965 7273 2069 6e20 736f 696c 6772 6964  yers in soilgrid
+00012390: 735f 3230 3230 2076 6572 7375 7320 6174  s_2020 versus at
+000123a0: 2073 7065 6369 6669 6320 6465 7074 6873   specific depths
+000123b0: 2066 6f72 2073 6f69 6c67 7269 6473 2e0a   for soilgrids..
+000123c0: 0a20 2020 2020 2020 2054 6865 2066 6f6c  .        The fol
+000123d0: 6c6f 7769 6e67 206d 6170 7320 6172 6520  lowing maps are 
+000123e0: 6164 6465 6420 746f 2073 7461 7469 636d  added to staticm
+000123f0: 6170 733a 0a0a 2020 2020 2020 2020 2a20  aps:..        * 
+00012400: 2a2a 7468 6574 6153 2a2a 206d 6170 3a20  **thetaS** map: 
+00012410: 6176 6572 6167 6520 7361 7475 7261 7465  average saturate
+00012420: 6420 736f 696c 2077 6174 6572 2063 6f6e  d soil water con
+00012430: 7465 6e74 205b 6d33 2f6d 335d 0a20 2020  tent [m3/m3].   
+00012440: 2020 2020 202a 202a 2a74 6865 7461 522a       * **thetaR*
+00012450: 2a20 6d61 703a 2061 7665 7261 6765 2072  * map: average r
+00012460: 6573 6964 7561 6c20 7761 7465 7220 636f  esidual water co
+00012470: 6e74 656e 7420 5b6d 332f 6d33 5d0a 2020  ntent [m3/m3].  
+00012480: 2020 2020 2020 2a20 2a2a 4b73 6174 5665        * **KsatVe
+00012490: 722a 2a20 6d61 703a 2076 6572 7469 6361  r** map: vertica
+000124a0: 6c20 7361 7475 7261 7465 6420 6879 6472  l saturated hydr
+000124b0: 6175 6c69 6320 636f 6e64 7563 7469 7669  aulic conductivi
+000124c0: 7479 2061 7420 736f 696c 2073 7572 6661  ty at soil surfa
+000124d0: 6365 205b 6d6d 2f64 6179 5d0a 2020 2020  ce [mm/day].    
+000124e0: 2020 2020 2a20 2a2a 536f 696c 5468 6963      * **SoilThic
+000124f0: 6b6e 6573 732a 2a20 6d61 703a 2073 6f69  kness** map: soi
+00012500: 6c20 7468 6963 6b6e 6573 7320 5b6d 6d5d  l thickness [mm]
+00012510: 0a20 2020 2020 2020 202a 202a 2a53 6f69  .        * **Soi
+00012520: 6c4d 696e 5468 6963 6b6e 6573 732a 2a20  lMinThickness** 
+00012530: 6d61 703a 206d 696e 696d 756d 2073 6f69  map: minimum soi
+00012540: 6c20 7468 6963 6b6e 6573 7320 5b6d 6d5d  l thickness [mm]
+00012550: 2028 6571 7561 6c20 746f 2053 6f69 6c54   (equal to SoilT
+00012560: 6869 636b 6e65 7373 290a 2020 2020 2020  hickness).      
+00012570: 2020 2a20 2a2a 4d2a 2a20 6d61 703a 206d    * **M** map: m
+00012580: 6f64 656c 2070 6172 616d 6574 6572 205b  odel parameter [
+00012590: 6d6d 5d20 7468 6174 2063 6f6e 7472 6f6c  mm] that control
+000125a0: 7320 6578 706f 6e65 6e74 6961 6c20 6465  s exponential de
+000125b0: 636c 696e 6520 6f66 204b 7361 7456 6572  cline of KsatVer
+000125c0: 2077 6974 6820 736f 696c 2064 6570 7468   with soil depth
+000125d0: 0a20 2020 2020 2020 2020 2020 2028 6669  .            (fi
+000125e0: 7474 6564 2077 6974 6820 6375 7276 655f  tted with curve_
+000125f0: 6669 7420 2873 6369 7079 2e6f 7074 696d  fit (scipy.optim
+00012600: 697a 6529 292c 2062 6f75 6e64 7320 6f66  ize)), bounds of
+00012610: 204d 2061 7265 2063 6865 636b 6564 0a20   M are checked. 
+00012620: 2020 2020 2020 202a 202a 2a60 4d5f 602a         * **`M_`*
+00012630: 2a20 6d61 703a 206d 6f64 656c 2070 6172  * map: model par
+00012640: 616d 6574 6572 205b 6d6d 5d20 7468 6174  ameter [mm] that
+00012650: 2063 6f6e 7472 6f6c 7320 6578 706f 6e65   controls expone
+00012660: 6e74 6961 6c20 6465 636c 696e 6520 6f66  ntial decline of
+00012670: 204b 7361 7456 6572 2077 6974 6820 736f   KsatVer with so
+00012680: 696c 2064 6570 7468 0a20 2020 2020 2020  il depth.       
+00012690: 2020 2020 2028 6669 7474 6564 2077 6974       (fitted wit
+000126a0: 6820 6e75 6d70 7920 6c69 6e61 6c67 2072  h numpy linalg r
+000126b0: 6567 7265 7373 696f 6e29 2c20 626f 756e  egression), boun
+000126c0: 6473 206f 6620 604d 5f60 2061 7265 2063  ds of `M_` are c
+000126d0: 6865 636b 6564 0a20 2020 2020 2020 202a  hecked.        *
+000126e0: 202a 2a4d 5f6f 7269 6769 6e61 6c2a 2a20   **M_original** 
+000126f0: 6d61 703a 204d 2077 6974 686f 7574 2063  map: M without c
+00012700: 6865 636b 696e 6720 626f 756e 6473 0a20  hecking bounds. 
+00012710: 2020 2020 2020 202a 202a 2a60 4d5f 6f72         * **`M_or
+00012720: 6967 696e 616c 5f60 2a2a 206d 6170 3a20  iginal_`** map: 
+00012730: 604d 5f60 2077 6974 686f 7574 2063 6865  `M_` without che
+00012740: 636b 696e 6720 626f 756e 6473 0a20 2020  cking bounds.   
+00012750: 2020 2020 202a 202a 2a66 2a2a 206d 6170       * **f** map
+00012760: 3a20 7363 616c 696e 6720 7061 7261 6d65  : scaling parame
+00012770: 7465 7220 636f 6e74 726f 6c6c 696e 6720  ter controlling 
+00012780: 7468 6520 6465 636c 696e 6520 6f66 204b  the decline of K
+00012790: 7361 7456 6572 205b 6d6d 2d31 5d20 2866  satVer [mm-1] (f
+000127a0: 6974 7465 6420 7769 7468 2063 7572 7665  itted with curve
+000127b0: 5f66 6974 2028 7363 6970 792e 6f70 7469  _fit (scipy.opti
+000127c0: 6d69 7a65 2929 2c20 626f 756e 6473 2061  mize)), bounds a
+000127d0: 7265 2063 6865 636b 6564 0a20 2020 2020  re checked.     
+000127e0: 2020 202a 202a 2a60 665f 602a 2a20 6d61     * **`f_`** ma
+000127f0: 703a 2073 6361 6c69 6e67 2070 6172 616d  p: scaling param
+00012800: 6574 6572 2063 6f6e 7472 6f6c 6c69 6e67  eter controlling
+00012810: 2074 6865 2064 6563 6c69 6e65 206f 6620   the decline of 
+00012820: 4b73 6174 5665 7220 5b6d 6d2d 315d 2028  KsatVer [mm-1] (
+00012830: 6669 7474 6564 2077 6974 6820 6e75 6d70  fitted with nump
+00012840: 7920 6c69 6e61 6c67 2072 6567 7265 7373  y linalg regress
+00012850: 696f 6e29 2c20 626f 756e 6473 2061 7265  ion), bounds are
+00012860: 2063 6865 636b 6564 0a20 2020 2020 2020   checked.       
+00012870: 202a 202a 2a63 5f30 2a2a 206d 6170 3a20   * **c_0** map: 
+00012880: 4272 6f6f 6b73 2043 6f72 6579 2063 6f65  Brooks Corey coe
+00012890: 6666 6963 6965 6e74 205b 2d5d 2062 6173  fficient [-] bas
+000128a0: 6564 206f 6e20 706f 7265 2073 697a 6520  ed on pore size 
+000128b0: 6469 7374 7269 6275 7469 6f6e 2069 6e64  distribution ind
+000128c0: 6578 2061 740a 2020 2020 2020 2020 2020  ex at.          
+000128d0: 2020 6465 7074 6820 6f66 2031 7374 2073    depth of 1st s
+000128e0: 6f69 6c20 6c61 7965 7220 2831 3030 206d  oil layer (100 m
+000128f0: 6d29 2077 666c 6f77 5f73 626d 0a20 2020  m) wflow_sbm.   
+00012900: 2020 2020 202a 202a 2a63 5f31 2a2a 206d       * **c_1** m
+00012910: 6170 3a20 6964 656d 2063 5f30 2061 7420  ap: idem c_0 at 
+00012920: 6465 7074 6820 326e 6420 736f 696c 206c  depth 2nd soil l
+00012930: 6179 6572 2028 3430 3020 6d6d 2920 7766  ayer (400 mm) wf
+00012940: 6c6f 775f 7362 6d0a 2020 2020 2020 2020  low_sbm.        
+00012950: 2a20 2a2a 635f 322a 2a20 6d61 703a 2069  * **c_2** map: i
+00012960: 6465 6d20 635f 3020 6174 2064 6570 7468  dem c_0 at depth
+00012970: 2033 7264 2073 6f69 6c20 6c61 7965 7220   3rd soil layer 
+00012980: 2831 3230 3020 6d6d 2920 7766 6c6f 775f  (1200 mm) wflow_
+00012990: 7362 6d0a 2020 2020 2020 2020 2a20 2a2a  sbm.        * **
+000129a0: 635f 332a 2a20 6d61 703a 2069 6465 6d20  c_3** map: idem 
+000129b0: 635f 3020 6174 2064 6570 7468 2034 7468  c_0 at depth 4th
+000129c0: 2073 6f69 6c20 6c61 7965 7220 283e 2031   soil layer (> 1
+000129d0: 3230 3020 6d6d 2920 7766 6c6f 775f 7362  200 mm) wflow_sb
+000129e0: 6d0a 2020 2020 2020 2020 2a20 2a2a 4b73  m.        * **Ks
+000129f0: 6174 5665 725f 5b7a 5d63 6d2a 2a20 6d61  atVer_[z]cm** ma
+00012a00: 703a 204b 7361 7456 6572 205b 6d6d 2f64  p: KsatVer [mm/d
+00012a10: 6179 5d20 6174 2073 6f69 6c20 6465 7074  ay] at soil dept
+00012a20: 6873 205b 7a5d 206f 6620 536f 696c 4772  hs [z] of SoilGr
+00012a30: 6964 7320 6461 7461 205b 302e 302c 2035  ids data [0.0, 5
+00012a40: 2e30 2c20 3135 2e30 2c20 3330 2e30 2c20  .0, 15.0, 30.0, 
+00012a50: 3630 2e30 2c20 3130 302e 302c 2032 3030  60.0, 100.0, 200
+00012a60: 2e30 5d0a 2020 2020 2020 2020 2a20 2a2a  .0].        * **
+00012a70: 7766 6c6f 775f 736f 696c 2a2a 206d 6170  wflow_soil** map
+00012a80: 3a20 736f 696c 2074 6578 7475 7265 2062  : soil texture b
+00012a90: 6173 6564 206f 6e20 5553 4441 2073 6f69  ased on USDA soi
+00012aa0: 6c20 7465 7874 7572 6520 7472 6961 6e67  l texture triang
+00012ab0: 6c65 2028 6d61 7070 696e 673a 205b 313a  le (mapping: [1:
+00012ac0: 436c 6179 2c20 323a 5369 6c74 7920 436c  Clay, 2:Silty Cl
+00012ad0: 6179 2c20 333a 5369 6c74 7920 436c 6179  ay, 3:Silty Clay
+00012ae0: 2d4c 6f61 6d2c 2034 3a53 616e 6479 2043  -Loam, 4:Sandy C
+00012af0: 6c61 792c 2035 3a53 616e 6479 2043 6c61  lay, 5:Sandy Cla
+00012b00: 792d 4c6f 616d 2c20 363a 436c 6179 2d4c  y-Loam, 6:Clay-L
+00012b10: 6f61 6d2c 2037 3a53 696c 742c 2038 3a53  oam, 7:Silt, 8:S
+00012b20: 696c 742d 4c6f 616d 2c20 393a 4c6f 616d  ilt-Loam, 9:Loam
+00012b30: 2c20 3130 3a53 616e 642c 2031 313a 204c  , 10:Sand, 11: L
+00012b40: 6f61 6d79 2053 616e 642c 2031 323a 5361  oamy Sand, 12:Sa
+00012b50: 6e64 7920 4c6f 616d 5d29 0a0a 0a20 2020  ndy Loam])...   
+00012b60: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00012b70: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00012b80: 2d2d 0a20 2020 2020 2020 2073 6f69 6c5f  --.        soil_
+00012b90: 666e 203a 207b 2773 6f69 6c67 7269 6473  fn : {'soilgrids
+00012ba0: 272c 2027 736f 696c 6772 6964 735f 3230  ', 'soilgrids_20
+00012bb0: 3230 277d 0a20 2020 2020 2020 2020 2020  20'}.           
+00012bc0: 204e 616d 6520 6f66 2064 6174 6120 736f   Name of data so
+00012bd0: 7572 6365 2066 6f72 2073 6f69 6c20 7061  urce for soil pa
+00012be0: 7261 6d65 7465 7220 6d61 7073 2c20 7365  rameter maps, se
+00012bf0: 6520 6461 7461 2f64 6174 615f 736f 7572  e data/data_sour
+00012c00: 6365 732e 796d 6c2e 2053 686f 756c 6420  ces.yml. Should 
+00012c10: 636f 6e74 6169 6e20 696e 666f 2066 6f72  contain info for
+00012c20: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00012c30: 2037 2073 6f69 6c20 6465 7074 6873 206f   7 soil depths o
+00012c40: 6620 736f 696c 6772 6964 7320 286f 7220  f soilgrids (or 
+00012c50: 3620 6465 7074 6873 2069 6e74 6572 7661  6 depths interva
+00012c60: 6c73 2066 6f72 2073 6f69 6c67 7269 6473  ls for soilgrids
+00012c70: 5f32 3032 3029 2e0a 2020 2020 2020 2020  _2020)..        
+00012c80: 2020 2020 2a20 5265 7175 6972 6564 2076      * Required v
+00012c90: 6172 6961 626c 6573 3a20 5b27 6264 5f73  ariables: ['bd_s
+00012ca0: 6c2a 272c 2027 636c 7970 7074 5f73 6c2a  l*', 'clyppt_sl*
+00012cb0: 272c 2027 736c 7470 7074 5f73 6c2a 272c  ', 'sltppt_sl*',
+00012cc0: 2027 6f63 5f73 6c2a 272c 2027 7068 5f73   'oc_sl*', 'ph_s
+00012cd0: 6c2a 272c 2027 736e 6470 7074 5f73 6c2a  l*', 'sndppt_sl*
+00012ce0: 272c 2027 736f 696c 7468 6963 6b6e 6573  ', 'soilthicknes
+00012cf0: 7327 2c20 2774 6178 5f75 7364 6127 5d0a  s', 'tax_usda'].
+00012d00: 2020 2020 2020 2020 7074 665f 6b73 6174          ptf_ksat
+00012d10: 7665 7220 3a20 7b27 6272 616b 656e 7369  ver : {'brakensi
+00012d20: 656b 272c 2027 636f 7362 7927 7d0a 2020  ek', 'cosby'}.  
+00012d30: 2020 2020 2020 2020 2020 5065 646f 7472            Pedotr
+00012d40: 616e 7366 6572 2066 756e 6374 696f 6e20  ansfer function 
+00012d50: 2850 5446 2920 746f 2075 7365 2066 6f72  (PTF) to use for
+00012d60: 2063 616c 6375 6c61 7469 6f6e 204b 7361   calculation Ksa
+00012d70: 7456 6572 2028 7665 7274 6963 616c 2073  tVer (vertical s
+00012d80: 6174 7572 6174 6564 0a20 2020 2020 2020  aturated.       
+00012d90: 2020 2020 2068 7964 7261 756c 6963 2063       hydraulic c
+00012da0: 6f6e 6475 6374 6976 6974 7920 5b6d 6d2f  onductivity [mm/
+00012db0: 6461 795d 292e 2042 7920 6465 6661 756c  day]). By defaul
+00012dc0: 7420 2762 7261 6b65 6e73 6965 6b27 2e0a  t 'brakensiek'..
+00012dd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012de0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00012df0: 696e 666f 2866 2250 7265 7061 7269 6e67  info(f"Preparing
+00012e00: 2073 6f69 6c20 7061 7261 6d65 7465 7220   soil parameter 
+00012e10: 6d61 7073 2e22 290a 2020 2020 2020 2020  maps.").        
+00012e20: 2320 544f 444f 2061 6464 2076 6172 6961  # TODO add varia
+00012e30: 626c 6573 206c 6973 7420 7769 7468 2072  bles list with r
+00012e40: 6571 7569 7265 6420 7661 7269 6162 6c65  equired variable
+00012e50: 206e 616d 6573 0a20 2020 2020 2020 2064   names.        d
+00012e60: 7369 6e20 3d20 7365 6c66 2e64 6174 615f  sin = self.data_
+00012e70: 6361 7461 6c6f 672e 6765 745f 7261 7374  catalog.get_rast
+00012e80: 6572 6461 7461 7365 7428 736f 696c 5f66  erdataset(soil_f
+00012e90: 6e2c 2067 656f 6d3d 7365 6c66 2e72 6567  n, geom=self.reg
+00012ea0: 696f 6e2c 2062 7566 6665 723d 3229 0a20  ion, buffer=2). 
+00012eb0: 2020 2020 2020 2064 736f 7574 203d 2077         dsout = w
+00012ec0: 6f72 6b66 6c6f 7773 2e73 6f69 6c67 7269  orkflows.soilgri
+00012ed0: 6473 280a 2020 2020 2020 2020 2020 2020  ds(.            
+00012ee0: 6473 696e 2c0a 2020 2020 2020 2020 2020  dsin,.          
+00012ef0: 2020 7365 6c66 2e73 7461 7469 636d 6170    self.staticmap
+00012f00: 732c 0a20 2020 2020 2020 2020 2020 2070  s,.            p
+00012f10: 7466 5f6b 7361 7476 6572 2c0a 2020 2020  tf_ksatver,.    
+00012f20: 2020 2020 2020 2020 736f 696c 5f66 6e2c          soil_fn,
+00012f30: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00012f40: 6765 723d 7365 6c66 2e6c 6f67 6765 722c  ger=self.logger,
+00012f50: 0a20 2020 2020 2020 2029 2e72 6573 6574  .        ).reset
+00012f60: 5f63 6f6f 7264 7328 6472 6f70 3d54 7275  _coords(drop=Tru
+00012f70: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+00012f80: 7365 745f 7374 6174 6963 6d61 7073 2864  set_staticmaps(d
+00012f90: 736f 7574 290a 0a20 2020 2064 6566 2073  sout)..    def s
+00012fa0: 6574 7570 5f67 6c61 6369 6572 7328 7365  etup_glaciers(se
+00012fb0: 6c66 2c20 676c 6163 6965 7273 5f66 6e3d  lf, glaciers_fn=
+00012fc0: 2272 6769 222c 206d 696e 5f61 7265 613d  "rgi", min_area=
+00012fd0: 3129 3a0a 2020 2020 2020 2020 2222 220a  1):.        """.
+00012fe0: 2020 2020 2020 2020 5468 6973 2063 6f6d          This com
+00012ff0: 706f 6e65 6e74 2067 656e 6572 6174 6573  ponent generates
+00013000: 206d 6170 7320 6f66 2067 6c61 6369 6572   maps of glacier
+00013010: 2061 7265 6173 2c20 6172 6561 2066 7261   areas, area fra
+00013020: 6374 696f 6e20 616e 6420 766f 6c75 6d65  ction and volume
+00013030: 2066 7261 6374 696f 6e2c 0a20 2020 2020   fraction,.     
+00013040: 2020 2061 7320 7765 6c6c 2061 7320 7461     as well as ta
+00013050: 626c 6573 2077 6974 6820 7465 6d70 6572  bles with temper
+00013060: 6174 7572 6520 7468 7265 7368 6f6c 642c  ature threshold,
+00013070: 206d 656c 7469 6e67 2066 6163 746f 7220   melting factor 
+00013080: 616e 6420 736e 6f77 2d74 6f2d 6963 650a  and snow-to-ice.
+00013090: 2020 2020 2020 2020 636f 6e76 6572 7469          converti
+000130a0: 6f6e 2066 7261 6374 696f 6e2e 0a0a 2020  on fraction...  
+000130b0: 2020 2020 2020 5468 6520 6461 7461 2069        The data i
+000130c0: 7320 6765 6e65 7261 7465 6420 6672 6f6d  s generated from
+000130d0: 2066 6561 7475 7265 7320 7769 7468 2060   features with `
+000130e0: 606d 696e 5f61 7265 6160 6020 5b6b 6d32  `min_area`` [km2
+000130f0: 5d20 2864 6566 6175 6c74 2069 7320 3120  ] (default is 1 
+00013100: 6b6d 3229 0a20 2020 2020 2020 2066 726f  km2).        fro
+00013110: 6d20 6120 6461 7461 6261 7365 2077 6974  m a database wit
+00013120: 6820 676c 6163 6965 7220 6765 6f6d 6574  h glacier geomet
+00013130: 7279 2c20 4944 7320 616e 6420 6d65 7461  ry, IDs and meta
+00013140: 6461 7461 2e0a 0a20 2020 2020 2020 2054  data...        T
+00013150: 6865 2072 6571 7569 7265 6420 7661 7269  he required vari
+00013160: 6162 6c65 7320 6672 6f6d 2067 6c61 6369  ables from glaci
+00013170: 6572 735f 666e 2064 6174 6173 6574 2061  ers_fn dataset a
+00013180: 7265 2067 6c61 6369 6572 2049 4420 2773  re glacier ID 's
+00013190: 696d 706c 655f 6964 272e 0a20 2020 2020  imple_id'..     
+000131a0: 2020 204f 7074 696f 6e6e 616c 6c79 2067     Optionnally g
+000131b0: 6c61 6369 6572 2061 7265 6120 2741 5245  lacier area 'ARE
+000131c0: 4127 205b 6b6d 325d 2063 616e 2062 6520  A' [km2] can be 
+000131d0: 7072 6573 656e 7420 746f 2066 696c 7465  present to filte
+000131e0: 7220 7468 6520 676c 6163 6965 7273 0a20  r the glaciers. 
+000131f0: 2020 2020 2020 2062 7920 7369 7a65 2e20         by size. 
+00013200: 4966 206e 6f74 2070 7265 7365 6e74 2069  If not present i
+00013210: 7420 7769 6c6c 2062 6520 636f 6d70 7574  t will be comput
+00013220: 6564 206f 6e20 7468 6520 666c 792e 0a0a  ed on the fly...
+00013230: 2020 2020 2020 2020 4164 6473 206d 6f64          Adds mod
+00013240: 656c 206c 6179 6572 733a 0a0a 2020 2020  el layers:..    
+00013250: 2020 2020 2a20 2a2a 7766 6c6f 775f 676c      * **wflow_gl
+00013260: 6163 6965 7261 7265 6173 2a2a 206d 6170  acierareas** map
+00013270: 3a20 676c 6163 6965 7220 4944 7320 5b2d  : glacier IDs [-
+00013280: 5d0a 2020 2020 2020 2020 2a20 2a2a 7766  ].        * **wf
+00013290: 6c6f 775f 676c 6163 6965 7266 7261 632a  low_glacierfrac*
+000132a0: 2a20 6d61 703a 2061 7265 6120 6672 6163  * map: area frac
+000132b0: 7469 6f6e 206f 6620 676c 6163 6965 7220  tion of glacier 
+000132c0: 7065 7220 6365 6c6c 205b 2d5d 0a20 2020  per cell [-].   
+000132d0: 2020 2020 202a 202a 2a77 666c 6f77 5f67       * **wflow_g
+000132e0: 6c61 6369 6572 7374 6f72 652a 2a20 6d61  lacierstore** ma
+000132f0: 703a 2073 746f 7261 6765 2028 766f 6c75  p: storage (volu
+00013300: 6d65 2920 6f66 2067 6c61 6369 6572 2070  me) of glacier p
+00013310: 6572 2063 656c 6c20 5b6d 6d5d 0a20 2020  er cell [mm].   
+00013320: 2020 2020 202a 202a 2a47 5f54 542a 2a20       * **G_TT** 
+00013330: 6d61 703a 2074 656d 7065 7261 7475 7265  map: temperature
+00013340: 2074 6872 6573 686f 6c64 2066 6f72 2067   threshold for g
+00013350: 6c61 6369 6572 206d 656c 742f 6275 696c  lacier melt/buil
+00013360: 6475 7020 5bc2 b043 5d0a 2020 2020 2020  dup [..C].      
+00013370: 2020 2a20 2a2a 475f 4366 6d61 782a 2a20    * **G_Cfmax** 
+00013380: 6d61 703a 2067 6c61 6369 6572 206d 656c  map: glacier mel
+00013390: 7469 6e67 2066 6163 746f 7220 5b6d 6d2f  ting factor [mm/
+000133a0: c2b0 432a 6461 795d 0a20 2020 2020 2020  ..C*day].       
+000133b0: 202a 202a 2a47 5f53 4966 7261 632a 2a20   * **G_SIfrac** 
+000133c0: 6d61 703a 2066 7261 6374 696f 6e20 6f66  map: fraction of
+000133d0: 2073 6e6f 7770 6163 6b20 6f6e 2074 6f70   snowpack on top
+000133e0: 206f 6620 676c 6163 6965 7220 636f 6e76   of glacier conv
+000133f0: 6572 7465 6420 746f 2069 6365 2c20 6164  erted to ice, ad
+00013400: 6465 6420 746f 2067 6c61 6369 6572 7374  ded to glacierst
+00013410: 6f72 6520 5b2d 5d0a 0a20 2020 2020 2020  ore [-]..       
+00013420: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00013430: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00013440: 2020 2020 2020 2067 6c61 6369 6572 735f         glaciers_
+00013450: 666e 203a 207b 2772 6769 277d 0a20 2020  fn : {'rgi'}.   
+00013460: 2020 2020 2020 2020 204e 616d 6520 6f66           Name of
+00013470: 2064 6174 6120 736f 7572 6365 2066 6f72   data source for
+00013480: 2067 6c61 6369 6572 732c 2073 6565 2064   glaciers, see d
+00013490: 6174 612f 6461 7461 5f73 6f75 7263 6573  ata/data_sources
+000134a0: 2e79 6d6c 2e0a 0a20 2020 2020 2020 2020  .yml...         
+000134b0: 2020 202a 2052 6571 7569 7265 6420 7661     * Required va
+000134c0: 7269 6162 6c65 733a 205b 2773 696d 706c  riables: ['simpl
+000134d0: 655f 6964 275d 0a20 2020 2020 2020 206d  e_id'].        m
+000134e0: 696e 5f61 7265 6120 3a20 666c 6f61 742c  in_area : float,
+000134f0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00013500: 2020 2020 2020 4d69 6e69 6d75 6d20 676c        Minimum gl
+00013510: 6163 6965 7220 6172 6561 2074 6872 6573  acier area thres
+00013520: 686f 6c64 205b 6b6d 325d 2c20 6279 2064  hold [km2], by d
+00013530: 6566 6175 6c74 2030 2028 616c 6c20 696e  efault 0 (all in
+00013540: 636c 7564 6564 290a 2020 2020 2020 2020  cluded).        
+00013550: 2222 220a 2020 2020 2020 2020 676c 6163  """.        glac
+00013560: 5f74 6f6d 6c20 3d20 7b0a 2020 2020 2020  _toml = {.      
+00013570: 2020 2020 2020 226d 6f64 656c 2e67 6c61        "model.gla
+00013580: 6369 6572 223a 2054 7275 652c 0a20 2020  cier": True,.   
+00013590: 2020 2020 2020 2020 2022 7374 6174 652e           "state.
+000135a0: 7665 7274 6963 616c 2e67 6c61 6369 6572  vertical.glacier
+000135b0: 7374 6f72 6522 3a20 2267 6c61 6369 6572  store": "glacier
+000135c0: 7374 6f72 6522 2c0a 2020 2020 2020 2020  store",.        
+000135d0: 2020 2020 2269 6e70 7574 2e76 6572 7469      "input.verti
+000135e0: 6361 6c2e 676c 6163 6965 7273 746f 7265  cal.glacierstore
+000135f0: 223a 2022 7766 6c6f 775f 676c 6163 6965  ": "wflow_glacie
+00013600: 7273 746f 7265 222c 0a20 2020 2020 2020  rstore",.       
+00013610: 2020 2020 2022 696e 7075 742e 7665 7274       "input.vert
+00013620: 6963 616c 2e67 6c61 6369 6572 6672 6163  ical.glacierfrac
+00013630: 223a 2022 7766 6c6f 775f 676c 6163 6965  ": "wflow_glacie
+00013640: 7266 7261 6322 2c0a 2020 2020 2020 2020  rfrac",.        
+00013650: 2020 2020 2269 6e70 7574 2e76 6572 7469      "input.verti
+00013660: 6361 6c2e 675f 6366 6d61 7822 3a20 2247  cal.g_cfmax": "G
+00013670: 5f43 666d 6178 222c 0a20 2020 2020 2020  _Cfmax",.       
+00013680: 2020 2020 2022 696e 7075 742e 7665 7274       "input.vert
+00013690: 6963 616c 2e67 5f74 7422 3a20 2247 5f54  ical.g_tt": "G_T
+000136a0: 5422 2c0a 2020 2020 2020 2020 2020 2020  T",.            
+000136b0: 2269 6e70 7574 2e76 6572 7469 6361 6c2e  "input.vertical.
+000136c0: 675f 7369 6672 6163 223a 2022 475f 5349  g_sifrac": "G_SI
+000136d0: 6672 6163 222c 0a20 2020 2020 2020 207d  frac",.        }
+000136e0: 0a20 2020 2020 2020 2023 2072 6574 7269  .        # retri
+000136f0: 6576 6520 6461 7461 2066 6f72 2062 6173  eve data for bas
+00013700: 696e 0a20 2020 2020 2020 2073 656c 662e  in.        self.
+00013710: 6c6f 6767 6572 2e69 6e66 6f28 6622 5072  logger.info(f"Pr
+00013720: 6570 6172 696e 6720 676c 6163 6965 7220  eparing glacier 
+00013730: 6d61 7073 2e22 290a 2020 2020 2020 2020  maps.").        
+00013740: 6764 665f 6f72 6720 3d20 7365 6c66 2e64  gdf_org = self.d
+00013750: 6174 615f 6361 7461 6c6f 672e 6765 745f  ata_catalog.get_
+00013760: 6765 6f64 6174 6166 7261 6d65 280a 2020  geodataframe(.  
+00013770: 2020 2020 2020 2020 2020 676c 6163 6965            glacie
+00013780: 7273 5f66 6e2c 2067 656f 6d3d 7365 6c66  rs_fn, geom=self
+00013790: 2e62 6173 696e 732c 2070 7265 6469 6361  .basins, predica
+000137a0: 7465 3d22 696e 7465 7273 6563 7473 220a  te="intersects".
+000137b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000137c0: 2020 2320 736b 6970 2073 6d61 6c6c 2073    # skip small s
+000137d0: 697a 6520 676c 6163 6965 720a 2020 2020  ize glacier.    
+000137e0: 2020 2020 6966 2022 4152 4541 2220 696e      if "AREA" in
+000137f0: 2067 6466 5f6f 7267 2e63 6f6c 756d 6e73   gdf_org.columns
+00013800: 2061 6e64 2067 6466 5f6f 7267 2e67 656f   and gdf_org.geo
+00013810: 6d65 7472 792e 7369 7a65 203e 2030 3a0a  metry.size > 0:.
+00013820: 2020 2020 2020 2020 2020 2020 6764 665f              gdf_
+00013830: 6f72 6720 3d20 6764 665f 6f72 675b 6764  org = gdf_org[gd
+00013840: 665f 6f72 675b 2241 5245 4122 5d20 3e3d  f_org["AREA"] >=
+00013850: 206d 696e 5f61 7265 615d 0a20 2020 2020   min_area].     
+00013860: 2020 2023 2067 6574 2067 6c61 6369 6572     # get glacier
+00013870: 206d 6170 7320 616e 6420 7061 7261 6d65   maps and parame
+00013880: 7465 7273 0a20 2020 2020 2020 206e 625f  ters.        nb_
+00013890: 676c 6163 203d 2067 6466 5f6f 7267 2e67  glac = gdf_org.g
+000138a0: 656f 6d65 7472 792e 7369 7a65 0a20 2020  eometry.size.   
+000138b0: 2020 2020 2064 735f 676c 6163 203d 204e       ds_glac = N
+000138c0: 6f6e 650a 2020 2020 2020 2020 6966 206e  one.        if n
+000138d0: 625f 676c 6163 203e 2030 3a0a 2020 2020  b_glac > 0:.    
+000138e0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000138f0: 6765 722e 696e 666f 280a 2020 2020 2020  ger.info(.      
+00013900: 2020 2020 2020 2020 2020 6622 7b6e 625f            f"{nb_
+00013910: 676c 6163 7d20 676c 6163 6965 7273 206f  glac} glaciers o
+00013920: 6620 7375 6666 6963 6965 6e74 2073 697a  f sufficient siz
+00013930: 6520 666f 756e 6420 7769 7468 696e 2072  e found within r
+00013940: 6567 696f 6e2e 220a 2020 2020 2020 2020  egion.".        
+00013950: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00013960: 2020 2320 6164 6420 676c 6163 6965 7220    # add glacier 
+00013970: 6d61 7073 0a20 2020 2020 2020 2020 2020  maps.           
+00013980: 2064 735f 676c 6163 203d 2077 6f72 6b66   ds_glac = workf
+00013990: 6c6f 7773 2e67 6c61 6369 6572 6d61 7073  lows.glaciermaps
+000139a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000139b0: 2020 6764 663d 6764 665f 6f72 672c 0a20    gdf=gdf_org,. 
+000139c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000139d0: 735f 6c69 6b65 3d73 656c 662e 7374 6174  s_like=self.stat
+000139e0: 6963 6d61 7073 2c0a 2020 2020 2020 2020  icmaps,.        
+000139f0: 2020 2020 2020 2020 6964 5f63 6f6c 756d          id_colum
+00013a00: 6e3d 2273 696d 706c 655f 6964 222c 0a20  n="simple_id",. 
+00013a10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00013a20: 6c65 7674 6e5f 6e61 6d65 3d73 656c 662e  levtn_name=self.
+00013a30: 5f4d 4150 535b 2265 6c65 7674 6e22 5d2c  _MAPS["elevtn"],
 00013a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013a50: 2067 6466 2e74 6f5f 6669 6c65 2866 6e5f   gdf.to_file(fn_
-00013a60: 6f75 742c 2064 7269 7665 723d 2247 656f  out, driver="Geo
-00013a70: 4a53 4f4e 2229 0a0a 2020 2020 6465 6620  JSON")..    def 
-00013a80: 7265 6164 5f66 6f72 6369 6e67 2873 656c  read_forcing(sel
-00013a90: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
-00013aa0: 6561 6420 666f 7263 696e 6722 2222 0a20  ead forcing""". 
-00013ab0: 2020 2020 2020 2066 6e5f 6465 6661 756c         fn_defaul
-00013ac0: 7420 3d20 6a6f 696e 2873 656c 662e 726f  t = join(self.ro
-00013ad0: 6f74 2c20 2269 6e6d 6170 732e 6e63 2229  ot, "inmaps.nc")
-00013ae0: 0a20 2020 2020 2020 2066 6e20 3d20 7365  .        fn = se
-00013af0: 6c66 2e67 6574 5f63 6f6e 6669 6728 2269  lf.get_config("i
-00013b00: 6e70 7574 2e70 6174 685f 666f 7263 696e  nput.path_forcin
-00013b10: 6722 2c20 6162 735f 7061 7468 3d54 7275  g", abs_path=Tru
-00013b20: 652c 2066 616c 6c62 6163 6b3d 666e 5f64  e, fallback=fn_d
-00013b30: 6566 6175 6c74 290a 2020 2020 2020 2020  efault).        
-00013b40: 6966 206e 6f74 2073 656c 662e 5f77 7269  if not self._wri
-00013b50: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-00013b60: 2320 7374 6172 7420 6672 6573 6820 696e  # start fresh in
-00013b70: 2072 6561 642d 6f6e 6c79 206d 6f64 650a   read-only mode.
-00013b80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013b90: 2e5f 666f 7263 696e 6720 3d20 6469 6374  ._forcing = dict
-00013ba0: 2829 0a20 2020 2020 2020 2069 6620 666e  ().        if fn
-00013bb0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00013bc0: 2069 7366 696c 6528 666e 293a 0a20 2020   isfile(fn):.   
-00013bd0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00013be0: 6767 6572 2e69 6e66 6f28 6622 5265 6164  gger.info(f"Read
-00013bf0: 2066 6f72 6369 6e67 2066 726f 6d20 7b66   forcing from {f
-00013c00: 6e7d 2229 0a20 2020 2020 2020 2020 2020  n}").           
-00013c10: 2064 7320 3d20 7872 2e6f 7065 6e5f 6461   ds = xr.open_da
-00013c20: 7461 7365 7428 666e 2c20 6368 756e 6b73  taset(fn, chunks
-00013c30: 3d7b 2274 696d 6522 3a20 3330 7d2c 2064  ={"time": 30}, d
-00013c40: 6563 6f64 655f 636f 6f72 6473 3d22 616c  ecode_coords="al
-00013c50: 6c22 290a 2020 2020 2020 2020 2020 2020  l").            
-00013c60: 666f 7220 7620 696e 2064 732e 6461 7461  for v in ds.data
-00013c70: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
-00013c80: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-00013c90: 666f 7263 696e 6728 6473 5b76 5d29 0a20  forcing(ds[v]). 
-00013ca0: 2020 2020 2020 2065 6c69 6620 222a 2220         elif "*" 
-00013cb0: 696e 2073 7472 2866 6e29 3a0a 2020 2020  in str(fn):.    
-00013cc0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00013cd0: 6765 722e 696e 666f 2866 2252 6561 6420  ger.info(f"Read 
-00013ce0: 6d75 6c74 6970 6c65 2066 6f72 6369 6e67  multiple forcing
-00013cf0: 2066 696c 6573 2075 7369 6e67 207b 666e   files using {fn
-00013d00: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00013d10: 666e 7320 3d20 6c69 7374 2866 6e2e 7061  fns = list(fn.pa
-00013d20: 7265 6e74 2e67 6c6f 6228 666e 2e6e 616d  rent.glob(fn.nam
-00013d30: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-00013d40: 6966 206c 656e 2866 6e73 2920 3d3d 2030  if len(fns) == 0
-00013d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013d60: 2020 7261 6973 6520 494f 4572 726f 7228    raise IOError(
-00013d70: 6622 4e6f 2066 6f72 6369 6e67 2066 696c  f"No forcing fil
-00013d80: 6573 2066 6f75 6e64 2075 7369 6e67 207b  es found using {
-00013d90: 666e 7d22 290a 2020 2020 2020 2020 2020  fn}").          
-00013da0: 2020 6473 203d 2078 722e 6f70 656e 5f6d    ds = xr.open_m
-00013db0: 6664 6174 6173 6574 2866 6e73 2c20 6368  fdataset(fns, ch
-00013dc0: 756e 6b73 3d7b 2274 696d 6522 3a20 3330  unks={"time": 30
-00013dd0: 7d2c 2064 6563 6f64 655f 636f 6f72 6473  }, decode_coords
-00013de0: 3d22 616c 6c22 290a 2020 2020 2020 2020  ="all").        
-00013df0: 2020 2020 666f 7220 7620 696e 2064 732e      for v in ds.
-00013e00: 6461 7461 5f76 6172 733a 0a20 2020 2020  data_vars:.     
-00013e10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013e20: 7365 745f 666f 7263 696e 6728 6473 5b76  set_forcing(ds[v
-00013e30: 5d29 0a0a 2020 2020 6465 6620 7772 6974  ])..    def writ
-00013e40: 655f 666f 7263 696e 6728 0a20 2020 2020  e_forcing(.     
-00013e50: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00013e60: 2066 6e5f 6f75 743d 4e6f 6e65 2c0a 2020   fn_out=None,.  
-00013e70: 2020 2020 2020 6672 6571 5f6f 7574 3d4e        freq_out=N
-00013e80: 6f6e 652c 0a20 2020 2020 2020 2063 6875  one,.        chu
-00013e90: 6e6b 7369 7a65 3d31 2c0a 2020 2020 2020  nksize=1,.      
-00013ea0: 2020 6465 6369 6d61 6c73 3d32 2c0a 2020    decimals=2,.  
-00013eb0: 2020 2020 2020 7469 6d65 5f75 6e69 7473        time_units
-00013ec0: 3d22 6461 7973 2073 696e 6365 2031 3930  ="days since 190
-00013ed0: 302d 3031 2d30 3154 3030 3a30 303a 3030  0-01-01T00:00:00
-00013ee0: 222c 0a20 2020 2020 2020 202a 2a6b 7761  ",.        **kwa
-00013ef0: 7267 732c 0a20 2020 2029 3a0a 2020 2020  rgs,.    ):.    
-00013f00: 2020 2020 2222 2277 7269 7465 2066 6f72      """write for
-00013f10: 6369 6e67 2061 7420 6066 6e5f 6f75 7460  cing at `fn_out`
-00013f20: 2069 6e20 6d6f 6465 6c20 7265 6164 7920   in model ready 
-00013f30: 666f 726d 6174 2e0a 0a20 2020 2020 2020  format...       
-00013f40: 2049 6620 6e6f 2060 666e 5f6f 7574 6020   If no `fn_out` 
-00013f50: 7061 7468 2069 7320 7072 6f76 6964 6564  path is provided
-00013f60: 2061 6e64 2070 6174 685f 666f 7263 696e   and path_forcin
-00013f70: 6720 6672 6f6d 2074 6865 2020 7766 6c6f  g from the  wflo
-00013f80: 7720 746f 6d6c 2065 7869 7374 732c 0a20  w toml exists,. 
-00013f90: 2020 2020 2020 2074 6865 2066 6f6c 6c6f         the follo
-00013fa0: 7769 6e67 2064 6566 6175 6c74 2066 696c  wing default fil
-00013fb0: 656e 616d 6573 2061 7265 2075 7365 643a  enames are used:
-00013fc0: 0a0a 2020 2020 2020 2020 2020 2020 2a20  ..            * 
-00013fd0: 4465 6661 756c 7420 6e61 6d65 2066 6f72  Default name for
-00013fe0: 6d61 7420 2877 6974 6820 646f 776e 7363  mat (with downsc
-00013ff0: 616c 696e 6729 3a20 696e 6d61 7073 5f73  aling): inmaps_s
-00014000: 6f75 7263 6550 645f 736f 7572 6365 5464  ourcePd_sourceTd
-00014010: 5f6d 6574 686f 6450 4554 5f66 7265 715f  _methodPET_freq_
-00014020: 7374 6172 7479 6561 725f 656e 6479 6561  startyear_endyea
-00014030: 722e 6e63 0a20 2020 2020 2020 2020 2020  r.nc.           
-00014040: 202a 2044 6566 6175 6c74 206e 616d 6520   * Default name 
-00014050: 666f 726d 6174 2028 6e6f 2064 6f77 6e73  format (no downs
-00014060: 6361 6c69 6e67 293a 2069 6e6d 6170 735f  caling): inmaps_
-00014070: 736f 7572 6365 505f 736f 7572 6365 545f  sourceP_sourceT_
-00014080: 6d65 7468 6f64 5045 545f 6672 6571 5f73  methodPET_freq_s
-00014090: 7461 7274 7965 6172 5f65 6e64 7965 6172  tartyear_endyear
-000140a0: 2e6e 630a 0a20 2020 2020 2020 2050 6172  .nc..        Par
-000140b0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-000140c0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-000140d0: 2020 2066 6e5f 6f75 743a 2073 7472 2c20     fn_out: str, 
-000140e0: 5061 7468 2c20 6f70 7469 6f6e 616c 0a20  Path, optional. 
-000140f0: 2020 2020 2020 2020 2020 2050 6174 6820             Path 
-00014100: 746f 2073 6176 6520 6f75 7470 7574 206e  to save output n
-00014110: 6574 6364 6620 6669 6c65 3b20 6966 204e  etcdf file; if N
-00014120: 6f6e 6520 7468 6520 6e61 6d65 2069 7320  one the name is 
-00014130: 7265 6164 2066 726f 6d20 7468 6520 7766  read from the wf
-00014140: 6c6f 770a 2020 2020 2020 2020 2020 2020  low.            
-00014150: 746f 6d6c 2066 696c 652e 0a20 2020 2020  toml file..     
-00014160: 2020 2066 7265 715f 6f75 743a 2073 7472     freq_out: str
-00014170: 2028 4f66 6673 6574 292c 206f 7074 696f   (Offset), optio
-00014180: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00014190: 5772 6974 6520 7365 7665 7261 6c20 6669  Write several fi
-000141a0: 6c65 7320 666f 7220 7468 6520 666f 7263  les for the forc
-000141b0: 696e 6720 6163 636f 7264 696e 6720 746f  ing according to
-000141c0: 2066 6e5f 6672 6571 2e20 466f 7220 6578   fn_freq. For ex
-000141d0: 616d 706c 6520 2759 2720 666f 7220 6f6e  ample 'Y' for on
-000141e0: 6520 6669 6c65 2070 6572 2079 6561 7220  e file per year 
-000141f0: 6f72 2027 4d27 0a20 2020 2020 2020 2020  or 'M'.         
-00014200: 2020 2066 6f72 206f 6e65 2066 696c 6520     for one file 
-00014210: 7065 7220 6d6f 6e74 682e 2042 7920 6465  per month. By de
-00014220: 6661 756c 7420 7772 6974 6573 2074 6865  fault writes the
-00014230: 206f 6e65 2066 696c 652e 0a20 2020 2020   one file..     
-00014240: 2020 2020 2020 2046 6f72 206d 6f72 6520         For more 
-00014250: 6f70 7469 6f6e 732c 2073 6565 2068 7474  options, see htt
-00014260: 7073 3a2f 2f70 616e 6461 732e 7079 6461  ps://pandas.pyda
-00014270: 7461 2e6f 7267 2f70 616e 6461 732d 646f  ta.org/pandas-do
-00014280: 6373 2f73 7461 626c 652f 7573 6572 5f67  cs/stable/user_g
-00014290: 7569 6465 2f74 696d 6573 6572 6965 732e  uide/timeseries.
-000142a0: 6874 6d6c 236f 6666 7365 742d 616c 6961  html#offset-alia
-000142b0: 7365 730a 2020 2020 2020 2020 6368 756e  ses.        chun
-000142c0: 6b73 697a 653a 2069 6e74 2c20 6f70 7469  ksize: int, opti
-000142d0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-000142e0: 2043 6875 6e6b 7369 7a65 206f 6e20 7469   Chunksize on ti
-000142f0: 6d65 2064 696d 656e 7369 6f6e 2077 6865  me dimension whe
-00014300: 6e20 7361 7669 6e67 2074 6f20 6469 736b  n saving to disk
-00014310: 2e20 4279 2064 6566 6175 6c74 2031 2e0a  . By default 1..
-00014320: 2020 2020 2020 2020 6465 6369 6d61 6c73          decimals
-00014330: 3a20 696e 742c 206f 7074 696f 6e61 6c0a  : int, optional.
-00014340: 2020 2020 2020 2020 2020 2020 526f 756e              Roun
-00014350: 6420 7468 6520 6f75 7075 7420 6461 7461  d the ouput data
-00014360: 2074 6f20 7468 6520 6769 7665 6e20 6e75   to the given nu
-00014370: 6d62 6572 206f 6620 6465 6369 6d61 6c73  mber of decimals
-00014380: 2e0a 2020 2020 2020 2020 7469 6d65 5f75  ..        time_u
-00014390: 6e69 7473 3a20 7374 722c 206f 7074 696f  nits: str, optio
-000143a0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-000143b0: 436f 6d6d 6f6e 2074 696d 6520 756e 6974  Common time unit
-000143c0: 7320 7768 656e 2077 7269 7474 696e 6720  s when writting 
-000143d0: 7365 7665 7261 6c20 6e65 7463 6466 2066  several netcdf f
-000143e0: 6f72 6369 6e67 2066 696c 6573 2e20 4279  orcing files. By
-000143f0: 2064 6566 6175 6c74 2022 6461 7973 2073   default "days s
-00014400: 696e 6365 2031 3930 302d 3031 2d30 3154  ince 1900-01-01T
-00014410: 3030 3a30 303a 3030 222e 0a0a 2020 2020  00:00:00"...    
-00014420: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014430: 6966 206e 6f74 2073 656c 662e 5f77 7269  if not self._wri
-00014440: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-00014450: 7261 6973 6520 494f 4572 726f 7228 224d  raise IOError("M
-00014460: 6f64 656c 206f 7065 6e65 6420 696e 2072  odel opened in r
-00014470: 6561 642d 6f6e 6c79 206d 6f64 6522 290a  ead-only mode").
-00014480: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00014490: 666f 7263 696e 673a 0a20 2020 2020 2020  forcing:.       
-000144a0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-000144b0: 2e69 6e66 6f28 2257 7269 7465 2066 6f72  .info("Write for
-000144c0: 6369 6e67 2066 696c 6522 290a 0a20 2020  cing file")..   
-000144d0: 2020 2020 2020 2020 2023 2047 6574 2064           # Get d
-000144e0: 6566 6175 6c74 2066 6f72 6369 6e67 206e  efault forcing n
-000144f0: 616d 6520 6672 6f6d 2066 6f72 6369 6e67  ame from forcing
-00014500: 2061 7474 7273 0a20 2020 2020 2020 2020   attrs.         
-00014510: 2020 2079 7230 203d 2070 642e 746f 5f64     yr0 = pd.to_d
-00014520: 6174 6574 696d 6528 7365 6c66 2e67 6574  atetime(self.get
-00014530: 5f63 6f6e 6669 6728 2273 7461 7274 7469  _config("startti
-00014540: 6d65 2229 292e 7965 6172 0a20 2020 2020  me")).year.     
-00014550: 2020 2020 2020 2079 7231 203d 2070 642e         yr1 = pd.
-00014560: 746f 5f64 6174 6574 696d 6528 7365 6c66  to_datetime(self
-00014570: 2e67 6574 5f63 6f6e 6669 6728 2265 6e64  .get_config("end
-00014580: 7469 6d65 2229 292e 7965 6172 0a20 2020  time")).year.   
-00014590: 2020 2020 2020 2020 2066 7265 7120 3d20           freq = 
-000145a0: 7365 6c66 2e67 6574 5f63 6f6e 6669 6728  self.get_config(
-000145b0: 2274 696d 6573 7465 7073 6563 7322 290a  "timestepsecs").
-000145c0: 0a20 2020 2020 2020 2020 2020 2023 2067  .            # g
-000145d0: 6574 206f 7574 7075 7420 6669 6c65 6e61  et output filena
-000145e0: 6d65 0a20 2020 2020 2020 2020 2020 2069  me.            i
-000145f0: 6620 666e 5f6f 7574 2069 7320 6e6f 7420  f fn_out is not 
-00014600: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00014610: 2020 2020 2020 7365 6c66 2e73 6574 5f63        self.set_c
-00014620: 6f6e 6669 6728 2269 6e70 7574 2e70 6174  onfig("input.pat
-00014630: 685f 666f 7263 696e 6722 2c20 666e 5f6f  h_forcing", fn_o
-00014640: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
-00014650: 2020 2020 7365 6c66 2e77 7269 7465 5f63      self.write_c
-00014660: 6f6e 6669 6728 2920 2023 2072 652d 7772  onfig()  # re-wr
-00014670: 6974 6520 636f 6e66 6967 0a20 2020 2020  ite config.     
-00014680: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00014690: 2020 2020 2020 2020 2020 2020 2066 6e5f               fn_
-000146a0: 6f75 7420 3d20 7365 6c66 2e67 6574 5f63  out = self.get_c
-000146b0: 6f6e 6669 6728 2269 6e70 7574 2e70 6174  onfig("input.pat
-000146c0: 685f 666f 7263 696e 6722 2c20 6162 735f  h_forcing", abs_
-000146d0: 7061 7468 3d54 7275 6529 0a20 2020 2020  path=True).     
-000146e0: 2020 2020 2020 2020 2020 2023 2067 6574             # get
-000146f0: 2064 6561 6675 6c74 2066 696c 656e 616d   deafult filenam
-00014700: 6520 6966 2066 696c 6520 6578 6973 7473  e if file exists
-00014710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014720: 2069 6620 666e 5f6f 7574 2069 7320 4e6f   if fn_out is No
-00014730: 6e65 206f 7220 6973 6669 6c65 2866 6e5f  ne or isfile(fn_
-00014740: 6f75 7429 3a0a 2020 2020 2020 2020 2020  out):.          
-00014750: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00014760: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
-00014770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014780: 2020 2020 2020 2022 4e65 7463 6466 2066         "Netcdf f
-00014790: 6f72 6369 6e67 2066 696c 6520 6672 6f6d  orcing file from
-000147a0: 2069 6e70 7574 2e70 6174 685f 666f 7263   input.path_forc
-000147b0: 696e 6720 696e 2074 6865 2054 4f4d 4c20  ing in the TOML 
-000147c0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000147d0: 2020 2020 2020 2020 2020 2022 616c 7265             "alre
-000147e0: 6164 7920 6578 6973 7473 2c20 7573 696e  ady exists, usin
-000147f0: 6720 6465 6661 756c 7420 6e61 6d65 2e22  g default name."
-00014800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014810: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00014820: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-00014830: 6550 203d 2022 220a 2020 2020 2020 2020  eP = "".        
-00014840: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-00014850: 6365 5420 3d20 2222 0a20 2020 2020 2020  ceT = "".       
-00014860: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00014870: 686f 6450 4554 203d 2022 220a 2020 2020  hodPET = "".    
-00014880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014890: 6966 2022 7072 6563 6970 2220 696e 2073  if "precip" in s
-000148a0: 656c 662e 666f 7263 696e 673a 0a20 2020  elf.forcing:.   
-000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148c0: 2020 2020 2076 616c 203d 2073 656c 662e       val = self.
-000148d0: 666f 7263 696e 675b 2270 7265 6369 7022  forcing["precip"
-000148e0: 5d2e 6174 7472 732e 6765 7428 2270 7265  ].attrs.get("pre
-000148f0: 6369 705f 636c 696d 5f66 6e22 2c20 4e6f  cip_clim_fn", No
-00014900: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-00014910: 2020 2020 2020 2020 2020 2020 5064 6f77              Pdow
-00014920: 6e20 3d20 2264 2220 6966 2076 616c 2069  n = "d" if val i
-00014930: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00014940: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
-00014950: 2020 2020 2020 2020 2020 2076 616c 203d             val =
-00014960: 2073 656c 662e 666f 7263 696e 675b 2270   self.forcing["p
-00014970: 7265 6369 7022 5d2e 6174 7472 732e 6765  recip"].attrs.ge
-00014980: 7428 2270 7265 6369 705f 666e 222c 204e  t("precip_fn", N
-00014990: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-000149a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000149b0: 7661 6c20 6973 206e 6f74 204e 6f6e 653a  val is not None:
-000149c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000149d0: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
-000149e0: 7263 6550 203d 2066 225f 7b76 616c 7d7b  rceP = f"_{val}{
-000149f0: 5064 6f77 6e7d 220a 2020 2020 2020 2020  Pdown}".        
-00014a00: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-00014a10: 7465 6d70 2220 696e 2073 656c 662e 666f  temp" in self.fo
-00014a20: 7263 696e 673a 0a20 2020 2020 2020 2020  rcing:.         
-00014a30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00014a40: 616c 203d 2073 656c 662e 666f 7263 696e  al = self.forcin
-00014a50: 675b 2274 656d 7022 5d2e 6174 7472 732e  g["temp"].attrs.
-00014a60: 6765 7428 2274 656d 705f 636f 7272 6563  get("temp_correc
-00014a70: 7469 6f6e 222c 2022 4661 6c73 6522 290a  tion", "False").
-00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a90: 2020 2020 2020 2020 5464 6f77 6e20 3d20          Tdown = 
-00014aa0: 2264 2220 6966 2076 616c 203d 3d20 2254  "d" if val == "T
-00014ab0: 7275 6522 2065 6c73 6520 2222 0a20 2020  rue" else "".   
-00014ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ad0: 2020 2020 2076 616c 203d 2073 656c 662e       val = self.
-00014ae0: 666f 7263 696e 675b 2274 656d 7022 5d2e  forcing["temp"].
-00014af0: 6174 7472 732e 6765 7428 2274 656d 705f  attrs.get("temp_
-00014b00: 666e 222c 204e 6f6e 6529 0a20 2020 2020  fn", None).     
-00014b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b20: 2020 2069 6620 7661 6c20 6973 206e 6f74     if val is not
-00014b30: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00014b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b50: 2020 2073 6f75 7263 6554 203d 2066 225f     sourceT = f"_
-00014b60: 7b76 616c 7d7b 5464 6f77 6e7d 220a 2020  {val}{Tdown}".  
-00014b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b80: 2020 6966 2022 7065 7422 2069 6e20 7365    if "pet" in se
-00014b90: 6c66 2e66 6f72 6369 6e67 3a0a 2020 2020  lf.forcing:.    
-00014ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bb0: 2020 2020 7661 6c20 3d20 7365 6c66 2e66      val = self.f
-00014bc0: 6f72 6369 6e67 5b22 7065 7422 5d2e 6174  orcing["pet"].at
-00014bd0: 7472 732e 6765 7428 2270 6574 5f6d 6574  trs.get("pet_met
-00014be0: 686f 6422 2c20 4e6f 6e65 290a 2020 2020  hod", None).    
-00014bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c00: 2020 2020 6966 2076 616c 2069 7320 6e6f      if val is no
-00014c10: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c30: 2020 2020 6d65 7468 6f64 5045 5420 3d20      methodPET = 
-00014c40: 6622 5f7b 7661 6c7d 220a 2020 2020 2020  f"_{val}".      
-00014c50: 2020 2020 2020 2020 2020 2020 2020 666e                fn
-00014c60: 5f64 6566 6175 6c74 203d 2028 0a20 2020  _default = (.   
-00014c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c80: 2020 2020 2066 2269 6e6d 6170 737b 736f       f"inmaps{so
-00014c90: 7572 6365 507d 7b73 6f75 7263 6554 7d7b  urceP}{sourceT}{
-00014ca0: 6d65 7468 6f64 5045 547d 5f7b 6672 6571  methodPET}_{freq
-00014cb0: 7d5f 7b79 7230 7d5f 7b79 7231 7d2e 6e63  }_{yr0}_{yr1}.nc
-00014cc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014cd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00014ce0: 2020 2020 2020 2020 2020 2020 666e 5f64              fn_d
-00014cf0: 6566 6175 6c74 5f70 6174 6820 3d20 6a6f  efault_path = jo
-00014d00: 696e 2873 656c 662e 726f 6f74 2c20 666e  in(self.root, fn
-00014d10: 5f64 6566 6175 6c74 290a 2020 2020 2020  _default).      
-00014d20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014d30: 2069 7366 696c 6528 666e 5f64 6566 6175   isfile(fn_defau
-00014d40: 6c74 5f70 6174 6829 3a0a 2020 2020 2020  lt_path):.      
-00014d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d60: 2020 7365 6c66 2e6c 6f67 6765 722e 7761    self.logger.wa
-00014d70: 726e 696e 6728 0a20 2020 2020 2020 2020  rning(.         
-00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d90: 2020 2022 4e65 7463 6466 2064 6566 6175     "Netcdf defau
-00014da0: 6c74 2066 6f72 6369 6e67 2066 696c 6520  lt forcing file 
-00014db0: 616c 7265 6164 7920 6578 6973 7473 2c20  already exists, 
-00014dc0: 736b 6970 7069 6e67 2077 7269 7465 5f66  skipping write_f
-00014dd0: 6f72 6369 6e67 2e20 220a 2020 2020 2020  orcing. ".      
-00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014df0: 2020 2020 2020 2254 6f20 6f76 6572 7772        "To overwr
-00014e00: 6974 6520 6e65 7463 6466 2066 6f72 6369  ite netcdf forci
-00014e10: 6e67 2066 696c 653a 2063 6861 6e67 6520  ng file: change 
-00014e20: 6e61 6d65 2069 6e70 7574 2e70 6174 685f  name input.path_
-00014e30: 666f 7263 696e 6720 220a 2020 2020 2020  forcing ".      
-00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e50: 2020 2020 2020 2269 6e20 7365 7475 705f        "in setup_
-00014e60: 636f 6e66 6967 2073 6563 7469 6f6e 206f  config section o
-00014e70: 6620 7468 6520 6275 696c 6420 696e 6966  f the build inif
-00014e80: 696c 652e 220a 2020 2020 2020 2020 2020  ile.".          
-00014e90: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00014ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014eb0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00014ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ed0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00014ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ef0: 2073 656c 662e 7365 745f 636f 6e66 6967   self.set_config
-00014f00: 2822 696e 7075 742e 7061 7468 5f66 6f72  ("input.path_for
-00014f10: 6369 6e67 222c 2066 6e5f 6465 6661 756c  cing", fn_defaul
-00014f20: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00014f30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00014f40: 7772 6974 655f 636f 6e66 6967 2829 2020  write_config()  
-00014f50: 2320 7265 2d77 7269 7465 2063 6f6e 6669  # re-write confi
-00014f60: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00014f70: 2020 2020 2020 2020 2020 666e 5f6f 7574            fn_out
-00014f80: 203d 2066 6e5f 6465 6661 756c 745f 7061   = fn_default_pa
-00014f90: 7468 0a0a 2020 2020 2020 2020 2020 2020  th..            
-00014fa0: 2320 4368 6563 6b20 6966 2061 6c6c 2064  # Check if all d
-00014fb0: 6174 6573 2062 6574 7765 656e 2028 7374  ates between (st
-00014fc0: 6172 7474 696d 652c 2065 6e64 7469 6d65  arttime, endtime
-00014fd0: 2920 6172 6520 696e 2061 6c6c 2064 6120  ) are in all da 
-00014fe0: 666f 7263 696e 670a 2020 2020 2020 2020  forcing.        
-00014ff0: 2020 2020 7374 6172 7420 3d20 7064 2e74      start = pd.t
-00015000: 6f5f 6461 7465 7469 6d65 2873 656c 662e  o_datetime(self.
-00015010: 6765 745f 636f 6e66 6967 2822 7374 6172  get_config("star
-00015020: 7474 696d 6522 2929 0a20 2020 2020 2020  ttime")).       
-00015030: 2020 2020 2065 6e64 203d 2070 642e 746f       end = pd.to
-00015040: 5f64 6174 6574 696d 6528 7365 6c66 2e67  _datetime(self.g
-00015050: 6574 5f63 6f6e 6669 6728 2265 6e64 7469  et_config("endti
-00015060: 6d65 2229 290a 2020 2020 2020 2020 2020  me")).          
-00015070: 2020 6d69 7373 696e 6773 203d 2046 616c    missings = Fal
-00015080: 7365 0a20 2020 2020 2020 2020 2020 2066  se.            f
-00015090: 6f72 2064 6120 696e 2073 656c 662e 666f  or da in self.fo
-000150a0: 7263 696e 672e 7661 6c75 6573 2829 3a0a  rcing.values():.
-000150b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150c0: 6966 2022 7469 6d65 2220 696e 2064 612e  if "time" in da.
-000150d0: 636f 6f72 6473 3a0a 2020 2020 2020 2020  coords:.        
-000150e0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-000150f0: 6173 6174 7472 2864 612e 696e 6465 7865  asattr(da.indexe
-00015100: 735b 2274 696d 6522 5d2c 2022 746f 5f64  s["time"], "to_d
-00015110: 6174 6574 696d 6569 6e64 6578 2229 3a0a  atetimeindex"):.
-00015120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015130: 2020 2020 2020 2020 7469 6d65 7320 3d20          times = 
-00015140: 6461 2e69 6e64 6578 6573 5b22 7469 6d65  da.indexes["time
-00015150: 225d 2e74 6f5f 6461 7465 7469 6d65 696e  "].to_datetimein
-00015160: 6465 7828 292e 7661 6c75 6573 0a20 2020  dex().values.   
-00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015180: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00015190: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000151a0: 696d 6573 203d 2064 612e 7469 6d65 2e76  imes = da.time.v
-000151b0: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
-000151c0: 2020 2020 2020 2020 2020 6966 2073 7461            if sta
-000151d0: 7274 203c 2070 642e 746f 5f64 6174 6574  rt < pd.to_datet
-000151e0: 696d 6528 7469 6d65 735b 305d 293a 0a20  ime(times[0]):. 
-000151f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015200: 2020 2020 2020 2073 7461 7274 203d 2070         start = p
-00015210: 642e 746f 5f64 6174 6574 696d 6528 7469  d.to_datetime(ti
-00015220: 6d65 735b 305d 290a 2020 2020 2020 2020  mes[0]).        
-00015230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015240: 6d69 7373 696e 6773 203d 2054 7275 650a  missings = True.
-00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015260: 2020 2020 6966 2065 6e64 203e 2070 642e      if end > pd.
-00015270: 746f 5f64 6174 6574 696d 6528 7469 6d65  to_datetime(time
-00015280: 735b 2d31 5d29 3a0a 2020 2020 2020 2020  s[-1]):.        
-00015290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152a0: 656e 6420 3d20 7064 2e74 6f5f 6461 7465  end = pd.to_date
-000152b0: 7469 6d65 2874 696d 6573 5b2d 315d 290a  time(times[-1]).
-000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152d0: 2020 2020 2020 2020 6d69 7373 696e 6773          missings
-000152e0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000152f0: 2020 2020 2320 6d65 7267 652c 2070 726f      # merge, pro
-00015300: 6365 7373 2061 6e64 2077 7269 7465 2066  cess and write f
-00015310: 6f72 6369 6e67 0a20 2020 2020 2020 2020  orcing.         
-00015320: 2020 2064 7320 3d20 7872 2e6d 6572 6765     ds = xr.merge
-00015330: 285b 6461 2e72 6573 6574 5f63 6f6f 7264  ([da.reset_coord
-00015340: 7328 6472 6f70 3d54 7275 6529 2066 6f72  s(drop=True) for
-00015350: 2064 6120 696e 2073 656c 662e 666f 7263   da in self.forc
-00015360: 696e 672e 7661 6c75 6573 2829 5d29 0a20  ing.values()]). 
-00015370: 2020 2020 2020 2020 2020 2064 732e 7261             ds.ra
-00015380: 7374 6572 2e73 6574 5f63 7273 2873 656c  ster.set_crs(sel
-00015390: 662e 6372 7329 0a20 2020 2020 2020 2020  f.crs).         
-000153a0: 2020 2023 2053 656e 6420 7761 726e 696e     # Send warnin
-000153b0: 672c 2073 6c69 6365 2064 7320 616e 6420  g, slice ds and 
-000153c0: 7570 6461 7465 2063 6f6e 6669 6720 7769  update config wi
-000153d0: 7468 206e 6577 2073 7461 7274 2061 6e64  th new start and
-000153e0: 2065 6e64 2074 696d 650a 2020 2020 2020   end time.      
-000153f0: 2020 2020 2020 6966 206d 6973 7369 6e67        if missing
-00015400: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00015410: 2020 2073 656c 662e 6c6f 6767 6572 2e77     self.logger.w
-00015420: 6172 6e69 6e67 280a 2020 2020 2020 2020  arning(.        
-00015430: 2020 2020 2020 2020 2020 2020 6622 4e6f              f"No
-00015440: 7420 616c 6c20 6461 7465 7320 666f 756e  t all dates foun
-00015450: 6420 696e 2070 7265 6369 705f 666e 2063  d in precip_fn c
-00015460: 6861 6e67 696e 6720 7374 6172 7474 696d  hanging starttim
-00015470: 6520 746f 207b 7374 6172 747d 2061 6e64  e to {start} and
-00015480: 2065 6e64 7469 6d65 2074 6f20 7b65 6e64   endtime to {end
-00015490: 7d20 696e 2074 6865 2074 6f6d 6c2e 220a  } in the toml.".
-000154a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000154c0: 2020 7365 6c66 2e73 6574 5f63 6f6e 6669    self.set_confi
-000154d0: 6728 2273 7461 7274 7469 6d65 222c 2073  g("starttime", s
-000154e0: 7461 7274 2e74 6f5f 7079 6461 7465 7469  tart.to_pydateti
-000154f0: 6d65 2829 290a 2020 2020 2020 2020 2020  me()).          
-00015500: 2020 2020 2020 7365 6c66 2e73 6574 5f63        self.set_c
-00015510: 6f6e 6669 6728 2265 6e64 7469 6d65 222c  onfig("endtime",
-00015520: 2065 6e64 2e74 6f5f 7079 6461 7465 7469   end.to_pydateti
-00015530: 6d65 2829 290a 2020 2020 2020 2020 2020  me()).          
-00015540: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
-00015550: 5f63 6f6e 6669 6728 290a 2020 2020 2020  _config().      
-00015560: 2020 2020 2020 2020 2020 6473 203d 2064            ds = d
-00015570: 732e 7365 6c28 7b22 7469 6d65 223a 2073  s.sel({"time": s
-00015580: 6c69 6365 2873 7461 7274 2c20 656e 6429  lice(start, end)
-00015590: 7d29 0a0a 2020 2020 2020 2020 2020 2020  })..            
-000155a0: 6966 2064 6563 696d 616c 7320 6973 206e  if decimals is n
-000155b0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000155c0: 2020 2020 2020 2020 2064 7320 3d20 6473           ds = ds
-000155d0: 2e72 6f75 6e64 2864 6563 696d 616c 7329  .round(decimals)
-000155e0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-000155f0: 6c65 616e 2d75 7020 666f 7263 696e 6720  lean-up forcing 
-00015600: 616e 6420 7772 6974 6520 4352 5320 6163  and write CRS ac
-00015610: 636f 7264 696e 6720 746f 2043 462d 636f  cording to CF-co
-00015620: 6e76 656e 7469 6f6e 730a 2020 2020 2020  nventions.      
-00015630: 2020 2020 2020 6473 203d 2064 732e 7261        ds = ds.ra
-00015640: 7374 6572 2e67 6461 6c5f 636f 6d70 6c69  ster.gdal_compli
-00015650: 616e 7428 7265 6e61 6d65 5f64 696d 733d  ant(rename_dims=
-00015660: 5472 7565 2c20 666f 7263 655f 736e 3d46  True, force_sn=F
-00015670: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-00015680: 2020 6473 203d 2064 732e 6472 6f70 5f76    ds = ds.drop_v
-00015690: 6172 7328 5b22 6d61 736b 222c 2022 6964  ars(["mask", "id
-000156a0: 785f 6f75 7422 5d2c 2065 7272 6f72 733d  x_out"], errors=
-000156b0: 2269 676e 6f72 6522 290a 0a20 2020 2020  "ignore")..     
-000156c0: 2020 2020 2020 2023 2077 7269 7465 2077         # write w
-000156d0: 6974 6820 6f75 7470 7574 2063 6875 6e6b  ith output chunk
-000156e0: 7369 7a65 7320 7769 7468 2073 696e 676c  sizes with singl
-000156f0: 6520 7469 6d65 7374 6570 2061 6e64 2063  e timestep and c
-00015700: 6f6d 706c 6574 650a 2020 2020 2020 2020  omplete.        
-00015710: 2020 2020 2320 7370 6174 6961 6c20 6772      # spatial gr
-00015720: 6964 2074 6f20 7370 6565 6420 7570 2074  id to speed up t
-00015730: 6865 2072 6561 6469 6e67 2066 726f 6d20  he reading from 
-00015740: 7766 6c6f 772e 6a6c 0a20 2020 2020 2020  wflow.jl.       
-00015750: 2020 2020 2023 2064 696d 7320 6172 6520       # dims are 
-00015760: 616c 7761 7973 206f 7264 6572 6564 2028  always ordered (
-00015770: 7469 6d65 2c20 792c 2078 290a 2020 2020  time, y, x).    
-00015780: 2020 2020 2020 2020 6473 2e72 6173 7465          ds.raste
-00015790: 722e 5f63 6865 636b 5f64 696d 656e 7369  r._check_dimensi
-000157a0: 6f6e 7328 290a 2020 2020 2020 2020 2020  ons().          
-000157b0: 2020 6368 756e 6b73 697a 6573 203d 2028    chunksizes = (
-000157c0: 6368 756e 6b73 697a 652c 2064 732e 7261  chunksize, ds.ra
-000157d0: 7374 6572 2e79 636f 6f72 6473 2e73 697a  ster.ycoords.siz
-000157e0: 652c 2064 732e 7261 7374 6572 2e78 636f  e, ds.raster.xco
-000157f0: 6f72 6473 2e73 697a 6529 0a20 2020 2020  ords.size).     
-00015800: 2020 2020 2020 2065 6e63 6f64 696e 6720         encoding 
-00015810: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00015820: 2020 2020 763a 207b 227a 6c69 6222 3a20      v: {"zlib": 
-00015830: 5472 7565 2c20 2264 7479 7065 223a 2022  True, "dtype": "
-00015840: 666c 6f61 7433 3222 2c20 2263 6875 6e6b  float32", "chunk
-00015850: 7369 7a65 7322 3a20 6368 756e 6b73 697a  sizes": chunksiz
-00015860: 6573 7d0a 2020 2020 2020 2020 2020 2020  es}.            
-00015870: 2020 2020 666f 7220 7620 696e 2064 732e      for v in ds.
-00015880: 6461 7461 5f76 6172 732e 6b65 7973 2829  data_vars.keys()
-00015890: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-000158a0: 2020 2020 2020 2020 2020 2023 206d 616b             # mak
-000158b0: 6520 7375 7265 206e 6f20 5f46 696c 6c56  e sure no _FillV
-000158c0: 616c 7565 2069 7320 7772 6974 7465 6e20  alue is written 
-000158d0: 746f 2074 6865 2074 696d 6520 6469 6d65  to the time dime
-000158e0: 6e73 696f 6e0a 2020 2020 2020 2020 2020  nsion.          
-000158f0: 2020 2320 466f 7220 7365 7665 7261 6c20    # For several 
-00015900: 666f 7263 696e 6720 6669 6c65 7320 6164  forcing files ad
-00015910: 6420 636f 6d6d 6f6e 2075 6e69 7473 2061  d common units a
-00015920: 7474 7269 6275 7465 7320 746f 2074 696d  ttributes to tim
-00015930: 650a 2020 2020 2020 2020 2020 2020 6473  e.            ds
-00015940: 5b22 7469 6d65 225d 2e61 7474 7273 2e70  ["time"].attrs.p
-00015950: 6f70 2822 5f46 696c 6c56 616c 7565 222c  op("_FillValue",
-00015960: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-00015970: 2020 2065 6e63 6f64 696e 675b 2274 696d     encoding["tim
-00015980: 6522 5d20 3d20 7b22 5f46 696c 6c56 616c  e"] = {"_FillVal
-00015990: 7565 223a 204e 6f6e 657d 0a0a 2020 2020  ue": None}..    
-000159a0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-000159b0: 6966 2061 6c6c 2073 7562 2d66 6f6c 6465  if all sub-folde
-000159c0: 7273 2069 6e20 666e 5f6f 7574 2065 7869  rs in fn_out exi
-000159d0: 7374 7320 616e 6420 6966 206e 6f74 2063  sts and if not c
-000159e0: 7265 6174 6520 7468 656d 0a20 2020 2020  reate them.     
-000159f0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00015a00: 6469 7228 6469 726e 616d 6528 666e 5f6f  dir(dirname(fn_o
-00015a10: 7574 2929 3a0a 2020 2020 2020 2020 2020  ut)):.          
-00015a20: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
-00015a30: 7328 6469 726e 616d 6528 666e 5f6f 7574  s(dirname(fn_out
-00015a40: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00015a50: 666f 7263 696e 675f 6c69 7374 203d 205b  forcing_list = [
-00015a60: 5d0a 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-00015a70: 6620 6672 6571 5f6f 7574 2069 7320 4e6f  f freq_out is No
-00015a80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00015a90: 2020 2020 2320 7769 7468 2063 6f6d 7075      # with compu
-00015aa0: 7465 3d46 616c 7365 2077 6520 6765 7420  te=False we get 
-00015ab0: 6120 6465 6c61 7965 6420 6f62 6a65 6374  a delayed object
-00015ac0: 2077 6869 6368 2069 7320 6578 6563 7574   which is execut
-00015ad0: 6564 2077 6865 6e0a 2020 2020 2020 2020  ed when.        
-00015ae0: 2020 2020 2020 2020 2320 6361 6c6c 696e          # callin
-00015af0: 6720 2e63 6f6d 7075 7465 2077 6865 7265  g .compute where
-00015b00: 2077 6520 6361 6e20 7061 7373 206d 6f72   we can pass mor
-00015b10: 6520 6172 6775 6d65 6e74 7320 746f 2074  e arguments to t
-00015b20: 6865 2064 6173 6b2e 636f 6d70 7574 6520  he dask.compute 
-00015b30: 6d65 7468 6f64 0a20 2020 2020 2020 2020  method.         
-00015b40: 2020 2020 2020 2066 6f72 6369 6e67 5f6c         forcing_l
-00015b50: 6973 742e 6170 7065 6e64 285b 666e 5f6f  ist.append([fn_o
-00015b60: 7574 2c20 6473 5d29 0a20 2020 2020 2020  ut, ds]).       
-00015b70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00015b80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015b90: 6c6f 6767 6572 2e69 6e66 6f28 6622 5772  logger.info(f"Wr
-00015ba0: 6974 7469 6e67 2073 6576 6572 616c 2066  itting several f
-00015bb0: 6f72 6369 6e67 2077 6974 6820 6672 6571  orcing with freq
-00015bc0: 207b 6672 6571 5f6f 7574 7d22 290a 2020   {freq_out}").  
-00015bd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00015be0: 466f 7220 7365 7665 7261 6c20 666f 7263  For several forc
-00015bf0: 696e 6720 6669 6c65 7320 6164 6420 636f  ing files add co
-00015c00: 6d6d 6f6e 2075 6e69 7473 2061 7474 7269  mmon units attri
-00015c10: 6275 7465 7320 746f 2074 696d 650a 2020  butes to time.  
-00015c20: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00015c30: 636f 6469 6e67 5b22 7469 6d65 225d 203d  coding["time"] =
-00015c40: 207b 225f 4669 6c6c 5661 6c75 6522 3a20   {"_FillValue": 
-00015c50: 4e6f 6e65 2c20 2275 6e69 7473 223a 2074  None, "units": t
-00015c60: 696d 655f 756e 6974 737d 0a20 2020 2020  ime_units}.     
-00015c70: 2020 2020 2020 2020 2020 2023 2055 7064             # Upd
-00015c80: 6174 696e 6720 7061 7468 2066 6f72 6369  ating path forci
-00015c90: 6e67 2069 6e20 636f 6e66 6967 0a20 2020  ng in config.   
-00015ca0: 2020 2020 2020 2020 2020 2020 2066 6e73               fns
-00015cb0: 5f6f 7574 203d 206f 732e 7061 7468 2e72  _out = os.path.r
-00015cc0: 656c 7061 7468 2866 6e5f 6f75 742c 2073  elpath(fn_out, s
-00015cd0: 656c 662e 726f 6f74 290a 2020 2020 2020  elf.root).      
-00015ce0: 2020 2020 2020 2020 2020 666e 735f 6f75            fns_ou
-00015cf0: 7420 3d20 6622 7b73 7472 2866 6e73 5f6f  t = f"{str(fns_o
-00015d00: 7574 295b 303a 2d33 5d7d 5f2a 2e6e 6322  ut)[0:-3]}_*.nc"
-00015d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015d20: 2073 656c 662e 7365 745f 636f 6e66 6967   self.set_config
-00015d30: 2822 696e 7075 742e 7061 7468 5f66 6f72  ("input.path_for
-00015d40: 6369 6e67 222c 2066 6e73 5f6f 7574 290a  cing", fns_out).
-00015d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d60: 7365 6c66 2e77 7269 7465 5f63 6f6e 6669  self.write_confi
-00015d70: 6728 2920 2023 2072 652d 7772 6974 6520  g()  # re-write 
-00015d80: 636f 6e66 6967 0a20 2020 2020 2020 2020  config.         
-00015d90: 2020 2020 2020 2066 6f72 206c 6162 656c         for label
-00015da0: 2c20 6473 5f67 7220 696e 2064 732e 7265  , ds_gr in ds.re
-00015db0: 7361 6d70 6c65 2874 696d 653d 6672 6571  sample(time=freq
-00015dc0: 5f6f 7574 293a 0a20 2020 2020 2020 2020  _out):.         
-00015dd0: 2020 2020 2020 2020 2020 2023 2064 735f             # ds_
-00015de0: 6772 203d 2067 726f 7570 5b31 5d0a 2020  gr = group[1].  
-00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e00: 2020 7374 6172 7420 3d20 6473 5f67 725b    start = ds_gr[
-00015e10: 2274 696d 6522 5d2e 6474 2e73 7472 6674  "time"].dt.strft
-00015e20: 696d 6528 2225 5925 6d25 6422 295b 305d  ime("%Y%m%d")[0]
-00015e30: 2e69 7465 6d28 290a 2020 2020 2020 2020  .item().        
-00015e40: 2020 2020 2020 2020 2020 2020 666e 5f6f              fn_o
-00015e50: 7574 5f67 7220 3d20 6622 7b73 7472 2866  ut_gr = f"{str(f
-00015e60: 6e5f 6f75 7429 5b30 3a2d 335d 7d5f 7b73  n_out)[0:-3]}_{s
-00015e70: 7461 7274 7d2e 6e63 220a 2020 2020 2020  tart}.nc".      
-00015e80: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00015e90: 7263 696e 675f 6c69 7374 2e61 7070 656e  rcing_list.appen
-00015ea0: 6428 5b66 6e5f 6f75 745f 6772 2c20 6473  d([fn_out_gr, ds
-00015eb0: 5f67 725d 290a 0a20 2020 2020 2020 2020  _gr])..         
-00015ec0: 2020 2066 6f72 2066 6e5f 6f75 745f 6772     for fn_out_gr
-00015ed0: 2c20 6473 5f67 7220 696e 2066 6f72 6369  , ds_gr in forci
-00015ee0: 6e67 5f6c 6973 743a 0a20 2020 2020 2020  ng_list:.       
-00015ef0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00015f00: 6767 6572 2e69 6e66 6f28 6622 5072 6f63  gger.info(f"Proc
-00015f10: 6573 7320 666f 7263 696e 673b 2073 6176  ess forcing; sav
-00015f20: 696e 6720 746f 207b 666e 5f6f 7574 5f67  ing to {fn_out_g
-00015f30: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
-00015f40: 2020 2020 2064 656c 6179 6564 5f6f 626a       delayed_obj
-00015f50: 203d 2064 735f 6772 2e74 6f5f 6e65 7463   = ds_gr.to_netc
-00015f60: 6466 280a 2020 2020 2020 2020 2020 2020  df(.            
-00015f70: 2020 2020 2020 2020 666e 5f6f 7574 5f67          fn_out_g
-00015f80: 722c 2065 6e63 6f64 696e 673d 656e 636f  r, encoding=enco
-00015f90: 6469 6e67 2c20 6d6f 6465 3d22 7722 2c20  ding, mode="w", 
-00015fa0: 636f 6d70 7574 653d 4661 6c73 650a 2020  compute=False.  
-00015fb0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00015fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fd0: 7769 7468 2050 726f 6772 6573 7342 6172  with ProgressBar
-00015fe0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00015ff0: 2020 2020 2020 2020 6465 6c61 7965 645f          delayed_
-00016000: 6f62 6a2e 636f 6d70 7574 6528 2a2a 6b77  obj.compute(**kw
-00016010: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
-00016020: 2020 2023 2054 4f20 7072 6f66 696c 6520     # TO profile 
-00016030: 756e 636f 6d6d 656e 7420 6c69 6e65 7320  uncomment lines 
-00016040: 6265 6c6f 7720 746f 2072 6570 6c61 6365  below to replace
-00016050: 206c 696e 6573 2061 626f 7665 0a20 2020   lines above.   
-00016060: 2020 2020 2020 2020 2023 2066 726f 6d20           # from 
-00016070: 6461 736b 2e64 6961 676e 6f73 7469 6373  dask.diagnostics
-00016080: 2069 6d70 6f72 7420 5072 6f66 696c 6572   import Profiler
-00016090: 2c20 4361 6368 6550 726f 6669 6c65 722c  , CacheProfiler,
-000160a0: 2052 6573 6f75 7263 6550 726f 6669 6c65   ResourceProfile
-000160b0: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
-000160c0: 696d 706f 7274 2063 6163 6865 790a 2020  import cachey.  
-000160d0: 2020 2020 2020 2020 2020 2320 7769 7468            # with
-000160e0: 2050 726f 6669 6c65 7228 2920 6173 2070   Profiler() as p
-000160f0: 726f 662c 2043 6163 6865 5072 6f66 696c  rof, CacheProfil
-00016100: 6572 286d 6574 7269 633d 6361 6368 6579  er(metric=cachey
-00016110: 2e6e 6279 7465 7329 2061 7320 6370 726f  .nbytes) as cpro
-00016120: 662c 2052 6573 6f75 7263 6550 726f 6669  f, ResourceProfi
-00016130: 6c65 7228 2920 6173 2072 7072 6f66 3a0a  ler() as rprof:.
-00016140: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00016150: 2020 6465 6c61 7965 645f 6f62 6a2e 636f    delayed_obj.co
-00016160: 6d70 7574 6528 290a 2020 2020 2020 2020  mpute().        
-00016170: 2020 2020 2320 7669 7375 616c 697a 6528      # visualize(
-00016180: 5b70 726f 662c 2063 7072 6f66 2c20 7270  [prof, cprof, rp
-00016190: 726f 665d 2c20 6669 6c65 5f70 6174 683d  rof], file_path=
-000161a0: 7227 633a 5c55 7365 7273 5c65 696c 616e  r'c:\Users\eilan
-000161b0: 5f64 6b5c 776f 726b 5c70 726f 6669 6c65  _dk\work\profile
-000161c0: 322e 6874 6d6c 2729 0a0a 2020 2020 6465  2.html')..    de
-000161d0: 6620 7265 6164 5f73 7461 7465 7328 7365  f read_states(se
-000161e0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-000161f0: 5265 6164 2073 7461 7465 7320 6174 203c  Read states at <
-00016200: 726f 6f74 2f3f 2f3e 2061 6e64 2070 6172  root/?/> and par
-00016210: 7365 2074 6f20 6469 6374 206f 6620 7872  se to dict of xr
-00016220: 2e44 6174 6141 7272 6179 2222 220a 2020  .DataArray""".  
-00016230: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00016240: 662e 5f77 7269 7465 3a0a 2020 2020 2020  f._write:.      
-00016250: 2020 2020 2020 2320 7374 6172 7420 6672        # start fr
-00016260: 6573 6820 696e 2072 6561 642d 6f6e 6c79  esh in read-only
-00016270: 206d 6f64 650a 2020 2020 2020 2020 2020   mode.          
-00016280: 2020 7365 6c66 2e5f 7374 6174 6573 203d    self._states =
-00016290: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-000162a0: 2320 7261 6973 6520 4e6f 7449 6d70 6c65  # raise NotImple
-000162b0: 6d65 6e74 6564 4572 726f 7228 290a 0a20  mentedError().. 
-000162c0: 2020 2064 6566 2077 7269 7465 5f73 7461     def write_sta
-000162d0: 7465 7328 7365 6c66 293a 0a20 2020 2020  tes(self):.     
-000162e0: 2020 2022 2222 7772 6974 6520 7374 6174     """write stat
-000162f0: 6573 2061 7420 3c72 6f6f 742f 3f2f 3e20  es at <root/?/> 
-00016300: 696e 206d 6f64 656c 2072 6561 6479 2066  in model ready f
-00016310: 6f72 6d61 7422 2222 0a20 2020 2020 2020  ormat""".       
-00016320: 2069 6620 6e6f 7420 7365 6c66 2e5f 7772   if not self._wr
-00016330: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
-00016340: 2072 6169 7365 2049 4f45 7272 6f72 2822   raise IOError("
-00016350: 4d6f 6465 6c20 6f70 656e 6564 2069 6e20  Model opened in 
-00016360: 7265 6164 2d6f 6e6c 7920 6d6f 6465 2229  read-only mode")
-00016370: 0a20 2020 2020 2020 2023 2072 6169 7365  .        # raise
-00016380: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
-00016390: 7272 6f72 2829 0a0a 2020 2020 6465 6620  rror()..    def 
-000163a0: 7265 6164 5f72 6573 756c 7473 2873 656c  read_results(sel
-000163b0: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
-000163c0: 6561 6420 7265 7375 6c74 7320 6174 203c  ead results at <
-000163d0: 726f 6f74 2f3f 2f3e 2061 6e64 2070 6172  root/?/> and par
-000163e0: 7365 2074 6f20 6469 6374 206f 6620 7872  se to dict of xr
-000163f0: 2e44 6174 6141 7272 6179 2f78 722e 4461  .DataArray/xr.Da
-00016400: 7461 7365 7422 2222 0a20 2020 2020 2020  taset""".       
-00016410: 2069 6620 6e6f 7420 7365 6c66 2e5f 7772   if not self._wr
-00016420: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
-00016430: 2023 2073 7461 7274 2066 7265 7368 2069   # start fresh i
-00016440: 6e20 7265 6164 2d6f 6e6c 7920 6d6f 6465  n read-only mode
-00016450: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016460: 662e 5f72 6573 756c 7473 203d 2064 6963  f._results = dic
-00016470: 7428 290a 0a20 2020 2020 2020 2023 2052  t()..        # R
-00016480: 6561 6420 6772 6964 6465 6420 6e65 7463  ead gridded netc
-00016490: 6466 2028 6f75 7470 7574 2073 6563 7469  df (output secti
-000164a0: 6f6e 290a 2020 2020 2020 2020 6e63 5f66  on).        nc_f
-000164b0: 6e20 3d20 7365 6c66 2e67 6574 5f63 6f6e  n = self.get_con
-000164c0: 6669 6728 226f 7574 7075 742e 7061 7468  fig("output.path
-000164d0: 222c 2061 6273 5f70 6174 683d 5472 7565  ", abs_path=True
-000164e0: 290a 2020 2020 2020 2020 6966 206e 635f  ).        if nc_
-000164f0: 666e 2069 7320 6e6f 7420 4e6f 6e65 2061  fn is not None a
-00016500: 6e64 2069 7366 696c 6528 6e63 5f66 6e29  nd isfile(nc_fn)
-00016510: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00016520: 6c66 2e6c 6f67 6765 722e 696e 666f 2866  lf.logger.info(f
-00016530: 2252 6561 6420 7265 7375 6c74 7320 6672  "Read results fr
-00016540: 6f6d 207b 6e63 5f66 6e7d 2229 0a20 2020  om {nc_fn}").   
-00016550: 2020 2020 2020 2020 2064 7320 3d20 7872           ds = xr
-00016560: 2e6f 7065 6e5f 6461 7461 7365 7428 6e63  .open_dataset(nc
-00016570: 5f66 6e2c 2063 6875 6e6b 733d 7b22 7469  _fn, chunks={"ti
-00016580: 6d65 223a 2033 307d 2c20 6465 636f 6465  me": 30}, decode
-00016590: 5f63 6f6f 7264 733d 2261 6c6c 2229 0a20  _coords="all"). 
-000165a0: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
-000165b0: 4f20 3f20 616c 6967 6e20 636f 6f72 6473  O ? align coords
-000165c0: 206e 616d 6573 2061 6e64 2076 616c 7565   names and value
-000165d0: 7320 6f66 2072 6573 756c 7473 206e 6320  s of results nc 
-000165e0: 7769 7468 2073 7461 7469 636d 6170 730a  with staticmaps.
-000165f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016600: 2e73 6574 5f72 6573 756c 7473 2864 732c  .set_results(ds,
-00016610: 206e 616d 653d 226f 7574 7075 7422 290a   name="output").
-00016620: 0a20 2020 2020 2020 2023 2052 6561 6420  .        # Read 
-00016630: 7363 616c 6172 206e 6574 6364 6620 286e  scalar netcdf (n
-00016640: 6574 6364 6620 7365 6374 696f 6e29 0a20  etcdf section). 
-00016650: 2020 2020 2020 206e 6373 5f66 6e20 3d20         ncs_fn = 
-00016660: 7365 6c66 2e67 6574 5f63 6f6e 6669 6728  self.get_config(
-00016670: 226e 6574 6364 662e 7061 7468 222c 2061  "netcdf.path", a
-00016680: 6273 5f70 6174 683d 5472 7565 290a 2020  bs_path=True).  
-00016690: 2020 2020 2020 6966 206e 6373 5f66 6e20        if ncs_fn 
-000166a0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-000166b0: 6973 6669 6c65 286e 6373 5f66 6e29 3a0a  isfile(ncs_fn):.
-000166c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000166d0: 2e6c 6f67 6765 722e 696e 666f 2866 2252  .logger.info(f"R
-000166e0: 6561 6420 7265 7375 6c74 7320 6672 6f6d  ead results from
-000166f0: 207b 6e63 735f 666e 7d22 290a 2020 2020   {ncs_fn}").    
-00016700: 2020 2020 2020 2020 6473 203d 2078 722e          ds = xr.
-00016710: 6f70 656e 5f64 6174 6173 6574 286e 6373  open_dataset(ncs
-00016720: 5f66 6e2c 2063 6875 6e6b 733d 7b22 7469  _fn, chunks={"ti
-00016730: 6d65 223a 2033 307d 290a 2020 2020 2020  me": 30}).      
-00016740: 2020 2020 2020 7365 6c66 2e73 6574 5f72        self.set_r
-00016750: 6573 756c 7473 2864 732c 206e 616d 653d  esults(ds, name=
-00016760: 226e 6574 6364 6622 290a 0a20 2020 2020  "netcdf")..     
-00016770: 2020 2023 2052 6561 6420 6373 7620 7469     # Read csv ti
-00016780: 6d65 7365 7269 6573 2028 6373 7620 7365  meseries (csv se
-00016790: 6374 696f 6e29 0a20 2020 2020 2020 2063  ction).        c
-000167a0: 7376 5f66 6e20 3d20 7365 6c66 2e67 6574  sv_fn = self.get
-000167b0: 5f63 6f6e 6669 6728 2263 7376 2e70 6174  _config("csv.pat
-000167c0: 6822 2c20 6162 735f 7061 7468 3d54 7275  h", abs_path=Tru
-000167d0: 6529 0a20 2020 2020 2020 2069 6620 6373  e).        if cs
-000167e0: 765f 666e 2069 7320 6e6f 7420 4e6f 6e65  v_fn is not None
-000167f0: 2061 6e64 2069 7366 696c 6528 6373 765f   and isfile(csv_
-00016800: 666e 293a 0a20 2020 2020 2020 2020 2020  fn):.           
-00016810: 2063 7376 5f64 6963 7420 3d20 7574 696c   csv_dict = util
-00016820: 732e 7265 6164 5f63 7376 5f72 6573 756c  s.read_csv_resul
-00016830: 7473 280a 2020 2020 2020 2020 2020 2020  ts(.            
-00016840: 2020 2020 6373 765f 666e 2c20 636f 6e66      csv_fn, conf
-00016850: 6967 3d73 656c 662e 636f 6e66 6967 2c20  ig=self.config, 
-00016860: 6d61 7073 3d73 656c 662e 7374 6174 6963  maps=self.static
-00016870: 6d61 7073 0a20 2020 2020 2020 2020 2020  maps.           
-00016880: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
-00016890: 6f72 206b 6579 2069 6e20 6373 765f 6469  or key in csv_di
-000168a0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
-000168b0: 2020 2020 2320 4164 6420 746f 2072 6573      # Add to res
-000168c0: 756c 7473 0a20 2020 2020 2020 2020 2020  ults.           
-000168d0: 2020 2020 2073 656c 662e 7365 745f 7265       self.set_re
-000168e0: 7375 6c74 7328 6373 765f 6469 6374 5b66  sults(csv_dict[f
-000168f0: 227b 6b65 797d 225d 290a 0a20 2020 2064  "{key}"])..    d
-00016900: 6566 2077 7269 7465 5f72 6573 756c 7473  ef write_results
-00016910: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00016920: 2222 2277 7269 7465 2072 6573 756c 7473  """write results
-00016930: 2061 7420 3c72 6f6f 742f 3f2f 3e20 696e   at <root/?/> in
-00016940: 206d 6f64 656c 2072 6561 6479 2066 6f72   model ready for
-00016950: 6d61 7422 2222 0a20 2020 2020 2020 2069  mat""".        i
-00016960: 6620 6e6f 7420 7365 6c66 2e5f 7772 6974  f not self._writ
-00016970: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00016980: 6169 7365 2049 4f45 7272 6f72 2822 4d6f  aise IOError("Mo
-00016990: 6465 6c20 6f70 656e 6564 2069 6e20 7265  del opened in re
-000169a0: 6164 2d6f 6e6c 7920 6d6f 6465 2229 0a20  ad-only mode"). 
-000169b0: 2020 2020 2020 2023 2072 6169 7365 204e         # raise N
-000169c0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-000169d0: 6f72 2829 0a0a 2020 2020 6465 6620 7265  or()..    def re
-000169e0: 6164 5f69 6e74 626c 2873 656c 662c 202a  ad_intbl(self, *
-000169f0: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00016a00: 2020 2222 2252 6561 6420 616e 6420 696e    """Read and in
-00016a10: 7462 6c20 6669 6c65 7320 6174 203c 726f  tbl files at <ro
-00016a20: 6f74 2f69 6e74 626c 3e20 616e 6420 7061  ot/intbl> and pa
-00016a30: 7273 6520 746f 2078 6172 7261 7922 2222  rse to xarray"""
-00016a40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00016a50: 7365 6c66 2e5f 7772 6974 653a 0a20 2020  self._write:.   
-00016a60: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
-00016a70: 6e74 626c 203d 2064 6963 7428 2920 2023  ntbl = dict()  #
-00016a80: 2073 7461 7274 2066 7265 7368 2069 6e20   start fresh in 
-00016a90: 7265 6164 2d6f 6e6c 7920 6d6f 6465 0a20  read-only mode. 
-00016aa0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00016ab0: 6c66 2e5f 7265 6164 3a0a 2020 2020 2020  lf._read:.      
-00016ac0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00016ad0: 722e 696e 666f 2822 5265 6164 696e 6720  r.info("Reading 
-00016ae0: 6465 6661 756c 7420 696e 7462 6c20 6669  default intbl fi
-00016af0: 6c65 732e 2229 0a20 2020 2020 2020 2020  les.").         
-00016b00: 2020 2066 6e73 203d 2067 6c6f 622e 676c     fns = glob.gl
-00016b10: 6f62 286a 6f69 6e28 4441 5441 4449 522c  ob(join(DATADIR,
-00016b20: 2022 7766 6c6f 7722 2c20 2269 6e74 626c   "wflow", "intbl
-00016b30: 222c 2066 222a 2e74 626c 2229 290a 2020  ", f"*.tbl")).  
-00016b40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00016b50: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00016b60: 6765 722e 696e 666f 2822 5265 6164 696e  ger.info("Readin
-00016b70: 6720 6d6f 6465 6c20 696e 7462 6c20 6669  g model intbl fi
-00016b80: 6c65 732e 2229 0a20 2020 2020 2020 2020  les.").         
-00016b90: 2020 2066 6e73 203d 2067 6c6f 622e 676c     fns = glob.gl
-00016ba0: 6f62 286a 6f69 6e28 7365 6c66 2e72 6f6f  ob(join(self.roo
-00016bb0: 742c 2022 696e 7462 6c22 2c20 6622 2a2e  t, "intbl", f"*.
-00016bc0: 7462 6c22 2929 0a20 2020 2020 2020 2069  tbl")).        i
-00016bd0: 6620 6c65 6e28 666e 7329 203e 2030 3a0a  f len(fns) > 0:.
-00016be0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00016bf0: 666e 2069 6e20 666e 733a 0a20 2020 2020  fn in fns:.     
-00016c00: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-00016c10: 3d20 6261 7365 6e61 6d65 2866 6e29 2e73  = basename(fn).s
-00016c20: 706c 6974 2822 2e22 295b 305d 0a20 2020  plit(".")[0].   
-00016c30: 2020 2020 2020 2020 2020 2020 2074 626c               tbl
-00016c40: 203d 2070 642e 7265 6164 5f63 7376 2866   = pd.read_csv(f
-00016c50: 6e2c 2064 656c 696d 5f77 6869 7465 7370  n, delim_whitesp
-00016c60: 6163 653d 5472 7565 2c20 6865 6164 6572  ace=True, header
-00016c70: 3d4e 6f6e 6529 0a20 2020 2020 2020 2020  =None).         
-00016c80: 2020 2020 2020 2074 626c 2e63 6f6c 756d         tbl.colum
-00016c90: 6e73 203d 205b 0a20 2020 2020 2020 2020  ns = [.         
-00016ca0: 2020 2020 2020 2020 2020 2066 2265 7870             f"exp
-00016cb0: 727b 692b 317d 2220 6966 2069 202b 2031  r{i+1}" if i + 1
-00016cc0: 203c 206c 656e 2874 626c 2e63 6f6c 756d   < len(tbl.colum
-00016cd0: 6e73 2920 656c 7365 2022 7661 6c75 6522  ns) else "value"
-00016ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016cf0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00016d00: 6e67 6528 6c65 6e28 7462 6c2e 636f 6c75  nge(len(tbl.colu
-00016d10: 6d6e 7329 290a 2020 2020 2020 2020 2020  mns)).          
-00016d20: 2020 2020 2020 5d20 2023 2072 656e 616d        ]  # renam
-00016d30: 6520 636f 6c75 6d6e 730a 2020 2020 2020  e columns.      
-00016d40: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00016d50: 6574 5f69 6e74 626c 2874 626c 2c20 6e61  et_intbl(tbl, na
-00016d60: 6d65 3d6e 616d 6529 0a0a 2020 2020 6465  me=name)..    de
-00016d70: 6620 7772 6974 655f 696e 7462 6c28 7365  f write_intbl(se
-00016d80: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00016d90: 5772 6974 6520 696e 7462 6c20 6174 203c  Write intbl at <
-00016da0: 726f 6f74 2f69 6e74 626c 3e20 696e 2050  root/intbl> in P
-00016db0: 4352 6173 7465 7220 7461 626c 6520 666f  CRaster table fo
-00016dc0: 726d 6174 2e22 2222 0a20 2020 2020 2020  rmat.""".       
-00016dd0: 2069 6620 6e6f 7420 7365 6c66 2e5f 7772   if not self._wr
-00016de0: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
-00016df0: 2072 6169 7365 2049 4f45 7272 6f72 2822   raise IOError("
-00016e00: 4d6f 6465 6c20 6f70 656e 6564 2069 6e20  Model opened in 
-00016e10: 7265 6164 2d6f 6e6c 7920 6d6f 6465 2229  read-only mode")
-00016e20: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00016e30: 2e69 6e74 626c 3a0a 2020 2020 2020 2020  .intbl:.        
-00016e40: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-00016e50: 696e 666f 2822 5772 6974 696e 6720 696e  info("Writing in
-00016e60: 7462 6c20 6669 6c65 732e 2229 0a20 2020  tbl files.").   
-00016e70: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
-00016e80: 6520 696e 2073 656c 662e 696e 7462 6c3a  e in self.intbl:
-00016e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ea0: 2066 6e5f 6f75 7420 3d20 6a6f 696e 2873   fn_out = join(s
-00016eb0: 656c 662e 726f 6f74 2c20 2269 6e74 626c  elf.root, "intbl
-00016ec0: 222c 2066 227b 6e61 6d65 7d2e 7462 6c22  ", f"{name}.tbl"
-00016ed0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016ee0: 2020 7365 6c66 2e69 6e74 626c 5b6e 616d    self.intbl[nam
-00016ef0: 655d 2e74 6f5f 6373 7628 666e 5f6f 7574  e].to_csv(fn_out
-00016f00: 2c20 7365 703d 2220 222c 2069 6e64 6578  , sep=" ", index
-00016f10: 3d46 616c 7365 2c20 6865 6164 6572 3d46  =False, header=F
-00016f20: 616c 7365 290a 0a20 2020 2064 6566 2073  alse)..    def s
-00016f30: 6574 5f69 6e74 626c 2873 656c 662c 2064  et_intbl(self, d
-00016f40: 662c 206e 616d 6529 3a0a 2020 2020 2020  f, name):.      
-00016f50: 2020 2222 2241 6464 2069 6e74 626c 203c    """Add intbl <
-00016f60: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
-00016f70: 3e20 746f 206d 6f64 656c 2e22 2222 0a20  > to model.""". 
-00016f80: 2020 2020 2020 2069 6620 6e6f 7420 2869         if not (i
-00016f90: 7369 6e73 7461 6e63 6528 6466 2c20 7064  sinstance(df, pd
-00016fa0: 2e44 6174 6146 7261 6d65 2920 6f72 2069  .DataFrame) or i
-00016fb0: 7369 6e73 7461 6e63 6528 6466 2c20 7064  sinstance(df, pd
-00016fc0: 2e53 6572 6965 7329 293a 0a20 2020 2020  .Series)):.     
-00016fd0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00016fe0: 7565 4572 726f 7228 2264 6620 7479 7065  ueError("df type
-00016ff0: 206e 6f74 2072 6563 6f67 6e69 7a65 642c   not recognized,
-00017000: 2073 686f 756c 6420 6265 2070 616e 6461   should be panda
-00017010: 732e 4461 7461 4672 616d 652e 2229 0a20  s.DataFrame."). 
-00017020: 2020 2020 2020 2069 6620 6e61 6d65 2069         if name i
-00017030: 6e20 7365 6c66 2e5f 696e 7462 6c3a 0a20  n self._intbl:. 
-00017040: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00017050: 7420 7365 6c66 2e5f 7772 6974 653a 0a20  t self._write:. 
-00017060: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00017070: 6169 7365 2049 4f45 7272 6f72 2866 2243  aise IOError(f"C
-00017080: 616e 6e6f 7420 6f76 6572 7772 6974 6520  annot overwrite 
-00017090: 696e 7462 6c20 7b6e 616d 657d 2069 6e20  intbl {name} in 
-000170a0: 7265 6164 2d6f 6e6c 7920 6d6f 6465 2229  read-only mode")
-000170b0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000170c0: 6620 7365 6c66 2e5f 7265 6164 3a0a 2020  f self._read:.  
-000170d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000170e0: 6c66 2e6c 6f67 6765 722e 7761 726e 696e  lf.logger.warnin
-000170f0: 6728 6622 4f76 6572 7772 6974 696e 6720  g(f"Overwriting 
-00017100: 696e 7462 6c3a 207b 6e61 6d65 7d22 290a  intbl: {name}").
-00017110: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
-00017120: 7462 6c5b 6e61 6d65 5d20 3d20 6466 0a0a  tbl[name] = df..
-00017130: 2020 2020 6465 6620 5f63 6f6e 6669 6772      def _configr
-00017140: 6561 6428 7365 6c66 2c20 666e 293a 0a20  ead(self, fn):. 
-00017150: 2020 2020 2020 2077 6974 6820 636f 6465         with code
-00017160: 6373 2e6f 7065 6e28 666e 2c20 2272 222c  cs.open(fn, "r",
-00017170: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
-00017180: 2229 2061 7320 663a 0a20 2020 2020 2020  ") as f:.       
-00017190: 2020 2020 2066 6469 6374 203d 2074 6f6d       fdict = tom
-000171a0: 6c2e 6c6f 6164 2866 290a 2020 2020 2020  l.load(f).      
-000171b0: 2020 7265 7475 726e 2066 6469 6374 0a0a    return fdict..
-000171c0: 2020 2020 6465 6620 5f63 6f6e 6669 6777      def _configw
-000171d0: 7269 7465 2873 656c 662c 2066 6e29 3a0a  rite(self, fn):.
-000171e0: 2020 2020 2020 2020 7769 7468 2063 6f64          with cod
-000171f0: 6563 732e 6f70 656e 2866 6e2c 2022 7722  ecs.open(fn, "w"
-00017200: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
-00017210: 3822 2920 6173 2066 3a0a 2020 2020 2020  8") as f:.      
-00017220: 2020 2020 2020 746f 6d6c 2e64 756d 7028        toml.dump(
-00017230: 7365 6c66 2e63 6f6e 6669 672c 2066 290a  self.config, f).
-00017240: 0a20 2020 2023 2320 5746 4c4f 5720 7370  .    ## WFLOW sp
-00017250: 6563 6966 6963 2064 6174 6120 616e 6420  ecific data and 
-00017260: 6d65 7468 6f64 730a 0a20 2020 2040 7072  methods..    @pr
-00017270: 6f70 6572 7479 0a20 2020 2064 6566 2069  operty.    def i
-00017280: 6e74 626c 2873 656c 6629 3a0a 2020 2020  ntbl(self):.    
-00017290: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
-000172a0: 2064 6963 7469 6f6e 6172 7920 6f66 2070   dictionary of p
-000172b0: 616e 6461 732e 4461 7461 4672 616d 6573  andas.DataFrames
-000172c0: 2072 6570 7265 7365 6e74 696e 6720 7468   representing th
-000172d0: 6520 7766 6c6f 7720 696e 7462 6c20 6669  e wflow intbl fi
-000172e0: 6c65 732e 2222 220a 2020 2020 2020 2020  les.""".        
-000172f0: 6966 206e 6f74 2073 656c 662e 5f69 6e74  if not self._int
-00017300: 626c 3a0a 2020 2020 2020 2020 2020 2020  bl:.            
-00017310: 7365 6c66 2e72 6561 645f 696e 7462 6c28  self.read_intbl(
-00017320: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00017330: 2073 656c 662e 5f69 6e74 626c 0a0a 2020   self._intbl..  
-00017340: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00017350: 6465 6620 666c 7764 6972 2873 656c 6629  def flwdir(self)
-00017360: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00017370: 7572 6e73 2074 6865 2070 7966 6c77 6469  urns the pyflwdi
-00017380: 722e 466c 7764 6972 5261 7374 6572 206f  r.FlwdirRaster o
-00017390: 626a 6563 7420 7061 7273 6564 2066 726f  bject parsed fro
-000173a0: 6d20 7468 6520 7766 6c6f 7720 6c64 642e  m the wflow ldd.
-000173b0: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-000173c0: 656c 662e 5f66 6c77 6469 7220 6973 204e  elf._flwdir is N
-000173d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000173e0: 2073 656c 662e 7365 745f 666c 7764 6972   self.set_flwdir
-000173f0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00017400: 6e20 7365 6c66 2e5f 666c 7764 6972 0a0a  n self._flwdir..
-00017410: 2020 2020 6465 6620 7365 745f 666c 7764      def set_flwd
-00017420: 6972 2873 656c 662c 2066 7479 7065 3d22  ir(self, ftype="
-00017430: 696e 6665 7222 293a 0a20 2020 2020 2020  infer"):.       
-00017440: 2022 2222 5061 7273 6520 7079 666c 7764   """Parse pyflwd
-00017450: 6972 2e46 6c77 6469 7252 6173 7465 7220  ir.FlwdirRaster 
-00017460: 6f62 6a65 6374 2070 6172 7365 6420 6672  object parsed fr
-00017470: 6f6d 2074 6865 2077 666c 6f77 206c 6464  om the wflow ldd
-00017480: 2222 220a 2020 2020 2020 2020 666c 7764  """.        flwd
-00017490: 6972 5f6e 616d 6520 3d20 666c 7764 6972  ir_name = flwdir
-000174a0: 5f6e 616d 6520 3d20 7365 6c66 2e5f 4d41  _name = self._MA
-000174b0: 5053 5b22 666c 7764 6972 225d 0a20 2020  PS["flwdir"].   
-000174c0: 2020 2020 2073 656c 662e 5f66 6c77 6469       self._flwdi
-000174d0: 7220 3d20 666c 772e 666c 7764 6972 5f66  r = flw.flwdir_f
-000174e0: 726f 6d5f 6461 280a 2020 2020 2020 2020  rom_da(.        
-000174f0: 2020 2020 7365 6c66 2e73 7461 7469 636d      self.staticm
-00017500: 6170 735b 666c 7764 6972 5f6e 616d 655d  aps[flwdir_name]
-00017510: 2c0a 2020 2020 2020 2020 2020 2020 6674  ,.            ft
-00017520: 7970 653d 6674 7970 652c 0a20 2020 2020  ype=ftype,.     
-00017530: 2020 2020 2020 2063 6865 636b 5f66 7479         check_fty
-00017540: 7065 3d54 7275 652c 0a20 2020 2020 2020  pe=True,.       
-00017550: 2020 2020 206d 6173 6b3d 2873 656c 662e       mask=(self.
-00017560: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
-00017570: 5f4d 4150 535b 2262 6173 696e 7322 5d5d  _MAPS["basins"]]
-00017580: 203e 2030 292c 0a20 2020 2020 2020 2029   > 0),.        )
-00017590: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-000175a0: 2020 2020 6465 6620 6261 7369 6e73 2873      def basins(s
-000175b0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-000175c0: 2252 6574 7572 6e73 2061 2062 6173 696e  "Returns a basin
-000175d0: 2873 2920 6765 6f6d 6574 7279 2061 7320  (s) geometry as 
-000175e0: 6120 6765 6f70 616e 6461 732e 4765 6f44  a geopandas.GeoD
-000175f0: 6174 6146 7261 6d65 2e22 2222 0a20 2020  ataFrame.""".   
-00017600: 2020 2020 2069 6620 2262 6173 696e 7322       if "basins"
-00017610: 2069 6e20 7365 6c66 2e73 7461 7469 6367   in self.staticg
-00017620: 656f 6d73 3a0a 2020 2020 2020 2020 2020  eoms:.          
-00017630: 2020 6764 6620 3d20 7365 6c66 2e73 7461    gdf = self.sta
-00017640: 7469 6367 656f 6d73 5b22 6261 7369 6e73  ticgeoms["basins
-00017650: 225d 0a20 2020 2020 2020 2065 6c73 653a  "].        else:
-00017660: 0a20 2020 2020 2020 2020 2020 2067 6466  .            gdf
-00017670: 203d 2066 6c77 2e62 6173 696e 5f73 6861   = flw.basin_sha
-00017680: 7065 280a 2020 2020 2020 2020 2020 2020  pe(.            
-00017690: 2020 2020 7365 6c66 2e73 7461 7469 636d      self.staticm
-000176a0: 6170 732c 2073 656c 662e 666c 7764 6972  aps, self.flwdir
-000176b0: 2c20 6261 7369 6e5f 6e61 6d65 3d73 656c  , basin_name=sel
-000176c0: 662e 5f4d 4150 535b 2262 6173 696e 7322  f._MAPS["basins"
-000176d0: 5d0a 2020 2020 2020 2020 2020 2020 290a  ].            ).
-000176e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000176f0: 2e73 6574 5f73 7461 7469 6367 656f 6d73  .set_staticgeoms
-00017700: 2867 6466 2c20 6e61 6d65 3d22 6261 7369  (gdf, name="basi
-00017710: 6e73 2229 0a20 2020 2020 2020 2072 6574  ns").        ret
-00017720: 7572 6e20 6764 660a 0a20 2020 2040 7072  urn gdf..    @pr
-00017730: 6f70 6572 7479 0a20 2020 2064 6566 2072  operty.    def r
-00017740: 6976 6572 7328 7365 6c66 293a 0a20 2020  ivers(self):.   
-00017750: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00017760: 6120 7269 7665 7220 6765 6f6d 6574 7279  a river geometry
-00017770: 2061 7320 6120 6765 6f70 616e 6461 732e   as a geopandas.
-00017780: 4765 6f44 6174 6146 7261 6d65 2e20 4966  GeoDataFrame. If
-00017790: 2061 7661 696c 6162 6c65 2c20 7468 650a   available, the.
-000177a0: 2020 2020 2020 2020 7374 7265 616d 206f          stream o
-000177b0: 7264 6572 2061 6e64 2075 7073 7472 6561  rder and upstrea
-000177c0: 6d20 6172 6561 2076 616c 7565 7320 6172  m area values ar
-000177d0: 6520 6164 6465 6420 746f 2074 6865 2067  e added to the g
-000177e0: 656f 6d65 7472 7920 7072 6f70 6572 7469  eometry properti
-000177f0: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-00017800: 2020 2020 2020 2020 6966 2022 7269 7665          if "rive
-00017810: 7273 2220 696e 2073 656c 662e 7374 6174  rs" in self.stat
-00017820: 6963 6765 6f6d 733a 0a20 2020 2020 2020  icgeoms:.       
-00017830: 2020 2020 2067 6466 203d 2073 656c 662e       gdf = self.
-00017840: 7374 6174 6963 6765 6f6d 735b 2272 6976  staticgeoms["riv
-00017850: 6572 7322 5d0a 2020 2020 2020 2020 656c  ers"].        el
-00017860: 6966 2073 656c 662e 5f4d 4150 535b 2272  if self._MAPS["r
-00017870: 6976 6d73 6b22 5d20 696e 2073 656c 662e  ivmsk"] in self.
-00017880: 7374 6174 6963 6d61 7073 3a0a 2020 2020  staticmaps:.    
-00017890: 2020 2020 2020 2020 7269 766d 736b 203d          rivmsk =
-000178a0: 2073 656c 662e 7374 6174 6963 6d61 7073   self.staticmaps
-000178b0: 5b73 656c 662e 5f4d 4150 535b 2272 6976  [self._MAPS["riv
-000178c0: 6d73 6b22 5d5d 2e76 616c 7565 7320 213d  msk"]].values !=
-000178d0: 2030 0a20 2020 2020 2020 2020 2020 2023   0.            #
-000178e0: 2043 6865 636b 2069 6620 7468 6572 6520   Check if there 
-000178f0: 6172 6520 7269 7665 7220 6365 6c6c 7320  are river cells 
-00017900: 696e 2074 6865 206d 6f64 656c 2062 6566  in the model bef
-00017910: 6f72 6520 636f 6e74 696e 7569 6e67 0a20  ore continuing. 
-00017920: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
-00017930: 2e61 6e79 2872 6976 6d73 6b29 3a0a 2020  .any(rivmsk):.  
-00017940: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00017950: 6164 6420 7374 7265 616d 206f 7264 6572  add stream order
-00017960: 2027 7374 726f 7264 2720 636f 6c75 6d6e   'strord' column
-00017970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017980: 2073 7472 6f72 6420 3d20 7365 6c66 2e66   strord = self.f
-00017990: 6c77 6469 722e 7374 7265 616d 5f6f 7264  lwdir.stream_ord
-000179a0: 6572 286d 6173 6b3d 7269 766d 736b 290a  er(mask=rivmsk).
-000179b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179c0: 6665 6174 7320 3d20 7365 6c66 2e66 6c77  feats = self.flw
-000179d0: 6469 722e 7374 7265 616d 7328 6d61 736b  dir.streams(mask
-000179e0: 3d72 6976 6d73 6b2c 2073 7472 6f72 643d  =rivmsk, strord=
-000179f0: 7374 726f 7264 290a 2020 2020 2020 2020  strord).        
-00017a00: 2020 2020 2020 2020 6764 6620 3d20 6770          gdf = gp
-00017a10: 642e 4765 6f44 6174 6146 7261 6d65 2e66  d.GeoDataFrame.f
-00017a20: 726f 6d5f 6665 6174 7572 6573 2866 6561  rom_features(fea
-00017a30: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-00017a40: 2020 2020 6764 662e 6372 7320 3d20 7079      gdf.crs = py
-00017a50: 7072 6f6a 2e43 5253 2e66 726f 6d5f 7573  proj.CRS.from_us
-00017a60: 6572 5f69 6e70 7574 2873 656c 662e 6372  er_input(self.cr
-00017a70: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00017a80: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
-00017a90: 6963 6765 6f6d 7328 6764 662c 206e 616d  icgeoms(gdf, nam
-00017aa0: 653d 2272 6976 6572 7322 290a 2020 2020  e="rivers").    
-00017ab0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00017ac0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00017ad0: 722e 7761 726e 696e 6728 224e 6f20 7269  r.warning("No ri
-00017ae0: 7665 7220 6365 6c6c 7320 6465 7465 6374  ver cells detect
-00017af0: 6564 2069 6e20 7468 6520 7365 6c65 6374  ed in the select
-00017b00: 6564 2062 6173 696e 2e22 290a 2020 2020  ed basin.").    
-00017b10: 2020 2020 2020 2020 6764 6620 3d20 4e6f          gdf = No
-00017b20: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
-00017b30: 6e20 6764 660a 0a20 2020 2064 6566 2063  n gdf..    def c
-00017b40: 6c69 705f 7374 6174 6963 6d61 7073 280a  lip_staticmaps(.
-00017b50: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00017b60: 2020 2020 2020 7265 6769 6f6e 2c0a 2020        region,.  
-00017b70: 2020 2020 2020 6275 6666 6572 3d30 2c0a        buffer=0,.
-00017b80: 2020 2020 2020 2020 616c 6967 6e3d 4e6f          align=No
-00017b90: 6e65 2c0a 2020 2020 2020 2020 6372 733d  ne,.        crs=
-00017ba0: 3433 3236 2c0a 2020 2020 293a 0a20 2020  4326,.    ):.   
-00017bb0: 2020 2020 2022 2222 436c 6970 2073 7461       """Clip sta
-00017bc0: 7469 636d 6170 7320 746f 2073 7562 6261  ticmaps to subba
-00017bd0: 7369 6e2e 0a0a 2020 2020 2020 2020 5061  sin...        Pa
-00017be0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00017bf0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00017c00: 2020 2020 7265 6769 6f6e 203a 2064 6963      region : dic
-00017c10: 740a 2020 2020 2020 2020 2020 2020 5365  t.            Se
-00017c20: 6520 3a6d 6574 683a 606d 6f64 656c 732e  e :meth:`models.
-00017c30: 7766 6c6f 772e 5766 6c6f 774d 6f64 656c  wflow.WflowModel
-00017c40: 2e73 6574 7570 5f62 6173 656d 6170 7360  .setup_basemaps`
-00017c50: 0a20 2020 2020 2020 2062 7566 6665 7220  .        buffer 
-00017c60: 3a20 696e 742c 206f 7074 696f 6e61 6c0a  : int, optional.
-00017c70: 2020 2020 2020 2020 2020 2020 4275 6666              Buff
-00017c80: 6572 2061 726f 756e 6420 7375 6262 6173  er around subbas
-00017c90: 696e 2069 6e20 6e75 6d62 6572 206f 6620  in in number of 
-00017ca0: 7069 7865 6c73 2c20 6279 2064 6566 6175  pixels, by defau
-00017cb0: 6c74 2030 0a20 2020 2020 2020 2061 6c69  lt 0.        ali
-00017cc0: 676e 203a 2066 6c6f 6174 2c20 6f70 7469  gn : float, opti
-00017cd0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00017ce0: 2041 6c69 676e 2062 6f75 6e64 7320 6f66   Align bounds of
-00017cf0: 2072 6567 696f 6e20 746f 2072 6173 7465   region to raste
-00017d00: 7220 7769 7468 2072 6573 6f6c 7574 696f  r with resolutio
-00017d10: 6e20 3c61 6c69 676e 3e2c 2062 7920 6465  n <align>, by de
-00017d20: 6661 756c 7420 4e6f 6e65 0a20 2020 2020  fault None.     
-00017d30: 2020 2063 7273 3a20 696e 742c 206f 7074     crs: int, opt
-00017d40: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-00017d50: 2020 4465 6661 756c 7420 6372 7320 6f66    Default crs of
-00017d60: 2074 6865 2073 7461 7469 636d 6170 7320   the staticmaps 
-00017d70: 746f 2063 6c69 702e 0a0a 2020 2020 2020  to clip...      
-00017d80: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00017d90: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00017da0: 2020 7861 7272 6179 2e44 6174 6153 6574    xarray.DataSet
-00017db0: 0a20 2020 2020 2020 2020 2020 2043 6c69  .            Cli
-00017dc0: 7070 6564 2073 7461 7469 636d 6170 732e  pped staticmaps.
-00017dd0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00017de0: 2020 2020 2062 6173 696e 735f 6e61 6d65       basins_name
-00017df0: 203d 2073 656c 662e 5f4d 4150 535b 2262   = self._MAPS["b
-00017e00: 6173 696e 7322 5d0a 2020 2020 2020 2020  asins"].        
-00017e10: 666c 7764 6972 5f6e 616d 6520 3d20 7365  flwdir_name = se
-00017e20: 6c66 2e5f 4d41 5053 5b22 666c 7764 6972  lf._MAPS["flwdir
-00017e30: 225d 0a0a 2020 2020 2020 2020 6b69 6e64  "]..        kind
-00017e40: 2c20 7265 6769 6f6e 203d 2068 7964 726f  , region = hydro
-00017e50: 6d74 2e77 6f72 6b66 6c6f 7773 2e70 6172  mt.workflows.par
-00017e60: 7365 5f72 6567 696f 6e28 7265 6769 6f6e  se_region(region
-00017e70: 2c20 6c6f 6767 6572 3d73 656c 662e 6c6f  , logger=self.lo
-00017e80: 6767 6572 290a 2020 2020 2020 2020 2320  gger).        # 
-00017e90: 7472 616e 736c 6174 6520 6261 7369 6e20  translate basin 
-00017ea0: 616e 6420 6f75 746c 6574 206b 696e 6473  and outlet kinds
-00017eb0: 2074 6f20 6765 6f6d 0a20 2020 2020 2020   to geom.       
-00017ec0: 2067 656f 6d20 3d20 7265 6769 6f6e 2e67   geom = region.g
-00017ed0: 6574 2822 6765 6f6d 222c 204e 6f6e 6529  et("geom", None)
-00017ee0: 0a20 2020 2020 2020 2062 626f 7820 3d20  .        bbox = 
-00017ef0: 7265 6769 6f6e 2e67 6574 2822 6262 6f78  region.get("bbox
-00017f00: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-00017f10: 2069 6620 6b69 6e64 2069 6e20 5b22 6261   if kind in ["ba
-00017f20: 7369 6e22 2c20 226f 7574 6c65 7422 2c20  sin", "outlet", 
-00017f30: 2273 7562 6261 7369 6e22 5d3a 0a20 2020  "subbasin"]:.   
-00017f40: 2020 2020 2020 2020 2023 2073 7570 706c           # suppl
-00017f50: 7920 6262 6f78 2074 6f20 6176 6f69 6420  y bbox to avoid 
-00017f60: 6765 7474 696e 6720 6261 7369 6e20 626f  getting basin bo
-00017f70: 756e 6473 2066 6972 7374 2077 6865 6e20  unds first when 
-00017f80: 636c 6970 7069 6e67 2073 7562 6261 7369  clipping subbasi
-00017f90: 6e73 0a20 2020 2020 2020 2020 2020 2069  ns.            i
-00017fa0: 6620 6b69 6e64 203d 3d20 2273 7562 6261  f kind == "subba
-00017fb0: 7369 6e22 2061 6e64 2062 626f 7820 6973  sin" and bbox is
-00017fc0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00017fd0: 2020 2020 2020 2072 6567 696f 6e2e 7570         region.up
-00017fe0: 6461 7465 2862 626f 783d 7365 6c66 2e62  date(bbox=self.b
-00017ff0: 6f75 6e64 7329 0a20 2020 2020 2020 2020  ounds).         
-00018000: 2020 2067 656f 6d2c 205f 203d 2068 7964     geom, _ = hyd
-00018010: 726f 6d74 2e77 6f72 6b66 6c6f 7773 2e67  romt.workflows.g
-00018020: 6574 5f62 6173 696e 5f67 656f 6d65 7472  et_basin_geometr
-00018030: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
-00018040: 2020 2064 733d 7365 6c66 2e73 7461 7469     ds=self.stati
-00018050: 636d 6170 732c 0a20 2020 2020 2020 2020  cmaps,.         
-00018060: 2020 2020 2020 206c 6f67 6765 723d 7365         logger=se
-00018070: 6c66 2e6c 6f67 6765 722c 0a20 2020 2020  lf.logger,.     
-00018080: 2020 2020 2020 2020 2020 206b 696e 643d             kind=
-00018090: 6b69 6e64 2c0a 2020 2020 2020 2020 2020  kind,.          
-000180a0: 2020 2020 2020 6261 7369 6e73 5f6e 616d        basins_nam
-000180b0: 653d 6261 7369 6e73 5f6e 616d 652c 0a20  e=basins_name,. 
-000180c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000180d0: 6c77 6469 725f 6e61 6d65 3d66 6c77 6469  lwdir_name=flwdi
-000180e0: 725f 6e61 6d65 2c0a 2020 2020 2020 2020  r_name,.        
-000180f0: 2020 2020 2020 2020 2a2a 7265 6769 6f6e          **region
-00018100: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00018110: 2020 2020 2020 2020 2320 636c 6970 2062          # clip b
-00018120: 6173 6564 206f 6e20 7375 6262 6173 696e  ased on subbasin
-00018130: 2061 7267 732c 2067 656f 6d20 6f72 2062   args, geom or b
-00018140: 626f 780a 2020 2020 2020 2020 6966 2067  box.        if g
-00018150: 656f 6d20 6973 206e 6f74 204e 6f6e 653a  eom is not None:
-00018160: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
-00018170: 7374 6174 6963 6d61 7073 203d 2073 656c  staticmaps = sel
-00018180: 662e 7374 6174 6963 6d61 7073 2e72 6173  f.staticmaps.ras
-00018190: 7465 722e 636c 6970 5f67 656f 6d28 0a20  ter.clip_geom(. 
-000181a0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-000181b0: 656f 6d2c 2061 6c69 676e 3d61 6c69 676e  eom, align=align
-000181c0: 2c20 6275 6666 6572 3d62 7566 6665 720a  , buffer=buffer.
-000181d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000181e0: 2020 2020 2020 2020 2020 6473 5f73 7461            ds_sta
-000181f0: 7469 636d 6170 735b 6261 7369 6e73 5f6e  ticmaps[basins_n
-00018200: 616d 655d 203d 2064 735f 7374 6174 6963  ame] = ds_static
-00018210: 6d61 7073 5b62 6173 696e 735f 6e61 6d65  maps[basins_name
-00018220: 5d2e 7768 6572 6528 0a20 2020 2020 2020  ].where(.       
-00018230: 2020 2020 2020 2020 2064 735f 7374 6174           ds_stat
-00018240: 6963 6d61 7073 5b22 6d61 736b 225d 2c20  icmaps["mask"], 
-00018250: 7365 6c66 2e73 7461 7469 636d 6170 735b  self.staticmaps[
-00018260: 6261 7369 6e73 5f6e 616d 655d 2e72 6173  basins_name].ras
-00018270: 7465 722e 6e6f 6461 7461 0a20 2020 2020  ter.nodata.     
-00018280: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00018290: 2020 2020 2064 735f 7374 6174 6963 6d61       ds_staticma
-000182a0: 7073 5b62 6173 696e 735f 6e61 6d65 5d2e  ps[basins_name].
-000182b0: 6174 7472 732e 7570 6461 7465 280a 2020  attrs.update(.  
-000182c0: 2020 2020 2020 2020 2020 2020 2020 5f46                _F
-000182d0: 696c 6c56 616c 7565 3d73 656c 662e 7374  illValue=self.st
-000182e0: 6174 6963 6d61 7073 5b62 6173 696e 735f  aticmaps[basins_
-000182f0: 6e61 6d65 5d2e 7261 7374 6572 2e6e 6f64  name].raster.nod
-00018300: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
-00018310: 290a 2020 2020 2020 2020 656c 6966 2062  ).        elif b
-00018320: 626f 7820 6973 206e 6f74 204e 6f6e 653a  box is not None:
-00018330: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
-00018340: 7374 6174 6963 6d61 7073 203d 2073 656c  staticmaps = sel
-00018350: 662e 7374 6174 6963 6d61 7073 2e72 6173  f.staticmaps.ras
-00018360: 7465 722e 636c 6970 5f62 626f 7828 0a20  ter.clip_bbox(. 
-00018370: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00018380: 626f 782c 2061 6c69 676e 3d61 6c69 676e  box, align=align
-00018390: 2c20 6275 6666 6572 3d62 7566 6665 720a  , buffer=buffer.
-000183a0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-000183b0: 2020 2020 2020 2023 2055 7064 6174 6520         # Update 
-000183c0: 666c 7764 6972 2073 7461 7469 636d 6170  flwdir staticmap
-000183d0: 7320 616e 6420 7374 6174 6963 6765 6f6d  s and staticgeom
-000183e0: 730a 2020 2020 2020 2020 6966 2073 656c  s.        if sel
-000183f0: 662e 6372 7320 6973 204e 6f6e 6520 616e  f.crs is None an
-00018400: 6420 6372 7320 6973 206e 6f74 204e 6f6e  d crs is not Non
-00018410: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00018420: 656c 662e 7365 745f 6372 7328 6372 7329  elf.set_crs(crs)
-00018430: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00018440: 7374 6174 6963 6d61 7073 203d 2078 722e  staticmaps = xr.
-00018450: 4461 7461 7365 7428 290a 2020 2020 2020  Dataset().      
-00018460: 2020 7365 6c66 2e73 6574 5f73 7461 7469    self.set_stati
-00018470: 636d 6170 7328 6473 5f73 7461 7469 636d  cmaps(ds_staticm
-00018480: 6170 7329 0a0a 2020 2020 2020 2020 2320  aps)..        # 
-00018490: 6164 6420 7069 7473 2061 7420 6564 6765  add pits at edge
-000184a0: 7320 6166 7465 7220 636c 6970 7069 6e67  s after clipping
-000184b0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
-000184c0: 6c77 6469 7220 3d20 4e6f 6e65 2020 2320  lwdir = None  # 
-000184d0: 6d61 6b65 2073 7572 6520 6f6c 6420 666c  make sure old fl
-000184e0: 7764 6972 206f 626a 6563 7420 6973 2072  wdir object is r
-000184f0: 656d 6f76 6564 0a20 2020 2020 2020 2073  emoved.        s
-00018500: 656c 662e 7374 6174 6963 6d61 7073 5b73  elf.staticmaps[s
-00018510: 656c 662e 5f4d 4150 535b 2266 6c77 6469  elf._MAPS["flwdi
-00018520: 7222 5d5d 2e64 6174 6120 3d20 7365 6c66  r"]].data = self
-00018530: 2e66 6c77 6469 722e 746f 5f61 7272 6179  .flwdir.to_array
-00018540: 2822 6c64 6422 290a 0a20 2020 2020 2020  ("ldd")..       
-00018550: 2023 2052 6569 6e69 7469 6c69 6173 6520   # Reinitiliase 
-00018560: 7374 6174 6963 6765 6f6d 7320 616e 6420  staticgeoms and 
-00018570: 7265 2d63 7265 6174 6520 6261 7369 6e73  re-create basins
-00018580: 2f72 6976 6572 730a 2020 2020 2020 2020  /rivers.        
-00018590: 7365 6c66 2e5f 7374 6174 6963 6765 6f6d  self._staticgeom
-000185a0: 7320 3d20 6469 6374 2829 0a20 2020 2020  s = dict().     
-000185b0: 2020 2023 2073 656c 662e 6261 7369 6e73     # self.basins
-000185c0: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
-000185d0: 7269 7665 7273 0a20 2020 2020 2020 2023  rivers.        #
-000185e0: 206e 6f77 2073 7461 7469 6367 656f 6d73   now staticgeoms
-000185f0: 206c 696e 6b73 2074 6f20 6765 6f6d 7320   links to geoms 
-00018600: 7768 6963 6820 646f 6573 206e 6f74 2065  which does not e
-00018610: 7869 7374 2069 6e20 6576 6572 7920 6879  xist in every hy
-00018620: 6472 6f6d 7420 7665 7273 696f 6e0a 2020  dromt version.  
-00018630: 2020 2020 2020 2320 7265 6d6f 7665 2077        # remove w
-00018640: 6865 6e20 7570 6461 7469 6e67 2077 666c  hen updating wfl
-00018650: 6f77 2074 6f20 6e65 7720 6f62 6a65 6374  ow to new object
-00018660: 730a 2020 2020 2020 2020 6261 7369 6e73  s.        basins
-00018670: 203d 2066 6c77 2e62 6173 696e 5f73 6861   = flw.basin_sha
-00018680: 7065 280a 2020 2020 2020 2020 2020 2020  pe(.            
-00018690: 7365 6c66 2e73 7461 7469 636d 6170 732c  self.staticmaps,
-000186a0: 2073 656c 662e 666c 7764 6972 2c20 6261   self.flwdir, ba
-000186b0: 7369 6e5f 6e61 6d65 3d73 656c 662e 5f4d  sin_name=self._M
-000186c0: 4150 535b 2262 6173 696e 7322 5d0a 2020  APS["basins"].  
-000186d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000186e0: 7365 6c66 2e73 6574 5f73 7461 7469 6367  self.set_staticg
-000186f0: 656f 6d73 2862 6173 696e 732c 206e 616d  eoms(basins, nam
-00018700: 653d 2262 6173 696e 7322 290a 2020 2020  e="basins").    
-00018710: 2020 2020 7269 766d 736b 203d 2073 656c      rivmsk = sel
-00018720: 662e 7374 6174 6963 6d61 7073 5b73 656c  f.staticmaps[sel
-00018730: 662e 5f4d 4150 535b 2272 6976 6d73 6b22  f._MAPS["rivmsk"
-00018740: 5d5d 2e76 616c 7565 7320 213d 2030 0a20  ]].values != 0. 
-00018750: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-00018760: 6620 7468 6572 6520 6172 6520 7269 7665  f there are rive
-00018770: 7220 6365 6c6c 7320 696e 2074 6865 206d  r cells in the m
-00018780: 6f64 656c 2062 6566 6f72 6520 636f 6e74  odel before cont
-00018790: 696e 7569 6e67 0a20 2020 2020 2020 2069  inuing.        i
-000187a0: 6620 6e70 2e61 6e79 2872 6976 6d73 6b29  f np.any(rivmsk)
-000187b0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-000187c0: 6164 6420 7374 7265 616d 206f 7264 6572  add stream order
-000187d0: 2027 7374 726f 7264 2720 636f 6c75 6d6e   'strord' column
-000187e0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-000187f0: 6f72 6420 3d20 7365 6c66 2e66 6c77 6469  ord = self.flwdi
-00018800: 722e 7374 7265 616d 5f6f 7264 6572 286d  r.stream_order(m
-00018810: 6173 6b3d 7269 766d 736b 290a 2020 2020  ask=rivmsk).    
-00018820: 2020 2020 2020 2020 6665 6174 7320 3d20          feats = 
-00018830: 7365 6c66 2e66 6c77 6469 722e 7374 7265  self.flwdir.stre
-00018840: 616d 7328 6d61 736b 3d72 6976 6d73 6b2c  ams(mask=rivmsk,
-00018850: 2073 7472 6f72 643d 7374 726f 7264 290a   strord=strord).
-00018860: 2020 2020 2020 2020 2020 2020 6764 6620              gdf 
-00018870: 3d20 6770 642e 4765 6f44 6174 6146 7261  = gpd.GeoDataFra
-00018880: 6d65 2e66 726f 6d5f 6665 6174 7572 6573  me.from_features
-00018890: 2866 6561 7473 290a 2020 2020 2020 2020  (feats).        
-000188a0: 2020 2020 6764 662e 6372 7320 3d20 7079      gdf.crs = py
-000188b0: 7072 6f6a 2e43 5253 2e66 726f 6d5f 7573  proj.CRS.from_us
-000188c0: 6572 5f69 6e70 7574 2873 656c 662e 6372  er_input(self.cr
-000188d0: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-000188e0: 656c 662e 7365 745f 7374 6174 6963 6765  elf.set_staticge
-000188f0: 6f6d 7328 6764 662c 206e 616d 653d 2272  oms(gdf, name="r
-00018900: 6976 6572 7322 290a 0a20 2020 2020 2020  ivers")..       
-00018910: 2023 2055 7064 6174 6520 7265 7365 7276   # Update reserv
-00018920: 6f69 7220 616e 6420 6c61 6b65 730a 2020  oir and lakes.  
-00018930: 2020 2020 2020 7265 6d6f 7665 5f72 6573        remove_res
-00018940: 6572 766f 6972 203d 2046 616c 7365 0a20  ervoir = False. 
-00018950: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00018960: 4d41 5053 5b22 7265 7361 7265 6173 225d  MAPS["resareas"]
-00018970: 2069 6e20 7365 6c66 2e73 7461 7469 636d   in self.staticm
-00018980: 6170 733a 0a20 2020 2020 2020 2020 2020  aps:.           
-00018990: 2072 6573 6572 766f 6972 203d 2073 656c   reservoir = sel
-000189a0: 662e 7374 6174 6963 6d61 7073 5b73 656c  f.staticmaps[sel
-000189b0: 662e 5f4d 4150 535b 2272 6573 6172 6561  f._MAPS["resarea
-000189c0: 7322 5d5d 0a20 2020 2020 2020 2020 2020  s"]].           
-000189d0: 2069 6620 6e6f 7420 6e70 2e61 6e79 2872   if not np.any(r
-000189e0: 6573 6572 766f 6972 203e 2030 293a 0a20  eservoir > 0):. 
-000189f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00018a00: 656d 6f76 655f 7265 7365 7276 6f69 7220  emove_reservoir 
-00018a10: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00018a20: 2020 2020 2020 2072 656d 6f76 655f 6d61         remove_ma
-00018a30: 7073 203d 205b 0a20 2020 2020 2020 2020  ps = [.         
-00018a40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018a50: 5f4d 4150 535b 2272 6573 6172 6561 7322  _MAPS["resareas"
-00018a60: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00018a70: 2020 2020 2020 2073 656c 662e 5f4d 4150         self._MAP
-00018a80: 535b 2272 6573 6c6f 6373 225d 2c0a 2020  S["reslocs"],.  
-00018a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018aa0: 2020 2252 6573 5369 6d70 6c65 4172 6561    "ResSimpleArea
-00018ab0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00018ac0: 2020 2020 2020 2022 5265 7344 656d 616e         "ResDeman
-00018ad0: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-00018ae0: 2020 2020 2020 2020 2252 6573 5461 7267          "ResTarg
-00018af0: 6574 4675 6c6c 4672 6163 222c 0a20 2020  etFullFrac",.   
-00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b10: 2022 5265 7354 6172 6765 744d 696e 4672   "ResTargetMinFr
-00018b20: 6163 222c 0a20 2020 2020 2020 2020 2020  ac",.           
-00018b30: 2020 2020 2020 2020 2022 5265 734d 6178           "ResMax
-00018b40: 5265 6c65 6173 6522 2c0a 2020 2020 2020  Release",.      
-00018b50: 2020 2020 2020 2020 2020 2020 2020 2252                "R
-00018b60: 6573 4d61 7856 6f6c 756d 6522 2c0a 2020  esMaxVolume",.  
-00018b70: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-00018b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b90: 7365 6c66 2e5f 7374 6174 6963 6d61 7073  self._staticmaps
-00018ba0: 203d 2073 656c 662e 7374 6174 6963 6d61   = self.staticma
-00018bb0: 7073 2e64 726f 705f 7661 7273 2872 656d  ps.drop_vars(rem
-00018bc0: 6f76 655f 6d61 7073 290a 0a20 2020 2020  ove_maps)..     
-00018bd0: 2020 2072 656d 6f76 655f 6c61 6b65 203d     remove_lake =
-00018be0: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
-00018bf0: 6620 7365 6c66 2e5f 4d41 5053 5b22 6c61  f self._MAPS["la
-00018c00: 6b65 6172 6561 7322 5d20 696e 2073 656c  keareas"] in sel
-00018c10: 662e 7374 6174 6963 6d61 7073 3a0a 2020  f.staticmaps:.  
-00018c20: 2020 2020 2020 2020 2020 6c61 6b65 203d            lake =
-00018c30: 2073 656c 662e 7374 6174 6963 6d61 7073   self.staticmaps
-00018c40: 5b73 656c 662e 5f4d 4150 535b 226c 616b  [self._MAPS["lak
-00018c50: 6561 7265 6173 225d 5d0a 2020 2020 2020  eareas"]].      
-00018c60: 2020 2020 2020 6966 206e 6f74 206e 702e        if not np.
-00018c70: 616e 7928 6c61 6b65 203e 2030 293a 0a20  any(lake > 0):. 
-00018c80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00018c90: 656d 6f76 655f 6c61 6b65 203d 2054 7275  emove_lake = Tru
-00018ca0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00018cb0: 2020 7265 6d6f 7665 5f6d 6170 7320 3d20    remove_maps = 
-00018cc0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00018cd0: 2020 2020 2020 7365 6c66 2e5f 4d41 5053        self._MAPS
-00018ce0: 5b22 6c61 6b65 6172 6561 7322 5d2c 0a20  ["lakeareas"],. 
-00018cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d00: 2020 2073 656c 662e 5f4d 4150 535b 226c     self._MAPS["l
-00018d10: 616b 656c 6f63 7322 5d2c 0a20 2020 2020  akelocs"],.     
-00018d20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00018d30: 4c69 6e6b 6564 4c61 6b65 4c6f 6373 222c  LinkedLakeLocs",
-00018d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d50: 2020 2020 2022 4c61 6b65 5374 6f72 4675       "LakeStorFu
-00018d60: 6e63 222c 0a20 2020 2020 2020 2020 2020  nc",.           
-00018d70: 2020 2020 2020 2020 2022 4c61 6b65 4f75           "LakeOu
-00018d80: 7466 6c6f 7746 756e 6322 2c0a 2020 2020  tflowFunc",.    
-00018d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018da0: 224c 616b 6541 7265 6122 2c0a 2020 2020  "LakeArea",.    
-00018db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018dc0: 224c 616b 6541 7667 4c65 7665 6c22 2c0a  "LakeAvgLevel",.
-00018dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018de0: 2020 2020 224c 616b 6541 7667 4f75 7422      "LakeAvgOut"
-00018df0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018e00: 2020 2020 2020 224c 616b 6554 6872 6573        "LakeThres
-00018e10: 686f 6c64 222c 0a20 2020 2020 2020 2020  hold",.         
-00018e20: 2020 2020 2020 2020 2020 2022 4c61 6b65             "Lake
-00018e30: 5f62 222c 0a20 2020 2020 2020 2020 2020  _b",.           
-00018e40: 2020 2020 2020 2020 2022 4c61 6b65 5f65           "Lake_e
-00018e50: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00018e60: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
-00018e70: 2020 2020 2073 656c 662e 5f73 7461 7469       self._stati
-00018e80: 636d 6170 7320 3d20 7365 6c66 2e73 7461  cmaps = self.sta
-00018e90: 7469 636d 6170 732e 6472 6f70 5f76 6172  ticmaps.drop_var
-00018ea0: 7328 7265 6d6f 7665 5f6d 6170 7329 0a0a  s(remove_maps)..
-00018eb0: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
-00018ec0: 2063 6f6e 6669 670a 2020 2020 2020 2020   config.        
-00018ed0: 2320 5265 6d6f 7665 2074 6865 2061 6273  # Remove the abs
-00018ee0: 6f6c 7574 6520 7061 7468 2061 6e64 2069  olute path and i
-00018ef0: 6620 6e65 6564 6564 2072 656d 6f76 6520  f needed remove 
-00018f00: 6c61 6b65 7320 616e 6420 7265 7365 7276  lakes and reserv
-00018f10: 6f69 7273 0a20 2020 2020 2020 2069 6620  oirs.        if 
-00018f20: 7265 6d6f 7665 5f72 6573 6572 766f 6972  remove_reservoir
-00018f30: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00018f40: 6368 616e 6765 2072 6573 6572 766f 6972  change reservoir
-00018f50: 7320 3d20 7472 7565 2074 6f20 6661 6c73  s = true to fals
-00018f60: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-00018f70: 6c66 2e73 6574 5f63 6f6e 6669 6728 226d  lf.set_config("m
-00018f80: 6f64 656c 2e72 6573 6572 766f 6972 7322  odel.reservoirs"
-00018f90: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-00018fa0: 2020 2020 2023 2072 656d 6f76 6520 7374       # remove st
-00018fb0: 6174 6573 0a20 2020 2020 2020 2020 2020  ates.           
-00018fc0: 2069 6620 7365 6c66 2e67 6574 5f63 6f6e   if self.get_con
-00018fd0: 6669 6728 2273 7461 7465 2e6c 6174 6572  fig("state.later
-00018fe0: 616c 2e72 6976 6572 2e72 6573 6572 766f  al.river.reservo
-00018ff0: 6972 2229 2069 7320 6e6f 7420 4e6f 6e65  ir") is not None
-00019000: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019010: 2020 6465 6c20 7365 6c66 2e63 6f6e 6669    del self.confi
-00019020: 675b 2273 7461 7465 225d 5b22 6c61 7465  g["state"]["late
-00019030: 7261 6c22 5d5b 2272 6976 6572 225d 5b22  ral"]["river"]["
-00019040: 7265 7365 7276 6f69 7222 5d0a 0a20 2020  reservoir"]..   
-00019050: 2020 2020 2069 6620 7265 6d6f 7665 5f6c       if remove_l
-00019060: 616b 653a 0a20 2020 2020 2020 2020 2020  ake:.           
-00019070: 2023 2063 6861 6e67 6520 6c61 6b65 7320   # change lakes 
-00019080: 3d20 7472 7565 2074 6f20 6661 6c73 650a  = true to false.
-00019090: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000190a0: 2e73 6574 5f63 6f6e 6669 6728 226d 6f64  .set_config("mod
-000190b0: 656c 2e6c 616b 6573 222c 2046 616c 7365  el.lakes", False
-000190c0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-000190d0: 7265 6d6f 7665 2073 7461 7465 730a 2020  remove states.  
-000190e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000190f0: 662e 6765 745f 636f 6e66 6967 2822 7374  f.get_config("st
-00019100: 6174 652e 6c61 7465 7261 6c2e 7269 7665  ate.lateral.rive
-00019110: 722e 6c61 6b65 2229 2069 7320 6e6f 7420  r.lake") is not 
-00019120: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00019130: 2020 2020 2020 6465 6c20 7365 6c66 2e63        del self.c
-00019140: 6f6e 6669 675b 2273 7461 7465 225d 5b22  onfig["state"]["
-00019150: 6c61 7465 7261 6c22 5d5b 2272 6976 6572  lateral"]["river
-00019160: 225d 5b22 6c61 6b65 225d 0a0a 2020 2020  "]["lake"]..    
-00019170: 6465 6620 636c 6970 5f66 6f72 6369 6e67  def clip_forcing
-00019180: 2873 656c 662c 2063 7273 3d34 3332 362c  (self, crs=4326,
-00019190: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-000191a0: 2020 2020 2222 2252 6574 7572 6e20 636c      """Return cl
-000191b0: 6970 7070 6564 2066 6f72 6369 6e67 2066  ippped forcing f
-000191c0: 6f72 2073 7562 6261 7369 6e2e 0a0a 2020  or subbasin...  
-000191d0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-000191e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-000191f0: 2020 2020 2020 7861 7272 6179 2e44 6174        xarray.Dat
-00019200: 6153 6574 0a20 2020 2020 2020 2020 2020  aSet.           
-00019210: 2043 6c69 7070 6564 2066 6f72 6369 6e67   Clipped forcing
-00019220: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
-00019230: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-00019240: 6c66 2e66 6f72 6369 6e67 2920 3e20 303a  lf.forcing) > 0:
-00019250: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00019260: 662e 6c6f 6767 6572 2e69 6e66 6f28 2243  f.logger.info("C
-00019270: 6c69 7070 696e 6720 4e65 7443 4446 2066  lipping NetCDF f
-00019280: 6f72 6369 6e67 2e2e 2229 0a20 2020 2020  orcing..").     
-00019290: 2020 2020 2020 2064 735f 666f 7263 696e         ds_forcin
-000192a0: 6720 3d20 7872 2e6d 6572 6765 2873 656c  g = xr.merge(sel
-000192b0: 662e 666f 7263 696e 672e 7661 6c75 6573  f.forcing.values
-000192c0: 2829 292e 7261 7374 6572 2e63 6c69 705f  ()).raster.clip_
-000192d0: 6262 6f78 280a 2020 2020 2020 2020 2020  bbox(.          
-000192e0: 2020 2020 2020 7365 6c66 2e73 7461 7469        self.stati
-000192f0: 636d 6170 732e 7261 7374 6572 2e62 6f75  cmaps.raster.bou
-00019300: 6e64 730a 2020 2020 2020 2020 2020 2020  nds.            
-00019310: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00019320: 6c66 2e73 6574 5f66 6f72 6369 6e67 2864  lf.set_forcing(d
-00019330: 735f 666f 7263 696e 6729 0a              s_forcing).
+00013a50: 206c 6f67 6765 723d 7365 6c66 2e6c 6f67   logger=self.log
+00013a60: 6765 722c 0a20 2020 2020 2020 2020 2020  ger,.           
+00013a70: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00013a80: 726d 6469 6374 203d 207b 6b3a 2076 2066  rmdict = {k: v f
+00013a90: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+00013aa0: 5f4d 4150 532e 6974 656d 7328 2920 6966  _MAPS.items() if
+00013ab0: 206b 2069 6e20 6473 5f67 6c61 632e 6461   k in ds_glac.da
+00013ac0: 7461 5f76 6172 737d 0a20 2020 2020 2020  ta_vars}.       
+00013ad0: 2020 2020 2073 656c 662e 7365 745f 7374       self.set_st
+00013ae0: 6174 6963 6d61 7073 2864 735f 676c 6163  aticmaps(ds_glac
+00013af0: 2e72 656e 616d 6528 726d 6469 6374 2929  .rename(rmdict))
+00013b00: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00013b10: 6c66 2e73 6574 5f73 7461 7469 6367 656f  lf.set_staticgeo
+00013b20: 6d73 2867 6466 5f6f 7267 2c20 6e61 6d65  ms(gdf_org, name
+00013b30: 3d22 676c 6163 6965 7273 2229 0a0a 2020  ="glaciers")..  
+00013b40: 2020 2020 2020 2020 2020 666f 7220 6f70            for op
+00013b50: 7469 6f6e 2069 6e20 676c 6163 5f74 6f6d  tion in glac_tom
+00013b60: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
+00013b70: 2020 2073 656c 662e 7365 745f 636f 6e66     self.set_conf
+00013b80: 6967 286f 7074 696f 6e2c 2067 6c61 635f  ig(option, glac_
+00013b90: 746f 6d6c 5b6f 7074 696f 6e5d 290a 2020  toml[option]).  
+00013ba0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00013bb0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+00013bc0: 6765 722e 7761 726e 696e 6728 0a20 2020  ger.warning(.   
+00013bd0: 2020 2020 2020 2020 2020 2020 2066 224e               f"N
+00013be0: 6f20 676c 6163 6965 7273 206f 6620 7375  o glaciers of su
+00013bf0: 6666 6963 6965 6e74 2073 697a 6520 666f  fficient size fo
+00013c00: 756e 6420 7769 7468 696e 2072 6567 696f  und within regio
+00013c10: 6e21 220a 2020 2020 2020 2020 2020 2020  n!".            
+00013c20: 2020 2020 6622 536b 6970 7069 6e67 2067      f"Skipping g
+00013c30: 6c61 6369 6572 2070 726f 6365 6475 7265  lacier procedure
+00013c40: 7321 220a 2020 2020 2020 2020 2020 2020  s!".            
+00013c50: 290a 0a20 2020 2064 6566 2073 6574 7570  )..    def setup
+00013c60: 5f63 6f6e 7374 616e 745f 7061 7273 2873  _constant_pars(s
+00013c70: 656c 662c 2064 7479 7065 3d22 666c 6f61  elf, dtype="floa
+00013c80: 7433 3222 2c20 6e6f 6461 7461 3d2d 3939  t32", nodata=-99
+00013c90: 392c 202a 2a6b 7761 7267 7329 3a0a 2020  9, **kwargs):.  
+00013ca0: 2020 2020 2020 2222 2253 6574 7570 2063        """Setup c
+00013cb0: 6f6e 7374 616e 7420 7061 7261 6d65 7465  onstant paramete
+00013cc0: 7220 6d61 7073 2066 6f72 2061 6c6c 2061  r maps for all a
+00013cd0: 6374 6976 6520 6d6f 6465 6c20 6365 6c6c  ctive model cell
+00013ce0: 732e 0a0a 2020 2020 2020 2020 4164 6473  s...        Adds
+00013cf0: 206d 6f64 656c 206c 6179 6572 3a0a 0a20   model layer:.. 
+00013d00: 2020 2020 2020 202a 202a 2a70 6172 616d         * **param
+00013d10: 5f6e 616d 652a 2a20 6d61 703a 2063 6f6e  _name** map: con
+00013d20: 7374 616e 7420 7061 7261 6d65 7465 7220  stant parameter 
+00013d30: 6d61 702e 0a0a 2020 2020 2020 2020 5061  map...        Pa
+00013d40: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00013d50: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00013d60: 2020 2020 6474 7970 653a 2073 7472 0a20      dtype: str. 
+00013d70: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+00013d80: 7479 7065 0a20 2020 2020 2020 206e 6f64  type.        nod
+00013d90: 6174 613a 2069 6e74 206f 7220 666c 6f61  ata: int or floa
+00013da0: 740a 2020 2020 2020 2020 2020 2020 6e6f  t.            no
+00013db0: 6461 7461 2076 616c 7565 0a20 2020 2020  data value.     
+00013dc0: 2020 206b 7761 7267 730a 2020 2020 2020     kwargs.      
+00013dd0: 2020 2020 2020 2270 6172 616d 5f6e 616d        "param_nam
+00013de0: 653a 2076 616c 7565 2220 7061 6972 7320  e: value" pairs 
+00013df0: 666f 7220 636f 6e73 7461 6e74 2073 7461  for constant sta
+00013e00: 7469 636d 6170 732e 0a0a 2020 2020 2020  ticmaps...      
+00013e10: 2020 2222 220a 2020 2020 2020 2020 666f    """.        fo
+00013e20: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
+00013e30: 6b77 6172 6773 2e69 7465 6d73 2829 3a0a  kwargs.items():.
+00013e40: 2020 2020 2020 2020 2020 2020 6e6f 6461              noda
+00013e50: 7461 203d 206e 702e 6474 7970 6528 6474  ta = np.dtype(dt
+00013e60: 7970 6529 2e74 7970 6528 6e6f 6461 7461  ype).type(nodata
+00013e70: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
+00013e80: 5f70 6172 616d 203d 2078 722e 7768 6572  _param = xr.wher
+00013e90: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00013ea0: 2020 2073 656c 662e 7374 6174 6963 6d61     self.staticma
+00013eb0: 7073 5b73 656c 662e 5f4d 4150 535b 2262  ps[self._MAPS["b
+00013ec0: 6173 696e 7322 5d5d 2c20 7661 6c75 652c  asins"]], value,
+00013ed0: 206e 6f64 6174 610a 2020 2020 2020 2020   nodata.        
+00013ee0: 2020 2020 292e 6173 7479 7065 2864 7479      ).astype(dty
+00013ef0: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+00013f00: 6461 5f70 6172 616d 2e72 6173 7465 722e  da_param.raster.
+00013f10: 7365 745f 6e6f 6461 7461 286e 6f64 6174  set_nodata(nodat
+00013f20: 6129 0a0a 2020 2020 2020 2020 2020 2020  a)..            
+00013f30: 6461 5f70 6172 616d 203d 2064 615f 7061  da_param = da_pa
+00013f40: 7261 6d2e 7265 6e61 6d65 286b 6579 290a  ram.rename(key).
+00013f50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013f60: 2e73 6574 5f73 7461 7469 636d 6170 7328  .set_staticmaps(
+00013f70: 6461 5f70 6172 616d 290a 0a20 2020 2064  da_param)..    d
+00013f80: 6566 2073 6574 7570 5f73 7461 7469 636d  ef setup_staticm
+00013f90: 6170 735f 6672 6f6d 5f72 6173 7465 7228  aps_from_raster(
+00013fa0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00013fb0: 2020 2020 2020 2072 6173 7465 725f 666e         raster_fn
+00013fc0: 3a20 7374 722c 0a20 2020 2020 2020 2072  : str,.        r
+00013fd0: 6570 726f 6a65 6374 5f6d 6574 686f 643a  eproject_method:
+00013fe0: 2073 7472 2c0a 2020 2020 2020 2020 7661   str,.        va
+00013ff0: 7269 6162 6c65 733a 204f 7074 696f 6e61  riables: Optiona
+00014000: 6c5b 4c69 7374 5d20 3d20 4e6f 6e65 2c0a  l[List] = None,.
+00014010: 2020 2020 2020 2020 7766 6c6f 775f 7661          wflow_va
+00014020: 7269 6162 6c65 733a 204f 7074 696f 6e61  riables: Optiona
+00014030: 6c5b 4c69 7374 5d20 3d20 4e6f 6e65 2c0a  l[List] = None,.
+00014040: 2020 2020 2020 2020 6669 6c6c 5f6d 6574          fill_met
+00014050: 686f 643a 204f 7074 696f 6e61 6c5b 7374  hod: Optional[st
+00014060: 725d 203d 204e 6f6e 652c 0a20 2020 2029  r] = None,.    )
+00014070: 202d 3e20 4c69 7374 5b73 7472 5d3a 0a20   -> List[str]:. 
+00014080: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014090: 2020 2054 6869 7320 636f 6d70 6f6e 656e     This componen
+000140a0: 7420 6164 6473 2064 6174 6120 7661 7269  t adds data vari
+000140b0: 6162 6c65 2873 2920 6672 6f6d 2060 6072  able(s) from ``r
+000140c0: 6173 7465 725f 666e 6060 2074 6f20 7374  aster_fn`` to st
+000140d0: 6174 6963 6d61 7073 206f 626a 6563 742e  aticmaps object.
+000140e0: 0a20 2020 2020 2020 2049 6620 7261 7374  .        If rast
+000140f0: 6572 2069 7320 6120 6461 7461 7365 742c  er is a dataset,
+00014100: 2061 6c6c 2076 6172 6961 626c 6573 2077   all variables w
+00014110: 696c 6c20 6265 2061 6464 6564 2075 6e6c  ill be added unl
+00014120: 6573 7320 6060 7661 7269 6162 6c65 7360  ess ``variables`
+00014130: 6020 6c69 7374 2069 7320 7370 6563 6966  ` list is specif
+00014140: 6965 642e 0a20 2020 2020 2020 2054 6865  ied..        The
+00014150: 2063 6f6e 6669 6720 746f 6d6c 2063 616e   config toml can
+00014160: 2061 6c73 6f20 6265 2075 7064 6174 6564   also be updated
+00014170: 2074 6f20 696e 636c 7564 6520 7468 6520   to include the 
+00014180: 6e65 7720 6d61 7073 2075 7369 6e67 2060  new maps using `
+00014190: 6077 666c 6f77 5f76 6172 6961 626c 6573  `wflow_variables
+000141a0: 6060 2e0a 0a20 2020 2020 2020 2041 6464  ``...        Add
+000141b0: 7320 6d6f 6465 6c20 6c61 7965 7273 3a0a  s model layers:.
+000141c0: 0a20 2020 2020 2020 202a 202a 2a72 6173  .        * **ras
+000141d0: 7465 722e 6e61 6d65 2a2a 206f 7220 2a2a  ter.name** or **
+000141e0: 7661 7269 6162 6c65 732a 2a20 7374 6174  variables** stat
+000141f0: 6963 6d61 7073 3a20 6461 7461 2066 726f  icmaps: data fro
+00014200: 6d20 7261 7374 6572 5f66 6e0a 0a20 2020  m raster_fn..   
+00014210: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00014220: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00014230: 2d2d 0a20 2020 2020 2020 2072 6173 7465  --.        raste
+00014240: 725f 666e 3a20 7374 720a 2020 2020 2020  r_fn: str.      
+00014250: 2020 2020 2020 536f 7572 6365 206e 616d        Source nam
+00014260: 6520 6f66 2072 6173 7465 7220 6461 7461  e of raster data
+00014270: 2069 6e20 6461 7461 5f63 6174 616c 6f67   in data_catalog
+00014280: 2e0a 2020 2020 2020 2020 7265 7072 6f6a  ..        reproj
+00014290: 6563 745f 6d65 7468 6f64 3a20 7374 720a  ect_method: str.
+000142a0: 2020 2020 2020 2020 2020 2020 5265 7072              Repr
+000142b0: 6f6a 6563 7469 6f6e 206d 6574 686f 6420  ojection method 
+000142c0: 6672 6f6d 2072 6173 7465 7269 6f2e 656e  from rasterio.en
+000142d0: 756d 732e 5265 7361 6d70 6c69 6e67 2e0a  ums.Resampling..
+000142e0: 2020 2020 2020 2020 2020 2020 4176 6169              Avai
+000142f0: 6c61 626c 6520 6d65 7468 6f64 733a 205b  lable methods: [
+00014300: 276e 6561 7265 7374 272c 2027 6269 6c69  'nearest', 'bili
+00014310: 6e65 6172 272c 2027 6375 6269 6327 2c20  near', 'cubic', 
+00014320: 2763 7562 6963 5f73 706c 696e 6527 2c20  'cubic_spline', 
+00014330: 276c 616e 637a 6f73 272c 2027 6176 6572  'lanczos', 'aver
+00014340: 6167 6527 2c20 276d 6f64 6527 2c0a 2020  age', 'mode',.  
+00014350: 2020 2020 2020 2020 2020 2767 6175 7373            'gauss
+00014360: 272c 2027 6d61 7827 2c20 276d 696e 272c  ', 'max', 'min',
+00014370: 2027 6d65 6427 2c20 2771 3127 2c20 2771   'med', 'q1', 'q
+00014380: 3327 2c20 2773 756d 272c 2027 726d 7327  3', 'sum', 'rms'
+00014390: 5d0a 2020 2020 2020 2020 7661 7269 6162  ].        variab
+000143a0: 6c65 733a 206c 6973 742c 206f 7074 696f  les: list, optio
+000143b0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+000143c0: 4c69 7374 206f 6620 7661 7269 6162 6c65  List of variable
+000143d0: 7320 746f 2061 6464 2074 6f20 7374 6174  s to add to stat
+000143e0: 6963 6d61 7073 2066 726f 6d20 7261 7374  icmaps from rast
+000143f0: 6572 5f66 6e2e 2042 7920 6465 6661 756c  er_fn. By defaul
+00014400: 7420 616c 6c2e 0a20 2020 2020 2020 2077  t all..        w
+00014410: 666c 6f77 5f76 6172 6961 626c 6573 3a20  flow_variables: 
+00014420: 6c69 7374 2c20 6f70 7469 6f6e 616c 0a20  list, optional. 
+00014430: 2020 2020 2020 2020 2020 204c 6973 7420             List 
+00014440: 6f66 2063 6f72 7265 7370 6f6e 6469 6e67  of corresponding
+00014450: 2077 666c 6f77 2076 6172 6961 626c 6573   wflow variables
+00014460: 2074 6f20 7570 6461 7465 2074 6865 2063   to update the c
+00014470: 6f6e 6669 6720 746f 6d6c 2028 652e 673a  onfig toml (e.g:
+00014480: 205b 2269 6e70 7574 2e76 6572 7469 6361   ["input.vertica
+00014490: 6c2e 616c 7469 7475 6465 225d 292e 0a20  l.altitude"]).. 
+000144a0: 2020 2020 2020 2020 2020 2053 686f 756c             Shoul
+000144b0: 6420 6d61 7463 6820 7468 6520 7661 7269  d match the vari
+000144c0: 6162 6c65 7320 6c69 7374 2e20 7661 7269  ables list. vari
+000144d0: 6162 6c65 7320 6c69 7374 2073 686f 756c  ables list shoul
+000144e0: 6420 6265 2070 726f 7669 6465 6420 756e  d be provided un
+000144f0: 6c65 7373 2072 6173 7465 725f 666e 2063  less raster_fn c
+00014500: 6f6e 7461 696e 730a 2020 2020 2020 2020  ontains.        
+00014510: 2020 2020 6120 7369 6e67 6c65 2076 6172      a single var
+00014520: 6961 626c 6520 286c 656e 2031 292e 0a20  iable (len 1).. 
+00014530: 2020 2020 2020 2066 696c 6c5f 6d65 7468         fill_meth
+00014540: 6f64 203a 2073 7472 2c20 6f70 7469 6f6e  od : str, option
+00014550: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
+00014560: 6620 7370 6563 6966 6965 642c 2066 696c  f specified, fil
+00014570: 6c73 206e 6f64 6174 6120 7661 6c75 6573  ls nodata values
+00014580: 2075 7369 6e67 2066 696c 6c5f 6e6f 6461   using fill_noda
+00014590: 7461 206d 6574 686f 642e 0a20 2020 2020  ta method..     
+000145a0: 2020 2020 2020 2041 7661 696c 6162 6c65         Available
+000145b0: 206d 6574 686f 6473 2061 7265 207b 276c   methods are {'l
+000145c0: 696e 6561 7227 2c20 276e 6561 7265 7374  inear', 'nearest
+000145d0: 272c 2027 6375 6269 6327 2c20 2772 696f  ', 'cubic', 'rio
+000145e0: 5f69 6477 277d 2e0a 0a20 2020 2020 2020  _idw'}...       
+000145f0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00014600: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+00014610: 206c 6973 740a 2020 2020 2020 2020 2020   list.          
+00014620: 2020 4e61 6d65 7320 6f66 2061 6464 6564    Names of added
+00014630: 206d 6f64 656c 2073 7461 7469 636d 6170   model staticmap
+00014640: 206c 6179 6572 732e 0a20 2020 2020 2020   layers..       
+00014650: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+00014660: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
+00014670: 5072 6570 6172 696e 6720 7374 6174 6963  Preparing static
+00014680: 6d61 7073 2064 6174 6120 6672 6f6d 2072  maps data from r
+00014690: 6173 7465 7220 736f 7572 6365 207b 7261  aster source {ra
+000146a0: 7374 6572 5f66 6e7d 2229 0a20 2020 2020  ster_fn}").     
+000146b0: 2020 2023 2052 6561 6420 7261 7374 6572     # Read raster
+000146c0: 2064 6174 6120 616e 6420 7365 6c65 6374   data and select
+000146d0: 2076 6172 6961 626c 6573 0a20 2020 2020   variables.     
+000146e0: 2020 2064 7320 3d20 7365 6c66 2e64 6174     ds = self.dat
+000146f0: 615f 6361 7461 6c6f 672e 6765 745f 7261  a_catalog.get_ra
+00014700: 7374 6572 6461 7461 7365 7428 0a20 2020  sterdataset(.   
+00014710: 2020 2020 2020 2020 2072 6173 7465 725f           raster_
+00014720: 666e 2c0a 2020 2020 2020 2020 2020 2020  fn,.            
+00014730: 6765 6f6d 3d73 656c 662e 7265 6769 6f6e  geom=self.region
+00014740: 2c0a 2020 2020 2020 2020 2020 2020 6275  ,.            bu
+00014750: 6666 6572 3d32 2c0a 2020 2020 2020 2020  ffer=2,.        
+00014760: 2020 2020 7661 7269 6162 6c65 733d 7661      variables=va
+00014770: 7269 6162 6c65 732c 0a20 2020 2020 2020  riables,.       
+00014780: 2020 2020 2073 696e 676c 655f 7661 725f       single_var_
+00014790: 6173 5f61 7272 6179 3d46 616c 7365 2c0a  as_array=False,.
+000147a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000147b0: 2020 2320 4669 6c6c 206e 6f64 6174 610a    # Fill nodata.
+000147c0: 2020 2020 2020 2020 6966 2066 696c 6c5f          if fill_
+000147d0: 6d65 7468 6f64 2069 7320 6e6f 7420 4e6f  method is not No
+000147e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000147f0: 6473 203d 2064 732e 7261 7374 6572 2e69  ds = ds.raster.i
+00014800: 6e74 6572 706f 6c61 7465 5f6e 6128 6d65  nterpolate_na(me
+00014810: 7468 6f64 3d66 696c 6c5f 6d65 7468 6f64  thod=fill_method
+00014820: 290a 2020 2020 2020 2020 2320 5265 7072  ).        # Repr
+00014830: 6f6a 6563 7469 6f6e 0a20 2020 2020 2020  ojection.       
+00014840: 2064 735f 6f75 7420 3d20 6473 2e72 6173   ds_out = ds.ras
+00014850: 7465 722e 7265 7072 6f6a 6563 745f 6c69  ter.reproject_li
+00014860: 6b65 2873 656c 662e 7374 6174 6963 6d61  ke(self.staticma
+00014870: 7073 2c20 6d65 7468 6f64 3d72 6570 726f  ps, method=repro
+00014880: 6a65 6374 5f6d 6574 686f 6429 0a20 2020  ject_method).   
+00014890: 2020 2020 2023 2041 6464 2074 6f20 7374       # Add to st
+000148a0: 6174 6963 6d61 7073 0a20 2020 2020 2020  aticmaps.       
+000148b0: 2073 656c 662e 7365 745f 7374 6174 6963   self.set_static
+000148c0: 6d61 7073 2864 735f 6f75 7429 0a0a 2020  maps(ds_out)..  
+000148d0: 2020 2020 2020 2320 5570 6461 7465 2063        # Update c
+000148e0: 6f6e 6669 670a 2020 2020 2020 2020 6966  onfig.        if
+000148f0: 2077 666c 6f77 5f76 6172 6961 626c 6573   wflow_variables
+00014900: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00014910: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00014920: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+00014930: 2020 2020 2020 2020 2020 2020 6622 5570              f"Up
+00014940: 6461 7469 6e67 2074 6865 2063 6f6e 6669  dating the confi
+00014950: 6720 666f 7220 7766 6c6f 775f 7661 7269  g for wflow_vari
+00014960: 6162 6c65 733a 207b 7766 6c6f 775f 7661  ables: {wflow_va
+00014970: 7269 6162 6c65 737d 220a 2020 2020 2020  riables}".      
+00014980: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00014990: 2020 2020 6966 2076 6172 6961 626c 6573      if variables
+000149a0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000149b0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000149c0: 2864 735f 6f75 742e 6461 7461 5f76 6172  (ds_out.data_var
+000149d0: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
+000149e0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+000149f0: 6961 626c 6573 203d 206c 6973 7428 6473  iables = list(ds
+00014a00: 5f6f 7574 2e64 6174 615f 7661 7273 2e6b  _out.data_vars.k
+00014a10: 6579 7328 2929 0a20 2020 2020 2020 2020  eys()).         
+00014a20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a40: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00014a50: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00014a60: 2020 2020 2020 2020 2020 2066 2243 616e             f"Can
+00014a70: 6e6f 7420 7570 6461 7465 2074 6865 2074  not update the t
+00014a80: 6f6d 6c20 6966 2072 6173 7465 725f 666e  oml if raster_fn
+00014a90: 2068 6173 206d 6f72 6520 7468 616e 206f   has more than o
+00014aa0: 6e65 2076 6172 6961 626c 6520 616e 6420  ne variable and 
+00014ab0: 7661 7269 6162 6c65 7320 6c69 7374 2069  variables list i
+00014ac0: 7320 6e6f 7420 7072 6f76 6964 6564 2e22  s not provided."
+00014ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ae0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00014af0: 2020 2020 2320 4368 6563 6b20 6f6e 206c      # Check on l
+00014b00: 656e 0a20 2020 2020 2020 2020 2020 2069  en.            i
+00014b10: 6620 6c65 6e28 7766 6c6f 775f 7661 7269  f len(wflow_vari
+00014b20: 6162 6c65 7329 2021 3d20 6c65 6e28 7661  ables) != len(va
+00014b30: 7269 6162 6c65 7329 3a0a 2020 2020 2020  riables):.      
+00014b40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00014b50: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00014b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b70: 6622 4c65 6e67 7468 206f 6620 7661 7269  f"Length of vari
+00014b80: 6162 6c65 7320 7b76 6172 6961 626c 6573  ables {variables
+00014b90: 7d20 646f 206e 6f74 206d 6174 6368 2077  } do not match w
+00014ba0: 666c 6f77 5f76 6172 6961 626c 6573 207b  flow_variables {
+00014bb0: 7766 6c6f 775f 7661 7269 6162 6c65 737d  wflow_variables}
+00014bc0: 2e20 4361 6e6e 6f74 2075 7064 6174 6520  . Cannot update 
+00014bd0: 7468 6520 746f 6d6c 2e22 0a20 2020 2020  the toml.".     
+00014be0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00014bf0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00014c00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014c10: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+00014c20: 6e28 7661 7269 6162 6c65 7329 293a 0a20  n(variables)):. 
+00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c40: 2020 2073 656c 662e 7365 745f 636f 6e66     self.set_conf
+00014c50: 6967 2877 666c 6f77 5f76 6172 6961 626c  ig(wflow_variabl
+00014c60: 6573 5b69 5d2c 2076 6172 6961 626c 6573  es[i], variables
+00014c70: 5b69 5d29 0a0a 2020 2020 6465 6620 7365  [i])..    def se
+00014c80: 7475 705f 7072 6563 6970 5f66 6f72 6369  tup_precip_forci
+00014c90: 6e67 280a 2020 2020 2020 2020 7365 6c66  ng(.        self
+00014ca0: 2c0a 2020 2020 2020 2020 7072 6563 6970  ,.        precip
+00014cb0: 5f66 6e3a 2073 7472 203d 2022 6572 6135  _fn: str = "era5
+00014cc0: 222c 0a20 2020 2020 2020 2070 7265 6369  ",.        preci
+00014cd0: 705f 636c 696d 5f66 6e3a 204f 7074 696f  p_clim_fn: Optio
+00014ce0: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+00014cf0: 0a20 2020 2020 2020 2063 6875 6e6b 7369  .        chunksi
+00014d00: 7a65 3a20 4f70 7469 6f6e 616c 5b69 6e74  ze: Optional[int
+00014d10: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00014d20: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00014d30: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00014d40: 2020 2022 2222 5365 7475 7020 6772 6964     """Setup grid
+00014d50: 6465 6420 7072 6563 6970 6974 6174 696f  ded precipitatio
+00014d60: 6e20 666f 7263 696e 6720 6174 206d 6f64  n forcing at mod
+00014d70: 656c 2072 6573 6f6c 7574 696f 6e2e 0a0a  el resolution...
+00014d80: 2020 2020 2020 2020 4164 6473 206d 6f64          Adds mod
+00014d90: 656c 206c 6179 6572 3a0a 0a20 2020 2020  el layer:..     
+00014da0: 2020 202a 202a 2a70 7265 6369 702a 2a3a     * **precip**:
+00014db0: 2070 7265 6369 7069 7461 7469 6f6e 205b   precipitation [
+00014dc0: 6d6d 5d0a 0a20 2020 2020 2020 2050 6172  mm]..        Par
+00014dd0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00014de0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00014df0: 2020 2070 7265 6369 705f 666e 203a 2073     precip_fn : s
+00014e00: 7472 2c20 6465 6661 756c 7420 6572 6135  tr, default era5
+00014e10: 0a20 2020 2020 2020 2020 2020 2050 7265  .            Pre
+00014e20: 6369 7069 7461 7469 6f6e 2064 6174 6120  cipitation data 
+00014e30: 736f 7572 6365 2c20 7365 6520 6461 7461  source, see data
+00014e40: 2f66 6f72 6369 6e67 5f73 6f75 7263 6573  /forcing_sources
+00014e50: 2e79 6d6c 2e0a 0a20 2020 2020 2020 2020  .yml...         
+00014e60: 2020 202a 2052 6571 7569 7265 6420 7661     * Required va
+00014e70: 7269 6162 6c65 3a20 5b27 7072 6563 6970  riable: ['precip
+00014e80: 275d 0a20 2020 2020 2020 2070 7265 6369  '].        preci
+00014e90: 705f 636c 696d 5f66 6e20 3a20 7374 722c  p_clim_fn : str,
+00014ea0: 2064 6566 6175 6c74 204e 6f6e 650a 2020   default None.  
+00014eb0: 2020 2020 2020 2020 2020 4869 6768 2072            High r
+00014ec0: 6573 6f6c 7574 696f 6e20 636c 696d 6174  esolution climat
+00014ed0: 6f6c 6f67 7920 7072 6563 6970 6974 6174  ology precipitat
+00014ee0: 696f 6e20 6461 7461 2073 6f75 7263 6520  ion data source 
+00014ef0: 746f 2063 6f72 7265 6374 2070 7265 6369  to correct preci
+00014f00: 7069 7461 7469 6f6e 2c0a 2020 2020 2020  pitation,.      
+00014f10: 2020 2020 2020 7365 6520 6461 7461 2f66        see data/f
+00014f20: 6f72 6369 6e67 5f73 6f75 7263 6573 2e79  orcing_sources.y
+00014f30: 6d6c 2e0a 0a20 2020 2020 2020 2020 2020  ml...           
+00014f40: 202a 2052 6571 7569 7265 6420 7661 7269   * Required vari
+00014f50: 6162 6c65 3a20 5b27 7072 6563 6970 275d  able: ['precip']
+00014f60: 0a20 2020 2020 2020 2063 6875 6e6b 7369  .        chunksi
+00014f70: 7a65 3a20 696e 742c 206f 7074 696f 6e61  ze: int, optiona
+00014f80: 6c0a 2020 2020 2020 2020 2020 2020 4368  l.            Ch
+00014f90: 756e 6b73 697a 6520 6f6e 2074 696d 6520  unksize on time 
+00014fa0: 6469 6d65 6e73 696f 6e20 666f 7220 7072  dimension for pr
+00014fb0: 6f63 6573 7369 6e67 2064 6174 6120 286e  ocessing data (n
+00014fc0: 6f74 2066 6f72 2073 6176 696e 6720 746f  ot for saving to
+00014fd0: 2064 6973 6b21 292e 0a20 2020 2020 2020   disk!)..       
+00014fe0: 2020 2020 2049 6620 4e6f 6e65 2074 6865       If None the
+00014ff0: 2064 6174 6120 6368 756e 6b73 697a 6520   data chunksize 
+00015000: 6973 2075 7365 642c 2074 6869 7320 6361  is used, this ca
+00015010: 6e20 686f 7765 7665 7220 6265 206f 7074  n however be opt
+00015020: 696d 697a 6564 2066 6f72 0a20 2020 2020  imized for.     
+00015030: 2020 2020 2020 206c 6172 6765 2f73 6d61         large/sma
+00015040: 6c6c 2063 6174 6368 6d65 6e74 732e 2042  ll catchments. B
+00015050: 7920 6465 6661 756c 7420 4e6f 6e65 2e0a  y default None..
+00015060: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015070: 2020 2020 6966 2070 7265 6369 705f 666e      if precip_fn
+00015080: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00015090: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+000150a0: 2020 2020 2073 7461 7274 7469 6d65 203d       starttime =
+000150b0: 2073 656c 662e 6765 745f 636f 6e66 6967   self.get_config
+000150c0: 2822 7374 6172 7474 696d 6522 290a 2020  ("starttime").  
+000150d0: 2020 2020 2020 656e 6474 696d 6520 3d20        endtime = 
+000150e0: 7365 6c66 2e67 6574 5f63 6f6e 6669 6728  self.get_config(
+000150f0: 2265 6e64 7469 6d65 2229 0a20 2020 2020  "endtime").     
+00015100: 2020 2066 7265 7120 3d20 7064 2e74 6f5f     freq = pd.to_
+00015110: 7469 6d65 6465 6c74 6128 7365 6c66 2e67  timedelta(self.g
+00015120: 6574 5f63 6f6e 6669 6728 2274 696d 6573  et_config("times
+00015130: 7465 7073 6563 7322 292c 2075 6e69 743d  tepsecs"), unit=
+00015140: 2273 2229 0a20 2020 2020 2020 206d 6173  "s").        mas
+00015150: 6b20 3d20 7365 6c66 2e73 7461 7469 636d  k = self.staticm
+00015160: 6170 735b 7365 6c66 2e5f 4d41 5053 5b22  aps[self._MAPS["
+00015170: 6261 7369 6e73 225d 5d2e 7661 6c75 6573  basins"]].values
+00015180: 203e 2030 0a0a 2020 2020 2020 2020 7072   > 0..        pr
+00015190: 6563 6970 203d 2073 656c 662e 6461 7461  ecip = self.data
+000151a0: 5f63 6174 616c 6f67 2e67 6574 5f72 6173  _catalog.get_ras
+000151b0: 7465 7264 6174 6173 6574 280a 2020 2020  terdataset(.    
+000151c0: 2020 2020 2020 2020 7072 6563 6970 5f66          precip_f
+000151d0: 6e2c 0a20 2020 2020 2020 2020 2020 2067  n,.            g
+000151e0: 656f 6d3d 7365 6c66 2e72 6567 696f 6e2c  eom=self.region,
+000151f0: 0a20 2020 2020 2020 2020 2020 2062 7566  .            buf
+00015200: 6665 723d 322c 0a20 2020 2020 2020 2020  fer=2,.         
+00015210: 2020 2074 696d 655f 7475 706c 653d 2873     time_tuple=(s
+00015220: 7461 7274 7469 6d65 2c20 656e 6474 696d  tarttime, endtim
+00015230: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+00015240: 7661 7269 6162 6c65 733d 5b22 7072 6563  variables=["prec
+00015250: 6970 225d 2c0a 2020 2020 2020 2020 290a  ip"],.        ).
+00015260: 0a20 2020 2020 2020 2069 6620 6368 756e  .        if chun
+00015270: 6b73 697a 6520 6973 206e 6f74 204e 6f6e  ksize is not Non
+00015280: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00015290: 7265 6369 7020 3d20 7072 6563 6970 2e63  recip = precip.c
+000152a0: 6875 6e6b 287b 2274 696d 6522 3a20 6368  hunk({"time": ch
+000152b0: 756e 6b73 697a 657d 290a 0a20 2020 2020  unksize})..     
+000152c0: 2020 2063 6c69 6d20 3d20 4e6f 6e65 0a20     clim = None. 
+000152d0: 2020 2020 2020 2069 6620 7072 6563 6970         if precip
+000152e0: 5f63 6c69 6d5f 666e 2021 3d20 4e6f 6e65  _clim_fn != None
+000152f0: 3a0a 2020 2020 2020 2020 2020 2020 636c  :.            cl
+00015300: 696d 203d 2073 656c 662e 6461 7461 5f63  im = self.data_c
+00015310: 6174 616c 6f67 2e67 6574 5f72 6173 7465  atalog.get_raste
+00015320: 7264 6174 6173 6574 280a 2020 2020 2020  rdataset(.      
+00015330: 2020 2020 2020 2020 2020 7072 6563 6970            precip
+00015340: 5f63 6c69 6d5f 666e 2c0a 2020 2020 2020  _clim_fn,.      
+00015350: 2020 2020 2020 2020 2020 6765 6f6d 3d70            geom=p
+00015360: 7265 6369 702e 7261 7374 6572 2e62 6f78  recip.raster.box
+00015370: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015380: 2020 6275 6666 6572 3d32 2c0a 2020 2020    buffer=2,.    
+00015390: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+000153a0: 6162 6c65 733d 5b22 7072 6563 6970 225d  ables=["precip"]
+000153b0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+000153c0: 0a20 2020 2020 2020 2070 7265 6369 705f  .        precip_
+000153d0: 6f75 7420 3d20 6879 6472 6f6d 742e 776f  out = hydromt.wo
+000153e0: 726b 666c 6f77 732e 666f 7263 696e 672e  rkflows.forcing.
+000153f0: 7072 6563 6970 280a 2020 2020 2020 2020  precip(.        
+00015400: 2020 2020 7072 6563 6970 3d70 7265 6369      precip=preci
+00015410: 702c 0a20 2020 2020 2020 2020 2020 2064  p,.            d
+00015420: 615f 6c69 6b65 3d73 656c 662e 7374 6174  a_like=self.stat
+00015430: 6963 6d61 7073 5b73 656c 662e 5f4d 4150  icmaps[self._MAP
+00015440: 535b 2265 6c65 7674 6e22 5d5d 2c0a 2020  S["elevtn"]],.  
+00015450: 2020 2020 2020 2020 2020 636c 696d 3d63            clim=c
+00015460: 6c69 6d2c 0a20 2020 2020 2020 2020 2020  lim,.           
+00015470: 2066 7265 713d 6672 6571 2c0a 2020 2020   freq=freq,.    
+00015480: 2020 2020 2020 2020 7265 7361 6d70 6c65          resample
+00015490: 5f6b 7761 7267 733d 6469 6374 286c 6162  _kwargs=dict(lab
+000154a0: 656c 3d22 7269 6768 7422 2c20 636c 6f73  el="right", clos
+000154b0: 6564 3d22 7269 6768 7422 292c 0a20 2020  ed="right"),.   
+000154c0: 2020 2020 2020 2020 206c 6f67 6765 723d           logger=
+000154d0: 7365 6c66 2e6c 6f67 6765 722c 0a20 2020  self.logger,.   
+000154e0: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+000154f0: 732c 0a20 2020 2020 2020 2029 0a0a 2020  s,.        )..  
+00015500: 2020 2020 2020 2320 5570 6461 7465 206d        # Update m
+00015510: 6574 6120 6174 7472 6962 7574 6573 2028  eta attributes (
+00015520: 7573 6564 2066 6f72 2064 6566 6175 6c74  used for default
+00015530: 206f 7574 7075 7420 6669 6c65 6e61 6d65   output filename
+00015540: 206c 6174 6572 290a 2020 2020 2020 2020   later).        
+00015550: 7072 6563 6970 5f6f 7574 2e61 7474 7273  precip_out.attrs
+00015560: 2e75 7064 6174 6528 7b22 7072 6563 6970  .update({"precip
+00015570: 5f66 6e22 3a20 7072 6563 6970 5f66 6e7d  _fn": precip_fn}
+00015580: 290a 2020 2020 2020 2020 6966 2070 7265  ).        if pre
+00015590: 6369 705f 636c 696d 5f66 6e20 6973 206e  cip_clim_fn is n
+000155a0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000155b0: 2020 2020 2070 7265 6369 705f 6f75 742e       precip_out.
+000155c0: 6174 7472 732e 7570 6461 7465 287b 2270  attrs.update({"p
+000155d0: 7265 6369 705f 636c 696d 5f66 6e22 3a20  recip_clim_fn": 
+000155e0: 7072 6563 6970 5f63 6c69 6d5f 666e 7d29  precip_clim_fn})
+000155f0: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
+00015600: 745f 666f 7263 696e 6728 7072 6563 6970  t_forcing(precip
+00015610: 5f6f 7574 2e77 6865 7265 286d 6173 6b29  _out.where(mask)
+00015620: 2c20 6e61 6d65 3d22 7072 6563 6970 2229  , name="precip")
+00015630: 0a0a 2020 2020 6465 6620 7365 7475 705f  ..    def setup_
+00015640: 7465 6d70 5f70 6574 5f66 6f72 6369 6e67  temp_pet_forcing
+00015650: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00015660: 2020 2020 2020 2020 7465 6d70 5f70 6574          temp_pet
+00015670: 5f66 6e3a 2073 7472 203d 2022 6572 6135  _fn: str = "era5
+00015680: 222c 0a20 2020 2020 2020 2070 6574 5f6d  ",.        pet_m
+00015690: 6574 686f 643a 2073 7472 203d 2022 6465  ethod: str = "de
+000156a0: 6272 7569 6e22 2c0a 2020 2020 2020 2020  bruin",.        
+000156b0: 7072 6573 735f 636f 7272 6563 7469 6f6e  press_correction
+000156c0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+000156d0: 2020 2020 2020 2074 656d 705f 636f 7272         temp_corr
+000156e0: 6563 7469 6f6e 3a20 626f 6f6c 203d 2054  ection: bool = T
+000156f0: 7275 652c 0a20 2020 2020 2020 2077 696e  rue,.        win
+00015700: 645f 636f 7272 6563 7469 6f6e 3a20 626f  d_correction: bo
+00015710: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
+00015720: 2020 2077 696e 645f 616c 7469 7475 6465     wind_altitude
+00015730: 3a20 696e 7420 3d20 3130 2c0a 2020 2020  : int = 10,.    
+00015740: 2020 2020 7265 7072 6f6a 5f6d 6574 686f      reproj_metho
+00015750: 643a 2073 7472 203d 2022 6e65 6172 6573  d: str = "neares
+00015760: 745f 696e 6465 7822 2c0a 2020 2020 2020  t_index",.      
+00015770: 2020 6465 6d5f 666f 7263 696e 675f 666e    dem_forcing_fn
+00015780: 3a20 7374 7220 3d20 2265 7261 355f 6f72  : str = "era5_or
+00015790: 6f67 7261 7068 7922 2c0a 2020 2020 2020  ography",.      
+000157a0: 2020 736b 6970 5f70 6574 3a20 7374 7220    skip_pet: str 
+000157b0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+000157c0: 2063 6875 6e6b 7369 7a65 3a20 4f70 7469   chunksize: Opti
+000157d0: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+000157e0: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+000157f0: 6773 2c0a 2020 2020 2920 2d3e 204e 6f6e  gs,.    ) -> Non
+00015800: 653a 0a20 2020 2020 2020 2022 2222 5365  e:.        """Se
+00015810: 7475 7020 6772 6964 6465 6420 7265 6665  tup gridded refe
+00015820: 7265 6e63 6520 6576 6170 6f74 7261 6e73  rence evapotrans
+00015830: 7069 7261 7469 6f6e 2066 6f72 6369 6e67  piration forcing
+00015840: 2061 7420 6d6f 6465 6c20 7265 736f 6c75   at model resolu
+00015850: 7469 6f6e 2e0a 0a20 2020 2020 2020 2041  tion...        A
+00015860: 6464 7320 6d6f 6465 6c20 6c61 7965 723a  dds model layer:
+00015870: 0a0a 2020 2020 2020 2020 2a20 2a2a 7065  ..        * **pe
+00015880: 742a 2a3a 2072 6566 6572 656e 6365 2065  t**: reference e
+00015890: 7661 706f 7472 616e 7370 6972 6174 696f  vapotranspiratio
+000158a0: 6e20 5b6d 6d5d 0a20 2020 2020 2020 202a  n [mm].        *
+000158b0: 202a 2a74 656d 702a 2a3a 2074 656d 7065   **temp**: tempe
+000158c0: 7261 7475 7265 205b c2b0 435d 0a0a 2020  rature [..C]..  
+000158d0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+000158e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000158f0: 2d2d 2d0a 2020 2020 2020 2020 7465 6d70  ---.        temp
+00015900: 5f70 6574 5f66 6e20 3a20 7374 722c 206f  _pet_fn : str, o
+00015910: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00015920: 2020 2020 4e61 6d65 206f 7220 7061 7468      Name or path
+00015930: 206f 6620 6461 7461 2073 6f75 7263 6520   of data source 
+00015940: 7769 7468 2076 6172 6961 626c 6573 2074  with variables t
+00015950: 6f20 6361 6c63 756c 6174 6520 7465 6d70  o calculate temp
+00015960: 6572 6174 7572 6520 616e 6420 7265 6665  erature and refe
+00015970: 7265 6e63 6520 6576 6170 6f74 7261 6e73  rence evapotrans
+00015980: 7069 7261 7469 6f6e 2c0a 2020 2020 2020  piration,.      
+00015990: 2020 2020 2020 7365 6520 6461 7461 2f66        see data/f
+000159a0: 6f72 6369 6e67 5f73 6f75 7263 6573 2e79  orcing_sources.y
+000159b0: 6d6c 2c20 6279 2064 6566 6175 6c74 2027  ml, by default '
+000159c0: 6572 6135 5f64 6169 6c79 5f7a 6172 7227  era5_daily_zarr'
+000159d0: 2e0a 0a20 2020 2020 2020 2020 2020 202a  ...            *
+000159e0: 2052 6571 7569 7265 6420 7661 7269 6162   Required variab
+000159f0: 6c65 2066 6f72 2074 656d 7065 7261 7475  le for temperatu
+00015a00: 7265 3a20 5b27 7465 6d70 275d 0a0a 2020  re: ['temp']..  
+00015a10: 2020 2020 2020 2020 2020 2a20 5265 7175            * Requ
+00015a20: 6972 6564 2076 6172 6961 626c 6573 2066  ired variables f
+00015a30: 6f72 2044 6520 4272 7569 6e20 7265 6665  or De Bruin refe
+00015a40: 7265 6e63 6520 6576 6170 6f74 7261 6e73  rence evapotrans
+00015a50: 7069 7261 7469 6f6e 3a20 5b27 7465 6d70  piration: ['temp
+00015a60: 272c 2027 7072 6573 735f 6d73 6c27 2c20  ', 'press_msl', 
+00015a70: 276b 696e 272c 2027 6b6f 7574 275d 0a0a  'kin', 'kout']..
+00015a80: 2020 2020 2020 2020 2020 2020 2a20 5265              * Re
+00015a90: 7175 6972 6564 2076 6172 6961 626c 6573  quired variables
+00015aa0: 2066 6f72 204d 616b 6b69 6e6b 2072 6566   for Makkink ref
+00015ab0: 6572 656e 6365 2065 7661 706f 7472 616e  erence evapotran
+00015ac0: 7370 6972 6174 696f 6e3a 205b 2774 656d  spiration: ['tem
+00015ad0: 7027 2c20 2770 7265 7373 5f6d 736c 272c  p', 'press_msl',
+00015ae0: 2027 6b69 6e27 5d0a 0a20 2020 2020 2020   'kin']..       
+00015af0: 2020 2020 202a 2052 6571 7569 7265 6420       * Required 
+00015b00: 7661 7269 6162 6c65 7320 666f 7220 6461  variables for da
+00015b10: 696c 7920 5065 6e6d 616e 2d4d 6f6e 7465  ily Penman-Monte
+00015b20: 6974 6820 7265 6665 7265 6e63 6520 6576  ith reference ev
+00015b30: 6170 6f74 7261 6e73 7069 7261 7469 6f6e  apotranspiration
+00015b40: 3a20 6569 7468 6572 205b 2774 656d 7027  : either ['temp'
+00015b50: 2c20 2774 656d 705f 6d69 6e27 2c20 2774  , 'temp_min', 't
+00015b60: 656d 705f 6d61 7827 2c20 2777 696e 6427  emp_max', 'wind'
+00015b70: 2c20 2772 6827 2c20 276b 696e 275d 2066  , 'rh', 'kin'] f
+00015b80: 6f72 2027 7065 6e6d 616e 2d6d 6f6e 7465  or 'penman-monte
+00015b90: 6974 685f 7268 5f73 696d 706c 6527 206f  ith_rh_simple' o
+00015ba0: 7220 5b27 7465 6d70 272c 2027 7465 6d70  r ['temp', 'temp
+00015bb0: 5f6d 696e 272c 2027 7465 6d70 5f6d 6178  _min', 'temp_max
+00015bc0: 272c 2027 7465 6d70 5f64 6577 272c 2027  ', 'temp_dew', '
+00015bd0: 7769 6e64 272c 2027 6b69 6e27 2c20 2770  wind', 'kin', 'p
+00015be0: 7265 7373 5f6d 736c 272c 2022 7769 6e64  ress_msl', "wind
+00015bf0: 3130 5f75 222c 2022 7769 6e64 3130 5f76  10_u", "wind10_v
+00015c00: 225d 2066 6f72 2027 7065 6e6d 616e 2d6d  "] for 'penman-m
+00015c10: 6f6e 7465 6974 685f 7464 6577 2720 2874  onteith_tdew' (t
+00015c20: 6865 7365 2061 7265 2074 6865 2076 6172  hese are the var
+00015c30: 6961 626c 6573 2061 7661 696c 6162 6c65  iables available
+00015c40: 2069 6e20 4552 4135 290a 2020 2020 2020   in ERA5).      
+00015c50: 2020 7065 745f 6d65 7468 6f64 203a 207b    pet_method : {
+00015c60: 2764 6562 7275 696e 272c 2027 6d61 6b6b  'debruin', 'makk
+00015c70: 696e 6b27 2c20 2770 656e 6d61 6e2d 6d6f  ink', 'penman-mo
+00015c80: 6e74 6569 7468 5f72 685f 7369 6d70 6c65  nteith_rh_simple
+00015c90: 272c 2027 7065 6e6d 616e 2d6d 6f6e 7465  ', 'penman-monte
+00015ca0: 6974 685f 7464 6577 277d 2c20 6f70 7469  ith_tdew'}, opti
+00015cb0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00015cc0: 2052 6566 6572 656e 6365 2065 7661 706f   Reference evapo
+00015cd0: 7472 616e 7370 6972 6174 696f 6e20 6d65  transpiration me
+00015ce0: 7468 6f64 2c20 6279 2064 6566 6175 6c74  thod, by default
+00015cf0: 2027 6465 6272 7569 6e27 2e0a 2020 2020   'debruin'..    
+00015d00: 2020 2020 2020 2020 4966 2070 656e 6d61          If penma
+00015d10: 6e2d 6d6f 6e74 6569 7468 2069 7320 7573  n-monteith is us
+00015d20: 6564 2c20 7265 7175 6972 6573 2074 6865  ed, requires the
+00015d30: 2069 6e73 7461 6c6c 6174 696f 6e20 6f66   installation of
+00015d40: 2074 6865 2070 7965 7420 7061 636b 6167   the pyet packag
+00015d50: 652e 0a20 2020 2020 2020 2070 7265 7373  e..        press
+00015d60: 5f63 6f72 7265 6374 696f 6e2c 2074 656d  _correction, tem
+00015d70: 705f 636f 7272 6563 7469 6f6e 203a 2062  p_correction : b
+00015d80: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+00015d90: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00015da0: 7565 2070 7265 7373 7572 652c 2074 656d  ue pressure, tem
+00015db0: 7065 7261 7475 7265 2061 7265 2063 6f72  perature are cor
+00015dc0: 7265 6374 6564 2075 7369 6e67 2065 6c65  rected using ele
+00015dd0: 7661 7469 6f6e 206c 6170 7365 2072 6174  vation lapse rat
+00015de0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00015df0: 6279 2064 6566 6175 6c74 2046 616c 7365  by default False
+00015e00: 2e0a 2020 2020 2020 2020 6465 6d5f 666f  ..        dem_fo
+00015e10: 7263 696e 675f 666e 203a 2073 7472 2c20  rcing_fn : str, 
+00015e20: 6465 6661 756c 7420 4e6f 6e65 0a20 2020  default None.   
+00015e30: 2020 2020 2020 2020 2020 456c 6576 6174            Elevat
+00015e40: 696f 6e20 6461 7461 2073 6f75 7263 6520  ion data source 
+00015e50: 7769 7468 2063 6f76 6572 6167 6520 6f66  with coverage of
+00015e60: 2065 6e74 6972 6520 6d65 7465 6f72 6f6c   entire meteorol
+00015e70: 6f67 6963 616c 2066 6f72 6369 6e67 2064  ogical forcing d
+00015e80: 6f6d 6169 6e2e 0a20 2020 2020 2020 2020  omain..         
+00015e90: 2020 2020 4966 2074 656d 705f 636f 7272      If temp_corr
+00015ea0: 6563 7469 6f6e 2069 7320 5472 7565 2061  ection is True a
+00015eb0: 6e64 2064 656d 5f66 6f72 6369 6e67 5f66  nd dem_forcing_f
+00015ec0: 6e20 6973 2070 726f 7669 6465 6420 7468  n is provided th
+00015ed0: 6973 2069 7320 7573 6564 2069 6e0a 2020  is is used in.  
+00015ee0: 2020 2020 2020 2020 2020 2063 6f6d 6269             combi
+00015ef0: 6e61 7469 6f6e 2077 6974 6820 656c 6576  nation with elev
+00015f00: 6174 696f 6e20 6174 206d 6f64 656c 2072  ation at model r
+00015f10: 6573 6f6c 7574 696f 6e20 746f 2063 6f72  esolution to cor
+00015f20: 7265 6374 2074 6865 2074 656d 7065 7261  rect the tempera
+00015f30: 7475 7265 2e0a 2020 2020 2020 2020 736b  ture..        sk
+00015f40: 6970 5f70 6574 203a 2062 6f6f 6c2c 206f  ip_pet : bool, o
+00015f50: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00015f60: 2020 2020 4966 2054 7275 6520 6361 6c63      If True calc
+00015f70: 756c 6174 6520 7465 6d70 206f 6e6c 792e  ulate temp only.
+00015f80: 0a20 2020 2020 2020 2063 6875 6e6b 7369  .        chunksi
+00015f90: 7a65 3a20 696e 742c 206f 7074 696f 6e61  ze: int, optiona
+00015fa0: 6c0a 2020 2020 2020 2020 2020 2020 4368  l.            Ch
+00015fb0: 756e 6b73 697a 6520 6f6e 2074 696d 6520  unksize on time 
+00015fc0: 6469 6d65 6e73 696f 6e20 666f 7220 7072  dimension for pr
+00015fd0: 6f63 6573 7369 6e67 2064 6174 6120 286e  ocessing data (n
+00015fe0: 6f74 2066 6f72 2073 6176 696e 6720 746f  ot for saving to
+00015ff0: 2064 6973 6b21 292e 0a20 2020 2020 2020   disk!)..       
+00016000: 2020 2020 2049 6620 4e6f 6e65 2074 6865       If None the
+00016010: 2064 6174 6120 6368 756e 6b73 697a 6520   data chunksize 
+00016020: 6973 2075 7365 642c 2074 6869 7320 6361  is used, this ca
+00016030: 6e20 686f 7765 7665 7220 6265 206f 7074  n however be opt
+00016040: 696d 697a 6564 2066 6f72 0a20 2020 2020  imized for.     
+00016050: 2020 2020 2020 206c 6172 6765 2f73 6d61         large/sma
+00016060: 6c6c 2063 6174 6368 6d65 6e74 732e 2042  ll catchments. B
+00016070: 7920 6465 6661 756c 7420 4e6f 6e65 2e0a  y default None..
+00016080: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016090: 2020 2020 6966 2074 656d 705f 7065 745f      if temp_pet_
+000160a0: 666e 2069 7320 4e6f 6e65 3a0a 2020 2020  fn is None:.    
+000160b0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+000160c0: 2020 2020 2020 2073 7461 7274 7469 6d65         starttime
+000160d0: 203d 2073 656c 662e 6765 745f 636f 6e66   = self.get_conf
+000160e0: 6967 2822 7374 6172 7474 696d 6522 290a  ig("starttime").
+000160f0: 2020 2020 2020 2020 656e 6474 696d 6520          endtime 
+00016100: 3d20 7365 6c66 2e67 6574 5f63 6f6e 6669  = self.get_confi
+00016110: 6728 2265 6e64 7469 6d65 2229 0a20 2020  g("endtime").   
+00016120: 2020 2020 2074 696d 6573 7465 7020 3d20       timestep = 
+00016130: 7365 6c66 2e67 6574 5f63 6f6e 6669 6728  self.get_config(
+00016140: 2274 696d 6573 7465 7073 6563 7322 290a  "timestepsecs").
+00016150: 2020 2020 2020 2020 6672 6571 203d 2070          freq = p
+00016160: 642e 746f 5f74 696d 6564 656c 7461 2874  d.to_timedelta(t
+00016170: 696d 6573 7465 702c 2075 6e69 743d 2273  imestep, unit="s
+00016180: 2229 0a20 2020 2020 2020 206d 6173 6b20  ").        mask 
+00016190: 3d20 7365 6c66 2e73 7461 7469 636d 6170  = self.staticmap
+000161a0: 735b 7365 6c66 2e5f 4d41 5053 5b22 6261  s[self._MAPS["ba
+000161b0: 7369 6e73 225d 5d2e 7661 6c75 6573 203e  sins"]].values >
+000161c0: 2030 0a0a 2020 2020 2020 2020 7661 7269   0..        vari
+000161d0: 6162 6c65 7320 3d20 5b22 7465 6d70 225d  ables = ["temp"]
+000161e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000161f0: 736b 6970 5f70 6574 3a0a 2020 2020 2020  skip_pet:.      
+00016200: 2020 2020 2020 6966 2070 6574 5f6d 6574        if pet_met
+00016210: 686f 6420 3d3d 2022 6465 6272 7569 6e22  hod == "debruin"
+00016220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016230: 2020 7661 7269 6162 6c65 7320 2b3d 205b    variables += [
+00016240: 2270 7265 7373 5f6d 736c 222c 2022 6b69  "press_msl", "ki
+00016250: 6e22 2c20 226b 6f75 7422 5d0a 2020 2020  n", "kout"].    
+00016260: 2020 2020 2020 2020 656c 6966 2070 6574          elif pet
+00016270: 5f6d 6574 686f 6420 3d3d 2022 6d61 6b6b  _method == "makk
+00016280: 696e 6b22 3a0a 2020 2020 2020 2020 2020  ink":.          
+00016290: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
+000162a0: 2b3d 205b 2270 7265 7373 5f6d 736c 222c  += ["press_msl",
+000162b0: 2022 6b69 6e22 5d0a 2020 2020 2020 2020   "kin"].        
+000162c0: 2020 2020 656c 6966 2070 6574 5f6d 6574      elif pet_met
+000162d0: 686f 6420 3d3d 2022 7065 6e6d 616e 2d6d  hod == "penman-m
+000162e0: 6f6e 7465 6974 685f 7268 5f73 696d 706c  onteith_rh_simpl
+000162f0: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+00016300: 2020 2020 7661 7269 6162 6c65 7320 2b3d      variables +=
+00016310: 205b 2274 656d 705f 6d69 6e22 2c20 2274   ["temp_min", "t
+00016320: 656d 705f 6d61 7822 2c20 2277 696e 6422  emp_max", "wind"
+00016330: 2c20 2272 6822 2c20 226b 696e 225d 0a20  , "rh", "kin"]. 
+00016340: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00016350: 7065 745f 6d65 7468 6f64 203d 3d20 2270  pet_method == "p
+00016360: 656e 6d61 6e2d 6d6f 6e74 6569 7468 5f74  enman-monteith_t
+00016370: 6465 7722 3a0a 2020 2020 2020 2020 2020  dew":.          
+00016380: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
+00016390: 2b3d 205b 0a20 2020 2020 2020 2020 2020  += [.           
+000163a0: 2020 2020 2020 2020 2022 7465 6d70 5f6d           "temp_m
+000163b0: 696e 222c 0a20 2020 2020 2020 2020 2020  in",.           
+000163c0: 2020 2020 2020 2020 2022 7465 6d70 5f6d           "temp_m
+000163d0: 6178 222c 0a20 2020 2020 2020 2020 2020  ax",.           
+000163e0: 2020 2020 2020 2020 2022 7769 6e64 3130           "wind10
+000163f0: 5f75 222c 0a20 2020 2020 2020 2020 2020  _u",.           
+00016400: 2020 2020 2020 2020 2022 7769 6e64 3130           "wind10
+00016410: 5f76 222c 0a20 2020 2020 2020 2020 2020  _v",.           
+00016420: 2020 2020 2020 2020 2022 7465 6d70 5f64           "temp_d
+00016430: 6577 222c 0a20 2020 2020 2020 2020 2020  ew",.           
+00016440: 2020 2020 2020 2020 2022 6b69 6e22 2c0a           "kin",.
+00016450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016460: 2020 2020 2270 7265 7373 5f6d 736c 222c      "press_msl",
+00016470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016480: 205d 0a20 2020 2020 2020 2020 2020 2065   ].            e
+00016490: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000164a0: 2020 2020 206d 6574 686f 6473 203d 205b       methods = [
+000164b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000164c0: 2020 2020 2022 6465 6272 7569 6e22 2c0a       "debruin",.
+000164d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164e0: 2020 2020 226d 616b 6b69 6e67 222c 0a20      "makking",. 
+000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016500: 2020 2022 7065 6e6d 616e 2d6d 6f6e 7465     "penman-monte
+00016510: 6974 685f 7268 5f73 696d 706c 6522 2c0a  ith_rh_simple",.
+00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016530: 2020 2020 2270 656e 6d61 6e2d 6d6f 6e74      "penman-mont
+00016540: 6569 7468 5f74 6465 7722 2c0a 2020 2020  eith_tdew",.    
+00016550: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+00016560: 2020 2020 2020 2020 2020 2020 2020 5661                Va
+00016570: 6c75 6545 7272 6f72 2866 2255 6e6b 6e6f  lueError(f"Unkno
+00016580: 776e 2070 6574 206d 6574 686f 6420 7b70  wn pet method {p
+00016590: 6574 5f6d 6574 686f 647d 2c20 7365 6c65  et_method}, sele
+000165a0: 6374 2066 726f 6d20 7b6d 6574 686f 6473  ct from {methods
+000165b0: 7d22 290a 0a20 2020 2020 2020 2064 7320  }")..        ds 
+000165c0: 3d20 7365 6c66 2e64 6174 615f 6361 7461  = self.data_cata
+000165d0: 6c6f 672e 6765 745f 7261 7374 6572 6461  log.get_rasterda
+000165e0: 7461 7365 7428 0a20 2020 2020 2020 2020  taset(.         
+000165f0: 2020 2074 656d 705f 7065 745f 666e 2c0a     temp_pet_fn,.
+00016600: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00016610: 3d73 656c 662e 7265 6769 6f6e 2c0a 2020  =self.region,.  
+00016620: 2020 2020 2020 2020 2020 6275 6666 6572            buffer
+00016630: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
+00016640: 7469 6d65 5f74 7570 6c65 3d28 7374 6172  time_tuple=(star
+00016650: 7474 696d 652c 2065 6e64 7469 6d65 292c  ttime, endtime),
+00016660: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
+00016670: 6961 626c 6573 3d76 6172 6961 626c 6573  iables=variables
+00016680: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+00016690: 6e67 6c65 5f76 6172 5f61 735f 6172 7261  ngle_var_as_arra
+000166a0: 793d 4661 6c73 652c 2020 2320 616c 7761  y=False,  # alwa
+000166b0: 7973 2072 6574 7572 6e20 6461 7461 7365  ys return datase
+000166c0: 740a 2020 2020 2020 2020 290a 2020 2020  t.        ).    
+000166d0: 2020 2020 6966 2063 6875 6e6b 7369 7a65      if chunksize
+000166e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000166f0: 2020 2020 2020 2020 2020 6473 203d 2064            ds = d
+00016700: 732e 6368 756e 6b28 7b22 7469 6d65 223a  s.chunk({"time":
+00016710: 2063 6875 6e6b 7369 7a65 7d29 0a0a 2020   chunksize})..  
+00016720: 2020 2020 2020 6465 6d5f 666f 7263 696e        dem_forcin
+00016730: 6720 3d20 4e6f 6e65 0a20 2020 2020 2020  g = None.       
+00016740: 2069 6620 6465 6d5f 666f 7263 696e 675f   if dem_forcing_
+00016750: 666e 2021 3d20 4e6f 6e65 3a0a 2020 2020  fn != None:.    
+00016760: 2020 2020 2020 2020 6465 6d5f 666f 7263          dem_forc
+00016770: 696e 6720 3d20 7365 6c66 2e64 6174 615f  ing = self.data_
+00016780: 6361 7461 6c6f 672e 6765 745f 7261 7374  catalog.get_rast
+00016790: 6572 6461 7461 7365 7428 0a20 2020 2020  erdataset(.     
+000167a0: 2020 2020 2020 2020 2020 2064 656d 5f66             dem_f
+000167b0: 6f72 6369 6e67 5f66 6e2c 0a20 2020 2020  orcing_fn,.     
+000167c0: 2020 2020 2020 2020 2020 2067 656f 6d3d             geom=
+000167d0: 6473 2e72 6173 7465 722e 626f 782c 2020  ds.raster.box,  
+000167e0: 2320 636c 6970 2064 656d 2077 6974 6820  # clip dem with 
+000167f0: 666f 7263 696e 6720 6262 6f78 2066 6f72  forcing bbox for
+00016800: 2066 756c 6c20 636f 7665 7261 6765 0a20   full coverage. 
+00016810: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00016820: 7566 6665 723d 322c 0a20 2020 2020 2020  uffer=2,.       
+00016830: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00016840: 6573 3d5b 2265 6c65 7674 6e22 5d2c 0a20  es=["elevtn"],. 
+00016850: 2020 2020 2020 2020 2020 2029 2e73 7175             ).squ
+00016860: 6565 7a65 2829 0a0a 2020 2020 2020 2020  eeze()..        
+00016870: 7465 6d70 5f69 6e20 3d20 6879 6472 6f6d  temp_in = hydrom
+00016880: 742e 776f 726b 666c 6f77 732e 666f 7263  t.workflows.forc
+00016890: 696e 672e 7465 6d70 280a 2020 2020 2020  ing.temp(.      
+000168a0: 2020 2020 2020 6473 5b22 7465 6d70 225d        ds["temp"]
+000168b0: 2c0a 2020 2020 2020 2020 2020 2020 6465  ,.            de
+000168c0: 6d5f 6d6f 6465 6c3d 7365 6c66 2e73 7461  m_model=self.sta
+000168d0: 7469 636d 6170 735b 7365 6c66 2e5f 4d41  ticmaps[self._MA
+000168e0: 5053 5b22 656c 6576 746e 225d 5d2c 0a20  PS["elevtn"]],. 
+000168f0: 2020 2020 2020 2020 2020 2064 656d 5f66             dem_f
+00016900: 6f72 6369 6e67 3d64 656d 5f66 6f72 6369  orcing=dem_forci
+00016910: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
+00016920: 6c61 7073 655f 636f 7272 6563 7469 6f6e  lapse_correction
+00016930: 3d74 656d 705f 636f 7272 6563 7469 6f6e  =temp_correction
+00016940: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+00016950: 6767 6572 3d73 656c 662e 6c6f 6767 6572  gger=self.logger
+00016960: 2c0a 2020 2020 2020 2020 2020 2020 6672  ,.            fr
+00016970: 6571 3d4e 6f6e 652c 2020 2320 7265 7361  eq=None,  # resa
+00016980: 6d70 6c65 2074 696d 6520 6166 7465 7220  mple time after 
+00016990: 7065 7420 776f 726b 666c 6f77 0a20 2020  pet workflow.   
+000169a0: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+000169b0: 732c 0a20 2020 2020 2020 2029 0a0a 2020  s,.        )..  
+000169c0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+000169d0: 2020 2020 2020 2022 7065 6e6d 616e 2d6d         "penman-m
+000169e0: 6f6e 7465 6974 6822 2069 6e20 7065 745f  onteith" in pet_
+000169f0: 6d65 7468 6f64 0a20 2020 2020 2020 2029  method.        )
+00016a00: 3a20 2023 2061 6c73 6f20 646f 776e 7363  :  # also downsc
+00016a10: 616c 6564 2074 656d 705f 6d69 6e20 616e  aled temp_min an
+00016a20: 6420 7465 6d70 5f6d 6178 2066 6f72 2050  d temp_max for P
+00016a30: 656e 6d61 6e20 6e65 6564 6564 0a20 2020  enman needed.   
+00016a40: 2020 2020 2020 2020 2074 656d 705f 6d61           temp_ma
+00016a50: 785f 696e 203d 2068 7964 726f 6d74 2e77  x_in = hydromt.w
+00016a60: 6f72 6b66 6c6f 7773 2e66 6f72 6369 6e67  orkflows.forcing
+00016a70: 2e74 656d 7028 0a20 2020 2020 2020 2020  .temp(.         
+00016a80: 2020 2020 2020 2064 735b 2274 656d 705f         ds["temp_
+00016a90: 6d61 7822 5d2c 0a20 2020 2020 2020 2020  max"],.         
+00016aa0: 2020 2020 2020 2064 656d 5f6d 6f64 656c         dem_model
+00016ab0: 3d73 656c 662e 7374 6174 6963 6d61 7073  =self.staticmaps
+00016ac0: 5b73 656c 662e 5f4d 4150 535b 2265 6c65  [self._MAPS["ele
+00016ad0: 7674 6e22 5d5d 2c0a 2020 2020 2020 2020  vtn"]],.        
+00016ae0: 2020 2020 2020 2020 6465 6d5f 666f 7263          dem_forc
+00016af0: 696e 673d 6465 6d5f 666f 7263 696e 672c  ing=dem_forcing,
+00016b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b10: 206c 6170 7365 5f63 6f72 7265 6374 696f   lapse_correctio
+00016b20: 6e3d 7465 6d70 5f63 6f72 7265 6374 696f  n=temp_correctio
+00016b30: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00016b40: 2020 206c 6f67 6765 723d 7365 6c66 2e6c     logger=self.l
+00016b50: 6f67 6765 722c 0a20 2020 2020 2020 2020  ogger,.         
+00016b60: 2020 2020 2020 2066 7265 713d 4e6f 6e65         freq=None
+00016b70: 2c20 2023 2072 6573 616d 706c 6520 7469  ,  # resample ti
+00016b80: 6d65 2061 6674 6572 2070 6574 2077 6f72  me after pet wor
+00016b90: 6b66 6c6f 770a 2020 2020 2020 2020 2020  kflow.          
+00016ba0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+00016bb0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00016bc0: 2020 2020 2020 2020 2020 7465 6d70 5f6d            temp_m
+00016bd0: 6178 5f69 6e2e 6e61 6d65 203d 2022 7465  ax_in.name = "te
+00016be0: 6d70 5f6d 6178 220a 0a20 2020 2020 2020  mp_max"..       
+00016bf0: 2020 2020 2074 656d 705f 6d69 6e5f 696e       temp_min_in
+00016c00: 203d 2068 7964 726f 6d74 2e77 6f72 6b66   = hydromt.workf
+00016c10: 6c6f 7773 2e66 6f72 6369 6e67 2e74 656d  lows.forcing.tem
+00016c20: 7028 0a20 2020 2020 2020 2020 2020 2020  p(.             
+00016c30: 2020 2064 735b 2274 656d 705f 6d69 6e22     ds["temp_min"
+00016c40: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00016c50: 2020 2064 656d 5f6d 6f64 656c 3d73 656c     dem_model=sel
+00016c60: 662e 7374 6174 6963 6d61 7073 5b73 656c  f.staticmaps[sel
+00016c70: 662e 5f4d 4150 535b 2265 6c65 7674 6e22  f._MAPS["elevtn"
+00016c80: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
+00016c90: 2020 2020 6465 6d5f 666f 7263 696e 673d      dem_forcing=
+00016ca0: 6465 6d5f 666f 7263 696e 672c 0a20 2020  dem_forcing,.   
+00016cb0: 2020 2020 2020 2020 2020 2020 206c 6170               lap
+00016cc0: 7365 5f63 6f72 7265 6374 696f 6e3d 7465  se_correction=te
+00016cd0: 6d70 5f63 6f72 7265 6374 696f 6e2c 0a20  mp_correction,. 
+00016ce0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00016cf0: 6f67 6765 723d 7365 6c66 2e6c 6f67 6765  ogger=self.logge
+00016d00: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00016d10: 2020 2066 7265 713d 4e6f 6e65 2c20 2023     freq=None,  #
+00016d20: 2072 6573 616d 706c 6520 7469 6d65 2061   resample time a
+00016d30: 6674 6572 2070 6574 2077 6f72 6b66 6c6f  fter pet workflo
+00016d40: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
+00016d50: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00016d60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00016d70: 2020 2020 2020 7465 6d70 5f6d 696e 5f69        temp_min_i
+00016d80: 6e2e 6e61 6d65 203d 2022 7465 6d70 5f6d  n.name = "temp_m
+00016d90: 696e 220a 0a20 2020 2020 2020 2020 2020  in"..           
+00016da0: 2074 656d 705f 696e 203d 2078 722e 6d65   temp_in = xr.me
+00016db0: 7267 6528 5b74 656d 705f 696e 2c20 7465  rge([temp_in, te
+00016dc0: 6d70 5f6d 6178 5f69 6e2c 2074 656d 705f  mp_max_in, temp_
+00016dd0: 6d69 6e5f 696e 5d29 0a0a 2020 2020 2020  min_in])..      
+00016de0: 2020 6966 206e 6f74 2073 6b69 705f 7065    if not skip_pe
+00016df0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+00016e00: 6574 5f6f 7574 203d 2068 7964 726f 6d74  et_out = hydromt
+00016e10: 2e77 6f72 6b66 6c6f 7773 2e66 6f72 6369  .workflows.forci
+00016e20: 6e67 2e70 6574 280a 2020 2020 2020 2020  ng.pet(.        
+00016e30: 2020 2020 2020 2020 6473 5b76 6172 6961          ds[varia
+00016e40: 626c 6573 5b31 3a5d 5d2c 0a20 2020 2020  bles[1:]],.     
+00016e50: 2020 2020 2020 2020 2020 2074 656d 703d             temp=
+00016e60: 7465 6d70 5f69 6e2c 0a20 2020 2020 2020  temp_in,.       
+00016e70: 2020 2020 2020 2020 2064 656d 5f6d 6f64           dem_mod
+00016e80: 656c 3d73 656c 662e 7374 6174 6963 6d61  el=self.staticma
+00016e90: 7073 5b73 656c 662e 5f4d 4150 535b 2265  ps[self._MAPS["e
+00016ea0: 6c65 7674 6e22 5d5d 2c0a 2020 2020 2020  levtn"]],.      
+00016eb0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00016ec0: 3d70 6574 5f6d 6574 686f 642c 0a20 2020  =pet_method,.   
+00016ed0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00016ee0: 7373 5f63 6f72 7265 6374 696f 6e3d 7072  ss_correction=pr
+00016ef0: 6573 735f 636f 7272 6563 7469 6f6e 2c0a  ess_correction,.
+00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f10: 7769 6e64 5f63 6f72 7265 6374 696f 6e3d  wind_correction=
+00016f20: 7769 6e64 5f63 6f72 7265 6374 696f 6e2c  wind_correction,
+00016f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016f40: 2077 696e 645f 616c 7469 7475 6465 3d77   wind_altitude=w
+00016f50: 696e 645f 616c 7469 7475 6465 2c0a 2020  ind_altitude,.  
+00016f60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016f70: 7072 6f6a 5f6d 6574 686f 643d 7265 7072  proj_method=repr
+00016f80: 6f6a 5f6d 6574 686f 642c 0a20 2020 2020  oj_method,.     
+00016f90: 2020 2020 2020 2020 2020 2066 7265 713d             freq=
+00016fa0: 6672 6571 2c0a 2020 2020 2020 2020 2020  freq,.          
+00016fb0: 2020 2020 2020 7265 7361 6d70 6c65 5f6b        resample_k
+00016fc0: 7761 7267 733d 6469 6374 286c 6162 656c  wargs=dict(label
+00016fd0: 3d22 7269 6768 7422 2c20 636c 6f73 6564  ="right", closed
+00016fe0: 3d22 7269 6768 7422 292c 0a20 2020 2020  ="right"),.     
+00016ff0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00017000: 723d 7365 6c66 2e6c 6f67 6765 722c 0a20  r=self.logger,. 
+00017010: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00017020: 2a6b 7761 7267 732c 0a20 2020 2020 2020  *kwargs,.       
+00017030: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00017040: 2020 2023 2055 7064 6174 6520 6d65 7461     # Update meta
+00017050: 2061 7474 7269 6275 7465 7320 7769 7468   attributes with
+00017060: 2073 6574 7570 206f 7074 0a20 2020 2020   setup opt.     
+00017070: 2020 2020 2020 206f 7074 5f61 7474 7220         opt_attr 
+00017080: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00017090: 2020 2020 2270 6574 5f66 6e22 3a20 7465      "pet_fn": te
+000170a0: 6d70 5f70 6574 5f66 6e2c 0a20 2020 2020  mp_pet_fn,.     
+000170b0: 2020 2020 2020 2020 2020 2022 7065 745f             "pet_
+000170c0: 6d65 7468 6f64 223a 2070 6574 5f6d 6574  method": pet_met
+000170d0: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+000170e0: 207d 0a20 2020 2020 2020 2020 2020 2070   }.            p
+000170f0: 6574 5f6f 7574 2e61 7474 7273 2e75 7064  et_out.attrs.upd
+00017100: 6174 6528 6f70 745f 6174 7472 290a 2020  ate(opt_attr).  
+00017110: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00017120: 6574 5f66 6f72 6369 6e67 2870 6574 5f6f  et_forcing(pet_o
+00017130: 7574 2e77 6865 7265 286d 6173 6b29 2c20  ut.where(mask), 
+00017140: 6e61 6d65 3d22 7065 7422 290a 0a20 2020  name="pet")..   
+00017150: 2020 2020 2023 206d 616b 6520 7375 7265       # make sure
+00017160: 206f 6e6c 7920 7465 6d70 2069 7320 7772   only temp is wr
+00017170: 6974 7465 6e20 746f 206e 6574 6364 660a  itten to netcdf.
+00017180: 2020 2020 2020 2020 6966 2022 7065 6e6d          if "penm
+00017190: 616e 2d6d 6f6e 7465 6974 6822 2069 6e20  an-monteith" in 
+000171a0: 7065 745f 6d65 7468 6f64 3a0a 2020 2020  pet_method:.    
+000171b0: 2020 2020 2020 2020 7465 6d70 5f69 6e20          temp_in 
+000171c0: 3d20 7465 6d70 5f69 6e5b 2274 656d 7022  = temp_in["temp"
+000171d0: 5d0a 2020 2020 2020 2020 2320 7265 7361  ].        # resa
+000171e0: 6d70 6c65 2074 656d 7020 6166 7465 7220  mple temp after 
+000171f0: 7065 7420 776f 726b 666c 6f77 0a20 2020  pet workflow.   
+00017200: 2020 2020 2074 656d 705f 6f75 7420 3d20       temp_out = 
+00017210: 6879 6472 6f6d 742e 776f 726b 666c 6f77  hydromt.workflow
+00017220: 732e 666f 7263 696e 672e 7265 7361 6d70  s.forcing.resamp
+00017230: 6c65 5f74 696d 6528 0a20 2020 2020 2020  le_time(.       
+00017240: 2020 2020 2074 656d 705f 696e 2c0a 2020       temp_in,.  
+00017250: 2020 2020 2020 2020 2020 6672 6571 2c0a            freq,.
+00017260: 2020 2020 2020 2020 2020 2020 7570 7361              upsa
+00017270: 6d70 6c69 6e67 3d22 6266 696c 6c22 2c20  mpling="bfill", 
+00017280: 2023 2077 6520 6173 7375 6d65 2072 6967   # we assume rig
+00017290: 6874 206c 6162 656c 6564 206f 7269 6769  ht labeled origi
+000172a0: 6e61 6c20 6461 7461 0a20 2020 2020 2020  nal data.       
+000172b0: 2020 2020 2064 6f77 6e73 616d 706c 696e       downsamplin
+000172c0: 673d 226d 6561 6e22 2c0a 2020 2020 2020  g="mean",.      
+000172d0: 2020 2020 2020 6c61 6265 6c3d 2272 6967        label="rig
+000172e0: 6874 222c 0a20 2020 2020 2020 2020 2020  ht",.           
+000172f0: 2063 6c6f 7365 643d 2272 6967 6874 222c   closed="right",
+00017300: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00017310: 7365 7276 655f 6d61 7373 3d46 616c 7365  serve_mass=False
+00017320: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+00017330: 6767 6572 3d73 656c 662e 6c6f 6767 6572  gger=self.logger
+00017340: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00017350: 2020 2020 2320 5570 6461 7465 206d 6574      # Update met
+00017360: 6120 6174 7472 6962 7574 6573 2077 6974  a attributes wit
+00017370: 6820 7365 7475 7020 6f70 7420 2875 7365  h setup opt (use
+00017380: 6420 666f 7220 6465 6661 756c 7420 6e61  d for default na
+00017390: 6d69 6e67 206c 6174 6572 290a 2020 2020  ming later).    
+000173a0: 2020 2020 6f70 745f 6174 7472 203d 207b      opt_attr = {
+000173b0: 0a20 2020 2020 2020 2020 2020 2022 7465  .            "te
+000173c0: 6d70 5f66 6e22 3a20 7465 6d70 5f70 6574  mp_fn": temp_pet
+000173d0: 5f66 6e2c 0a20 2020 2020 2020 2020 2020  _fn,.           
+000173e0: 2022 7465 6d70 5f63 6f72 7265 6374 696f   "temp_correctio
+000173f0: 6e22 3a20 7374 7228 7465 6d70 5f63 6f72  n": str(temp_cor
+00017400: 7265 6374 696f 6e29 2c0a 2020 2020 2020  rection),.      
+00017410: 2020 7d0a 2020 2020 2020 2020 7465 6d70    }.        temp
+00017420: 5f6f 7574 2e61 7474 7273 2e75 7064 6174  _out.attrs.updat
+00017430: 6528 6f70 745f 6174 7472 290a 2020 2020  e(opt_attr).    
+00017440: 2020 2020 7365 6c66 2e73 6574 5f66 6f72      self.set_for
+00017450: 6369 6e67 2874 656d 705f 6f75 742e 7768  cing(temp_out.wh
+00017460: 6572 6528 6d61 736b 292c 206e 616d 653d  ere(mask), name=
+00017470: 2274 656d 7022 290a 0a20 2020 2064 6566  "temp")..    def
+00017480: 2073 6574 7570 5f72 6f6f 747a 6f6e 6563   setup_rootzonec
+00017490: 6c69 6d28 0a20 2020 2020 2020 2073 656c  lim(.        sel
+000174a0: 662c 0a20 2020 2020 2020 2072 756e 5f66  f,.        run_f
+000174b0: 6e3a 2055 6e69 6f6e 5b73 7472 2c20 5061  n: Union[str, Pa
+000174c0: 7468 2c20 7872 2e44 6174 6173 6574 5d2c  th, xr.Dataset],
+000174d0: 0a20 2020 2020 2020 2066 6f72 6369 6e67  .        forcing
+000174e0: 5f6f 6273 5f66 6e3a 2055 6e69 6f6e 5b73  _obs_fn: Union[s
+000174f0: 7472 2c20 5061 7468 2c20 7872 2e44 6174  tr, Path, xr.Dat
+00017500: 6173 6574 5d2c 0a20 2020 2020 2020 2066  aset],.        f
+00017510: 6f72 6369 6e67 5f63 635f 6869 7374 5f66  orcing_cc_hist_f
+00017520: 6e3a 204f 7074 696f 6e61 6c5b 556e 696f  n: Optional[Unio
+00017530: 6e5b 7374 722c 2050 6174 682c 2078 722e  n[str, Path, xr.
+00017540: 4461 7461 7365 745d 5d20 3d20 4e6f 6e65  Dataset]] = None
+00017550: 2c0a 2020 2020 2020 2020 666f 7263 696e  ,.        forcin
+00017560: 675f 6363 5f66 7574 5f66 6e3a 204f 7074  g_cc_fut_fn: Opt
+00017570: 696f 6e61 6c5b 556e 696f 6e5b 7374 722c  ional[Union[str,
+00017580: 2050 6174 682c 2078 722e 4461 7461 7365   Path, xr.Datase
+00017590: 745d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  t]] = None,.    
+000175a0: 2020 2020 6368 756e 6b73 697a 653a 204f      chunksize: O
+000175b0: 7074 696f 6e61 6c5b 696e 745d 203d 2031  ptional[int] = 1
+000175c0: 3030 2c0a 2020 2020 2020 2020 7265 7475  00,.        retu
+000175d0: 726e 5f70 6572 696f 643a 204f 7074 696f  rn_period: Optio
+000175e0: 6e61 6c5b 6c69 7374 5d20 3d20 5b32 2c20  nal[list] = [2, 
+000175f0: 332c 2035 2c20 3130 2c20 3135 2c20 3230  3, 5, 10, 15, 20
+00017600: 2c20 3235 2c20 3530 2c20 3630 2c20 3130  , 25, 50, 60, 10
+00017610: 305d 2c0a 2020 2020 2020 2020 496d 6178  0],.        Imax
+00017620: 3a20 4f70 7469 6f6e 616c 5b66 6c6f 6174  : Optional[float
+00017630: 5d20 3d20 322e 302c 0a20 2020 2020 2020  ] = 2.0,.       
+00017640: 2073 7461 7274 5f68 7964 726f 5f79 6561   start_hydro_yea
+00017650: 723a 204f 7074 696f 6e61 6c5b 7374 725d  r: Optional[str]
+00017660: 203d 2022 5365 7022 2c0a 2020 2020 2020   = "Sep",.      
+00017670: 2020 7374 6172 745f 6669 656c 645f 6361    start_field_ca
+00017680: 7061 6369 7479 3a20 4f70 7469 6f6e 616c  pacity: Optional
+00017690: 5b73 7472 5d20 3d20 2241 7072 222c 0a20  [str] = "Apr",. 
+000176a0: 2020 2020 2020 204c 4149 3a20 4f70 7469         LAI: Opti
+000176b0: 6f6e 616c 5b62 6f6f 6c5d 203d 2046 616c  onal[bool] = Fal
+000176c0: 7365 2c0a 2020 2020 2020 2020 726f 6f74  se,.        root
+000176d0: 7a6f 6e65 5f73 746f 7261 6765 3a20 4f70  zone_storage: Op
+000176e0: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 2046  tional[bool] = F
+000176f0: 616c 7365 2c0a 2020 2020 2020 2020 636f  alse,.        co
+00017700: 7272 6563 745f 6363 5f64 6566 6963 6974  rrect_cc_deficit
+00017710: 3a20 4f70 7469 6f6e 616c 5b62 6f6f 6c5d  : Optional[bool]
+00017720: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+00017730: 2020 7469 6d65 5f74 7570 6c65 3a20 4f70    time_tuple: Op
+00017740: 7469 6f6e 616c 5b74 7570 6c65 5d20 3d20  tional[tuple] = 
+00017750: 4e6f 6e65 2c0a 2020 2020 2020 2020 7469  None,.        ti
+00017760: 6d65 5f74 7570 6c65 5f66 7574 3a20 4f70  me_tuple_fut: Op
+00017770: 7469 6f6e 616c 5b74 7570 6c65 5d20 3d20  tional[tuple] = 
+00017780: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d69  None,.        mi
+00017790: 7373 696e 675f 6461 7973 5f74 6872 6573  ssing_days_thres
+000177a0: 686f 6c64 3a20 4f70 7469 6f6e 616c 5b69  hold: Optional[i
+000177b0: 6e74 5d20 3d20 3333 302c 0a20 2020 2020  nt] = 330,.     
+000177c0: 2020 2075 7064 6174 655f 746f 6d6c 5f72     update_toml_r
+000177d0: 6f6f 7469 6e67 6465 7074 683a 204f 7074  ootingdepth: Opt
+000177e0: 696f 6e61 6c5b 7374 725d 203d 2022 526f  ional[str] = "Ro
+000177f0: 6f74 696e 6744 6570 7468 5f6f 6273 5f32  otingDepth_obs_2
+00017800: 3022 2c0a 2020 2020 2920 2d3e 204e 6f6e  0",.    ) -> Non
+00017810: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00017820: 2020 2020 2020 2054 6869 7320 636f 6d70         This comp
+00017830: 6f6e 656e 7420 7365 7473 2075 7020 7468  onent sets up th
+00017840: 6520 526f 6f74 696e 6744 6570 7468 2062  e RootingDepth b
+00017850: 7920 6573 7469 6d61 7469 6e67 2074 6865  y estimating the
+00017860: 2063 6174 6368 6d65 6e74 2d73 6361 6c65   catchment-scale
+00017870: 0a20 2020 2020 2020 2072 6f6f 742d 7a6f  .        root-zo
+00017880: 6e65 2073 746f 7261 6765 2063 6170 6163  ne storage capac
+00017890: 6974 7920 6672 6f6d 206f 6273 6572 7665  ity from observe
+000178a0: 6420 6879 6472 6f63 6c69 6d61 7469 6320  d hydroclimatic 
+000178b0: 6461 7461 0a20 2020 2020 2020 2028 616e  data.        (an
+000178c0: 6420 6f70 7469 6f6e 616c 6c79 2061 6c73  d optionally als
+000178d0: 6f20 666f 7220 636c 696d 6174 6520 6368  o for climate ch
+000178e0: 616e 6765 2068 6973 746f 7269 6361 6c20  ange historical 
+000178f0: 616e 6420 6675 7475 7265 2070 6572 696f  and future perio
+00017900: 6473 292e 0a0a 2020 2020 2020 2020 5468  ds)...        Th
+00017910: 6973 2070 7265 7365 6e74 7320 616e 2061  is presents an a
+00017920: 6c74 6572 6e61 7469 7665 2061 7070 726f  lternative appro
+00017930: 6163 6820 746f 2064 6574 6572 6d69 6e65  ach to determine
+00017940: 2074 6865 2052 6f6f 7469 6e67 4465 7074   the RootingDept
+00017950: 680a 2020 2020 2020 2020 6261 7365 6420  h.        based 
+00017960: 6f6e 2068 7964 726f 636c 696d 6174 6963  on hydroclimatic
+00017970: 2064 6174 6120 696e 7374 6561 6420 6f66   data instead of
+00017980: 2074 6872 6f75 6768 2061 206c 6f6f 6b2d   through a look-
+00017990: 7570 2074 6162 6c65 2072 656c 6174 696e  up table relatin
+000179a0: 670a 2020 2020 2020 2020 6c61 6e64 2075  g.        land u
+000179b0: 7365 2074 6f20 726f 6f74 696e 6720 6465  se to rooting de
+000179c0: 7074 6820 2861 7320 7573 7561 6c6c 7920  pth (as usually 
+000179d0: 646f 6e65 2066 6f72 2074 6865 2077 666c  done for the wfl
+000179e0: 6f77 5f73 626d 206d 6f64 656c 292e 0a20  ow_sbm model).. 
+000179f0: 2020 2020 2020 2054 6865 206d 6574 686f         The metho
+00017a00: 6420 6973 2062 6173 6564 206f 6e20 7468  d is based on th
+00017a10: 6520 6573 7469 6d61 7469 6f6e 206f 6620  e estimation of 
+00017a20: 6d61 7869 6d75 6d20 616e 6e75 616c 2073  maximum annual s
+00017a30: 746f 7261 6765 2064 6566 6963 6974 730a  torage deficits.
+00017a40: 2020 2020 2020 2020 6261 7365 6420 6f6e          based on
+00017a50: 2070 7265 6369 7069 7461 7469 6f6e 2061   precipitation a
+00017a60: 6e64 2065 7374 696d 6174 6564 2061 6374  nd estimated act
+00017a70: 7561 6c20 6576 6170 6f72 6174 696f 6e20  ual evaporation 
+00017a80: 7469 6d65 2073 6572 6965 732c 0a20 2020  time series,.   
+00017a90: 2020 2020 2077 6869 6368 2069 6e20 7475       which in tu
+00017aa0: 726e 2061 7265 2065 7374 696d 6174 6564  rn are estimated
+00017ab0: 2066 726f 6d20 6f62 7365 7276 6564 2073   from observed s
+00017ac0: 7472 6561 6d66 6c6f 7720 6461 7461 2061  treamflow data a
+00017ad0: 6e64 0a20 2020 2020 2020 206c 6f6e 672d  nd.        long-
+00017ae0: 7465 726d 2070 7265 6369 7069 7461 7469  term precipitati
+00017af0: 6f6e 2061 6e64 2070 6f74 656e 7469 616c  on and potential
+00017b00: 2065 7661 702e 2064 6174 612c 2061 7320   evap. data, as 
+00017b10: 6578 706c 6169 6e65 6420 696e 0a20 2020  explained in.   
+00017b20: 2020 2020 2042 6f75 617a 697a 2065 7420       Bouaziz et 
+00017b30: 616c 2e20 2832 3032 3229 2e0a 0a20 2020  al. (2022)...   
+00017b40: 2020 2020 2054 6865 206d 6169 6e20 6173       The main as
+00017b50: 7375 6d70 7469 6f6e 2069 7320 7468 6174  sumption is that
+00017b60: 2076 6567 6574 6174 696f 6e20 6164 6170   vegetation adap
+00017b70: 7473 2069 7473 2072 6f6f 747a 6f6e 6520  ts its rootzone 
+00017b80: 7374 6f72 6167 6520 6361 7061 6369 7479  storage capacity
+00017b90: 0a20 2020 2020 2020 2074 6f20 6f76 6572  .        to over
+00017ba0: 636f 6d65 2064 7279 2073 7065 6c6c 7320  come dry spells 
+00017bb0: 7769 7468 2061 2063 6572 7461 696e 2072  with a certain r
+00017bc0: 6574 7572 6e20 7065 7269 6f64 2028 7479  eturn period (ty
+00017bd0: 7069 6361 6c6c 7920 3230 2079 6561 7273  pically 20 years
+00017be0: 2066 6f72 2066 6f72 6573 7420 6563 6f73   for forest ecos
+00017bf0: 7973 7465 6d73 292e 0a20 2020 2020 2020  ystems)..       
+00017c00: 2049 6e20 7265 7370 6f6e 7365 2074 6f20   In response to 
+00017c10: 6120 6368 616e 6769 6e67 2063 6c69 6d74  a changing climt
+00017c20: 6174 652c 0a20 2020 2020 2020 2069 7420  ate,.        it 
+00017c30: 6973 206c 696b 656c 7920 7468 6174 2076  is likely that v
+00017c40: 6567 6574 6174 696f 6e20 616c 736f 2061  egetation also a
+00017c50: 6461 7074 7320 6974 7320 726f 6f74 7a6f  dapts its rootzo
+00017c60: 6e65 2073 746f 7261 6765 2063 6170 6163  ne storage capac
+00017c70: 6974 792c 0a20 2020 2020 2020 2074 6865  ity,.        the
+00017c80: 7265 6279 2063 6861 6e67 696e 6720 6d6f  reby changing mo
+00017c90: 6465 6c20 7061 7261 6d65 7465 7273 2066  del parameters f
+00017ca0: 6f72 2066 7574 7572 6520 636f 6e64 6974  or future condit
+00017cb0: 696f 6e73 2e0a 2020 2020 2020 2020 5468  ions..        Th
+00017cc0: 6973 206d 6574 686f 6420 616c 736f 2061  is method also a
+00017cd0: 6c6c 6f77 7320 746f 2065 7374 696d 6174  llows to estimat
+00017ce0: 6520 7468 6520 6368 616e 6765 2069 6e20  e the change in 
+00017cf0: 726f 6f74 7a6f 6e65 2073 746f 7261 6765  rootzone storage
+00017d00: 2063 6170 6163 6974 790a 2020 2020 2020   capacity.      
+00017d10: 2020 696e 2072 6573 706f 6e73 6520 746f    in response to
+00017d20: 2061 2063 6861 6e67 696e 6720 636c 696d   a changing clim
+00017d30: 6174 652e 0a0a 2020 2020 2020 2020 4173  ate...        As
+00017d40: 2074 6865 206d 6574 686f 6420 7265 7175   the method requ
+00017d50: 6972 6573 2070 7265 6369 7069 7461 7469  ires precipitati
+00017d60: 6f6e 2061 6e64 2070 6f74 656e 7469 616c  on and potential
+00017d70: 2065 7661 706f 7261 7469 6f6e 2074 696d   evaporation tim
+00017d80: 6573 6572 6965 732c 2069 7420 6d61 7920  eseries, it may 
+00017d90: 6265 2075 7365 6675 6c20 746f 2072 756e  be useful to run
+00017da0: 2074 6869 7320 6d65 7468 6f64 2061 7320   this method as 
+00017db0: 616e 2075 7064 6174 6520 7374 6570 2069  an update step i
+00017dc0: 6e20 7468 6520 7365 7474 696e 672d 7570  n the setting-up
+00017dd0: 206f 6620 7468 6520 6879 6472 6f6c 6f67   of the hydrolog
+00017de0: 6963 616c 206d 6f64 656c 2c20 6f6e 6365  ical model, once
+00017df0: 2074 6865 2066 6f72 6369 6e67 2066 696c   the forcing fil
+00017e00: 6573 2068 6176 6520 616c 7265 6164 7920  es have already 
+00017e10: 6265 656e 2064 6572 6976 6564 2e0a 2020  been derived..  
+00017e20: 2020 2020 2020 496e 2061 6464 6974 696f        In additio
+00017e30: 6e20 7468 6520 7365 7475 705f 736f 696c  n the setup_soil
+00017e40: 6d61 7073 206d 6574 686f 6420 6973 2061  maps method is a
+00017e50: 6c73 6f20 7265 7175 6972 6564 2074 6f20  lso required to 
+00017e60: 6361 6c63 756c 6174 6520 7468 6520 526f  calculate the Ro
+00017e70: 6f74 696e 6744 6570 7468 2028 726f 6f74  otingDepth (root
+00017e80: 7a6f 6e65 5f73 746f 7261 6765 202f 2028  zone_storage / (
+00017e90: 7468 6574 6153 2d74 6865 7461 5229 292e  thetaS-thetaR)).
+00017ea0: 0a20 2020 2020 2020 2054 6865 2073 6574  .        The set
+00017eb0: 7570 5f6c 6169 6d61 7073 206d 6574 686f  up_laimaps metho
+00017ec0: 6420 6973 2061 6c73 6f20 7265 7175 6972  d is also requir
+00017ed0: 6564 2069 6620 4c41 4920 6973 2073 6574  ed if LAI is set
+00017ee0: 2074 6f20 5472 7565 2028 696e 7465 7263   to True (interc
+00017ef0: 6570 7469 6f6e 2063 6170 6163 6974 7920  eption capacity 
+00017f00: 6573 7469 6d61 7465 6420 6672 6f6d 204c  estimated from L
+00017f10: 4149 206d 6170 732c 2069 6e73 7465 6164  AI maps, instead
+00017f20: 206f 6620 7072 6f76 6964 696e 6720 6120   of providing a 
+00017f30: 6465 6661 756c 7420 6d61 7869 6d75 6d20  default maximum 
+00017f40: 696e 7465 7263 6570 7469 6f6e 2063 6170  interception cap
+00017f50: 6163 6974 7929 2e0a 0a20 2020 2020 2020  acity)...       
+00017f60: 2052 6566 6572 656e 6365 730a 2020 2020   References.    
+00017f70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00017f80: 2020 2020 2020 2042 6f75 617a 697a 2c20         Bouaziz, 
+00017f90: 4c2e 204a 2e20 452e 2c20 4161 6c62 6572  L. J. E., Aalber
+00017fa0: 732c 2045 2e20 452e 2c20 5765 6572 7473  s, E. E., Weerts
+00017fb0: 2c20 412e 2048 2e2c 2048 6567 6e61 7565  , A. H., Hegnaue
+00017fc0: 722c 204d 2e2c 2042 7569 7465 7665 6c64  r, M., Buiteveld
+00017fd0: 2c0a 2020 2020 2020 2020 482e 2c20 4c61  ,.        H., La
+00017fe0: 6d6d 6572 7365 6e2c 2052 2e2c 2053 7461  mmersen, R., Sta
+00017ff0: 6d2c 204a 2e2c 2053 7072 6f6b 6b65 7265  m, J., Sprokkere
+00018000: 6566 2c20 452e 2c20 5361 7665 6e69 6a65  ef, E., Savenije
+00018010: 2c20 482e 2048 2e20 472e 2061 6e64 0a20  , H. H. G. and. 
+00018020: 2020 2020 2020 2048 7261 6368 6f77 6974         Hrachowit
+00018030: 7a2c 204d 2e20 2832 3032 3229 2e20 4563  z, M. (2022). Ec
+00018040: 6f73 7973 7465 6d20 6164 6170 7461 7469  osystem adaptati
+00018050: 6f6e 2074 6f20 636c 696d 6174 6520 6368  on to climate ch
+00018060: 616e 6765 3a20 7468 650a 2020 2020 2020  ange: the.      
+00018070: 2020 7365 6e73 6974 6976 6974 7920 6f66    sensitivity of
+00018080: 2068 7964 726f 6c6f 6769 6361 6c20 7072   hydrological pr
+00018090: 6564 6963 7469 6f6e 7320 746f 2074 696d  edictions to tim
+000180a0: 652d 6479 6e61 6d69 6320 6d6f 6465 6c20  e-dynamic model 
+000180b0: 7061 7261 6d65 7465 7273 2c0a 2020 2020  parameters,.    
+000180c0: 2020 2020 4879 6472 6f6c 6f67 7920 616e      Hydrology an
+000180d0: 6420 4561 7274 6820 5379 7374 656d 2053  d Earth System S
+000180e0: 6369 656e 6365 732c 2032 3628 3529 2c20  ciences, 26(5), 
+000180f0: 3132 3935 2d31 3331 382e 2044 4f49 3a0a  1295-1318. DOI:.
+00018100: 2020 2020 2020 2020 3130 2e35 3139 342f          10.5194/
+00018110: 6865 7373 2d32 362d 3132 3935 2d32 3032  hess-26-1295-202
+00018120: 322e 0a0a 2020 2020 2020 2020 4164 6473  2...        Adds
+00018130: 206d 6f64 656c 206c 6179 6572 3a0a 0a20   model layer:.. 
+00018140: 2020 2020 2020 202a 202a 2a52 6f6f 7469         * **Rooti
+00018150: 6e67 4465 7074 685f 7b66 6f72 6369 6e67  ngDepth_{forcing
+00018160: 7d5f 7b52 507d 2a2a 206d 6170 3a20 726f  }_{RP}** map: ro
+00018170: 6f74 696e 6720 6465 7074 6820 5b6d 6d20  oting depth [mm 
+00018180: 6f66 2074 6865 2073 6f69 6c20 636f 6c75  of the soil colu
+00018190: 6d6e 5d20 6573 7469 6d61 7465 6420 6672  mn] estimated fr
+000181a0: 6f6d 2068 7964 726f 636c 696d 6174 6963  om hydroclimatic
+000181b0: 2064 6174 6120 7b66 6f72 6369 6e67 3a20   data {forcing: 
+000181c0: 6f62 732c 2063 635f 6869 7374 206f 7220  obs, cc_hist or 
+000181d0: 6363 5f66 7574 7d20 666f 7220 6469 6666  cc_fut} for diff
+000181e0: 6572 656e 7420 7265 7475 726e 2070 6572  erent return per
+000181f0: 696f 6473 2052 502e 2054 6865 2074 7261  iods RP. The tra
+00018200: 6e73 6c61 7469 6f6e 2074 6f20 526f 6f74  nslation to Root
+00018210: 696e 6744 6570 7468 2069 7320 646f 6e65  ingDepth is done
+00018220: 2062 7920 6469 7669 6469 6e67 2074 6865   by dividing the
+00018230: 2072 6f6f 747a 6f6e 655f 7374 6f72 6167   rootzone_storag
+00018240: 6520 6279 2028 7468 6574 6153 202d 2074  e by (thetaS - t
+00018250: 6865 7461 5229 2e0a 2020 2020 2020 2020  hetaR)..        
+00018260: 2a20 2a2a 726f 6f74 7a6f 6e65 5f73 746f  * **rootzone_sto
+00018270: 7261 6765 5f7b 666f 7263 696e 677d 5f7b  rage_{forcing}_{
+00018280: 5250 7d2a 2a20 6765 6f6d 3a20 706f 6c79  RP}** geom: poly
+00018290: 676f 6e73 206f 6620 726f 6f74 7a6f 6e65  gons of rootzone
+000182a0: 2073 746f 7261 6765 2063 6170 6163 6974   storage capacit
+000182b0: 7920 5b6d 6d20 6f66 2077 6174 6572 5d20  y [mm of water] 
+000182c0: 666f 7220 6561 6368 2063 6174 6368 6d65  for each catchme
+000182d0: 6e74 2065 7374 696d 6174 6564 2062 6566  nt estimated bef
+000182e0: 6f72 6520 6669 6c6c 696e 6720 7468 6520  ore filling the 
+000182f0: 6d69 7373 696e 6773 2077 6974 6820 6461  missings with da
+00018300: 7461 2066 726f 6d20 646f 776e 7374 7265  ta from downstre
+00018310: 616d 2063 6174 6368 6d65 6e74 732e 0a20  am catchments.. 
+00018320: 2020 2020 2020 202a 202a 2a72 6f6f 747a         * **rootz
+00018330: 6f6e 655f 7374 6f72 6167 655f 7b66 6f72  one_storage_{for
+00018340: 6369 6e67 7d5f 7b52 507d 2a2a 206d 6170  cing}_{RP}** map
+00018350: 3a20 726f 6f74 7a6f 6e65 2073 746f 7261  : rootzone stora
+00018360: 6765 2063 6170 6163 6974 7920 5b6d 6d20  ge capacity [mm 
+00018370: 6f66 2077 6174 6572 5d20 6573 7469 6d61  of water] estima
+00018380: 7465 6420 6672 6f6d 2068 7964 726f 636c  ted from hydrocl
+00018390: 696d 6174 6963 2064 6174 6120 7b66 6f72  imatic data {for
+000183a0: 6369 6e67 3a20 6f62 732c 2063 635f 6869  cing: obs, cc_hi
+000183b0: 7374 206f 7220 6363 5f66 7574 7d20 666f  st or cc_fut} fo
+000183c0: 7220 6469 6666 6572 656e 7420 7265 7475  r different retu
+000183d0: 726e 2070 6572 696f 6473 2052 502e 204f  rn periods RP. O
+000183e0: 6e6c 7920 6966 2072 6f6f 747a 6f6e 655f  nly if rootzone_
+000183f0: 7374 6f72 6167 6520 6973 2073 6574 2074  storage is set t
+00018400: 6f20 5472 7565 210a 0a0a 2020 2020 2020  o True!...      
+00018410: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00018420: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00018430: 2020 2020 2020 2020 7275 6e5f 666e 203a          run_fn :
+00018440: 2073 7472 2c20 5061 7468 2c20 7872 2e44   str, Path, xr.D
+00018450: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+00018460: 2020 2047 656f 6461 7461 7365 7420 7769     Geodataset wi
+00018470: 7468 2073 7472 6561 6d66 6c6f 7720 7469  th streamflow ti
+00018480: 6d65 7365 7269 6573 2028 6d33 2f73 2920  meseries (m3/s) 
+00018490: 7065 7220 782c 7920 6c6f 6361 7469 6f6e  per x,y location
+000184a0: 2e0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
+000184b0: 6520 6765 6f64 6174 6173 6574 2065 7870  e geodataset exp
+000184c0: 6563 7473 2074 6865 2063 6f6f 7264 696e  ects the coordin
+000184d0: 6174 6520 6e61 6d65 7320 2269 6e64 6578  ate names "index
+000184e0: 2220 2866 6f72 2065 6163 6820 7374 6174  " (for each stat
+000184f0: 696f 6e20 6964 2920 616e 6420 7468 6520  ion id) and the 
+00018500: 7661 7269 6162 6c65 206e 616d 6520 2264  variable name "d
+00018510: 6973 6368 6172 6765 222e 0a20 2020 2020  ischarge"..     
+00018520: 2020 2066 6f72 6369 6e67 5f6f 6273 5f66     forcing_obs_f
+00018530: 6e20 3a20 7374 722c 2050 6174 682c 2078  n : str, Path, x
+00018540: 722e 4461 7461 7365 740a 2020 2020 2020  r.Dataset.      
+00018550: 2020 2020 2020 4772 6964 6465 6420 7469        Gridded ti
+00018560: 6d65 7365 7269 6573 2077 6974 6820 7468  meseries with th
+00018570: 6520 6f62 7365 7276 6564 2066 6f72 6369  e observed forci
+00018580: 6e67 205b 6d6d 2f74 696d 6573 7465 705d  ng [mm/timestep]
+00018590: 2e0a 2020 2020 2020 2020 2020 2020 4578  ..            Ex
+000185a0: 7065 6374 7320 746f 2068 6176 6520 7661  pects to have va
+000185b0: 7269 6162 6c65 7320 2270 7265 6369 7022  riables "precip"
+000185c0: 2061 6e64 2022 7065 7422 2e0a 2020 2020   and "pet"..    
+000185d0: 2020 2020 666f 7263 696e 675f 6363 5f68      forcing_cc_h
+000185e0: 6973 745f 666e 203a 2073 7472 2c20 5061  ist_fn : str, Pa
+000185f0: 7468 2c20 7872 2e44 6174 6173 6574 2c20  th, xr.Dataset, 
+00018600: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00018610: 2020 2020 2047 7269 6464 6564 2074 696d       Gridded tim
+00018620: 6573 6572 6965 7320 7769 7468 2074 6865  eseries with the
+00018630: 2073 696d 756c 6174 6564 2068 6973 746f   simulated histo
+00018640: 7269 6361 6c20 666f 7263 696e 6720 5b6d  rical forcing [m
+00018650: 6d2f 7469 6d65 7374 6570 5d2c 2062 6173  m/timestep], bas
+00018660: 6564 206f 6e20 6120 636c 696d 6174 650a  ed on a climate.
+00018670: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00018680: 6c2e 2045 7870 6563 7473 2074 6f20 6861  l. Expects to ha
+00018690: 7665 2076 6172 6961 626c 6573 2022 7072  ve variables "pr
+000186a0: 6563 6970 2220 616e 6420 2270 6574 222e  ecip" and "pet".
+000186b0: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
+000186c0: 4e6f 6e65 2e0a 2020 2020 2020 2020 666f  None..        fo
+000186d0: 7263 696e 675f 6363 5f66 7574 5f66 6e20  rcing_cc_fut_fn 
+000186e0: 3a20 7374 722c 206f 7074 696f 6e61 6c0a  : str, optional.
+000186f0: 2020 2020 2020 2020 2020 2020 4772 6964              Grid
+00018700: 6465 6420 7469 6d65 7365 7269 6573 2077  ded timeseries w
+00018710: 6974 6820 7468 6520 7369 6d75 6c61 7465  ith the simulate
+00018720: 6420 636c 696d 6174 6520 666f 7263 696e  d climate forcin
+00018730: 6720 5b6d 6d2f 7469 6d65 7374 6570 5d2c  g [mm/timestep],
+00018740: 2062 6173 6564 206f 6e20 610a 2020 2020   based on a.    
+00018750: 2020 2020 2020 2020 636c 696d 6174 6520          climate 
+00018760: 6d6f 6465 6c2e 2045 7870 6563 7473 2074  model. Expects t
+00018770: 6f20 6861 7665 2076 6172 6961 626c 6573  o have variables
+00018780: 2022 7072 6563 6970 2220 616e 6420 2270   "precip" and "p
+00018790: 6574 222e 0a20 2020 2020 2020 2020 2020  et"..           
+000187a0: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
+000187b0: 4e6f 6e65 2e0a 2020 2020 2020 2020 6368  None..        ch
+000187c0: 756e 6b73 697a 6520 3a20 696e 742c 206f  unksize : int, o
+000187d0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+000187e0: 2020 2020 4368 756e 6b73 697a 6520 6f6e      Chunksize on
+000187f0: 2074 696d 6520 6469 6d65 6e73 696f 6e20   time dimension 
+00018800: 666f 7220 7072 6f63 6573 7369 6e67 2064  for processing d
+00018810: 6174 6120 286e 6f74 2066 6f72 2073 6176  ata (not for sav
+00018820: 696e 6720 746f 0a20 2020 2020 2020 2020  ing to.         
+00018830: 2020 2064 6973 6b21 292e 2054 6865 2064     disk!). The d
+00018840: 6566 6175 6c74 2069 7320 3130 302e 0a20  efault is 100.. 
+00018850: 2020 2020 2020 2072 6574 7572 6e5f 7065         return_pe
+00018860: 7269 6f64 203a 206c 6973 742c 206f 7074  riod : list, opt
+00018870: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00018880: 2020 4c69 7374 2077 6974 6820 6f6e 6520    List with one 
+00018890: 6f72 206d 6f72 6520 7661 6c75 6573 2069  or more values i
+000188a0: 6e64 6963 6961 7469 6e67 2074 6865 2072  ndiciating the r
+000188b0: 6574 7572 6e20 7065 7269 6f64 2873 2920  eturn period(s) 
+000188c0: 2869 6e0a 2020 2020 2020 2020 2020 2020  (in.            
+000188d0: 7965 6172 7329 2066 6f72 2077 6963 6820  years) for wich 
+000188e0: 7468 6520 726f 6f74 7a6f 6e65 2073 746f  the rootzone sto
+000188f0: 7261 6765 2064 6570 7468 2073 686f 756c  rage depth shoul
+00018900: 6420 6265 2063 616c 6375 6c61 7465 642e  d be calculated.
+00018910: 2054 6865 0a20 2020 2020 2020 2020 2020   The.           
+00018920: 2064 6566 6175 6c74 2069 7320 5b32 2c33   default is [2,3
+00018930: 2c35 2c31 302c 3135 2c32 302c 3235 2c35  ,5,10,15,20,25,5
+00018940: 302c 3630 2c31 3030 5d20 7965 6172 732e  0,60,100] years.
+00018950: 0a20 2020 2020 2020 2049 6d61 7820 3a20  .        Imax : 
+00018960: 666c 6f61 742c 206f 7074 696f 6e61 6c0a  float, optional.
+00018970: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+00018980: 6d61 7869 6d75 6d20 696e 7465 7263 6570  maximum intercep
+00018990: 7469 6f6e 2073 746f 7261 6765 2063 6170  tion storage cap
+000189a0: 6163 6974 7920 5b6d 6d5d 2e20 5468 6520  acity [mm]. The 
+000189b0: 6465 6661 756c 7420 6973 2032 2e30 206d  default is 2.0 m
+000189c0: 6d2e 0a20 2020 2020 2020 2073 7461 7274  m..        start
+000189d0: 5f68 7964 726f 5f79 6561 7220 3a20 7374  _hydro_year : st
+000189e0: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
+000189f0: 2020 2020 2020 2020 5468 6520 7374 6172          The star
+00018a00: 7420 6d6f 6e74 6820 2861 6272 6576 6961  t month (abrevia
+00018a10: 7465 6420 746f 2074 6865 2066 6972 7374  ted to the first
+00018a20: 2074 6872 6565 206c 6574 7465 7273 206f   three letters o
+00018a30: 6620 7468 6520 6d6f 6e74 682c 0a20 2020  f the month,.   
+00018a40: 2020 2020 2020 2020 2073 7461 7274 696e           startin
+00018a50: 6720 7769 7468 2061 2063 6170 6974 616c  g with a capital
+00018a60: 206c 6574 7465 7229 206f 6620 7468 6520   letter) of the 
+00018a70: 6879 6472 6f6c 6f67 6963 616c 2079 6561  hydrological yea
+00018a80: 722e 2054 6865 0a20 2020 2020 2020 2020  r. The.         
+00018a90: 2020 2064 6566 6175 6c74 2069 7320 2753     default is 'S
+00018aa0: 6570 272e 0a20 2020 2020 2020 2073 7461  ep'..        sta
+00018ab0: 7274 5f66 6965 6c64 5f63 6170 6163 6974  rt_field_capacit
+00018ac0: 7920 3a20 7374 722c 206f 7074 696f 6e61  y : str, optiona
+00018ad0: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
+00018ae0: 6520 656e 6420 6f66 2074 6865 2077 6574  e end of the wet
+00018af0: 2073 6561 736f 6e20 2f20 636f 6d6d 656e   season / commen
+00018b00: 6365 6d65 6e74 206f 6620 6472 7920 7365  cement of dry se
+00018b10: 6173 6f6e 2e20 5468 6973 2069 7320 7468  ason. This is th
+00018b20: 650a 2020 2020 2020 2020 2020 2020 6d6f  e.            mo
+00018b30: 6d65 6e74 2077 6865 6e20 7468 6520 736f  ment when the so
+00018b40: 696c 2069 7320 6174 2066 6965 6c64 2063  il is at field c
+00018b50: 6170 6163 6974 792c 2069 2e65 2e20 7468  apacity, i.e. th
+00018b60: 6572 6520 6973 206e 6f20 7374 6f72 6167  ere is no storag
+00018b70: 650a 2020 2020 2020 2020 2020 2020 6465  e.            de
+00018b80: 6669 6369 7420 7965 742e 2054 6865 2064  ficit yet. The d
+00018b90: 6566 6175 6c74 2069 7320 2741 7072 272e  efault is 'Apr'.
+00018ba0: 0a20 2020 2020 2020 204c 4149 203a 2062  .        LAI : b
+00018bb0: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+00018bc0: 2020 2020 2020 2020 2020 4465 7465 726d            Determ
+00018bd0: 696e 6520 7768 6574 6865 7220 7468 6520  ine whether the 
+00018be0: 4c41 4920 7769 6c6c 2062 6520 7573 6564  LAI will be used
+00018bf0: 2074 6f20 6465 7465 726d 696e 6520 496d   to determine Im
+00018c00: 6178 2e20 5468 650a 2020 2020 2020 2020  ax. The.        
+00018c10: 2020 2020 6465 6661 756c 7420 6973 2046      default is F
+00018c20: 616c 7365 2e0a 2020 2020 2020 2020 2020  alse..          
+00018c30: 2020 4966 2073 6574 2074 6f20 5472 7565    If set to True
+00018c40: 2c20 7265 7175 6972 6573 2074 6f20 6861  , requires to ha
+00018c50: 7665 2072 756e 2073 6574 7570 5f6c 6169  ve run setup_lai
+00018c60: 6d61 7073 2e0a 2020 2020 2020 2020 726f  maps..        ro
+00018c70: 6f74 7a6f 6e65 5f73 746f 7261 6765 203a  otzone_storage :
+00018c80: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c0a   bool, optional.
+00018c90: 2020 2020 2020 2020 2020 2020 4465 7465              Dete
+00018ca0: 726d 696e 6573 2077 6865 7468 6572 2074  rmines whether t
+00018cb0: 6865 2072 6f6f 747a 6f6e 6520 7374 6f72  he rootzone stor
+00018cc0: 6167 6520 6d61 7073 0a20 2020 2020 2020  age maps.       
+00018cd0: 2020 2020 2073 686f 756c 6420 6265 2073       should be s
+00018ce0: 746f 7265 6420 696e 2074 6865 2073 7461  tored in the sta
+00018cf0: 7469 636d 6170 7320 6f72 206e 6f74 2e20  ticmaps or not. 
+00018d00: 5468 6520 6465 6661 756c 7420 6973 2046  The default is F
+00018d10: 616c 7365 2e0a 2020 2020 2020 2020 636f  alse..        co
+00018d20: 7272 6563 745f 6363 5f64 6566 6963 6974  rrect_cc_deficit
+00018d30: 203a 2062 6f6f 6c2c 206f 7074 696f 6e61   : bool, optiona
+00018d40: 6c0a 2020 2020 2020 2020 2020 2020 4465  l.            De
+00018d50: 7465 726d 696e 6573 2077 6865 7468 6572  termines whether
+00018d60: 2061 2062 6961 732d 636f 7272 6563 7469   a bias-correcti
+00018d70: 6f6e 206f 6620 7468 6520 6675 7475 7265  on of the future
+00018d80: 2064 6566 6963 6974 2073 686f 756c 6420   deficit should 
+00018d90: 6265 0a20 2020 2020 2020 2020 2020 2061  be.            a
+00018da0: 7070 6c69 6564 2075 7369 6e67 2074 6865  pplied using the
+00018db0: 2063 635f 6869 7374 2064 6566 6963 6974   cc_hist deficit
+00018dc0: 2e20 4f6e 6c79 2077 6f72 6b73 2069 6620  . Only works if 
+00018dd0: 7468 6520 7469 6d65 2070 6572 696f 6473  the time periods
+00018de0: 206f 6620 6363 5f68 6973 7420 616e 640a   of cc_hist and.
+00018df0: 2020 2020 2020 2020 2020 2020 6363 5f66              cc_f
+00018e00: 7574 2061 7265 2074 6865 2073 616d 652e  ut are the same.
+00018e10: 2049 6620 7468 6520 636c 696d 6174 6520   If the climate 
+00018e20: 6368 616e 6765 2073 6365 6e61 7269 6f20  change scenario 
+00018e30: 616e 6420 6869 7374 2070 6572 696f 6420  and hist period 
+00018e40: 6172 6520 6269 6173 2d63 6f72 7265 6374  are bias-correct
+00018e50: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00018e60: 7468 6973 2073 686f 756c 6420 7072 6f62  this should prob
+00018e70: 6162 6c79 2073 6574 2074 6f20 4661 6c73  ably set to Fals
+00018e80: 652e 2054 6865 2064 6566 6175 6c74 2069  e. The default i
+00018e90: 7320 4661 6c73 652e 0a20 2020 2020 2020  s False..       
+00018ea0: 2074 696d 655f 7475 706c 653a 2074 7570   time_tuple: tup
+00018eb0: 6c65 2c20 6f70 7469 6f6e 616c 0a20 2020  le, optional.   
+00018ec0: 2020 2020 2020 2020 2053 656c 6563 7420           Select 
+00018ed0: 7768 6963 6820 7469 6d65 2070 6572 696f  which time perio
+00018ee0: 6420 746f 2072 6561 6420 6672 6f6d 2061  d to read from a
+00018ef0: 6c6c 2074 6865 2066 6f72 6369 6e67 2066  ll the forcing f
+00018f00: 696c 6573 2e20 5468 6572 6520 7368 6f75  iles. There shou
+00018f10: 6c64 2062 6520 736f 6d65 206f 7665 726c  ld be some overl
+00018f20: 6170 0a20 2020 2020 2020 2020 2020 2062  ap.            b
+00018f30: 6574 7765 656e 2074 6865 2074 696d 6520  etween the time 
+00018f40: 7065 7269 6f64 2061 7661 696c 6162 6c65  period available
+00018f50: 2069 6e20 7468 6520 666f 7263 696e 6720   in the forcing 
+00018f60: 6669 6c65 7320 666f 7220 7468 6520 6869  files for the hi
+00018f70: 7374 6f72 6963 616c 2070 6572 696f 6420  storical period 
+00018f80: 616e 6420 696e 2074 6865 206f 6273 6572  and in the obser
+00018f90: 7665 6420 7374 7265 616d 666c 6f77 2064  ved streamflow d
+00018fa0: 6174 612e 0a20 2020 2020 2020 206d 6973  ata..        mis
+00018fb0: 7369 6e67 5f64 6179 735f 7468 7265 7368  sing_days_thresh
+00018fc0: 6f6c 643a 2069 6e74 2c20 6f70 7469 6f6e  old: int, option
+00018fd0: 616c 0a20 2020 2020 2020 2020 2020 204d  al.            M
+00018fe0: 696e 696d 756d 206e 756d 6265 7220 6f66  inimum number of
+00018ff0: 2064 6179 7320 7769 7468 696e 2061 2079   days within a y
+00019000: 6561 7220 666f 7220 7468 6174 2079 6561  ear for that yea
+00019010: 7220 746f 2062 6520 636f 756e 7465 6420  r to be counted 
+00019020: 696e 2074 6865 206c 6f6e 672d 7465 726d  in the long-term
+00019030: 2042 7564 796b 6f20 616e 616c 7973 6973   Budyko analysis
+00019040: 2e0a 2020 2020 2020 2020 7570 6461 7465  ..        update
+00019050: 5f74 6f6d 6c5f 726f 6f74 696e 6764 6570  _toml_rootingdep
+00019060: 7468 3a20 7374 722c 206f 7074 696f 6e61  th: str, optiona
+00019070: 6c0a 2020 2020 2020 2020 2020 2020 5570  l.            Up
+00019080: 6461 7465 2074 6865 2077 666c 6f77 5f73  date the wflow_s
+00019090: 626d 206d 6f64 656c 2063 6f6e 6669 6720  bm model config 
+000190a0: 6f66 2074 6865 2052 6f6f 7469 6e67 4465  of the RootingDe
+000190b0: 7074 6820 7661 7269 6162 6c65 2077 6974  pth variable wit
+000190c0: 6820 7468 6520 6573 7469 6d61 7465 6420  h the estimated 
+000190d0: 526f 6f74 696e 6744 6570 7468 2e0a 2020  RootingDepth..  
+000190e0: 2020 2020 2020 2020 2020 5468 6520 6465            The de
+000190f0: 6661 756c 7420 6973 2052 6f6f 7469 6e67  fault is Rooting
+00019100: 4465 7074 685f 6f62 735f 3230 2c20 7768  Depth_obs_20, wh
+00019110: 6963 6820 7265 7175 6972 6573 2074 6f20  ich requires to 
+00019120: 6861 7665 2052 5020 3230 2069 6e20 7468  have RP 20 in th
+00019130: 6520 6c69 7374 2070 726f 7669 6465 6420  e list provided 
+00019140: 666f 7220 7468 6520 7265 7475 726e 5f70  for the return_p
+00019150: 6572 696f 6420 6172 6775 6d65 6e74 2e0a  eriod argument..
+00019160: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00019170: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00019180: 2e69 6e66 6f28 2250 7265 7061 7269 6e67  .info("Preparing
+00019190: 2063 6c69 6d61 7465 2062 6173 6564 2072   climate based r
+000191a0: 6f6f 7420 7a6f 6e65 2073 746f 7261 6765  oot zone storage
+000191b0: 2070 6172 616d 6574 6572 206d 6170 732e   parameter maps.
+000191c0: 2229 0a20 2020 2020 2020 2023 204f 7065  ").        # Ope
+000191d0: 6e20 7468 6520 6461 7461 2073 6574 730a  n the data sets.
+000191e0: 2020 2020 2020 2020 6473 5f6f 6273 203d          ds_obs =
+000191f0: 2073 656c 662e 6461 7461 5f63 6174 616c   self.data_catal
+00019200: 6f67 2e67 6574 5f72 6173 7465 7264 6174  og.get_rasterdat
+00019210: 6173 6574 280a 2020 2020 2020 2020 2020  aset(.          
+00019220: 2020 666f 7263 696e 675f 6f62 735f 666e    forcing_obs_fn
+00019230: 2c0a 2020 2020 2020 2020 2020 2020 6765  ,.            ge
+00019240: 6f6d 3d73 656c 662e 7265 6769 6f6e 2c0a  om=self.region,.
+00019250: 2020 2020 2020 2020 2020 2020 6275 6666              buff
+00019260: 6572 3d32 2c0a 2020 2020 2020 2020 2020  er=2,.          
+00019270: 2020 7661 7269 6162 6c65 733d 5b22 7065    variables=["pe
+00019280: 7422 2c20 2270 7265 6369 7022 5d2c 0a20  t", "precip"],. 
+00019290: 2020 2020 2020 2020 2020 2074 696d 655f             time_
+000192a0: 7475 706c 653d 7469 6d65 5f74 7570 6c65  tuple=time_tuple
+000192b0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+000192c0: 2020 2020 6473 5f63 635f 6869 7374 203d      ds_cc_hist =
+000192d0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+000192e0: 2066 6f72 6369 6e67 5f63 635f 6869 7374   forcing_cc_hist
+000192f0: 5f66 6e20 213d 204e 6f6e 653a 0a20 2020  _fn != None:.   
+00019300: 2020 2020 2020 2020 2064 735f 6363 5f68           ds_cc_h
+00019310: 6973 7420 3d20 7365 6c66 2e64 6174 615f  ist = self.data_
+00019320: 6361 7461 6c6f 672e 6765 745f 7261 7374  catalog.get_rast
+00019330: 6572 6461 7461 7365 7428 0a20 2020 2020  erdataset(.     
+00019340: 2020 2020 2020 2020 2020 2066 6f72 6369             forci
+00019350: 6e67 5f63 635f 6869 7374 5f66 6e2c 0a20  ng_cc_hist_fn,. 
+00019360: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00019370: 656f 6d3d 7365 6c66 2e72 6567 696f 6e2c  eom=self.region,
+00019380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019390: 2062 7566 6665 723d 322c 0a20 2020 2020   buffer=2,.     
+000193a0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+000193b0: 626c 6573 3d5b 2270 6574 222c 2022 7072  bles=["pet", "pr
+000193c0: 6563 6970 225d 2c0a 2020 2020 2020 2020  ecip"],.        
+000193d0: 2020 2020 2020 2020 7469 6d65 5f74 7570          time_tup
+000193e0: 6c65 3d74 696d 655f 7475 706c 652c 0a20  le=time_tuple,. 
+000193f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00019400: 2020 2020 2064 735f 6363 5f66 7574 203d       ds_cc_fut =
+00019410: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+00019420: 2066 6f72 6369 6e67 5f63 635f 6675 745f   forcing_cc_fut_
+00019430: 666e 2021 3d20 4e6f 6e65 3a0a 2020 2020  fn != None:.    
+00019440: 2020 2020 2020 2020 6473 5f63 635f 6675          ds_cc_fu
+00019450: 7420 3d20 7365 6c66 2e64 6174 615f 6361  t = self.data_ca
+00019460: 7461 6c6f 672e 6765 745f 7261 7374 6572  talog.get_raster
+00019470: 6461 7461 7365 7428 0a20 2020 2020 2020  dataset(.       
+00019480: 2020 2020 2020 2020 2066 6f72 6369 6e67           forcing
+00019490: 5f63 635f 6675 745f 666e 2c0a 2020 2020  _cc_fut_fn,.    
+000194a0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+000194b0: 3d73 656c 662e 7265 6769 6f6e 2c0a 2020  =self.region,.  
+000194c0: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+000194d0: 6666 6572 3d32 2c0a 2020 2020 2020 2020  ffer=2,.        
+000194e0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000194f0: 733d 5b22 7065 7422 2c20 2270 7265 6369  s=["pet", "preci
+00019500: 7022 5d2c 0a20 2020 2020 2020 2020 2020  p"],.           
+00019510: 2020 2020 2074 696d 655f 7475 706c 653d       time_tuple=
+00019520: 7469 6d65 5f74 7570 6c65 5f66 7574 2c0a  time_tuple_fut,.
+00019530: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00019540: 2020 2020 2020 2320 6f62 7365 7276 6564        # observed
+00019550: 2073 7472 6561 6d66 6c6f 7720 6461 7461   streamflow data
+00019560: 0a20 2020 2020 2020 2064 7372 756e 203d  .        dsrun =
+00019570: 2073 656c 662e 6461 7461 5f63 6174 616c   self.data_catal
+00019580: 6f67 2e67 6574 5f67 656f 6461 7461 7365  og.get_geodatase
+00019590: 7428 0a20 2020 2020 2020 2020 2020 2072  t(.            r
+000195a0: 756e 5f66 6e2c 2073 696e 676c 655f 7661  un_fn, single_va
+000195b0: 725f 6173 5f61 7272 6179 3d46 616c 7365  r_as_array=False
+000195c0: 2c20 7469 6d65 5f74 7570 6c65 3d74 696d  , time_tuple=tim
+000195d0: 655f 7475 706c 650a 2020 2020 2020 2020  e_tuple.        
+000195e0: 290a 0a20 2020 2020 2020 2023 206d 616b  )..        # mak
+000195f0: 6520 7375 7265 2064 7372 756e 206f 7665  e sure dsrun ove
+00019600: 726c 6170 7320 7769 7468 2064 735f 6f62  rlaps with ds_ob
+00019610: 732c 206f 7468 6572 7769 7365 2067 6976  s, otherwise giv
+00019620: 6520 6572 726f 720a 2020 2020 2020 2020  e error.        
+00019630: 6966 2064 7372 756e 2e74 696d 655b 305d  if dsrun.time[0]
+00019640: 203c 2064 735f 6f62 732e 7469 6d65 5b30   < ds_obs.time[0
+00019650: 5d3a 0a20 2020 2020 2020 2020 2020 2064  ]:.            d
+00019660: 7372 756e 203d 2064 7372 756e 2e73 656c  srun = dsrun.sel
+00019670: 2874 696d 653d 736c 6963 6528 6473 5f6f  (time=slice(ds_o
+00019680: 6273 2e74 696d 655b 305d 2c20 4e6f 6e65  bs.time[0], None
+00019690: 2929 0a20 2020 2020 2020 2069 6620 6473  )).        if ds
+000196a0: 7275 6e2e 7469 6d65 5b2d 315d 203e 2064  run.time[-1] > d
+000196b0: 735f 6f62 732e 7469 6d65 5b2d 315d 3a0a  s_obs.time[-1]:.
+000196c0: 2020 2020 2020 2020 2020 2020 6473 7275              dsru
+000196d0: 6e20 3d20 6473 7275 6e2e 7365 6c28 7469  n = dsrun.sel(ti
+000196e0: 6d65 3d73 6c69 6365 284e 6f6e 652c 2064  me=slice(None, d
+000196f0: 735f 6f62 732e 7469 6d65 5b2d 315d 2929  s_obs.time[-1]))
+00019700: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00019710: 6473 7275 6e2e 7469 6d65 2920 3d3d 2030  dsrun.time) == 0
+00019720: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00019730: 6c66 2e6c 6f67 6765 722e 6572 726f 7228  lf.logger.error(
+00019740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019750: 2022 4e6f 206f 7665 726c 6170 7069 6e67   "No overlapping
+00019760: 2070 6572 696f 6420 6265 7477 6565 6e20   period between 
+00019770: 7468 6520 6d65 7465 6f20 616e 6420 6f62  the meteo and ob
+00019780: 7365 7276 6564 2073 7472 6561 6d66 6c6f  served streamflo
+00019790: 7720 6461 7461 220a 2020 2020 2020 2020  w data".        
+000197a0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+000197b0: 2063 6865 636b 2069 6620 7365 7475 705f   check if setup_
+000197c0: 736f 696c 6d61 7073 2061 6e64 2073 6574  soilmaps and set
+000197d0: 7570 5f6c 6169 6d61 7073 2077 6572 6520  up_laimaps were 
+000197e0: 7275 6e20 6966 204c 4149 203d 5472 7565  run if LAI =True
+000197f0: 2061 6e64 2069 6620 726f 6f74 696e 675f   and if rooting_
+00019800: 6465 7074 6820 3d20 5472 7565 220a 2020  depth = True".  
+00019810: 2020 2020 2020 6966 2028 4c41 4920 3d3d        if (LAI ==
+00019820: 2054 7275 6529 2061 6e64 2028 224c 4149   True) and ("LAI
+00019830: 2220 6e6f 7420 696e 2073 656c 662e 7374  " not in self.st
+00019840: 6174 6963 6d61 7073 293a 0a20 2020 2020  aticmaps):.     
+00019850: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+00019860: 6572 2e65 7272 6f72 280a 2020 2020 2020  er.error(.      
+00019870: 2020 2020 2020 2020 2020 6622 4c41 4920            f"LAI 
+00019880: 7661 7269 6162 6c65 206e 6f74 2066 6f75  variable not fou
+00019890: 6e64 2069 6e20 7374 6174 6963 6d61 7073  nd in staticmaps
+000198a0: 2e20 5365 7420 4c41 4920 746f 2046 616c  . Set LAI to Fal
+000198b0: 7365 206f 7220 7275 6e20 7365 7475 705f  se or run setup_
+000198c0: 6c61 696d 6170 7320 6669 7273 7422 0a20  laimaps first". 
+000198d0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000198e0: 2020 2020 2020 6966 2028 2274 6865 7461        if ("theta
+000198f0: 5222 206e 6f74 2069 6e20 7365 6c66 2e73  R" not in self.s
+00019900: 7461 7469 636d 6170 7329 206f 7220 2822  taticmaps) or ("
+00019910: 7468 6574 6153 2220 6e6f 7420 696e 2073  thetaS" not in s
+00019920: 656c 662e 7374 6174 6963 6d61 7073 293a  elf.staticmaps):
+00019930: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00019940: 662e 6c6f 6767 6572 2e65 7272 6f72 280a  f.logger.error(.
+00019950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019960: 6622 7468 6574 6153 206f 7220 7468 6574  f"thetaS or thet
+00019970: 6152 2076 6172 6961 626c 6573 206e 6f74  aR variables not
+00019980: 2066 6f75 6e64 2069 6e20 7374 6174 6963   found in static
+00019990: 6d61 7073 2e20 5275 6e20 7365 7475 705f  maps. Run setup_
+000199a0: 736f 696c 6d61 7073 2066 6972 7374 220a  soilmaps first".
+000199b0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000199c0: 2020 2020 2020 2023 2052 756e 2074 6865         # Run the
+000199d0: 2072 6f6f 747a 6f6e 6520 636c 696d 2077   rootzone clim w
+000199e0: 6f72 6b66 6c6f 770a 2020 2020 2020 2020  orkflow.        
+000199f0: 6473 6f75 742c 2067 6466 203d 2077 6f72  dsout, gdf = wor
+00019a00: 6b66 6c6f 7773 2e72 6f6f 747a 6f6e 6563  kflows.rootzonec
+00019a10: 6c69 6d28 0a20 2020 2020 2020 2020 2020  lim(.           
+00019a20: 2064 7372 756e 3d64 7372 756e 2c0a 2020   dsrun=dsrun,.  
+00019a30: 2020 2020 2020 2020 2020 6473 5f6f 6273            ds_obs
+00019a40: 3d64 735f 6f62 732c 0a20 2020 2020 2020  =ds_obs,.       
+00019a50: 2020 2020 2064 735f 6c69 6b65 3d73 656c       ds_like=sel
+00019a60: 662e 7374 6174 6963 6d61 7073 2c0a 2020  f.staticmaps,.  
+00019a70: 2020 2020 2020 2020 2020 666c 7764 6972            flwdir
+00019a80: 3d73 656c 662e 666c 7764 6972 2c0a 2020  =self.flwdir,.  
+00019a90: 2020 2020 2020 2020 2020 6473 5f63 635f            ds_cc_
+00019aa0: 6869 7374 3d64 735f 6363 5f68 6973 742c  hist=ds_cc_hist,
+00019ab0: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
+00019ac0: 6363 5f66 7574 3d64 735f 6363 5f66 7574  cc_fut=ds_cc_fut
+00019ad0: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+00019ae0: 7475 726e 5f70 6572 696f 643d 7265 7475  turn_period=retu
+00019af0: 726e 5f70 6572 696f 642c 0a20 2020 2020  rn_period,.     
+00019b00: 2020 2020 2020 2049 6d61 783d 496d 6178         Imax=Imax
+00019b10: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+00019b20: 6172 745f 6879 6472 6f5f 7965 6172 3d73  art_hydro_year=s
+00019b30: 7461 7274 5f68 7964 726f 5f79 6561 722c  tart_hydro_year,
+00019b40: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00019b50: 7274 5f66 6965 6c64 5f63 6170 6163 6974  rt_field_capacit
+00019b60: 793d 7374 6172 745f 6669 656c 645f 6361  y=start_field_ca
+00019b70: 7061 6369 7479 2c0a 2020 2020 2020 2020  pacity,.        
+00019b80: 2020 2020 4c41 493d 4c41 492c 0a20 2020      LAI=LAI,.   
+00019b90: 2020 2020 2020 2020 2072 6f6f 747a 6f6e           rootzon
+00019ba0: 655f 7374 6f72 6167 653d 726f 6f74 7a6f  e_storage=rootzo
+00019bb0: 6e65 5f73 746f 7261 6765 2c0a 2020 2020  ne_storage,.    
+00019bc0: 2020 2020 2020 2020 636f 7272 6563 745f          correct_
+00019bd0: 6363 5f64 6566 6963 6974 3d63 6f72 7265  cc_deficit=corre
+00019be0: 6374 5f63 635f 6465 6669 6369 742c 0a20  ct_cc_deficit,. 
+00019bf0: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00019c00: 7369 7a65 3d63 6875 6e6b 7369 7a65 2c0a  size=chunksize,.
+00019c10: 2020 2020 2020 2020 2020 2020 6d69 7373              miss
+00019c20: 696e 675f 6461 7973 5f74 6872 6573 686f  ing_days_thresho
+00019c30: 6c64 3d6d 6973 7369 6e67 5f64 6179 735f  ld=missing_days_
+00019c40: 7468 7265 7368 6f6c 642c 0a20 2020 2020  threshold,.     
+00019c50: 2020 2020 2020 206c 6f67 6765 723d 7365         logger=se
+00019c60: 6c66 2e6c 6f67 6765 722c 0a20 2020 2020  lf.logger,.     
+00019c70: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00019c80: 7365 7420 6e6f 6461 7461 2076 616c 7565  set nodata value
+00019c90: 206f 7574 7369 6465 2062 6173 696e 0a20   outside basin. 
+00019ca0: 2020 2020 2020 2064 736f 7574 203d 2064         dsout = d
+00019cb0: 736f 7574 2e77 6865 7265 2873 656c 662e  sout.where(self.
+00019cc0: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
+00019cd0: 5f4d 4150 535b 2262 6173 696e 7322 5d5d  _MAPS["basins"]]
+00019ce0: 203e 2030 2c20 2d39 3939 290a 2020 2020   > 0, -999).    
+00019cf0: 2020 2020 666f 7220 7661 7220 696e 2064      for var in d
+00019d00: 736f 7574 2e64 6174 615f 7661 7273 3a0a  sout.data_vars:.
+00019d10: 2020 2020 2020 2020 2020 2020 6473 6f75              dsou
+00019d20: 745b 7661 725d 2e72 6173 7465 722e 7365  t[var].raster.se
+00019d30: 745f 6e6f 6461 7461 282d 3939 3929 0a20  t_nodata(-999). 
+00019d40: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+00019d50: 7374 6174 6963 6d61 7073 2864 736f 7574  staticmaps(dsout
+00019d60: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+00019d70: 6574 5f73 7461 7469 6367 656f 6d73 2867  et_staticgeoms(g
+00019d80: 6466 2c20 6e61 6d65 3d22 726f 6f74 7a6f  df, name="rootzo
+00019d90: 6e65 5f73 746f 7261 6765 2229 0a0a 2020  ne_storage")..  
+00019da0: 2020 2020 2020 2320 7570 6461 7465 2063        # update c
+00019db0: 6f6e 6669 670a 2020 2020 2020 2020 7365  onfig.        se
+00019dc0: 6c66 2e73 6574 5f63 6f6e 6669 6728 2269  lf.set_config("i
+00019dd0: 6e70 7574 2e76 6572 7469 6361 6c2e 726f  nput.vertical.ro
+00019de0: 6f74 696e 6764 6570 7468 222c 2075 7064  otingdepth", upd
+00019df0: 6174 655f 746f 6d6c 5f72 6f6f 7469 6e67  ate_toml_rooting
+00019e00: 6465 7074 6829 0a0a 2020 2020 2320 492f  depth)..    # I/
+00019e10: 4f0a 2020 2020 6465 6620 7265 6164 2873  O.    def read(s
+00019e20: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00019e30: 224d 6574 686f 6420 746f 2072 6561 6420  "Method to read 
+00019e40: 7468 6520 636f 6d70 6c65 7465 206d 6f64  the complete mod
+00019e50: 656c 2073 6368 656d 6174 697a 6174 696f  el schematizatio
+00019e60: 6e20 616e 6420 636f 6e66 6967 7572 6174  n and configurat
+00019e70: 696f 6e20 6672 6f6d 2066 696c 652e 2222  ion from file.""
+00019e80: 220a 2020 2020 2020 2020 7365 6c66 2e72  ".        self.r
+00019e90: 6561 645f 636f 6e66 6967 2829 0a20 2020  ead_config().   
+00019ea0: 2020 2020 2073 656c 662e 7265 6164 5f73       self.read_s
+00019eb0: 7461 7469 636d 6170 7328 290a 2020 2020  taticmaps().    
+00019ec0: 2020 2020 7365 6c66 2e72 6561 645f 696e      self.read_in
+00019ed0: 7462 6c28 290a 2020 2020 2020 2020 7365  tbl().        se
+00019ee0: 6c66 2e72 6561 645f 7461 626c 6573 2829  lf.read_tables()
+00019ef0: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+00019f00: 6164 5f73 7461 7469 6367 656f 6d73 2829  ad_staticgeoms()
+00019f10: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+00019f20: 6164 5f66 6f72 6369 6e67 2829 0a20 2020  ad_forcing().   
+00019f30: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00019f40: 2e69 6e66 6f28 224d 6f64 656c 2072 6561  .info("Model rea
+00019f50: 6422 290a 0a20 2020 2064 6566 2077 7269  d")..    def wri
+00019f60: 7465 2873 656c 6629 3a0a 2020 2020 2020  te(self):.      
+00019f70: 2020 2222 224d 6574 686f 6420 746f 2077    """Method to w
+00019f80: 7269 7465 2074 6865 2063 6f6d 706c 6574  rite the complet
+00019f90: 6520 6d6f 6465 6c20 7363 6865 6d61 7469  e model schemati
+00019fa0: 7a61 7469 6f6e 2061 6e64 2063 6f6e 6669  zation and confi
+00019fb0: 6775 7261 7469 6f6e 2074 6f20 6669 6c65  guration to file
+00019fc0: 2e22 2222 0a20 2020 2020 2020 2073 656c  .""".        sel
+00019fd0: 662e 6c6f 6767 6572 2e69 6e66 6f28 6622  f.logger.info(f"
+00019fe0: 5772 6974 6520 6d6f 6465 6c20 6461 7461  Write model data
+00019ff0: 2074 6f20 7b73 656c 662e 726f 6f74 7d22   to {self.root}"
+0001a000: 290a 2020 2020 2020 2020 2320 6966 2069  ).        # if i
+0001a010: 6e20 722c 2072 2b20 6d6f 6465 2c20 6f6e  n r, r+ mode, on
+0001a020: 6c79 2077 7269 7465 2075 7064 6174 6564  ly write updated
+0001a030: 2063 6f6d 706f 6e65 6e74 730a 2020 2020   components.    
+0001a040: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0001a050: 5f77 7269 7465 3a0a 2020 2020 2020 2020  _write:.        
+0001a060: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0001a070: 7761 726e 696e 6728 2243 616e 6e6f 7420  warning("Cannot 
+0001a080: 7772 6974 6520 696e 2072 6561 642d 6f6e  write in read-on
+0001a090: 6c79 206d 6f64 6522 290a 2020 2020 2020  ly mode").      
+0001a0a0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0001a0b0: 2020 2020 2073 656c 662e 7772 6974 655f       self.write_
+0001a0c0: 6461 7461 5f63 6174 616c 6f67 2829 0a20  data_catalog(). 
+0001a0d0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+0001a0e0: 6f6e 6669 673a 2020 2320 7472 7920 746f  onfig:  # try to
+0001a0f0: 2072 6561 6420 6465 6661 756c 7420 6966   read default if
+0001a100: 206e 6f74 2079 6574 2073 6574 0a20 2020   not yet set.   
+0001a110: 2020 2020 2020 2020 2073 656c 662e 7772           self.wr
+0001a120: 6974 655f 636f 6e66 6967 2829 0a20 2020  ite_config().   
+0001a130: 2020 2020 2069 6620 7365 6c66 2e5f 7374       if self._st
+0001a140: 6174 6963 6d61 7073 3a0a 2020 2020 2020  aticmaps:.      
+0001a150: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
+0001a160: 5f73 7461 7469 636d 6170 7328 290a 2020  _staticmaps().  
+0001a170: 2020 2020 2020 6966 2073 656c 662e 5f74        if self._t
+0001a180: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+0001a190: 2020 2073 656c 662e 7772 6974 655f 7461     self.write_ta
+0001a1a0: 626c 6573 2829 0a20 2020 2020 2020 2069  bles().        i
+0001a1b0: 6620 7365 6c66 2e5f 7374 6174 6963 6765  f self._staticge
+0001a1c0: 6f6d 733a 0a20 2020 2020 2020 2020 2020  oms:.           
+0001a1d0: 2073 656c 662e 7772 6974 655f 7374 6174   self.write_stat
+0001a1e0: 6963 6765 6f6d 7328 290a 2020 2020 2020  icgeoms().      
+0001a1f0: 2020 6966 2073 656c 662e 5f66 6f72 6369    if self._forci
+0001a200: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+0001a210: 7365 6c66 2e77 7269 7465 5f66 6f72 6369  self.write_forci
+0001a220: 6e67 2829 0a0a 2020 2020 6465 6620 7265  ng()..    def re
+0001a230: 6164 5f73 7461 7469 636d 6170 7328 7365  ad_staticmaps(se
+0001a240: 6c66 2c20 2a2a 6b77 6172 6773 293a 0a20  lf, **kwargs):. 
+0001a250: 2020 2020 2020 2022 2222 5265 6164 2073         """Read s
+0001a260: 7461 7469 636d 6170 7322 2222 0a20 2020  taticmaps""".   
+0001a270: 2020 2020 2066 6e5f 6465 6661 756c 7420       fn_default 
+0001a280: 3d20 6a6f 696e 2873 656c 662e 726f 6f74  = join(self.root
+0001a290: 2c20 2273 7461 7469 636d 6170 732e 6e63  , "staticmaps.nc
+0001a2a0: 2229 0a20 2020 2020 2020 2066 6e20 3d20  ").        fn = 
+0001a2b0: 7365 6c66 2e67 6574 5f63 6f6e 6669 6728  self.get_config(
+0001a2c0: 2269 6e70 7574 2e70 6174 685f 7374 6174  "input.path_stat
+0001a2d0: 6963 222c 2061 6273 5f70 6174 683d 5472  ic", abs_path=Tr
+0001a2e0: 7565 2c20 6661 6c6c 6261 636b 3d66 6e5f  ue, fallback=fn_
+0001a2f0: 6465 6661 756c 7429 0a0a 2020 2020 2020  default)..      
+0001a300: 2020 6966 2073 656c 662e 6765 745f 636f    if self.get_co
+0001a310: 6e66 6967 2822 6469 725f 696e 7075 7422  nfig("dir_input"
+0001a320: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
+0001a330: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+0001a340: 5f64 6972 203d 2073 656c 662e 6765 745f  _dir = self.get_
+0001a350: 636f 6e66 6967 2822 6469 725f 696e 7075  config("dir_inpu
+0001a360: 7422 2c20 6162 735f 7061 7468 3d54 7275  t", abs_path=Tru
+0001a370: 6529 0a20 2020 2020 2020 2020 2020 2066  e).            f
+0001a380: 6e20 3d20 6a6f 696e 280a 2020 2020 2020  n = join(.      
+0001a390: 2020 2020 2020 2020 2020 696e 7075 745f            input_
+0001a3a0: 6469 722c 2073 656c 662e 6765 745f 636f  dir, self.get_co
+0001a3b0: 6e66 6967 2822 696e 7075 742e 7061 7468  nfig("input.path
+0001a3c0: 5f73 7461 7469 6322 2c20 6661 6c6c 6261  _static", fallba
+0001a3d0: 636b 3d66 6e5f 6465 6661 756c 7429 0a20  ck=fn_default). 
+0001a3e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001a3f0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0001a400: 6767 6572 2e69 6e66 6f28 6622 496e 7075  gger.info(f"Inpu
+0001a410: 7420 6469 7265 6374 6f72 7920 666f 756e  t directory foun
+0001a420: 6420 7b69 6e70 7574 5f64 6972 7d22 290a  d {input_dir}").
+0001a430: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001a440: 7365 6c66 2e5f 7772 6974 653a 0a20 2020  self._write:.   
+0001a450: 2020 2020 2020 2020 2023 2073 7461 7274           # start
+0001a460: 2066 7265 7368 2069 6e20 7265 6164 2d6f   fresh in read-o
+0001a470: 6e6c 7920 6d6f 6465 0a20 2020 2020 2020  nly mode.       
+0001a480: 2020 2020 2073 656c 662e 5f73 7461 7469       self._stati
+0001a490: 636d 6170 7320 3d20 7872 2e44 6174 6173  cmaps = xr.Datas
+0001a4a0: 6574 2829 0a20 2020 2020 2020 2069 6620  et().        if 
+0001a4b0: 666e 2069 7320 6e6f 7420 4e6f 6e65 2061  fn is not None a
+0001a4c0: 6e64 2069 7366 696c 6528 666e 293a 0a20  nd isfile(fn):. 
+0001a4d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001a4e0: 6c6f 6767 6572 2e69 6e66 6f28 6622 5265  logger.info(f"Re
+0001a4f0: 6164 2073 7461 7469 636d 6170 7320 6672  ad staticmaps fr
+0001a500: 6f6d 207b 666e 7d22 290a 2020 2020 2020  om {fn}").      
+0001a510: 2020 2020 2020 2320 4649 584d 453a 2077        # FIXME: w
+0001a520: 6520 6e65 6564 2061 2073 6d61 7274 6572  e need a smarter
+0001a530: 2028 6c61 7a79 2920 736f 6c75 7469 6f6e   (lazy) solution
+0001a540: 2066 6f72 2062 6967 206d 6f64 656c 7320   for big models 
+0001a550: 7768 6963 6820 616c 736f 0a20 2020 2020  which also.     
+0001a560: 2020 2020 2020 2023 2077 6f72 6b73 2077         # works w
+0001a570: 6865 6e20 6f76 6572 7772 6974 696e 6720  hen overwriting 
+0001a580: 2f20 6170 7065 6e64 696e 6720 6461 7461  / appending data
+0001a590: 2069 6e20 7468 6520 7361 6d65 2073 6f75   in the same sou
+0001a5a0: 7263 6521 0a20 2020 2020 2020 2020 2020  rce!.           
+0001a5b0: 2064 7320 3d20 7872 2e6f 7065 6e5f 6461   ds = xr.open_da
+0001a5c0: 7461 7365 7428 0a20 2020 2020 2020 2020  taset(.         
+0001a5d0: 2020 2020 2020 2066 6e2c 206d 6173 6b5f         fn, mask_
+0001a5e0: 616e 645f 7363 616c 653d 4661 6c73 652c  and_scale=False,
+0001a5f0: 2064 6563 6f64 655f 636f 6f72 6473 3d22   decode_coords="
+0001a600: 616c 6c22 2c20 2a2a 6b77 6172 6773 0a20  all", **kwargs. 
+0001a610: 2020 2020 2020 2020 2020 2029 2e6c 6f61             ).loa
+0001a620: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
+0001a630: 6473 2e63 6c6f 7365 2829 0a20 2020 2020  ds.close().     
+0001a640: 2020 2020 2020 2023 206d 616b 6520 7375         # make su
+0001a650: 7265 2069 6e74 6572 6e61 6c6c 7920 6d61  re internally ma
+0001a660: 7073 2061 7265 2061 6c77 6179 7320 4e6f  ps are always No
+0001a670: 7274 6820 2d3e 2053 6f75 7468 206f 7269  rth -> South ori
+0001a680: 656e 7465 640a 2020 2020 2020 2020 2020  ented.          
+0001a690: 2020 6966 2064 732e 7261 7374 6572 2e72    if ds.raster.r
+0001a6a0: 6573 5b31 5d20 3e20 303a 0a20 2020 2020  es[1] > 0:.     
+0001a6b0: 2020 2020 2020 2020 2020 2064 7320 3d20             ds = 
+0001a6c0: 6473 2e72 6173 7465 722e 666c 6970 7564  ds.raster.flipud
+0001a6d0: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+0001a6e0: 656c 662e 7365 745f 7374 6174 6963 6d61  elf.set_staticma
+0001a6f0: 7073 2864 7329 0a20 2020 2020 2020 2065  ps(ds).        e
+0001a700: 6c69 6620 6c65 6e28 676c 6f62 2e67 6c6f  lif len(glob.glo
+0001a710: 6228 6a6f 696e 2873 656c 662e 726f 6f74  b(join(self.root
+0001a720: 2c20 2273 7461 7469 636d 6170 7322 2c20  , "staticmaps", 
+0001a730: 222a 2e6d 6170 2229 2929 203e 2030 3a0a  "*.map"))) > 0:.
+0001a740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001a750: 2e72 6561 645f 7374 6174 6963 6d61 7073  .read_staticmaps
+0001a760: 5f70 6372 2829 0a0a 2020 2020 6465 6620  _pcr()..    def 
+0001a770: 7772 6974 655f 7374 6174 6963 6d61 7073  write_staticmaps
+0001a780: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001a790: 2222 2257 7269 7465 2073 7461 7469 636d  """Write staticm
+0001a7a0: 6170 7322 2222 0a20 2020 2020 2020 2069  aps""".        i
+0001a7b0: 6620 6e6f 7420 7365 6c66 2e5f 7772 6974  f not self._writ
+0001a7c0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0001a7d0: 6169 7365 2049 4f45 7272 6f72 2822 4d6f  aise IOError("Mo
+0001a7e0: 6465 6c20 6f70 656e 6564 2069 6e20 7265  del opened in re
+0001a7f0: 6164 2d6f 6e6c 7920 6d6f 6465 2229 0a20  ad-only mode"). 
+0001a800: 2020 2020 2020 2023 2063 6c65 616e 2d75         # clean-u
+0001a810: 7020 7374 6174 6963 6d61 7073 2061 6e64  p staticmaps and
+0001a820: 2077 7269 7465 2043 5253 2061 6363 6f72   write CRS accor
+0001a830: 6469 6e67 2074 6f20 4346 2d63 6f6e 7665  ding to CF-conve
+0001a840: 6e74 696f 6e73 0a20 2020 2020 2020 2023  ntions.        #
+0001a850: 2054 4f44 4f20 7265 706c 6163 6520 6c61   TODO replace la
+0001a860: 7465 7220 7769 7468 2068 7964 726f 6d74  ter with hydromt
+0001a870: 2e72 6173 7465 722e 6764 616c 5f63 6f6d  .raster.gdal_com
+0001a880: 706c 6961 6e74 206d 6574 686f 6420 6166  pliant method af
+0001a890: 7465 7220 636f 7265 2072 656c 6561 7365  ter core release
+0001a8a0: 0a20 2020 2020 2020 2063 7273 203d 2073  .        crs = s
+0001a8b0: 656c 662e 7374 6174 6963 6d61 7073 2e72  elf.staticmaps.r
+0001a8c0: 6173 7465 722e 6372 730a 2020 2020 2020  aster.crs.      
+0001a8d0: 2020 6473 5f6f 7574 203d 2073 656c 662e    ds_out = self.
+0001a8e0: 7374 6174 6963 6d61 7073 2e72 6573 6574  staticmaps.reset
+0001a8f0: 5f63 6f6f 7264 7328 290a 2020 2020 2020  _coords().      
+0001a900: 2020 2320 544f 444f 3f21 0a20 2020 2020    # TODO?!.     
+0001a910: 2020 2023 2069 6620 6473 5f6f 7574 2e72     # if ds_out.r
+0001a920: 6173 7465 722e 7265 735b 315d 203c 2030  aster.res[1] < 0
+0001a930: 3a20 2320 7772 6974 6520 6461 7461 2077  : # write data w
+0001a940: 6974 6820 536f 7574 6820 2d3e 204e 6f72  ith South -> Nor
+0001a950: 7468 206f 7269 656e 7461 7469 6f6e 0a20  th orientation. 
+0001a960: 2020 2020 2020 2023 2020 2020 2064 735f         #     ds_
+0001a970: 6f75 7420 3d20 6473 5f6f 7574 2e72 6173  out = ds_out.ras
+0001a980: 7465 722e 666c 6970 7564 2829 0a20 2020  ter.flipud().   
+0001a990: 2020 2020 2078 5f64 696d 2c20 795f 6469       x_dim, y_di
+0001a9a0: 6d2c 2078 5f61 7474 7273 2c20 795f 6174  m, x_attrs, y_at
+0001a9b0: 7472 7320 3d20 6879 6472 6f6d 742e 6769  trs = hydromt.gi
+0001a9c0: 735f 7574 696c 732e 6178 6573 5f61 7474  s_utils.axes_att
+0001a9d0: 7273 2863 7273 290a 2020 2020 2020 2020  rs(crs).        
+0001a9e0: 6473 5f6f 7574 203d 2064 735f 6f75 742e  ds_out = ds_out.
+0001a9f0: 7265 6e61 6d65 287b 6473 5f6f 7574 2e72  rename({ds_out.r
+0001aa00: 6173 7465 722e 785f 6469 6d3a 2078 5f64  aster.x_dim: x_d
+0001aa10: 696d 2c20 6473 5f6f 7574 2e72 6173 7465  im, ds_out.raste
+0001aa20: 722e 795f 6469 6d3a 2079 5f64 696d 7d29  r.y_dim: y_dim})
+0001aa30: 0a20 2020 2020 2020 2064 735f 6f75 745b  .        ds_out[
+0001aa40: 785f 6469 6d5d 2e61 7474 7273 2e75 7064  x_dim].attrs.upd
+0001aa50: 6174 6528 785f 6174 7472 7329 0a20 2020  ate(x_attrs).   
+0001aa60: 2020 2020 2064 735f 6f75 745b 795f 6469       ds_out[y_di
+0001aa70: 6d5d 2e61 7474 7273 2e75 7064 6174 6528  m].attrs.update(
+0001aa80: 795f 6174 7472 7329 0a20 2020 2020 2020  y_attrs).       
+0001aa90: 2064 735f 6f75 7420 3d20 6473 5f6f 7574   ds_out = ds_out
+0001aaa0: 2e64 726f 705f 7661 7273 285b 226d 6173  .drop_vars(["mas
+0001aab0: 6b22 2c20 2273 7061 7469 616c 5f72 6566  k", "spatial_ref
+0001aac0: 222c 2022 6c73 225d 2c20 6572 726f 7273  ", "ls"], errors
+0001aad0: 3d22 6967 6e6f 7265 2229 0a20 2020 2020  ="ignore").     
+0001aae0: 2020 2064 735f 6f75 742e 7269 6f2e 7772     ds_out.rio.wr
+0001aaf0: 6974 655f 6372 7328 6372 732c 2069 6e70  ite_crs(crs, inp
+0001ab00: 6c61 6365 3d54 7275 6529 0a20 2020 2020  lace=True).     
+0001ab10: 2020 2064 735f 6f75 742e 7269 6f2e 7772     ds_out.rio.wr
+0001ab20: 6974 655f 7472 616e 7366 6f72 6d28 7365  ite_transform(se
+0001ab30: 6c66 2e73 7461 7469 636d 6170 732e 7261  lf.staticmaps.ra
+0001ab40: 7374 6572 2e74 7261 6e73 666f 726d 2c20  ster.transform, 
+0001ab50: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+0001ab60: 2020 2020 2020 6473 5f6f 7574 2e72 6173        ds_out.ras
+0001ab70: 7465 722e 7365 745f 7370 6174 6961 6c5f  ter.set_spatial_
+0001ab80: 6469 6d73 2829 0a0a 2020 2020 2020 2020  dims()..        
+0001ab90: 2320 5265 6d6f 7665 2046 696c 6c56 616c  # Remove FillVal
+0001aba0: 7565 204e 616e 2066 6f72 2078 5f64 696d  ue Nan for x_dim
+0001abb0: 2c20 795f 6469 6d0a 2020 2020 2020 2020  , y_dim.        
+0001abc0: 656e 636f 6469 6e67 203d 2064 6963 7428  encoding = dict(
+0001abd0: 290a 2020 2020 2020 2020 666f 7220 7620  ).        for v 
+0001abe0: 696e 205b 6473 5f6f 7574 2e72 6173 7465  in [ds_out.raste
+0001abf0: 722e 785f 6469 6d2c 2064 735f 6f75 742e  r.x_dim, ds_out.
+0001ac00: 7261 7374 6572 2e79 5f64 696d 5d3a 0a20  raster.y_dim]:. 
+0001ac10: 2020 2020 2020 2020 2020 2064 735f 6f75             ds_ou
+0001ac20: 745b 765d 2e61 7474 7273 2e70 6f70 2822  t[v].attrs.pop("
+0001ac30: 5f46 696c 6c56 616c 7565 222c 204e 6f6e  _FillValue", Non
+0001ac40: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+0001ac50: 6e63 6f64 696e 675b 765d 203d 207b 225f  ncoding[v] = {"_
+0001ac60: 4669 6c6c 5661 6c75 6522 3a20 4e6f 6e65  FillValue": None
+0001ac70: 7d0a 0a20 2020 2020 2020 2023 2066 696c  }..        # fil
+0001ac80: 656e 616d 650a 2020 2020 2020 2020 666e  ename.        fn
+0001ac90: 5f64 6566 6175 6c74 203d 206a 6f69 6e28  _default = join(
+0001aca0: 7365 6c66 2e72 6f6f 742c 2022 7374 6174  self.root, "stat
+0001acb0: 6963 6d61 7073 2e6e 6322 290a 2020 2020  icmaps.nc").    
+0001acc0: 2020 2020 666e 203d 2073 656c 662e 6765      fn = self.ge
+0001acd0: 745f 636f 6e66 6967 2822 696e 7075 742e  t_config("input.
+0001ace0: 7061 7468 5f73 7461 7469 6322 2c20 6162  path_static", ab
+0001acf0: 735f 7061 7468 3d54 7275 652c 2066 616c  s_path=True, fal
+0001ad00: 6c62 6163 6b3d 666e 5f64 6566 6175 6c74  lback=fn_default
+0001ad10: 290a 2020 2020 2020 2020 2320 4170 7065  ).        # Appe
+0001ad20: 6e64 2069 6e70 7574 6469 7220 6966 2072  nd inputdir if r
+0001ad30: 6571 7569 7265 640a 2020 2020 2020 2020  equired.        
+0001ad40: 6966 2073 656c 662e 6765 745f 636f 6e66  if self.get_conf
+0001ad50: 6967 2822 6469 725f 696e 7075 7422 2920  ig("dir_input") 
+0001ad60: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001ad70: 2020 2020 2020 2020 2069 6e70 7574 5f64           input_d
+0001ad80: 6972 203d 2073 656c 662e 6765 745f 636f  ir = self.get_co
+0001ad90: 6e66 6967 2822 6469 725f 696e 7075 7422  nfig("dir_input"
+0001ada0: 2c20 6162 735f 7061 7468 3d54 7275 6529  , abs_path=True)
+0001adb0: 0a20 2020 2020 2020 2020 2020 2066 6e20  .            fn 
+0001adc0: 3d20 6a6f 696e 280a 2020 2020 2020 2020  = join(.        
+0001add0: 2020 2020 2020 2020 696e 7075 745f 6469          input_di
+0001ade0: 722c 2073 656c 662e 6765 745f 636f 6e66  r, self.get_conf
+0001adf0: 6967 2822 696e 7075 742e 7061 7468 5f73  ig("input.path_s
+0001ae00: 7461 7469 6322 2c20 6661 6c6c 6261 636b  tatic", fallback
+0001ae10: 3d66 6e5f 6465 6661 756c 7429 0a20 2020  =fn_default).   
+0001ae20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001ae30: 2020 2023 2043 6865 636b 2069 6620 616c     # Check if al
+0001ae40: 6c20 7375 622d 666f 6c64 6572 7320 696e  l sub-folders in
+0001ae50: 2066 6e20 6578 6973 7473 2061 6e64 2069   fn exists and i
+0001ae60: 6620 6e6f 7420 6372 6561 7465 2074 6865  f not create the
+0001ae70: 6d0a 2020 2020 2020 2020 6966 206e 6f74  m.        if not
+0001ae80: 2069 7364 6972 2864 6972 6e61 6d65 2866   isdir(dirname(f
+0001ae90: 6e29 293a 0a20 2020 2020 2020 2020 2020  n)):.           
+0001aea0: 206f 732e 6d61 6b65 6469 7273 2864 6972   os.makedirs(dir
+0001aeb0: 6e61 6d65 2866 6e29 290a 2020 2020 2020  name(fn)).      
+0001aec0: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
+0001aed0: 666f 2866 2257 7269 7465 2073 7461 7469  fo(f"Write stati
+0001aee0: 636d 6170 7320 746f 207b 666e 7d22 290a  cmaps to {fn}").
+0001aef0: 2020 2020 2020 2020 6d61 736b 203d 2064          mask = d
+0001af00: 735f 6f75 745b 7365 6c66 2e5f 4d41 5053  s_out[self._MAPS
+0001af10: 5b22 6261 7369 6e73 225d 5d20 3e20 300a  ["basins"]] > 0.
+0001af20: 2020 2020 2020 2020 666f 7220 7620 696e          for v in
+0001af30: 2064 735f 6f75 742e 6461 7461 5f76 6172   ds_out.data_var
+0001af40: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
+0001af50: 206e 6f64 6174 6120 6973 2072 6571 7569   nodata is requi
+0001af60: 7265 6420 666f 7220 616c 6c20 6275 7420  red for all but 
+0001af70: 626f 6f6c 6561 6e20 6669 656c 6473 0a20  boolean fields. 
+0001af80: 2020 2020 2020 2020 2020 2069 6620 6473             if ds
+0001af90: 5f6f 7574 5b76 5d2e 6474 7970 6520 213d  _out[v].dtype !=
+0001afa0: 2022 626f 6f6c 223a 0a20 2020 2020 2020   "bool":.       
+0001afb0: 2020 2020 2020 2020 2064 735f 6f75 745b           ds_out[
+0001afc0: 765d 203d 2064 735f 6f75 745b 765d 2e77  v] = ds_out[v].w
+0001afd0: 6865 7265 286d 6173 6b2c 2064 735f 6f75  here(mask, ds_ou
+0001afe0: 745b 765d 2e72 6173 7465 722e 6e6f 6461  t[v].raster.noda
+0001aff0: 7461 290a 2020 2020 2020 2020 6473 5f6f  ta).        ds_o
+0001b000: 7574 2e74 6f5f 6e65 7463 6466 2866 6e2c  ut.to_netcdf(fn,
+0001b010: 2065 6e63 6f64 696e 673d 656e 636f 6469   encoding=encodi
+0001b020: 6e67 290a 2020 2020 2020 2020 2320 7365  ng).        # se
+0001b030: 6c66 2e77 7269 7465 5f73 7461 7469 636d  lf.write_staticm
+0001b040: 6170 735f 7063 7228 290a 0a20 2020 2064  aps_pcr()..    d
+0001b050: 6566 2072 6561 645f 7374 6174 6963 6d61  ef read_staticma
+0001b060: 7073 5f70 6372 2873 656c 662c 2063 7273  ps_pcr(self, crs
+0001b070: 3d34 3332 362c 202a 2a6b 7761 7267 7329  =4326, **kwargs)
+0001b080: 3a0a 2020 2020 2020 2020 2222 2252 6561  :.        """Rea
+0001b090: 6420 616e 6420 7374 6174 6963 6d61 7073  d and staticmaps
+0001b0a0: 2061 7420 3c72 6f6f 742f 7374 6174 6963   at <root/static
+0001b0b0: 6d61 7073 3e20 616e 6420 7061 7273 6520  maps> and parse 
+0001b0c0: 746f 2078 6172 7261 7922 2222 0a20 2020  to xarray""".   
+0001b0d0: 2020 2020 2069 6620 7365 6c66 2e5f 7265       if self._re
+0001b0e0: 6164 2061 6e64 2022 6368 756e 6b73 2220  ad and "chunks" 
+0001b0f0: 6e6f 7420 696e 206b 7761 7267 733a 0a20  not in kwargs:. 
+0001b100: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+0001b110: 732e 7570 6461 7465 2863 6875 6e6b 733d  s.update(chunks=
+0001b120: 7b22 7922 3a20 2d31 2c20 2278 223a 202d  {"y": -1, "x": -
+0001b130: 317d 290a 2020 2020 2020 2020 666e 203d  1}).        fn =
+0001b140: 206a 6f69 6e28 7365 6c66 2e72 6f6f 742c   join(self.root,
+0001b150: 2022 7374 6174 6963 6d61 7073 222c 2066   "staticmaps", f
+0001b160: 222a 2e6d 6170 2229 0a20 2020 2020 2020  "*.map").       
+0001b170: 2066 6e73 203d 2067 6c6f 622e 676c 6f62   fns = glob.glob
+0001b180: 2866 6e29 0a20 2020 2020 2020 2069 6620  (fn).        if 
+0001b190: 6c65 6e28 666e 7329 203d 3d20 303a 0a20  len(fns) == 0:. 
+0001b1a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001b1b0: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
+0001b1c0: 224e 6f20 7374 6174 6963 6d61 7073 2066  "No staticmaps f
+0001b1d0: 6f75 6e64 2061 7420 7b66 6e7d 2229 0a20  ound at {fn}"). 
+0001b1e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b1f0: 6e0a 2020 2020 2020 2020 7365 6c66 2e5f  n.        self._
+0001b200: 7374 6174 6963 6d61 7073 203d 206f 7065  staticmaps = ope
+0001b210: 6e5f 6d66 7261 7374 6572 2866 6e73 2c20  n_mfraster(fns, 
+0001b220: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+0001b230: 2020 7061 7468 203d 206a 6f69 6e28 7365    path = join(se
+0001b240: 6c66 2e72 6f6f 742c 2022 7374 6174 6963  lf.root, "static
+0001b250: 6d61 7073 222c 2022 636c 696d 222c 2066  maps", "clim", f
+0001b260: 224c 4149 2a22 290a 2020 2020 2020 2020  "LAI*").        
+0001b270: 6966 206c 656e 2867 6c6f 622e 676c 6f62  if len(glob.glob
+0001b280: 2870 6174 6829 2920 3e20 303a 0a20 2020  (path)) > 0:.   
+0001b290: 2020 2020 2020 2020 2064 615f 6c61 6920           da_lai 
+0001b2a0: 3d20 6f70 656e 5f6d 6672 6173 7465 7228  = open_mfraster(
+0001b2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b2c0: 2070 6174 682c 2063 6f6e 6361 743d 5472   path, concat=Tr
+0001b2d0: 7565 2c20 636f 6e63 6174 5f64 696d 3d22  ue, concat_dim="
+0001b2e0: 7469 6d65 222c 206c 6f67 6765 723d 7365  time", logger=se
+0001b2f0: 6c66 2e6c 6f67 6765 722c 202a 2a6b 7761  lf.logger, **kwa
+0001b300: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+0001b310: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0001b320: 6c66 2e73 6574 5f73 7461 7469 636d 6170  lf.set_staticmap
+0001b330: 7328 6461 5f6c 6169 2c20 224c 4149 2229  s(da_lai, "LAI")
+0001b340: 0a0a 2020 2020 2020 2020 2320 7265 6f72  ..        # reor
+0001b350: 6761 6e69 7a65 2063 5f30 2065 7463 206d  ganize c_0 etc m
+0001b360: 6170 730a 2020 2020 2020 2020 6461 5f63  aps.        da_c
+0001b370: 203d 205b 5d0a 2020 2020 2020 2020 6c69   = [].        li
+0001b380: 7374 5f63 203d 205b 7620 666f 7220 7620  st_c = [v for v 
+0001b390: 696e 2073 656c 662e 5f73 7461 7469 636d  in self._staticm
+0001b3a0: 6170 7320 6966 2073 7472 2876 292e 7374  aps if str(v).st
+0001b3b0: 6172 7473 7769 7468 2822 635f 2229 5d0a  artswith("c_")].
+0001b3c0: 2020 2020 2020 2020 6966 206c 656e 286c          if len(l
+0001b3d0: 6973 745f 6329 203e 2030 3a0a 2020 2020  ist_c) > 0:.    
+0001b3e0: 2020 2020 2020 2020 666f 7220 692c 2076          for i, v
+0001b3f0: 2069 6e20 656e 756d 6572 6174 6528 6c69   in enumerate(li
+0001b400: 7374 5f63 293a 0a20 2020 2020 2020 2020  st_c):.         
+0001b410: 2020 2020 2020 2064 615f 632e 6170 7065         da_c.appe
+0001b420: 6e64 2873 656c 662e 5f73 7461 7469 636d  nd(self._staticm
+0001b430: 6170 735b 6622 635f 7b69 3a64 7d22 5d29  aps[f"c_{i:d}"])
+0001b440: 0a20 2020 2020 2020 2020 2020 2064 6120  .            da 
+0001b450: 3d20 7872 2e63 6f6e 6361 7428 0a20 2020  = xr.concat(.   
+0001b460: 2020 2020 2020 2020 2020 2020 2064 615f               da_
+0001b470: 632c 2070 642e 496e 6465 7828 6e70 2e61  c, pd.Index(np.a
+0001b480: 7261 6e67 6528 6c65 6e28 6c69 7374 5f63  range(len(list_c
+0001b490: 292c 2064 7479 7065 3d69 6e74 292c 206e  ), dtype=int), n
+0001b4a0: 616d 653d 226c 6179 6572 2229 0a20 2020  ame="layer").   
+0001b4b0: 2020 2020 2020 2020 2029 2e74 7261 6e73           ).trans
+0001b4c0: 706f 7365 2822 6c61 7965 7222 2c20 2e2e  pose("layer", ..
+0001b4d0: 2e29 0a20 2020 2020 2020 2020 2020 2073  .).            s
+0001b4e0: 656c 662e 7365 745f 7374 6174 6963 6d61  elf.set_staticma
+0001b4f0: 7073 2864 612c 2022 6322 290a 0a20 2020  ps(da, "c")..   
+0001b500: 2020 2020 2069 6620 7365 6c66 2e63 7273       if self.crs
+0001b510: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001b520: 2020 2020 2020 6966 2063 7273 2069 7320        if crs is 
+0001b530: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0001b540: 2020 2020 2020 6372 7320 3d20 3433 3236        crs = 4326
+0001b550: 2020 2320 6465 6661 756c 7420 746f 2034    # default to 4
+0001b560: 3332 360a 2020 2020 2020 2020 2020 2020  326.            
+0001b570: 7365 6c66 2e73 6574 5f63 7273 2863 7273  self.set_crs(crs
+0001b580: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
+0001b590: 5f73 7461 7469 636d 6170 735f 7063 7228  _staticmaps_pcr(
+0001b5a0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0001b5b0: 2222 5772 6974 6520 7374 6174 6963 6d61  ""Write staticma
+0001b5c0: 7073 2061 7420 3c72 6f6f 742f 7374 6174  ps at <root/stat
+0001b5d0: 6963 6d61 7073 3e20 696e 2050 4352 6173  icmaps> in PCRas
+0001b5e0: 7465 7220 6d61 7073 2066 6f72 6d61 742e  ter maps format.
+0001b5f0: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+0001b600: 6f74 2073 656c 662e 5f77 7269 7465 3a0a  ot self._write:.
+0001b610: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001b620: 6520 494f 4572 726f 7228 224d 6f64 656c  e IOError("Model
+0001b630: 206f 7065 6e65 6420 696e 2072 6561 642d   opened in read-
+0001b640: 6f6e 6c79 206d 6f64 6522 290a 2020 2020  only mode").    
+0001b650: 2020 2020 6473 5f6f 7574 203d 2073 656c      ds_out = sel
+0001b660: 662e 7374 6174 6963 6d61 7073 0a20 2020  f.staticmaps.   
+0001b670: 2020 2020 2069 6620 224c 4149 2220 696e       if "LAI" in
+0001b680: 2064 735f 6f75 742e 6461 7461 5f76 6172   ds_out.data_var
+0001b690: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
+0001b6a0: 735f 6f75 7420 3d20 6473 5f6f 7574 2e72  s_out = ds_out.r
+0001b6b0: 656e 616d 655f 7661 7273 287b 224c 4149  ename_vars({"LAI
+0001b6c0: 223a 2022 636c 696d 2f4c 4149 227d 290a  ": "clim/LAI"}).
+0001b6d0: 2020 2020 2020 2020 6966 2022 6322 2069          if "c" i
+0001b6e0: 6e20 6473 5f6f 7574 2e64 6174 615f 7661  n ds_out.data_va
+0001b6f0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0001b700: 666f 7220 6c61 7965 7220 696e 2064 735f  for layer in ds_
+0001b710: 6f75 745b 226c 6179 6572 225d 3a0a 2020  out["layer"]:.  
+0001b720: 2020 2020 2020 2020 2020 2020 2020 6473                ds
+0001b730: 5f6f 7574 5b66 2263 5f7b 6c61 7965 722e  _out[f"c_{layer.
+0001b740: 6974 656d 2829 3a64 7d22 5d20 3d20 6473  item():d}"] = ds
+0001b750: 5f6f 7574 5b22 6322 5d2e 7365 6c28 6c61  _out["c"].sel(la
+0001b760: 7965 723d 6c61 7965 7229 0a20 2020 2020  yer=layer).     
+0001b770: 2020 2020 2020 2020 2020 2064 735f 6f75             ds_ou
+0001b780: 745b 6622 635f 7b6c 6179 6572 2e69 7465  t[f"c_{layer.ite
+0001b790: 6d28 293a 647d 225d 2e72 6173 7465 722e  m():d}"].raster.
+0001b7a0: 7365 745f 6e6f 6461 7461 280a 2020 2020  set_nodata(.    
+0001b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7c0: 6473 5f6f 7574 5b22 6322 5d2e 7261 7374  ds_out["c"].rast
+0001b7d0: 6572 2e6e 6f64 6174 610a 2020 2020 2020  er.nodata.      
+0001b7e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001b7f0: 2020 2020 2020 2020 6473 5f6f 7574 203d          ds_out =
+0001b800: 2064 735f 6f75 742e 6472 6f70 5f76 6172   ds_out.drop_var
+0001b810: 7328 5b22 6322 2c20 226c 6179 6572 225d  s(["c", "layer"]
+0001b820: 290a 2020 2020 2020 2020 7365 6c66 2e6c  ).        self.l
+0001b830: 6f67 6765 722e 696e 666f 2822 5772 6974  ogger.info("Writ
+0001b840: 696e 6720 2875 7064 6174 6564 2920 7374  ing (updated) st
+0001b850: 6174 6963 6d61 7020 6669 6c65 732e 2229  aticmap files.")
+0001b860: 0a20 2020 2020 2020 2023 2061 6464 2064  .        # add d
+0001b870: 6174 6174 7970 6573 2066 6f72 206d 6170  atatypes for map
+0001b880: 7320 7769 7468 2073 616d 6520 6261 7365  s with same base
+0001b890: 6e61 6d65 732c 2065 2e67 2e20 7766 6c6f  names, e.g. wflo
+0001b8a0: 775f 6761 7567 6573 5f67 7264 630a 2020  w_gauges_grdc.  
+0001b8b0: 2020 2020 2020 7063 725f 7673 5f6d 6170        pcr_vs_map
+0001b8c0: 203d 2050 4352 5f56 535f 4d41 502e 636f   = PCR_VS_MAP.co
+0001b8d0: 7079 2829 0a20 2020 2020 2020 2066 6f72  py().        for
+0001b8e0: 2076 6172 5f6e 616d 6520 696e 2064 735f   var_name in ds_
+0001b8f0: 6f75 742e 7261 7374 6572 2e76 6172 733a  out.raster.vars:
+0001b900: 0a20 2020 2020 2020 2020 2020 2062 6173  .            bas
+0001b910: 655f 6e61 6d65 203d 2022 5f22 2e6a 6f69  e_name = "_".joi
+0001b920: 6e28 7661 725f 6e61 6d65 2e73 706c 6974  n(var_name.split
+0001b930: 2822 5f22 295b 3a2d 315d 2920 2023 2063  ("_")[:-1])  # c
+0001b940: 6c69 7020 5f3c 706f 7374 6669 783e 0a20  lip _<postfix>. 
+0001b950: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
+0001b960: 7365 5f6e 616d 6520 696e 2050 4352 5f56  se_name in PCR_V
+0001b970: 535f 4d41 503a 0a20 2020 2020 2020 2020  S_MAP:.         
+0001b980: 2020 2020 2020 2070 6372 5f76 735f 6d61         pcr_vs_ma
+0001b990: 702e 7570 6461 7465 287b 7661 725f 6e61  p.update({var_na
+0001b9a0: 6d65 3a20 5043 525f 5653 5f4d 4150 5b62  me: PCR_VS_MAP[b
+0001b9b0: 6173 655f 6e61 6d65 5d7d 290a 2020 2020  ase_name]}).    
+0001b9c0: 2020 2020 6473 5f6f 7574 2e72 6173 7465      ds_out.raste
+0001b9d0: 722e 746f 5f6d 6170 7374 6163 6b28 0a20  r.to_mapstack(. 
+0001b9e0: 2020 2020 2020 2020 2020 2072 6f6f 743d             root=
+0001b9f0: 6a6f 696e 2873 656c 662e 726f 6f74 2c20  join(self.root, 
+0001ba00: 2273 7461 7469 636d 6170 7322 292c 0a20  "staticmaps"),. 
+0001ba10: 2020 2020 2020 2020 2020 206d 6173 6b3d             mask=
+0001ba20: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0001ba30: 2020 6472 6976 6572 3d22 5043 5261 7374    driver="PCRast
+0001ba40: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
+0001ba50: 2070 6372 5f76 735f 6d61 703d 7063 725f   pcr_vs_map=pcr_
+0001ba60: 7673 5f6d 6170 2c0a 2020 2020 2020 2020  vs_map,.        
+0001ba70: 2020 2020 6c6f 6767 6572 3d73 656c 662e      logger=self.
+0001ba80: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
+0001ba90: 290a 0a20 2020 2064 6566 2072 6561 645f  )..    def read_
+0001baa0: 7374 6174 6963 6765 6f6d 7328 7365 6c66  staticgeoms(self
+0001bab0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+0001bac0: 6164 2061 6e64 2073 7461 7469 6367 656f  ad and staticgeo
+0001bad0: 6d73 2061 7420 3c72 6f6f 742f 7374 6174  ms at <root/stat
+0001bae0: 6963 6765 6f6d 733e 2061 6e64 2070 6172  icgeoms> and par
+0001baf0: 7365 2074 6f20 6765 6f70 616e 6461 7322  se to geopandas"
+0001bb00: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+0001bb10: 7420 7365 6c66 2e5f 7772 6974 653a 0a20  t self._write:. 
+0001bb20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001bb30: 5f73 7461 7469 6367 656f 6d73 203d 2064  _staticgeoms = d
+0001bb40: 6963 7428 2920 2023 2066 7265 7368 2073  ict()  # fresh s
+0001bb50: 7461 7274 2069 6e20 7265 6164 2d6f 6e6c  tart in read-onl
+0001bb60: 7920 6d6f 6465 0a20 2020 2020 2020 2064  y mode.        d
+0001bb70: 6972 5f64 6566 6175 6c74 203d 206a 6f69  ir_default = joi
+0001bb80: 6e28 7365 6c66 2e72 6f6f 742c 2022 7374  n(self.root, "st
+0001bb90: 6174 6963 6d61 7073 2e6e 6322 290a 2020  aticmaps.nc").  
+0001bba0: 2020 2020 2020 6469 725f 6d6f 6420 3d20        dir_mod = 
+0001bbb0: 6469 726e 616d 6528 0a20 2020 2020 2020  dirname(.       
+0001bbc0: 2020 2020 2073 656c 662e 6765 745f 636f       self.get_co
+0001bbd0: 6e66 6967 2822 696e 7075 742e 7061 7468  nfig("input.path
+0001bbe0: 5f73 7461 7469 6322 2c20 6162 735f 7061  _static", abs_pa
+0001bbf0: 7468 3d54 7275 652c 2066 616c 6c62 6163  th=True, fallbac
+0001bc00: 6b3d 6469 725f 6465 6661 756c 7429 0a20  k=dir_default). 
+0001bc10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001bc20: 2066 6e73 203d 2067 6c6f 622e 676c 6f62   fns = glob.glob
+0001bc30: 286a 6f69 6e28 6469 725f 6d6f 642c 2022  (join(dir_mod, "
+0001bc40: 7374 6174 6963 6765 6f6d 7322 2c20 222a  staticgeoms", "*
+0001bc50: 2e67 656f 6a73 6f6e 2229 290a 2020 2020  .geojson")).    
+0001bc60: 2020 2020 6966 206c 656e 2866 6e73 2920      if len(fns) 
+0001bc70: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+0001bc80: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
+0001bc90: 6f28 2252 6561 6469 6e67 206d 6f64 656c  o("Reading model
+0001bca0: 2073 7461 7469 6367 656f 6d20 6669 6c65   staticgeom file
+0001bcb0: 732e 2229 0a20 2020 2020 2020 2066 6f72  s.").        for
+0001bcc0: 2066 6e20 696e 2066 6e73 3a0a 2020 2020   fn in fns:.    
+0001bcd0: 2020 2020 2020 2020 6e61 6d65 203d 2062          name = b
+0001bce0: 6173 656e 616d 6528 666e 292e 7370 6c69  asename(fn).spli
+0001bcf0: 7428 222e 2229 5b30 5d0a 2020 2020 2020  t(".")[0].      
+0001bd00: 2020 2020 2020 6966 206e 616d 6520 213d        if name !=
+0001bd10: 2022 7265 6769 6f6e 223a 0a20 2020 2020   "region":.     
+0001bd20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001bd30: 7365 745f 7374 6174 6963 6765 6f6d 7328  set_staticgeoms(
+0001bd40: 6770 642e 7265 6164 5f66 696c 6528 666e  gpd.read_file(fn
+0001bd50: 292c 206e 616d 653d 6e61 6d65 290a 0a20  ), name=name).. 
+0001bd60: 2020 2064 6566 2077 7269 7465 5f73 7461     def write_sta
+0001bd70: 7469 6367 656f 6d73 2873 656c 6629 3a0a  ticgeoms(self):.
+0001bd80: 2020 2020 2020 2020 2222 2257 7269 7465          """Write
+0001bd90: 2073 7461 7469 636d 6170 7320 6174 203c   staticmaps at <
+0001bda0: 726f 6f74 2f73 7461 7469 6367 656f 6d73  root/staticgeoms
+0001bdb0: 3e20 696e 206d 6f64 656c 2072 6561 6479  > in model ready
+0001bdc0: 2066 6f72 6d61 7422 2222 0a20 2020 2020   format""".     
+0001bdd0: 2020 2023 2074 6f20 7772 6974 6520 7573     # to write us
+0001bde0: 6520 7365 6c66 2e73 7461 7469 6367 656f  e self.staticgeo
+0001bdf0: 6d73 5b76 6172 5d2e 746f 5f66 696c 6528  ms[var].to_file(
+0001be00: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0001be10: 2073 656c 662e 5f77 7269 7465 3a0a 2020   self._write:.  
+0001be20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001be30: 494f 4572 726f 7228 224d 6f64 656c 206f  IOError("Model o
+0001be40: 7065 6e65 6420 696e 2072 6561 642d 6f6e  pened in read-on
+0001be50: 6c79 206d 6f64 6522 290a 2020 2020 2020  ly mode").      
+0001be60: 2020 6966 2073 656c 662e 7374 6174 6963    if self.static
+0001be70: 6765 6f6d 733a 0a20 2020 2020 2020 2020  geoms:.         
+0001be80: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
+0001be90: 6e66 6f28 2257 7269 7469 6e67 206d 6f64  nfo("Writing mod
+0001bea0: 656c 2073 7461 7469 6367 656f 6d20 746f  el staticgeom to
+0001beb0: 2066 696c 652e 2229 0a20 2020 2020 2020   file.").       
+0001bec0: 2020 2020 2066 6f72 206e 616d 652c 2067       for name, g
+0001bed0: 6466 2069 6e20 7365 6c66 2e73 7461 7469  df in self.stati
+0001bee0: 6367 656f 6d73 2e69 7465 6d73 2829 3a0a  cgeoms.items():.
+0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf00: 666e 5f6f 7574 203d 206a 6f69 6e28 7365  fn_out = join(se
+0001bf10: 6c66 2e72 6f6f 742c 2022 7374 6174 6963  lf.root, "static
+0001bf20: 6765 6f6d 7322 2c20 6622 7b6e 616d 657d  geoms", f"{name}
+0001bf30: 2e67 656f 6a73 6f6e 2229 0a20 2020 2020  .geojson").     
+0001bf40: 2020 2020 2020 2020 2020 2067 6466 2e74             gdf.t
+0001bf50: 6f5f 6669 6c65 2866 6e5f 6f75 742c 2064  o_file(fn_out, d
+0001bf60: 7269 7665 723d 2247 656f 4a53 4f4e 2229  river="GeoJSON")
+0001bf70: 0a0a 2020 2020 6465 6620 7265 6164 5f66  ..    def read_f
+0001bf80: 6f72 6369 6e67 2873 656c 6629 3a0a 2020  orcing(self):.  
+0001bf90: 2020 2020 2020 2222 2252 6561 6420 666f        """Read fo
+0001bfa0: 7263 696e 6722 2222 0a20 2020 2020 2020  rcing""".       
+0001bfb0: 2066 6e5f 6465 6661 756c 7420 3d20 6a6f   fn_default = jo
+0001bfc0: 696e 2873 656c 662e 726f 6f74 2c20 2269  in(self.root, "i
+0001bfd0: 6e6d 6170 732e 6e63 2229 0a20 2020 2020  nmaps.nc").     
+0001bfe0: 2020 2066 6e20 3d20 7365 6c66 2e67 6574     fn = self.get
+0001bff0: 5f63 6f6e 6669 6728 2269 6e70 7574 2e70  _config("input.p
+0001c000: 6174 685f 666f 7263 696e 6722 2c20 6162  ath_forcing", ab
+0001c010: 735f 7061 7468 3d54 7275 652c 2066 616c  s_path=True, fal
+0001c020: 6c62 6163 6b3d 666e 5f64 6566 6175 6c74  lback=fn_default
+0001c030: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+0001c040: 6c66 2e67 6574 5f63 6f6e 6669 6728 2264  lf.get_config("d
+0001c050: 6972 5f69 6e70 7574 2229 2069 7320 6e6f  ir_input") is no
+0001c060: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0001c070: 2020 2020 696e 7075 745f 6469 7220 3d20      input_dir = 
+0001c080: 7365 6c66 2e67 6574 5f63 6f6e 6669 6728  self.get_config(
+0001c090: 2264 6972 5f69 6e70 7574 222c 2061 6273  "dir_input", abs
+0001c0a0: 5f70 6174 683d 5472 7565 290a 2020 2020  _path=True).    
+0001c0b0: 2020 2020 2020 2020 666e 203d 206a 6f69          fn = joi
+0001c0c0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+0001c0d0: 2020 2069 6e70 7574 5f64 6972 2c20 7365     input_dir, se
+0001c0e0: 6c66 2e67 6574 5f63 6f6e 6669 6728 2269  lf.get_config("i
+0001c0f0: 6e70 7574 2e70 6174 685f 666f 7263 696e  nput.path_forcin
+0001c100: 6722 2c20 6661 6c6c 6261 636b 3d66 6e5f  g", fallback=fn_
+0001c110: 6465 6661 756c 7429 0a20 2020 2020 2020  default).       
+0001c120: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001c130: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
+0001c140: 6e66 6f28 6622 496e 7075 7420 6469 7265  nfo(f"Input dire
+0001c150: 6374 6f72 7920 666f 756e 6420 7b69 6e70  ctory found {inp
+0001c160: 7574 5f64 6972 7d22 290a 0a20 2020 2020  ut_dir}")..     
+0001c170: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+0001c180: 7772 6974 653a 0a20 2020 2020 2020 2020  write:.         
+0001c190: 2020 2023 2073 7461 7274 2066 7265 7368     # start fresh
+0001c1a0: 2069 6e20 7265 6164 2d6f 6e6c 7920 6d6f   in read-only mo
+0001c1b0: 6465 0a20 2020 2020 2020 2020 2020 2073  de.            s
+0001c1c0: 656c 662e 5f66 6f72 6369 6e67 203d 2064  elf._forcing = d
+0001c1d0: 6963 7428 290a 2020 2020 2020 2020 6966  ict().        if
+0001c1e0: 2066 6e20 6973 206e 6f74 204e 6f6e 6520   fn is not None 
+0001c1f0: 616e 6420 6973 6669 6c65 2866 6e29 3a0a  and isfile(fn):.
+0001c200: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001c210: 2e6c 6f67 6765 722e 696e 666f 2866 2252  .logger.info(f"R
+0001c220: 6561 6420 666f 7263 696e 6720 6672 6f6d  ead forcing from
+0001c230: 207b 666e 7d22 290a 2020 2020 2020 2020   {fn}").        
+0001c240: 2020 2020 6473 203d 2078 722e 6f70 656e      ds = xr.open
+0001c250: 5f64 6174 6173 6574 2866 6e2c 2063 6875  _dataset(fn, chu
+0001c260: 6e6b 733d 7b22 7469 6d65 223a 2033 307d  nks={"time": 30}
+0001c270: 2c20 6465 636f 6465 5f63 6f6f 7264 733d  , decode_coords=
+0001c280: 2261 6c6c 2229 0a20 2020 2020 2020 2020  "all").         
+0001c290: 2020 2066 6f72 2076 2069 6e20 6473 2e64     for v in ds.d
+0001c2a0: 6174 615f 7661 7273 3a0a 2020 2020 2020  ata_vars:.      
+0001c2b0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0001c2c0: 6574 5f66 6f72 6369 6e67 2864 735b 765d  et_forcing(ds[v]
+0001c2d0: 290a 2020 2020 2020 2020 656c 6966 2022  ).        elif "
+0001c2e0: 2a22 2069 6e20 7374 7228 666e 293a 0a20  *" in str(fn):. 
+0001c2f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001c300: 6c6f 6767 6572 2e69 6e66 6f28 6622 5265  logger.info(f"Re
+0001c310: 6164 206d 756c 7469 706c 6520 666f 7263  ad multiple forc
+0001c320: 696e 6720 6669 6c65 7320 7573 696e 6720  ing files using 
+0001c330: 7b66 6e7d 2229 0a20 2020 2020 2020 2020  {fn}").         
+0001c340: 2020 2066 6e73 203d 206c 6973 7428 666e     fns = list(fn
+0001c350: 2e70 6172 656e 742e 676c 6f62 2866 6e2e  .parent.glob(fn.
+0001c360: 6e61 6d65 2929 0a20 2020 2020 2020 2020  name)).         
+0001c370: 2020 2069 6620 6c65 6e28 666e 7329 203d     if len(fns) =
+0001c380: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001c390: 2020 2020 2072 6169 7365 2049 4f45 7272       raise IOErr
+0001c3a0: 6f72 2866 224e 6f20 666f 7263 696e 6720  or(f"No forcing 
+0001c3b0: 6669 6c65 7320 666f 756e 6420 7573 696e  files found usin
+0001c3c0: 6720 7b66 6e7d 2229 0a20 2020 2020 2020  g {fn}").       
+0001c3d0: 2020 2020 2064 7320 3d20 7872 2e6f 7065       ds = xr.ope
+0001c3e0: 6e5f 6d66 6461 7461 7365 7428 666e 732c  n_mfdataset(fns,
+0001c3f0: 2063 6875 6e6b 733d 7b22 7469 6d65 223a   chunks={"time":
+0001c400: 2033 307d 2c20 6465 636f 6465 5f63 6f6f   30}, decode_coo
+0001c410: 7264 733d 2261 6c6c 2229 0a20 2020 2020  rds="all").     
+0001c420: 2020 2020 2020 2066 6f72 2076 2069 6e20         for v in 
+0001c430: 6473 2e64 6174 615f 7661 7273 3a0a 2020  ds.data_vars:.  
+0001c440: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001c450: 6c66 2e73 6574 5f66 6f72 6369 6e67 2864  lf.set_forcing(d
+0001c460: 735b 765d 290a 0a20 2020 2064 6566 2077  s[v])..    def w
+0001c470: 7269 7465 5f66 6f72 6369 6e67 280a 2020  rite_forcing(.  
+0001c480: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001c490: 2020 2020 666e 5f6f 7574 3d4e 6f6e 652c      fn_out=None,
+0001c4a0: 0a20 2020 2020 2020 2066 7265 715f 6f75  .        freq_ou
+0001c4b0: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
+0001c4c0: 6368 756e 6b73 697a 653d 312c 0a20 2020  chunksize=1,.   
+0001c4d0: 2020 2020 2064 6563 696d 616c 733d 322c       decimals=2,
+0001c4e0: 0a20 2020 2020 2020 2074 696d 655f 756e  .        time_un
+0001c4f0: 6974 733d 2264 6179 7320 7369 6e63 6520  its="days since 
+0001c500: 3139 3030 2d30 312d 3031 5430 303a 3030  1900-01-01T00:00
+0001c510: 3a30 3022 2c0a 2020 2020 2020 2020 2a2a  :00",.        **
+0001c520: 6b77 6172 6773 2c0a 2020 2020 293a 0a20  kwargs,.    ):. 
+0001c530: 2020 2020 2020 2022 2222 7772 6974 6520         """write 
+0001c540: 666f 7263 696e 6720 6174 2060 6066 6e5f  forcing at ``fn_
+0001c550: 6f75 7460 6020 696e 206d 6f64 656c 2072  out`` in model r
+0001c560: 6561 6479 2066 6f72 6d61 742e 0a0a 2020  eady format...  
+0001c570: 2020 2020 2020 4966 206e 6f20 6060 666e        If no ``fn
+0001c580: 5f6f 7574 6060 2070 6174 6820 6973 2070  _out`` path is p
+0001c590: 726f 7669 6465 6420 616e 6420 7061 7468  rovided and path
+0001c5a0: 5f66 6f72 6369 6e67 2066 726f 6d20 7468  _forcing from th
+0001c5b0: 6520 2077 666c 6f77 2074 6f6d 6c20 6578  e  wflow toml ex
+0001c5c0: 6973 7473 2c0a 2020 2020 2020 2020 7468  ists,.        th
+0001c5d0: 6520 666f 6c6c 6f77 696e 6720 6465 6661  e following defa
+0001c5e0: 756c 7420 6669 6c65 6e61 6d65 7320 6172  ult filenames ar
+0001c5f0: 6520 7573 6564 3a0a 0a20 2020 2020 2020  e used:..       
+0001c600: 2020 2020 202a 2044 6566 6175 6c74 206e       * Default n
+0001c610: 616d 6520 666f 726d 6174 2028 7769 7468  ame format (with
+0001c620: 2064 6f77 6e73 6361 6c69 6e67 293a 2069   downscaling): i
+0001c630: 6e6d 6170 735f 736f 7572 6365 5064 5f73  nmaps_sourcePd_s
+0001c640: 6f75 7263 6554 645f 6d65 7468 6f64 5045  ourceTd_methodPE
+0001c650: 545f 6672 6571 5f73 7461 7274 7965 6172  T_freq_startyear
+0001c660: 5f65 6e64 7965 6172 2e6e 630a 2020 2020  _endyear.nc.    
+0001c670: 2020 2020 2020 2020 2a20 4465 6661 756c          * Defaul
+0001c680: 7420 6e61 6d65 2066 6f72 6d61 7420 286e  t name format (n
+0001c690: 6f20 646f 776e 7363 616c 696e 6729 3a20  o downscaling): 
+0001c6a0: 696e 6d61 7073 5f73 6f75 7263 6550 5f73  inmaps_sourceP_s
+0001c6b0: 6f75 7263 6554 5f6d 6574 686f 6450 4554  ourceT_methodPET
+0001c6c0: 5f66 7265 715f 7374 6172 7479 6561 725f  _freq_startyear_
+0001c6d0: 656e 6479 6561 722e 6e63 0a0a 2020 2020  endyear.nc..    
+0001c6e0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0001c6f0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001c700: 2d0a 2020 2020 2020 2020 666e 5f6f 7574  -.        fn_out
+0001c710: 3a20 7374 722c 2050 6174 682c 206f 7074  : str, Path, opt
+0001c720: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+0001c730: 2020 5061 7468 2074 6f20 7361 7665 206f    Path to save o
+0001c740: 7574 7075 7420 6e65 7463 6466 2066 696c  utput netcdf fil
+0001c750: 653b 2069 6620 4e6f 6e65 2074 6865 206e  e; if None the n
+0001c760: 616d 6520 6973 2072 6561 6420 6672 6f6d  ame is read from
+0001c770: 2074 6865 2077 666c 6f77 0a20 2020 2020   the wflow.     
+0001c780: 2020 2020 2020 2074 6f6d 6c20 6669 6c65         toml file
+0001c790: 2e0a 2020 2020 2020 2020 6672 6571 5f6f  ..        freq_o
+0001c7a0: 7574 3a20 7374 7220 284f 6666 7365 7429  ut: str (Offset)
+0001c7b0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0001c7c0: 2020 2020 2020 2057 7269 7465 2073 6576         Write sev
+0001c7d0: 6572 616c 2066 696c 6573 2066 6f72 2074  eral files for t
+0001c7e0: 6865 2066 6f72 6369 6e67 2061 6363 6f72  he forcing accor
+0001c7f0: 6469 6e67 2074 6f20 666e 5f66 7265 712e  ding to fn_freq.
+0001c800: 2046 6f72 2065 7861 6d70 6c65 2027 5927   For example 'Y'
+0001c810: 2066 6f72 206f 6e65 2066 696c 6520 7065   for one file pe
+0001c820: 7220 7965 6172 206f 7220 274d 270a 2020  r year or 'M'.  
+0001c830: 2020 2020 2020 2020 2020 666f 7220 6f6e            for on
+0001c840: 6520 6669 6c65 2070 6572 206d 6f6e 7468  e file per month
+0001c850: 2e20 4279 2064 6566 6175 6c74 2077 7269  . By default wri
+0001c860: 7465 7320 7468 6520 6f6e 6520 6669 6c65  tes the one file
+0001c870: 2e0a 2020 2020 2020 2020 2020 2020 466f  ..            Fo
+0001c880: 7220 6d6f 7265 206f 7074 696f 6e73 2c20  r more options, 
+0001c890: 7365 6520 6874 7470 733a 2f2f 7061 6e64  see https://pand
+0001c8a0: 6173 2e70 7964 6174 612e 6f72 672f 7061  as.pydata.org/pa
+0001c8b0: 6e64 6173 2d64 6f63 732f 7374 6162 6c65  ndas-docs/stable
+0001c8c0: 2f75 7365 725f 6775 6964 652f 7469 6d65  /user_guide/time
+0001c8d0: 7365 7269 6573 2e68 746d 6c23 6f66 6673  series.html#offs
+0001c8e0: 6574 2d61 6c69 6173 6573 0a20 2020 2020  et-aliases.     
+0001c8f0: 2020 2063 6875 6e6b 7369 7a65 3a20 696e     chunksize: in
+0001c900: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
+0001c910: 2020 2020 2020 2020 4368 756e 6b73 697a          Chunksiz
+0001c920: 6520 6f6e 2074 696d 6520 6469 6d65 6e73  e on time dimens
+0001c930: 696f 6e20 7768 656e 2073 6176 696e 6720  ion when saving 
+0001c940: 746f 2064 6973 6b2e 2042 7920 6465 6661  to disk. By defa
+0001c950: 756c 7420 312e 0a20 2020 2020 2020 2064  ult 1..        d
+0001c960: 6563 696d 616c 733a 2069 6e74 2c20 6f70  ecimals: int, op
+0001c970: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0001c980: 2020 2052 6f75 6e64 2074 6865 206f 7570     Round the oup
+0001c990: 7574 2064 6174 6120 746f 2074 6865 2067  ut data to the g
+0001c9a0: 6976 656e 206e 756d 6265 7220 6f66 2064  iven number of d
+0001c9b0: 6563 696d 616c 732e 0a20 2020 2020 2020  ecimals..       
+0001c9c0: 2074 696d 655f 756e 6974 733a 2073 7472   time_units: str
+0001c9d0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0001c9e0: 2020 2020 2020 2043 6f6d 6d6f 6e20 7469         Common ti
+0001c9f0: 6d65 2075 6e69 7473 2077 6865 6e20 7772  me units when wr
+0001ca00: 6974 7469 6e67 2073 6576 6572 616c 206e  itting several n
+0001ca10: 6574 6364 6620 666f 7263 696e 6720 6669  etcdf forcing fi
+0001ca20: 6c65 732e 2042 7920 6465 6661 756c 7420  les. By default 
+0001ca30: 2264 6179 7320 7369 6e63 6520 3139 3030  "days since 1900
+0001ca40: 2d30 312d 3031 5430 303a 3030 3a30 3022  -01-01T00:00:00"
+0001ca50: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
+0001ca60: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0001ca70: 6c66 2e5f 7772 6974 653a 0a20 2020 2020  lf._write:.     
+0001ca80: 2020 2020 2020 2072 6169 7365 2049 4f45         raise IOE
+0001ca90: 7272 6f72 2822 4d6f 6465 6c20 6f70 656e  rror("Model open
+0001caa0: 6564 2069 6e20 7265 6164 2d6f 6e6c 7920  ed in read-only 
+0001cab0: 6d6f 6465 2229 0a20 2020 2020 2020 2069  mode").        i
+0001cac0: 6620 7365 6c66 2e66 6f72 6369 6e67 3a0a  f self.forcing:.
+0001cad0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001cae0: 2e6c 6f67 6765 722e 696e 666f 2822 5772  .logger.info("Wr
+0001caf0: 6974 6520 666f 7263 696e 6720 6669 6c65  ite forcing file
+0001cb00: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0001cb10: 2320 4765 7420 6465 6661 756c 7420 666f  # Get default fo
+0001cb20: 7263 696e 6720 6e61 6d65 2066 726f 6d20  rcing name from 
+0001cb30: 666f 7263 696e 6720 6174 7472 730a 2020  forcing attrs.  
+0001cb40: 2020 2020 2020 2020 2020 7972 3020 3d20            yr0 = 
+0001cb50: 7064 2e74 6f5f 6461 7465 7469 6d65 2873  pd.to_datetime(s
+0001cb60: 656c 662e 6765 745f 636f 6e66 6967 2822  elf.get_config("
+0001cb70: 7374 6172 7474 696d 6522 2929 2e79 6561  starttime")).yea
+0001cb80: 720a 2020 2020 2020 2020 2020 2020 7972  r.            yr
+0001cb90: 3120 3d20 7064 2e74 6f5f 6461 7465 7469  1 = pd.to_dateti
+0001cba0: 6d65 2873 656c 662e 6765 745f 636f 6e66  me(self.get_conf
+0001cbb0: 6967 2822 656e 6474 696d 6522 2929 2e79  ig("endtime")).y
+0001cbc0: 6561 720a 2020 2020 2020 2020 2020 2020  ear.            
+0001cbd0: 6672 6571 203d 2073 656c 662e 6765 745f  freq = self.get_
+0001cbe0: 636f 6e66 6967 2822 7469 6d65 7374 6570  config("timestep
+0001cbf0: 7365 6373 2229 0a20 2020 2020 2020 2020  secs").         
+0001cc00: 2020 2023 2067 6574 206f 7574 7075 7420     # get output 
+0001cc10: 6669 6c65 6e61 6d65 0a20 2020 2020 2020  filename.       
+0001cc20: 2020 2020 2069 6620 666e 5f6f 7574 2069       if fn_out i
+0001cc30: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0001cc40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001cc50: 2e73 6574 5f63 6f6e 6669 6728 2269 6e70  .set_config("inp
+0001cc60: 7574 2e70 6174 685f 666f 7263 696e 6722  ut.path_forcing"
+0001cc70: 2c20 666e 5f6f 7574 290a 2020 2020 2020  , fn_out).      
+0001cc80: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
+0001cc90: 7269 7465 5f63 6f6e 6669 6728 2920 2023  rite_config()  #
+0001cca0: 2072 652d 7772 6974 6520 636f 6e66 6967   re-write config
+0001ccb0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0001ccc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001ccd0: 2020 2066 6e5f 6f75 7420 3d20 7365 6c66     fn_out = self
+0001cce0: 2e67 6574 5f63 6f6e 6669 6728 2269 6e70  .get_config("inp
+0001ccf0: 7574 2e70 6174 685f 666f 7263 696e 6722  ut.path_forcing"
+0001cd00: 2c20 6162 735f 7061 7468 3d54 7275 6529  , abs_path=True)
+0001cd10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd20: 2069 6620 222a 2220 696e 2062 6173 656e   if "*" in basen
+0001cd30: 616d 6528 666e 5f6f 7574 293a 0a20 2020  ame(fn_out):.   
+0001cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd50: 2023 2067 6574 2072 6964 206f 6620 2a20   # get rid of * 
+0001cd60: 696e 2063 6173 6520 6d6f 6465 6c20 6861  in case model ha
+0001cd70: 6420 6d75 6c74 6970 6c65 2066 6f72 6369  d multiple forci
+0001cd80: 6e67 2066 696c 6573 2061 6e64 2077 7269  ng files and wri
+0001cd90: 7465 2074 6f20 7369 6e67 6c65 206e 6320  te to single nc 
+0001cda0: 6669 6c65 2e0a 2020 2020 2020 2020 2020  file..          
+0001cdb0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0001cdc0: 6f67 6765 722e 7761 726e 696e 6728 2257  ogger.warning("W
+0001cdd0: 7269 7469 6e67 206d 756c 7469 706c 6520  riting multiple 
+0001cde0: 666f 7263 696e 6720 6669 6c65 7320 746f  forcing files to
+0001cdf0: 206f 6e65 2066 696c 6522 290a 2020 2020   one file").    
+0001ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce10: 666e 5f6f 7574 203d 206a 6f69 6e28 6469  fn_out = join(di
+0001ce20: 726e 616d 6528 666e 5f6f 7574 292c 2062  rname(fn_out), b
+0001ce30: 6173 656e 616d 6528 666e 5f6f 7574 292e  asename(fn_out).
+0001ce40: 7265 706c 6163 6528 222a 222c 2022 2229  replace("*", "")
+0001ce50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ce60: 2020 6966 2073 656c 662e 6765 745f 636f    if self.get_co
+0001ce70: 6e66 6967 2822 6469 725f 696e 7075 7422  nfig("dir_input"
+0001ce80: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cea0: 2020 2069 6e70 7574 5f64 6972 203d 2073     input_dir = s
+0001ceb0: 656c 662e 6765 745f 636f 6e66 6967 2822  elf.get_config("
+0001cec0: 6469 725f 696e 7075 7422 2c20 6162 735f  dir_input", abs_
+0001ced0: 7061 7468 3d54 7275 6529 0a20 2020 2020  path=True).     
+0001cee0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001cef0: 6e5f 6f75 7420 3d20 6a6f 696e 2869 6e70  n_out = join(inp
+0001cf00: 7574 5f64 6972 2c20 666e 5f6f 7574 290a  ut_dir, fn_out).
+0001cf10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cf20: 2023 2067 6574 2064 6561 6675 6c74 2066   # get deafult f
+0001cf30: 696c 656e 616d 6520 6966 2066 696c 6520  ilename if file 
+0001cf40: 6578 6973 7473 0a20 2020 2020 2020 2020  exists.         
+0001cf50: 2020 2020 2020 2069 6620 666e 5f6f 7574         if fn_out
+0001cf60: 2069 7320 4e6f 6e65 206f 7220 6973 6669   is None or isfi
+0001cf70: 6c65 2866 6e5f 6f75 7429 3a0a 2020 2020  le(fn_out):.    
+0001cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf90: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
+0001cfa0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+0001cfb0: 2020 2020 2020 2020 2020 2020 2022 4e65               "Ne
+0001cfc0: 7463 6466 2066 6f72 6369 6e67 2066 696c  tcdf forcing fil
+0001cfd0: 6520 6672 6f6d 2069 6e70 7574 2e70 6174  e from input.pat
+0001cfe0: 685f 666f 7263 696e 6720 696e 2074 6865  h_forcing in the
+0001cff0: 2054 4f4d 4c20 2022 0a20 2020 2020 2020   TOML  ".       
+0001d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d010: 2022 616c 7265 6164 7920 6578 6973 7473   "already exists
+0001d020: 2c20 7573 696e 6720 6465 6661 756c 7420  , using default 
+0001d030: 6e61 6d65 2e22 0a20 2020 2020 2020 2020  name.".         
+0001d040: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d060: 2073 6f75 7263 6550 203d 2022 220a 2020   sourceP = "".  
+0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d080: 2020 736f 7572 6365 5420 3d20 2222 0a20    sourceT = "". 
+0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0a0: 2020 206d 6574 686f 6450 4554 203d 2022     methodPET = "
+0001d0b0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001d0c0: 2020 2020 2020 6966 2022 7072 6563 6970        if "precip
+0001d0d0: 2220 696e 2073 656c 662e 666f 7263 696e  " in self.forcin
+0001d0e0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+0001d0f0: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+0001d100: 2073 656c 662e 666f 7263 696e 675b 2270   self.forcing["p
+0001d110: 7265 6369 7022 5d2e 6174 7472 732e 6765  recip"].attrs.ge
+0001d120: 7428 2270 7265 6369 705f 636c 696d 5f66  t("precip_clim_f
+0001d130: 6e22 2c20 4e6f 6e65 290a 2020 2020 2020  n", None).      
+0001d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d150: 2020 5064 6f77 6e20 3d20 2264 2220 6966    Pdown = "d" if
+0001d160: 2076 616c 2069 7320 6e6f 7420 4e6f 6e65   val is not None
+0001d170: 2065 6c73 6520 2222 0a20 2020 2020 2020   else "".       
+0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d190: 2076 616c 203d 2073 656c 662e 666f 7263   val = self.forc
+0001d1a0: 696e 675b 2270 7265 6369 7022 5d2e 6174  ing["precip"].at
+0001d1b0: 7472 732e 6765 7428 2270 7265 6369 705f  trs.get("precip_
+0001d1c0: 666e 222c 204e 6f6e 6529 0a20 2020 2020  fn", None).     
+0001d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1e0: 2020 2069 6620 7661 6c20 6973 206e 6f74     if val is not
+0001d1f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d210: 2020 2073 6f75 7263 6550 203d 2066 225f     sourceP = f"_
+0001d220: 7b76 616c 7d7b 5064 6f77 6e7d 220a 2020  {val}{Pdown}".  
+0001d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d240: 2020 6966 2022 7465 6d70 2220 696e 2073    if "temp" in s
+0001d250: 656c 662e 666f 7263 696e 673a 0a20 2020  elf.forcing:.   
+0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d270: 2020 2020 2076 616c 203d 2073 656c 662e       val = self.
+0001d280: 666f 7263 696e 675b 2274 656d 7022 5d2e  forcing["temp"].
+0001d290: 6174 7472 732e 6765 7428 2274 656d 705f  attrs.get("temp_
+0001d2a0: 636f 7272 6563 7469 6f6e 222c 2022 4661  correction", "Fa
+0001d2b0: 6c73 6522 290a 2020 2020 2020 2020 2020  lse").          
+0001d2c0: 2020 2020 2020 2020 2020 2020 2020 5464                Td
+0001d2d0: 6f77 6e20 3d20 2264 2220 6966 2076 616c  own = "d" if val
+0001d2e0: 203d 3d20 2254 7275 6522 2065 6c73 6520   == "True" else 
+0001d2f0: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
+0001d300: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+0001d310: 2073 656c 662e 666f 7263 696e 675b 2274   self.forcing["t
+0001d320: 656d 7022 5d2e 6174 7472 732e 6765 7428  emp"].attrs.get(
+0001d330: 2274 656d 705f 666e 222c 204e 6f6e 6529  "temp_fn", None)
+0001d340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d350: 2020 2020 2020 2020 2069 6620 7661 6c20           if val 
+0001d360: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d380: 2020 2020 2020 2020 2073 6f75 7263 6554           sourceT
+0001d390: 203d 2066 225f 7b76 616c 7d7b 5464 6f77   = f"_{val}{Tdow
+0001d3a0: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
+0001d3b0: 2020 2020 2020 2020 6966 2022 7065 7422          if "pet"
+0001d3c0: 2069 6e20 7365 6c66 2e66 6f72 6369 6e67   in self.forcing
+0001d3d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d3e0: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
+0001d3f0: 7365 6c66 2e66 6f72 6369 6e67 5b22 7065  self.forcing["pe
+0001d400: 7422 5d2e 6174 7472 732e 6765 7428 2270  t"].attrs.get("p
+0001d410: 6574 5f6d 6574 686f 6422 2c20 4e6f 6e65  et_method", None
+0001d420: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d430: 2020 2020 2020 2020 2020 6966 2076 616c            if val
+0001d440: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0001d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d460: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+0001d470: 5045 5420 3d20 6622 5f7b 7661 6c7d 220a  PET = f"_{val}".
+0001d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d490: 2020 2020 666e 5f64 6566 6175 6c74 203d      fn_default =
+0001d4a0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001d4b0: 2020 2020 2020 2020 2020 2066 2269 6e6d             f"inm
+0001d4c0: 6170 737b 736f 7572 6365 507d 7b73 6f75  aps{sourceP}{sou
+0001d4d0: 7263 6554 7d7b 6d65 7468 6f64 5045 547d  rceT}{methodPET}
+0001d4e0: 5f7b 6672 6571 7d5f 7b79 7230 7d5f 7b79  _{freq}_{yr0}_{y
+0001d4f0: 7231 7d2e 6e63 220a 2020 2020 2020 2020  r1}.nc".        
+0001d500: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d520: 2020 666e 5f64 6566 6175 6c74 5f70 6174    fn_default_pat
+0001d530: 6820 3d20 6a6f 696e 2873 656c 662e 726f  h = join(self.ro
+0001d540: 6f74 2c20 666e 5f64 6566 6175 6c74 290a  ot, fn_default).
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2020 2020 6966 2069 7366 696c 6528 666e      if isfile(fn
+0001d570: 5f64 6566 6175 6c74 5f70 6174 6829 3a0a  _default_path):.
+0001d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d590: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0001d5a0: 6765 722e 7761 726e 696e 6728 0a20 2020  ger.warning(.   
+0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5c0: 2020 2020 2020 2020 2022 4e65 7463 6466           "Netcdf
+0001d5d0: 2064 6566 6175 6c74 2066 6f72 6369 6e67   default forcing
+0001d5e0: 2066 696c 6520 616c 7265 6164 7920 6578   file already ex
+0001d5f0: 6973 7473 2c20 736b 6970 7069 6e67 2077  ists, skipping w
+0001d600: 7269 7465 5f66 6f72 6369 6e67 2e20 220a  rite_forcing. ".
+0001d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d620: 2020 2020 2020 2020 2020 2020 2254 6f20              "To 
+0001d630: 6f76 6572 7772 6974 6520 6e65 7463 6466  overwrite netcdf
+0001d640: 2066 6f72 6369 6e67 2066 696c 653a 2063   forcing file: c
+0001d650: 6861 6e67 6520 6e61 6d65 2069 6e70 7574  hange name input
+0001d660: 2e70 6174 685f 666f 7263 696e 6720 220a  .path_forcing ".
+0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d680: 2020 2020 2020 2020 2020 2020 2269 6e20              "in 
+0001d690: 7365 7475 705f 636f 6e66 6967 2073 6563  setup_config sec
+0001d6a0: 7469 6f6e 206f 6620 7468 6520 6275 696c  tion of the buil
+0001d6b0: 6420 696e 6966 696c 652e 220a 2020 2020  d inifile.".    
+0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6d0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0001d6e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001d6f0: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+0001d700: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d720: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+0001d730: 636f 6e66 6967 2822 696e 7075 742e 7061  config("input.pa
+0001d740: 7468 5f66 6f72 6369 6e67 222c 2066 6e5f  th_forcing", fn_
+0001d750: 6465 6661 756c 7429 0a20 2020 2020 2020  default).       
+0001d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d770: 2073 656c 662e 7772 6974 655f 636f 6e66   self.write_conf
+0001d780: 6967 2829 2020 2320 7265 2d77 7269 7465  ig()  # re-write
+0001d790: 2063 6f6e 6669 670a 2020 2020 2020 2020   config.        
+0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7b0: 666e 5f6f 7574 203d 2066 6e5f 6465 6661  fn_out = fn_defa
+0001d7c0: 756c 745f 7061 7468 0a0a 2020 2020 2020  ult_path..      
+0001d7d0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+0001d7e0: 2061 6c6c 2064 6174 6573 2062 6574 7765   all dates betwe
+0001d7f0: 656e 2028 7374 6172 7474 696d 652c 2065  en (starttime, e
+0001d800: 6e64 7469 6d65 2920 6172 6520 696e 2061  ndtime) are in a
+0001d810: 6c6c 2064 6120 666f 7263 696e 670a 2020  ll da forcing.  
+0001d820: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
+0001d830: 6b20 6966 2073 7461 7274 7469 6d65 2061  k if starttime a
+0001d840: 6e64 2065 6e64 7469 6d65 2074 696d 6573  nd endtime times
+0001d850: 7461 6d70 7320 6172 6520 636f 7272 6563  tamps are correc
+0001d860: 740a 2020 2020 2020 2020 2020 2020 7374  t.            st
+0001d870: 6172 7420 3d20 7064 2e74 6f5f 6461 7465  art = pd.to_date
+0001d880: 7469 6d65 2873 656c 662e 6765 745f 636f  time(self.get_co
+0001d890: 6e66 6967 2822 7374 6172 7474 696d 6522  nfig("starttime"
+0001d8a0: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
+0001d8b0: 6e64 203d 2070 642e 746f 5f64 6174 6574  nd = pd.to_datet
+0001d8c0: 696d 6528 7365 6c66 2e67 6574 5f63 6f6e  ime(self.get_con
+0001d8d0: 6669 6728 2265 6e64 7469 6d65 2229 290a  fig("endtime")).
+0001d8e0: 2020 2020 2020 2020 2020 2020 636f 7272              corr
+0001d8f0: 6563 745f 7469 6d65 7320 3d20 4661 6c73  ect_times = Fals
+0001d900: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+0001d910: 7220 6461 2069 6e20 7365 6c66 2e66 6f72  r da in self.for
+0001d920: 6369 6e67 2e76 616c 7565 7328 293a 0a20  cing.values():. 
+0001d930: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001d940: 6620 2274 696d 6522 2069 6e20 6461 2e63  f "time" in da.c
+0001d950: 6f6f 7264 733a 0a20 2020 2020 2020 2020  oords:.         
+0001d960: 2020 2020 2020 2020 2020 2023 206f 6e6c             # onl
+0001d970: 7920 636f 7272 6563 7420 6461 7465 7320  y correct dates 
+0001d980: 696e 2074 6f6d 6c20 666f 7220 7374 616e  in toml for stan
+0001d990: 6461 7264 2063 616c 656e 6461 7273 3a0a  dard calendars:.
+0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9b0: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
+0001d9c0: 7472 2864 612e 696e 6465 7865 735b 2274  tr(da.indexes["t
+0001d9d0: 696d 6522 5d2c 2022 746f 5f64 6174 6574  ime"], "to_datet
+0001d9e0: 696d 6569 6e64 6578 2229 3a0a 2020 2020  imeindex"):.    
+0001d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da00: 2020 2020 7469 6d65 7320 3d20 6461 2e74      times = da.t
+0001da10: 696d 652e 7661 6c75 6573 0a20 2020 2020  ime.values.     
+0001da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da30: 2020 2069 6620 2873 7461 7274 203c 2070     if (start < p
+0001da40: 642e 746f 5f64 6174 6574 696d 6528 7469  d.to_datetime(ti
+0001da50: 6d65 735b 305d 2929 207c 2028 7374 6172  mes[0])) | (star
+0001da60: 7420 6e6f 7420 696e 2074 696d 6573 293a  t not in times):
+0001da70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001da80: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0001da90: 7274 203d 2070 642e 746f 5f64 6174 6574  rt = pd.to_datet
+0001daa0: 696d 6528 7469 6d65 735b 305d 290a 2020  ime(times[0]).  
+0001dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dac0: 2020 2020 2020 2020 2020 636f 7272 6563            correc
+0001dad0: 745f 7469 6d65 7320 3d20 5472 7565 0a20  t_times = True. 
+0001dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001daf0: 2020 2020 2020 2069 6620 2865 6e64 203e         if (end >
+0001db00: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
+0001db10: 7469 6d65 735b 2d31 5d29 2920 7c20 2865  times[-1])) | (e
+0001db20: 6e64 206e 6f74 2069 6e20 7469 6d65 7329  nd not in times)
+0001db30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001db40: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0001db50: 6420 3d20 7064 2e74 6f5f 6461 7465 7469  d = pd.to_dateti
+0001db60: 6d65 2874 696d 6573 5b2d 315d 290a 2020  me(times[-1]).  
+0001db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db80: 2020 2020 2020 2020 2020 636f 7272 6563            correc
+0001db90: 745f 7469 6d65 7320 3d20 5472 7565 0a20  t_times = True. 
+0001dba0: 2020 2020 2020 2020 2020 2023 206d 6572             # mer
+0001dbb0: 6765 2c20 7072 6f63 6573 7320 616e 6420  ge, process and 
+0001dbc0: 7772 6974 6520 666f 7263 696e 670a 2020  write forcing.  
+0001dbd0: 2020 2020 2020 2020 2020 6473 203d 2078            ds = x
+0001dbe0: 722e 6d65 7267 6528 5b64 612e 7265 7365  r.merge([da.rese
+0001dbf0: 745f 636f 6f72 6473 2864 726f 703d 5472  t_coords(drop=Tr
+0001dc00: 7565 2920 666f 7220 6461 2069 6e20 7365  ue) for da in se
+0001dc10: 6c66 2e66 6f72 6369 6e67 2e76 616c 7565  lf.forcing.value
+0001dc20: 7328 295d 290a 2020 2020 2020 2020 2020  s()]).          
+0001dc30: 2020 6473 2e72 6173 7465 722e 7365 745f    ds.raster.set_
+0001dc40: 6372 7328 7365 6c66 2e63 7273 290a 2020  crs(self.crs).  
+0001dc50: 2020 2020 2020 2020 2020 2320 5365 6e64            # Send
+0001dc60: 2077 6172 6e69 6e67 2c20 616e 6420 7570   warning, and up
+0001dc70: 6461 7465 2063 6f6e 6669 6720 7769 7468  date config with
+0001dc80: 206e 6577 2073 7461 7274 2061 6e64 2065   new start and e
+0001dc90: 6e64 2074 696d 650a 2020 2020 2020 2020  nd time.        
+0001dca0: 2020 2020 6966 2063 6f72 7265 6374 5f74      if correct_t
+0001dcb0: 696d 6573 3a0a 2020 2020 2020 2020 2020  imes:.          
+0001dcc0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0001dcd0: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
+0001dce0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001dcf0: 224e 6f74 2061 6c6c 2064 6174 6573 2066  "Not all dates f
+0001dd00: 6f75 6e64 2069 6e20 7072 6563 6970 5f66  ound in precip_f
+0001dd10: 6e20 6368 616e 6769 6e67 2073 7461 7274  n changing start
+0001dd20: 7469 6d65 2074 6f20 7b73 7461 7274 7d20  time to {start} 
+0001dd30: 616e 6420 656e 6474 696d 6520 746f 207b  and endtime to {
+0001dd40: 656e 647d 2069 6e20 7468 6520 746f 6d6c  end} in the toml
+0001dd50: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+0001dd60: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001dd70: 2020 2020 2073 656c 662e 7365 745f 636f       self.set_co
+0001dd80: 6e66 6967 2822 7374 6172 7474 696d 6522  nfig("starttime"
+0001dd90: 2c20 7374 6172 742e 746f 5f70 7964 6174  , start.to_pydat
+0001dda0: 6574 696d 6528 2929 0a20 2020 2020 2020  etime()).       
+0001ddb0: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+0001ddc0: 745f 636f 6e66 6967 2822 656e 6474 696d  t_config("endtim
+0001ddd0: 6522 2c20 656e 642e 746f 5f70 7964 6174  e", end.to_pydat
+0001dde0: 6574 696d 6528 2929 0a20 2020 2020 2020  etime()).       
+0001ddf0: 2020 2020 2020 2020 2073 656c 662e 7772           self.wr
+0001de00: 6974 655f 636f 6e66 6967 2829 0a0a 2020  ite_config()..  
+0001de10: 2020 2020 2020 2020 2020 6966 2064 6563            if dec
+0001de20: 696d 616c 7320 6973 206e 6f74 204e 6f6e  imals is not Non
+0001de30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001de40: 2020 2064 7320 3d20 6473 2e72 6f75 6e64     ds = ds.round
+0001de50: 2864 6563 696d 616c 7329 0a20 2020 2020  (decimals).     
+0001de60: 2020 2020 2020 2023 2063 6c65 616e 2d75         # clean-u
+0001de70: 7020 666f 7263 696e 6720 616e 6420 7772  p forcing and wr
+0001de80: 6974 6520 4352 5320 6163 636f 7264 696e  ite CRS accordin
+0001de90: 6720 746f 2043 462d 636f 6e76 656e 7469  g to CF-conventi
+0001dea0: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+0001deb0: 6473 203d 2064 732e 7261 7374 6572 2e67  ds = ds.raster.g
+0001dec0: 6461 6c5f 636f 6d70 6c69 616e 7428 7265  dal_compliant(re
+0001ded0: 6e61 6d65 5f64 696d 733d 5472 7565 2c20  name_dims=True, 
+0001dee0: 666f 7263 655f 736e 3d46 616c 7365 290a  force_sn=False).
+0001def0: 2020 2020 2020 2020 2020 2020 6473 203d              ds =
+0001df00: 2064 732e 6472 6f70 5f76 6172 7328 5b22   ds.drop_vars(["
+0001df10: 6d61 736b 222c 2022 6964 785f 6f75 7422  mask", "idx_out"
+0001df20: 5d2c 2065 7272 6f72 733d 2269 676e 6f72  ], errors="ignor
+0001df30: 6522 290a 0a20 2020 2020 2020 2020 2020  e")..           
+0001df40: 2023 2077 7269 7465 2077 6974 6820 6f75   # write with ou
+0001df50: 7470 7574 2063 6875 6e6b 7369 7a65 7320  tput chunksizes 
+0001df60: 7769 7468 2073 696e 676c 6520 7469 6d65  with single time
+0001df70: 7374 6570 2061 6e64 2063 6f6d 706c 6574  step and complet
+0001df80: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+0001df90: 7370 6174 6961 6c20 6772 6964 2074 6f20  spatial grid to 
+0001dfa0: 7370 6565 6420 7570 2074 6865 2072 6561  speed up the rea
+0001dfb0: 6469 6e67 2066 726f 6d20 7766 6c6f 772e  ding from wflow.
+0001dfc0: 6a6c 0a20 2020 2020 2020 2020 2020 2023  jl.            #
+0001dfd0: 2064 696d 7320 6172 6520 616c 7761 7973   dims are always
+0001dfe0: 206f 7264 6572 6564 2028 7469 6d65 2c20   ordered (time, 
+0001dff0: 792c 2078 290a 2020 2020 2020 2020 2020  y, x).          
+0001e000: 2020 6473 2e72 6173 7465 722e 5f63 6865    ds.raster._che
+0001e010: 636b 5f64 696d 656e 7369 6f6e 7328 290a  ck_dimensions().
+0001e020: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+0001e030: 6b73 697a 6573 203d 2028 6368 756e 6b73  ksizes = (chunks
+0001e040: 697a 652c 2064 732e 7261 7374 6572 2e79  ize, ds.raster.y
+0001e050: 636f 6f72 6473 2e73 697a 652c 2064 732e  coords.size, ds.
+0001e060: 7261 7374 6572 2e78 636f 6f72 6473 2e73  raster.xcoords.s
+0001e070: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+0001e080: 2065 6e63 6f64 696e 6720 3d20 7b0a 2020   encoding = {.  
+0001e090: 2020 2020 2020 2020 2020 2020 2020 763a                v:
+0001e0a0: 207b 227a 6c69 6222 3a20 5472 7565 2c20   {"zlib": True, 
+0001e0b0: 2264 7479 7065 223a 2022 666c 6f61 7433  "dtype": "float3
+0001e0c0: 3222 2c20 2263 6875 6e6b 7369 7a65 7322  2", "chunksizes"
+0001e0d0: 3a20 6368 756e 6b73 697a 6573 7d0a 2020  : chunksizes}.  
+0001e0e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001e0f0: 7220 7620 696e 2064 732e 6461 7461 5f76  r v in ds.data_v
+0001e100: 6172 732e 6b65 7973 2829 0a20 2020 2020  ars.keys().     
+0001e110: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001e120: 2020 2020 2023 206d 616b 6520 7375 7265       # make sure
+0001e130: 206e 6f20 5f46 696c 6c56 616c 7565 2069   no _FillValue i
+0001e140: 7320 7772 6974 7465 6e20 746f 2074 6865  s written to the
+0001e150: 2074 696d 6520 2f20 785f 6469 6d20 2f20   time / x_dim / 
+0001e160: 795f 6469 6d20 6469 6d65 6e73 696f 6e0a  y_dim dimension.
+0001e170: 2020 2020 2020 2020 2020 2020 2320 466f              # Fo
+0001e180: 7220 7365 7665 7261 6c20 666f 7263 696e  r several forcin
+0001e190: 6720 6669 6c65 7320 6164 6420 636f 6d6d  g files add comm
+0001e1a0: 6f6e 2075 6e69 7473 2061 7474 7269 6275  on units attribu
+0001e1b0: 7465 7320 746f 2074 696d 650a 2020 2020  tes to time.    
+0001e1c0: 2020 2020 2020 2020 666f 7220 7620 696e          for v in
+0001e1d0: 205b 2274 696d 6522 2c20 6473 2e72 6173   ["time", ds.ras
+0001e1e0: 7465 722e 785f 6469 6d2c 2064 732e 7261  ter.x_dim, ds.ra
+0001e1f0: 7374 6572 2e79 5f64 696d 5d3a 0a20 2020  ster.y_dim]:.   
+0001e200: 2020 2020 2020 2020 2020 2020 2064 735b               ds[
+0001e210: 765d 2e61 7474 7273 2e70 6f70 2822 5f46  v].attrs.pop("_F
+0001e220: 696c 6c56 616c 7565 222c 204e 6f6e 6529  illValue", None)
+0001e230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e240: 2065 6e63 6f64 696e 675b 765d 203d 207b   encoding[v] = {
+0001e250: 225f 4669 6c6c 5661 6c75 6522 3a20 4e6f  "_FillValue": No
+0001e260: 6e65 7d0a 0a20 2020 2020 2020 2020 2020  ne}..           
+0001e270: 2023 2043 6865 636b 2069 6620 616c 6c20   # Check if all 
+0001e280: 7375 622d 666f 6c64 6572 7320 696e 2066  sub-folders in f
+0001e290: 6e5f 6f75 7420 6578 6973 7473 2061 6e64  n_out exists and
+0001e2a0: 2069 6620 6e6f 7420 6372 6561 7465 2074   if not create t
+0001e2b0: 6865 6d0a 2020 2020 2020 2020 2020 2020  hem.            
+0001e2c0: 6966 206e 6f74 2069 7364 6972 2864 6972  if not isdir(dir
+0001e2d0: 6e61 6d65 2866 6e5f 6f75 7429 293a 0a20  name(fn_out)):. 
+0001e2e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0001e2f0: 732e 6d61 6b65 6469 7273 2864 6972 6e61  s.makedirs(dirna
+0001e300: 6d65 2866 6e5f 6f75 7429 290a 0a20 2020  me(fn_out))..   
+0001e310: 2020 2020 2020 2020 2066 6f72 6369 6e67           forcing
+0001e320: 5f6c 6973 7420 3d20 5b5d 0a0a 2020 2020  _list = []..    
+0001e330: 2020 2020 2020 2020 6966 2066 7265 715f          if freq_
+0001e340: 6f75 7420 6973 204e 6f6e 653a 0a20 2020  out is None:.   
+0001e350: 2020 2020 2020 2020 2020 2020 2023 2077               # w
+0001e360: 6974 6820 636f 6d70 7574 653d 4661 6c73  ith compute=Fals
+0001e370: 6520 7765 2067 6574 2061 2064 656c 6179  e we get a delay
+0001e380: 6564 206f 626a 6563 7420 7768 6963 6820  ed object which 
+0001e390: 6973 2065 7865 6375 7465 6420 7768 656e  is executed when
+0001e3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e3b0: 2023 2063 616c 6c69 6e67 202e 636f 6d70   # calling .comp
+0001e3c0: 7574 6520 7768 6572 6520 7765 2063 616e  ute where we can
+0001e3d0: 2070 6173 7320 6d6f 7265 2061 7267 756d   pass more argum
+0001e3e0: 656e 7473 2074 6f20 7468 6520 6461 736b  ents to the dask
+0001e3f0: 2e63 6f6d 7075 7465 206d 6574 686f 640a  .compute method.
+0001e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e410: 666f 7263 696e 675f 6c69 7374 2e61 7070  forcing_list.app
+0001e420: 656e 6428 5b66 6e5f 6f75 742c 2064 735d  end([fn_out, ds]
+0001e430: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0001e440: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001e450: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0001e460: 696e 666f 2866 2257 7269 7474 696e 6720  info(f"Writting 
+0001e470: 7365 7665 7261 6c20 666f 7263 696e 6720  several forcing 
+0001e480: 7769 7468 2066 7265 7120 7b66 7265 715f  with freq {freq_
+0001e490: 6f75 747d 2229 0a20 2020 2020 2020 2020  out}").         
+0001e4a0: 2020 2020 2020 2023 2046 6f72 2073 6576         # For sev
+0001e4b0: 6572 616c 2066 6f72 6369 6e67 2066 696c  eral forcing fil
+0001e4c0: 6573 2061 6464 2063 6f6d 6d6f 6e20 756e  es add common un
+0001e4d0: 6974 7320 6174 7472 6962 7574 6573 2074  its attributes t
+0001e4e0: 6f20 7469 6d65 0a20 2020 2020 2020 2020  o time.         
+0001e4f0: 2020 2020 2020 2065 6e63 6f64 696e 675b         encoding[
+0001e500: 2274 696d 6522 5d20 3d20 7b22 5f46 696c  "time"] = {"_Fil
+0001e510: 6c56 616c 7565 223a 204e 6f6e 652c 2022  lValue": None, "
+0001e520: 756e 6974 7322 3a20 7469 6d65 5f75 6e69  units": time_uni
+0001e530: 7473 7d0a 2020 2020 2020 2020 2020 2020  ts}.            
+0001e540: 2020 2020 2320 5570 6461 7469 6e67 2070      # Updating p
+0001e550: 6174 6820 666f 7263 696e 6720 696e 2063  ath forcing in c
+0001e560: 6f6e 6669 670a 2020 2020 2020 2020 2020  onfig.          
+0001e570: 2020 2020 2020 666e 735f 6f75 7420 3d20        fns_out = 
+0001e580: 6f73 2e70 6174 682e 7265 6c70 6174 6828  os.path.relpath(
+0001e590: 666e 5f6f 7574 2c20 7365 6c66 2e72 6f6f  fn_out, self.roo
+0001e5a0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0001e5b0: 2020 2066 6e73 5f6f 7574 203d 2066 227b     fns_out = f"{
+0001e5c0: 7374 7228 666e 735f 6f75 7429 5b30 3a2d  str(fns_out)[0:-
+0001e5d0: 335d 7d5f 2a2e 6e63 220a 2020 2020 2020  3]}_*.nc".      
+0001e5e0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0001e5f0: 6574 5f63 6f6e 6669 6728 2269 6e70 7574  et_config("input
+0001e600: 2e70 6174 685f 666f 7263 696e 6722 2c20  .path_forcing", 
+0001e610: 666e 735f 6f75 7429 0a20 2020 2020 2020  fns_out).       
+0001e620: 2020 2020 2020 2020 2073 656c 662e 7772           self.wr
+0001e630: 6974 655f 636f 6e66 6967 2829 2020 2320  ite_config()  # 
+0001e640: 7265 2d77 7269 7465 2063 6f6e 6669 670a  re-write config.
+0001e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e660: 666f 7220 6c61 6265 6c2c 2064 735f 6772  for label, ds_gr
+0001e670: 2069 6e20 6473 2e72 6573 616d 706c 6528   in ds.resample(
+0001e680: 7469 6d65 3d66 7265 715f 6f75 7429 3a0a  time=freq_out):.
+0001e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6a0: 2020 2020 2320 6473 5f67 7220 3d20 6772      # ds_gr = gr
+0001e6b0: 6f75 705b 315d 0a20 2020 2020 2020 2020  oup[1].         
+0001e6c0: 2020 2020 2020 2020 2020 2073 7461 7274             start
+0001e6d0: 203d 2064 735f 6772 5b22 7469 6d65 225d   = ds_gr["time"]
+0001e6e0: 2e64 742e 7374 7266 7469 6d65 2822 2559  .dt.strftime("%Y
+0001e6f0: 256d 2564 2229 5b30 5d2e 6974 656d 2829  %m%d")[0].item()
+0001e700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e710: 2020 2020 2066 6e5f 6f75 745f 6772 203d       fn_out_gr =
+0001e720: 2066 227b 7374 7228 666e 5f6f 7574 295b   f"{str(fn_out)[
+0001e730: 303a 2d33 5d7d 5f7b 7374 6172 747d 2e6e  0:-3]}_{start}.n
+0001e740: 6322 0a20 2020 2020 2020 2020 2020 2020  c".             
+0001e750: 2020 2020 2020 2066 6f72 6369 6e67 5f6c         forcing_l
+0001e760: 6973 742e 6170 7065 6e64 285b 666e 5f6f  ist.append([fn_o
+0001e770: 7574 5f67 722c 2064 735f 6772 5d29 0a0a  ut_gr, ds_gr])..
+0001e780: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001e790: 666e 5f6f 7574 5f67 722c 2064 735f 6772  fn_out_gr, ds_gr
+0001e7a0: 2069 6e20 666f 7263 696e 675f 6c69 7374   in forcing_list
+0001e7b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e7c0: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
+0001e7d0: 666f 2866 2250 726f 6365 7373 2066 6f72  fo(f"Process for
+0001e7e0: 6369 6e67 3b20 7361 7669 6e67 2074 6f20  cing; saving to 
+0001e7f0: 7b66 6e5f 6f75 745f 6772 7d22 290a 2020  {fn_out_gr}").  
+0001e800: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0001e810: 6c61 7965 645f 6f62 6a20 3d20 6473 5f67  layed_obj = ds_g
+0001e820: 722e 746f 5f6e 6574 6364 6628 0a20 2020  r.to_netcdf(.   
+0001e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e840: 2066 6e5f 6f75 745f 6772 2c20 656e 636f   fn_out_gr, enco
+0001e850: 6469 6e67 3d65 6e63 6f64 696e 672c 206d  ding=encoding, m
+0001e860: 6f64 653d 2277 222c 2063 6f6d 7075 7465  ode="w", compute
+0001e870: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+0001e880: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001e890: 2020 2020 2020 2020 2077 6974 6820 5072           with Pr
+0001e8a0: 6f67 7265 7373 4261 7228 293a 0a20 2020  ogressBar():.   
+0001e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8c0: 2064 656c 6179 6564 5f6f 626a 2e63 6f6d   delayed_obj.com
+0001e8d0: 7075 7465 282a 2a6b 7761 7267 7329 0a0a  pute(**kwargs)..
+0001e8e0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
+0001e8f0: 2070 726f 6669 6c65 2075 6e63 6f6d 6d65   profile uncomme
+0001e900: 6e74 206c 696e 6573 2062 656c 6f77 2074  nt lines below t
+0001e910: 6f20 7265 706c 6163 6520 6c69 6e65 7320  o replace lines 
+0001e920: 6162 6f76 650a 2020 2020 2020 2020 2020  above.          
+0001e930: 2020 2320 6672 6f6d 2064 6173 6b2e 6469    # from dask.di
+0001e940: 6167 6e6f 7374 6963 7320 696d 706f 7274  agnostics import
+0001e950: 2050 726f 6669 6c65 722c 2043 6163 6865   Profiler, Cache
+0001e960: 5072 6f66 696c 6572 2c20 5265 736f 7572  Profiler, Resour
+0001e970: 6365 5072 6f66 696c 6572 0a20 2020 2020  ceProfiler.     
+0001e980: 2020 2020 2020 2023 2069 6d70 6f72 7420         # import 
+0001e990: 6361 6368 6579 0a20 2020 2020 2020 2020  cachey.         
+0001e9a0: 2020 2023 2077 6974 6820 5072 6f66 696c     # with Profil
+0001e9b0: 6572 2829 2061 7320 7072 6f66 2c20 4361  er() as prof, Ca
+0001e9c0: 6368 6550 726f 6669 6c65 7228 6d65 7472  cheProfiler(metr
+0001e9d0: 6963 3d63 6163 6865 792e 6e62 7974 6573  ic=cachey.nbytes
+0001e9e0: 2920 6173 2063 7072 6f66 2c20 5265 736f  ) as cprof, Reso
+0001e9f0: 7572 6365 5072 6f66 696c 6572 2829 2061  urceProfiler() a
+0001ea00: 7320 7270 726f 663a 0a20 2020 2020 2020  s rprof:.       
+0001ea10: 2020 2020 2023 2020 2020 2064 656c 6179       #     delay
+0001ea20: 6564 5f6f 626a 2e63 6f6d 7075 7465 2829  ed_obj.compute()
+0001ea30: 0a20 2020 2020 2020 2020 2020 2023 2076  .            # v
+0001ea40: 6973 7561 6c69 7a65 285b 7072 6f66 2c20  isualize([prof, 
+0001ea50: 6370 726f 662c 2072 7072 6f66 5d2c 2066  cprof, rprof], f
+0001ea60: 696c 655f 7061 7468 3d72 2763 3a5c 5573  ile_path=r'c:\Us
+0001ea70: 6572 735c 6569 6c61 6e5f 646b 5c77 6f72  ers\eilan_dk\wor
+0001ea80: 6b5c 7072 6f66 696c 6532 2e68 746d 6c27  k\profile2.html'
+0001ea90: 290a 0a20 2020 2064 6566 2072 6561 645f  )..    def read_
+0001eaa0: 7374 6174 6573 2873 656c 6629 3a0a 2020  states(self):.  
+0001eab0: 2020 2020 2020 2222 2252 6561 6420 7374        """Read st
+0001eac0: 6174 6573 2061 7420 3c72 6f6f 742f 3f2f  ates at <root/?/
+0001ead0: 3e20 616e 6420 7061 7273 6520 746f 2064  > and parse to d
+0001eae0: 6963 7420 6f66 2078 722e 4461 7461 4172  ict of xr.DataAr
+0001eaf0: 7261 7922 2222 0a20 2020 2020 2020 2069  ray""".        i
+0001eb00: 6620 6e6f 7420 7365 6c66 2e5f 7772 6974  f not self._writ
+0001eb10: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+0001eb20: 2073 7461 7274 2066 7265 7368 2069 6e20   start fresh in 
+0001eb30: 7265 6164 2d6f 6e6c 7920 6d6f 6465 0a20  read-only mode. 
+0001eb40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001eb50: 5f73 7461 7465 7320 3d20 6469 6374 2829  _states = dict()
+0001eb60: 0a20 2020 2020 2020 2023 2072 6169 7365  .        # raise
+0001eb70: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
+0001eb80: 7272 6f72 2829 0a0a 2020 2020 6465 6620  rror()..    def 
+0001eb90: 7772 6974 655f 7374 6174 6573 2873 656c  write_states(sel
+0001eba0: 6629 3a0a 2020 2020 2020 2020 2222 2277  f):.        """w
+0001ebb0: 7269 7465 2073 7461 7465 7320 6174 203c  rite states at <
+0001ebc0: 726f 6f74 2f3f 2f3e 2069 6e20 6d6f 6465  root/?/> in mode
+0001ebd0: 6c20 7265 6164 7920 666f 726d 6174 2222  l ready format""
+0001ebe0: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+0001ebf0: 2073 656c 662e 5f77 7269 7465 3a0a 2020   self._write:.  
+0001ec00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001ec10: 494f 4572 726f 7228 224d 6f64 656c 206f  IOError("Model o
+0001ec20: 7065 6e65 6420 696e 2072 6561 642d 6f6e  pened in read-on
+0001ec30: 6c79 206d 6f64 6522 290a 2020 2020 2020  ly mode").      
+0001ec40: 2020 2320 7261 6973 6520 4e6f 7449 6d70    # raise NotImp
+0001ec50: 6c65 6d65 6e74 6564 4572 726f 7228 290a  lementedError().
+0001ec60: 0a20 2020 2064 6566 2072 6561 645f 7265  .    def read_re
+0001ec70: 7375 6c74 7328 7365 6c66 293a 0a20 2020  sults(self):.   
+0001ec80: 2020 2020 2022 2222 5265 6164 2072 6573       """Read res
+0001ec90: 756c 7473 2061 7420 3c72 6f6f 742f 3f2f  ults at <root/?/
+0001eca0: 3e20 616e 6420 7061 7273 6520 746f 2064  > and parse to d
+0001ecb0: 6963 7420 6f66 2078 722e 4461 7461 4172  ict of xr.DataAr
+0001ecc0: 7261 792f 7872 2e44 6174 6173 6574 2222  ray/xr.Dataset""
+0001ecd0: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+0001ece0: 2073 656c 662e 5f77 7269 7465 3a0a 2020   self._write:.  
+0001ecf0: 2020 2020 2020 2020 2020 2320 7374 6172            # star
+0001ed00: 7420 6672 6573 6820 696e 2072 6561 642d  t fresh in read-
+0001ed10: 6f6e 6c79 206d 6f64 650a 2020 2020 2020  only mode.      
+0001ed20: 2020 2020 2020 7365 6c66 2e5f 7265 7375        self._resu
+0001ed30: 6c74 7320 3d20 6469 6374 2829 0a0a 2020  lts = dict()..  
+0001ed40: 2020 2020 2020 6f75 7470 7574 5f64 6972        output_dir
+0001ed50: 203d 2022 220a 2020 2020 2020 2020 6966   = "".        if
+0001ed60: 2073 656c 662e 6765 745f 636f 6e66 6967   self.get_config
+0001ed70: 2822 6469 725f 6f75 7470 7574 2229 2069  ("dir_output") i
+0001ed80: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0001ed90: 2020 2020 2020 2020 6f75 7470 7574 5f64          output_d
+0001eda0: 6972 203d 2073 656c 662e 6765 745f 636f  ir = self.get_co
+0001edb0: 6e66 6967 2822 6469 725f 6f75 7470 7574  nfig("dir_output
+0001edc0: 2229 0a0a 2020 2020 2020 2020 2320 5265  ")..        # Re
+0001edd0: 6164 2067 7269 6464 6564 206e 6574 6364  ad gridded netcd
+0001ede0: 6620 286f 7574 7075 7420 7365 6374 696f  f (output sectio
+0001edf0: 6e29 0a20 2020 2020 2020 206e 635f 666e  n).        nc_fn
+0001ee00: 203d 2073 656c 662e 6765 745f 636f 6e66   = self.get_conf
+0001ee10: 6967 2822 6f75 7470 7574 2e70 6174 6822  ig("output.path"
+0001ee20: 2c20 6162 735f 7061 7468 3d54 7275 6529  , abs_path=True)
+0001ee30: 0a20 2020 2020 2020 206e 635f 666e 203d  .        nc_fn =
+0001ee40: 206e 635f 666e 2e70 6172 656e 7420 2f20   nc_fn.parent / 
+0001ee50: 6f75 7470 7574 5f64 6972 202f 206e 635f  output_dir / nc_
+0001ee60: 666e 2e6e 616d 6520 6966 206e 635f 666e  fn.name if nc_fn
+0001ee70: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+0001ee80: 6520 6e63 5f66 6e0a 2020 2020 2020 2020  e nc_fn.        
+0001ee90: 6966 206e 635f 666e 2069 7320 6e6f 7420  if nc_fn is not 
+0001eea0: 4e6f 6e65 2061 6e64 2069 7366 696c 6528  None and isfile(
+0001eeb0: 6e63 5f66 6e29 3a0a 2020 2020 2020 2020  nc_fn):.        
+0001eec0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0001eed0: 696e 666f 2866 2252 6561 6420 7265 7375  info(f"Read resu
+0001eee0: 6c74 7320 6672 6f6d 207b 6e63 5f66 6e7d  lts from {nc_fn}
+0001eef0: 2229 0a20 2020 2020 2020 2020 2020 2064  ").            d
+0001ef00: 7320 3d20 7872 2e6f 7065 6e5f 6461 7461  s = xr.open_data
+0001ef10: 7365 7428 6e63 5f66 6e2c 2063 6875 6e6b  set(nc_fn, chunk
+0001ef20: 733d 7b22 7469 6d65 223a 2033 307d 2c20  s={"time": 30}, 
+0001ef30: 6465 636f 6465 5f63 6f6f 7264 733d 2261  decode_coords="a
+0001ef40: 6c6c 2229 0a20 2020 2020 2020 2020 2020  ll").           
+0001ef50: 2023 2054 4f44 4f20 3f20 616c 6967 6e20   # TODO ? align 
+0001ef60: 636f 6f72 6473 206e 616d 6573 2061 6e64  coords names and
+0001ef70: 2076 616c 7565 7320 6f66 2072 6573 756c   values of resul
+0001ef80: 7473 206e 6320 7769 7468 2073 7461 7469  ts nc with stati
+0001ef90: 636d 6170 730a 2020 2020 2020 2020 2020  cmaps.          
+0001efa0: 2020 7365 6c66 2e73 6574 5f72 6573 756c    self.set_resul
+0001efb0: 7473 2864 732c 206e 616d 653d 226f 7574  ts(ds, name="out
+0001efc0: 7075 7422 290a 0a20 2020 2020 2020 2023  put")..        #
+0001efd0: 2052 6561 6420 7363 616c 6172 206e 6574   Read scalar net
+0001efe0: 6364 6620 286e 6574 6364 6620 7365 6374  cdf (netcdf sect
+0001eff0: 696f 6e29 0a20 2020 2020 2020 206e 6373  ion).        ncs
+0001f000: 5f66 6e20 3d20 7365 6c66 2e67 6574 5f63  _fn = self.get_c
+0001f010: 6f6e 6669 6728 226e 6574 6364 662e 7061  onfig("netcdf.pa
+0001f020: 7468 222c 2061 6273 5f70 6174 683d 5472  th", abs_path=Tr
+0001f030: 7565 290a 2020 2020 2020 2020 6e63 735f  ue).        ncs_
+0001f040: 666e 203d 2028 0a20 2020 2020 2020 2020  fn = (.         
+0001f050: 2020 206e 6373 5f66 6e2e 7061 7265 6e74     ncs_fn.parent
+0001f060: 202f 206f 7574 7075 745f 6469 7220 2f20   / output_dir / 
+0001f070: 6e63 735f 666e 2e6e 616d 6520 6966 206e  ncs_fn.name if n
+0001f080: 6373 5f66 6e20 6973 206e 6f74 204e 6f6e  cs_fn is not Non
+0001f090: 6520 656c 7365 206e 6373 5f66 6e0a 2020  e else ncs_fn.  
+0001f0a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001f0b0: 6966 206e 6373 5f66 6e20 6973 206e 6f74  if ncs_fn is not
+0001f0c0: 204e 6f6e 6520 616e 6420 6973 6669 6c65   None and isfile
+0001f0d0: 286e 6373 5f66 6e29 3a0a 2020 2020 2020  (ncs_fn):.      
+0001f0e0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0001f0f0: 722e 696e 666f 2866 2252 6561 6420 7265  r.info(f"Read re
+0001f100: 7375 6c74 7320 6672 6f6d 207b 6e63 735f  sults from {ncs_
+0001f110: 666e 7d22 290a 2020 2020 2020 2020 2020  fn}").          
+0001f120: 2020 6473 203d 2078 722e 6f70 656e 5f64    ds = xr.open_d
+0001f130: 6174 6173 6574 286e 6373 5f66 6e2c 2063  ataset(ncs_fn, c
+0001f140: 6875 6e6b 733d 7b22 7469 6d65 223a 2033  hunks={"time": 3
+0001f150: 307d 290a 2020 2020 2020 2020 2020 2020  0}).            
+0001f160: 7365 6c66 2e73 6574 5f72 6573 756c 7473  self.set_results
+0001f170: 2864 732c 206e 616d 653d 226e 6574 6364  (ds, name="netcd
+0001f180: 6622 290a 0a20 2020 2020 2020 2023 2052  f")..        # R
+0001f190: 6561 6420 6373 7620 7469 6d65 7365 7269  ead csv timeseri
+0001f1a0: 6573 2028 6373 7620 7365 6374 696f 6e29  es (csv section)
+0001f1b0: 0a20 2020 2020 2020 2063 7376 5f66 6e20  .        csv_fn 
+0001f1c0: 3d20 7365 6c66 2e67 6574 5f63 6f6e 6669  = self.get_confi
+0001f1d0: 6728 2263 7376 2e70 6174 6822 2c20 6162  g("csv.path", ab
+0001f1e0: 735f 7061 7468 3d54 7275 6529 0a20 2020  s_path=True).   
+0001f1f0: 2020 2020 2063 7376 5f66 6e20 3d20 280a       csv_fn = (.
+0001f200: 2020 2020 2020 2020 2020 2020 6373 765f              csv_
+0001f210: 666e 2e70 6172 656e 7420 2f20 6f75 7470  fn.parent / outp
+0001f220: 7574 5f64 6972 202f 2063 7376 5f66 6e2e  ut_dir / csv_fn.
+0001f230: 6e61 6d65 2069 6620 6373 765f 666e 2069  name if csv_fn i
+0001f240: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+0001f250: 6373 765f 666e 0a20 2020 2020 2020 2029  csv_fn.        )
+0001f260: 0a20 2020 2020 2020 2069 6620 6373 765f  .        if csv_
+0001f270: 666e 2069 7320 6e6f 7420 4e6f 6e65 2061  fn is not None a
+0001f280: 6e64 2069 7366 696c 6528 6373 765f 666e  nd isfile(csv_fn
+0001f290: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+0001f2a0: 7376 5f64 6963 7420 3d20 7574 696c 732e  sv_dict = utils.
+0001f2b0: 7265 6164 5f63 7376 5f72 6573 756c 7473  read_csv_results
+0001f2c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001f2d0: 2020 6373 765f 666e 2c20 636f 6e66 6967    csv_fn, config
+0001f2e0: 3d73 656c 662e 636f 6e66 6967 2c20 6d61  =self.config, ma
+0001f2f0: 7073 3d73 656c 662e 7374 6174 6963 6d61  ps=self.staticma
+0001f300: 7073 0a20 2020 2020 2020 2020 2020 2029  ps.            )
+0001f310: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001f320: 206b 6579 2069 6e20 6373 765f 6469 6374   key in csv_dict
+0001f330: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f340: 2020 2320 4164 6420 746f 2072 6573 756c    # Add to resul
+0001f350: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+0001f360: 2020 2073 656c 662e 7365 745f 7265 7375     self.set_resu
+0001f370: 6c74 7328 6373 765f 6469 6374 5b66 227b  lts(csv_dict[f"{
+0001f380: 6b65 797d 225d 290a 0a20 2020 2064 6566  key}"])..    def
+0001f390: 2077 7269 7465 5f72 6573 756c 7473 2873   write_results(s
+0001f3a0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0001f3b0: 2277 7269 7465 2072 6573 756c 7473 2061  "write results a
+0001f3c0: 7420 3c72 6f6f 742f 3f2f 3e20 696e 206d  t <root/?/> in m
+0001f3d0: 6f64 656c 2072 6561 6479 2066 6f72 6d61  odel ready forma
+0001f3e0: 7422 2222 0a20 2020 2020 2020 2069 6620  t""".        if 
+0001f3f0: 6e6f 7420 7365 6c66 2e5f 7772 6974 653a  not self._write:
+0001f400: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001f410: 7365 2049 4f45 7272 6f72 2822 4d6f 6465  se IOError("Mode
+0001f420: 6c20 6f70 656e 6564 2069 6e20 7265 6164  l opened in read
+0001f430: 2d6f 6e6c 7920 6d6f 6465 2229 0a20 2020  -only mode").   
+0001f440: 2020 2020 2023 2072 6169 7365 204e 6f74       # raise Not
+0001f450: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
+0001f460: 2829 0a0a 2020 2020 6465 6620 7265 6164  ()..    def read
+0001f470: 5f69 6e74 626c 2873 656c 662c 202a 2a6b  _intbl(self, **k
+0001f480: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0001f490: 2222 2252 6561 6420 616e 6420 696e 7462  """Read and intb
+0001f4a0: 6c20 6669 6c65 7320 6174 203c 726f 6f74  l files at <root
+0001f4b0: 2f69 6e74 626c 3e20 616e 6420 7061 7273  /intbl> and pars
+0001f4c0: 6520 746f 2078 6172 7261 7922 2222 0a20  e to xarray""". 
+0001f4d0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0001f4e0: 6c66 2e5f 7772 6974 653a 0a20 2020 2020  lf._write:.     
+0001f4f0: 2020 2020 2020 2073 656c 662e 5f69 6e74         self._int
+0001f500: 626c 203d 2064 6963 7428 2920 2023 2073  bl = dict()  # s
+0001f510: 7461 7274 2066 7265 7368 2069 6e20 7265  tart fresh in re
+0001f520: 6164 2d6f 6e6c 7920 6d6f 6465 0a20 2020  ad-only mode.   
+0001f530: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0001f540: 2e5f 7265 6164 3a0a 2020 2020 2020 2020  ._read:.        
+0001f550: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0001f560: 696e 666f 2822 5265 6164 696e 6720 6465  info("Reading de
+0001f570: 6661 756c 7420 696e 7462 6c20 6669 6c65  fault intbl file
+0001f580: 732e 2229 0a20 2020 2020 2020 2020 2020  s.").           
+0001f590: 2066 6e73 203d 2067 6c6f 622e 676c 6f62   fns = glob.glob
+0001f5a0: 286a 6f69 6e28 4441 5441 4449 522c 2022  (join(DATADIR, "
+0001f5b0: 7766 6c6f 7722 2c20 2269 6e74 626c 222c  wflow", "intbl",
+0001f5c0: 2066 222a 2e74 626c 2229 290a 2020 2020   f"*.tbl")).    
+0001f5d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001f5e0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0001f5f0: 722e 696e 666f 2822 5265 6164 696e 6720  r.info("Reading 
+0001f600: 6d6f 6465 6c20 696e 7462 6c20 6669 6c65  model intbl file
+0001f610: 732e 2229 0a20 2020 2020 2020 2020 2020  s.").           
+0001f620: 2066 6e73 203d 2067 6c6f 622e 676c 6f62   fns = glob.glob
+0001f630: 286a 6f69 6e28 7365 6c66 2e72 6f6f 742c  (join(self.root,
+0001f640: 2022 696e 7462 6c22 2c20 6622 2a2e 7462   "intbl", f"*.tb
+0001f650: 6c22 2929 0a20 2020 2020 2020 2069 6620  l")).        if 
+0001f660: 6c65 6e28 666e 7329 203e 2030 3a0a 2020  len(fns) > 0:.  
+0001f670: 2020 2020 2020 2020 2020 666f 7220 666e            for fn
+0001f680: 2069 6e20 666e 733a 0a20 2020 2020 2020   in fns:.       
+0001f690: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+0001f6a0: 6261 7365 6e61 6d65 2866 6e29 2e73 706c  basename(fn).spl
+0001f6b0: 6974 2822 2e22 295b 305d 0a20 2020 2020  it(".")[0].     
+0001f6c0: 2020 2020 2020 2020 2020 2074 626c 203d             tbl =
+0001f6d0: 2070 642e 7265 6164 5f63 7376 2866 6e2c   pd.read_csv(fn,
+0001f6e0: 2064 656c 696d 5f77 6869 7465 7370 6163   delim_whitespac
+0001f6f0: 653d 5472 7565 2c20 6865 6164 6572 3d4e  e=True, header=N
+0001f700: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+0001f710: 2020 2020 2074 626c 2e63 6f6c 756d 6e73       tbl.columns
+0001f720: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0001f730: 2020 2020 2020 2020 2066 2265 7870 727b           f"expr{
+0001f740: 692b 317d 2220 6966 2069 202b 2031 203c  i+1}" if i + 1 <
+0001f750: 206c 656e 2874 626c 2e63 6f6c 756d 6e73   len(tbl.columns
+0001f760: 2920 656c 7365 2022 7661 6c75 6522 0a20  ) else "value". 
+0001f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f780: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+0001f790: 6528 6c65 6e28 7462 6c2e 636f 6c75 6d6e  e(len(tbl.column
+0001f7a0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+0001f7b0: 2020 2020 5d20 2023 2072 656e 616d 6520      ]  # rename 
+0001f7c0: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
+0001f7d0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+0001f7e0: 5f69 6e74 626c 2874 626c 2c20 6e61 6d65  _intbl(tbl, name
+0001f7f0: 3d6e 616d 6529 0a0a 2020 2020 6465 6620  =name)..    def 
+0001f800: 7772 6974 655f 696e 7462 6c28 7365 6c66  write_intbl(self
+0001f810: 293a 0a20 2020 2020 2020 2022 2222 5772  ):.        """Wr
+0001f820: 6974 6520 696e 7462 6c20 6174 203c 726f  ite intbl at <ro
+0001f830: 6f74 2f69 6e74 626c 3e20 696e 2050 4352  ot/intbl> in PCR
+0001f840: 6173 7465 7220 7461 626c 6520 666f 726d  aster table form
+0001f850: 6174 2e22 2222 0a20 2020 2020 2020 2069  at.""".        i
+0001f860: 6620 6e6f 7420 7365 6c66 2e5f 7772 6974  f not self._writ
+0001f870: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0001f880: 6169 7365 2049 4f45 7272 6f72 2822 4d6f  aise IOError("Mo
+0001f890: 6465 6c20 6f70 656e 6564 2069 6e20 7265  del opened in re
+0001f8a0: 6164 2d6f 6e6c 7920 6d6f 6465 2229 0a20  ad-only mode"). 
+0001f8b0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+0001f8c0: 6e74 626c 3a0a 2020 2020 2020 2020 2020  ntbl:.          
+0001f8d0: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
+0001f8e0: 666f 2822 5772 6974 696e 6720 696e 7462  fo("Writing intb
+0001f8f0: 6c20 6669 6c65 732e 2229 0a20 2020 2020  l files.").     
+0001f900: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
+0001f910: 696e 2073 656c 662e 696e 7462 6c3a 0a20  in self.intbl:. 
+0001f920: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001f930: 6e5f 6f75 7420 3d20 6a6f 696e 2873 656c  n_out = join(sel
+0001f940: 662e 726f 6f74 2c20 2269 6e74 626c 222c  f.root, "intbl",
+0001f950: 2066 227b 6e61 6d65 7d2e 7462 6c22 290a   f"{name}.tbl").
+0001f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f970: 7365 6c66 2e69 6e74 626c 5b6e 616d 655d  self.intbl[name]
+0001f980: 2e74 6f5f 6373 7628 666e 5f6f 7574 2c20  .to_csv(fn_out, 
+0001f990: 7365 703d 2220 222c 2069 6e64 6578 3d46  sep=" ", index=F
+0001f9a0: 616c 7365 2c20 6865 6164 6572 3d46 616c  alse, header=Fal
+0001f9b0: 7365 290a 0a20 2020 2064 6566 2073 6574  se)..    def set
+0001f9c0: 5f69 6e74 626c 2873 656c 662c 2064 662c  _intbl(self, df,
+0001f9d0: 206e 616d 6529 3a0a 2020 2020 2020 2020   name):.        
+0001f9e0: 2222 2241 6464 2069 6e74 626c 203c 7061  """Add intbl <pa
+0001f9f0: 6e64 6173 2e44 6174 6146 7261 6d65 3e20  ndas.DataFrame> 
+0001fa00: 746f 206d 6f64 656c 2e22 2222 0a20 2020  to model.""".   
+0001fa10: 2020 2020 2069 6620 6e6f 7420 2869 7369       if not (isi
+0001fa20: 6e73 7461 6e63 6528 6466 2c20 7064 2e44  nstance(df, pd.D
+0001fa30: 6174 6146 7261 6d65 2920 6f72 2069 7369  ataFrame) or isi
+0001fa40: 6e73 7461 6e63 6528 6466 2c20 7064 2e53  nstance(df, pd.S
+0001fa50: 6572 6965 7329 293a 0a20 2020 2020 2020  eries)):.       
+0001fa60: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0001fa70: 4572 726f 7228 2264 6620 7479 7065 206e  Error("df type n
+0001fa80: 6f74 2072 6563 6f67 6e69 7a65 642c 2073  ot recognized, s
+0001fa90: 686f 756c 6420 6265 2070 616e 6461 732e  hould be pandas.
+0001faa0: 4461 7461 4672 616d 652e 2229 0a20 2020  DataFrame.").   
+0001fab0: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
+0001fac0: 7365 6c66 2e5f 696e 7462 6c3a 0a20 2020  self._intbl:.   
+0001fad0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001fae0: 7365 6c66 2e5f 7772 6974 653a 0a20 2020  self._write:.   
+0001faf0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0001fb00: 7365 2049 4f45 7272 6f72 2866 2243 616e  se IOError(f"Can
+0001fb10: 6e6f 7420 6f76 6572 7772 6974 6520 696e  not overwrite in
+0001fb20: 7462 6c20 7b6e 616d 657d 2069 6e20 7265  tbl {name} in re
+0001fb30: 6164 2d6f 6e6c 7920 6d6f 6465 2229 0a20  ad-only mode"). 
+0001fb40: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001fb50: 7365 6c66 2e5f 7265 6164 3a0a 2020 2020  self._read:.    
+0001fb60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001fb70: 2e6c 6f67 6765 722e 7761 726e 696e 6728  .logger.warning(
+0001fb80: 6622 4f76 6572 7772 6974 696e 6720 696e  f"Overwriting in
+0001fb90: 7462 6c3a 207b 6e61 6d65 7d22 290a 2020  tbl: {name}").  
+0001fba0: 2020 2020 2020 7365 6c66 2e5f 696e 7462        self._intb
+0001fbb0: 6c5b 6e61 6d65 5d20 3d20 6466 0a0a 2020  l[name] = df..  
+0001fbc0: 2020 6465 6620 7265 6164 5f74 6162 6c65    def read_table
+0001fbd0: 7328 7365 6c66 2c20 2a2a 6b77 6172 6773  s(self, **kwargs
+0001fbe0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+0001fbf0: 6164 2074 6162 6c65 2066 696c 6573 2061  ad table files a
+0001fc00: 7420 3c72 6f6f 743e 2061 6e64 2070 6172  t <root> and par
+0001fc10: 7365 2074 6f20 6469 6374 206f 6620 6461  se to dict of da
+0001fc20: 7461 6672 616d 6573 2222 220a 2020 2020  taframes""".    
+0001fc30: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0001fc40: 5f77 7269 7465 3a0a 2020 2020 2020 2020  _write:.        
+0001fc50: 2020 2020 7365 6c66 2e5f 7461 626c 6573      self._tables
+0001fc60: 203d 2064 6963 7428 2920 2023 2073 7461   = dict()  # sta
+0001fc70: 7274 2066 7265 7368 2069 6e20 7265 6164  rt fresh in read
+0001fc80: 2d6f 6e6c 7920 6d6f 6465 0a0a 2020 2020  -only mode..    
+0001fc90: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0001fca0: 696e 666f 2822 5265 6164 696e 6720 6d6f  info("Reading mo
+0001fcb0: 6465 6c20 7461 626c 6520 6669 6c65 732e  del table files.
+0001fcc0: 2229 0a20 2020 2020 2020 2066 6e73 203d  ").        fns =
+0001fcd0: 2067 6c6f 622e 676c 6f62 286a 6f69 6e28   glob.glob(join(
+0001fce0: 7365 6c66 2e72 6f6f 742c 2066 222a 2e63  self.root, f"*.c
+0001fcf0: 7376 2229 290a 2020 2020 2020 2020 6966  sv")).        if
+0001fd00: 206c 656e 2866 6e73 2920 3e20 303a 0a20   len(fns) > 0:. 
+0001fd10: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+0001fd20: 6e20 696e 2066 6e73 3a0a 2020 2020 2020  n in fns:.      
+0001fd30: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+0001fd40: 2062 6173 656e 616d 6528 666e 292e 7370   basename(fn).sp
+0001fd50: 6c69 7428 222e 2229 5b30 5d0a 2020 2020  lit(".")[0].    
+0001fd60: 2020 2020 2020 2020 2020 2020 7462 6c20              tbl 
+0001fd70: 3d20 7064 2e72 6561 645f 6373 7628 666e  = pd.read_csv(fn
+0001fd80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001fd90: 2020 7365 6c66 2e73 6574 5f74 6162 6c65    self.set_table
+0001fda0: 7328 7462 6c2c 206e 616d 653d 6e61 6d65  s(tbl, name=name
+0001fdb0: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
+0001fdc0: 5f74 6162 6c65 7328 7365 6c66 293a 0a20  _tables(self):. 
+0001fdd0: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
+0001fde0: 7461 626c 6573 2061 7420 3c72 6f6f 743e  tables at <root>
+0001fdf0: 2e22 2222 0a20 2020 2020 2020 2069 6620  .""".        if 
+0001fe00: 6e6f 7420 7365 6c66 2e5f 7772 6974 653a  not self._write:
+0001fe10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001fe20: 7365 2049 4f45 7272 6f72 2822 4d6f 6465  se IOError("Mode
+0001fe30: 6c20 6f70 656e 6564 2069 6e20 7265 6164  l opened in read
+0001fe40: 2d6f 6e6c 7920 6d6f 6465 2229 0a20 2020  -only mode").   
+0001fe50: 2020 2020 2069 6620 7365 6c66 2e74 6162       if self.tab
+0001fe60: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+0001fe70: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
+0001fe80: 6f28 2257 7269 7469 6e67 2074 6162 6c65  o("Writing table
+0001fe90: 2066 696c 6573 2e22 290a 2020 2020 2020   files.").      
+0001fea0: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
+0001feb0: 6e20 7365 6c66 2e74 6162 6c65 733a 0a20  n self.tables:. 
+0001fec0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001fed0: 6e5f 6f75 7420 3d20 6a6f 696e 2873 656c  n_out = join(sel
+0001fee0: 662e 726f 6f74 2c20 6622 7b6e 616d 657d  f.root, f"{name}
+0001fef0: 2e63 7376 2229 0a20 2020 2020 2020 2020  .csv").         
+0001ff00: 2020 2020 2020 2073 656c 662e 7461 626c         self.tabl
+0001ff10: 6573 5b6e 616d 655d 2e74 6f5f 6373 7628  es[name].to_csv(
+0001ff20: 666e 5f6f 7574 2c20 7365 703d 222c 222c  fn_out, sep=",",
+0001ff30: 2069 6e64 6578 3d46 616c 7365 2c20 6865   index=False, he
+0001ff40: 6164 6572 3d54 7275 6529 0a0a 2020 2020  ader=True)..    
+0001ff50: 6465 6620 7365 745f 7461 626c 6573 2873  def set_tables(s
+0001ff60: 656c 662c 2064 662c 206e 616d 6529 3a0a  elf, df, name):.
+0001ff70: 2020 2020 2020 2020 2222 2241 6464 2074          """Add t
+0001ff80: 6162 6c65 203c 7061 6e64 6173 2e44 6174  able <pandas.Dat
+0001ff90: 6146 7261 6d65 3e20 746f 206d 6f64 656c  aFrame> to model
+0001ffa0: 2e22 2222 0a20 2020 2020 2020 2069 6620  .""".        if 
+0001ffb0: 6e6f 7420 2869 7369 6e73 7461 6e63 6528  not (isinstance(
+0001ffc0: 6466 2c20 7064 2e44 6174 6146 7261 6d65  df, pd.DataFrame
+0001ffd0: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
+0001ffe0: 6466 2c20 7064 2e53 6572 6965 7329 293a  df, pd.Series)):
+0001fff0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00020000: 7365 2056 616c 7565 4572 726f 7228 2264  se ValueError("d
+00020010: 6620 7479 7065 206e 6f74 2072 6563 6f67  f type not recog
+00020020: 6e69 7a65 642c 2073 686f 756c 6420 6265  nized, should be
+00020030: 2070 616e 6461 732e 4461 7461 4672 616d   pandas.DataFram
+00020040: 652e 2229 0a20 2020 2020 2020 2069 6620  e.").        if 
+00020050: 6e61 6d65 2069 6e20 7365 6c66 2e5f 7461  name in self._ta
+00020060: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+00020070: 2020 6966 206e 6f74 2073 656c 662e 5f77    if not self._w
+00020080: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
+00020090: 2020 2020 2020 7261 6973 6520 494f 4572        raise IOEr
+000200a0: 726f 7228 6622 4361 6e6e 6f74 206f 7665  ror(f"Cannot ove
+000200b0: 7277 7269 7465 2074 6162 6c65 207b 6e61  rwrite table {na
+000200c0: 6d65 7d20 696e 2072 6561 642d 6f6e 6c79  me} in read-only
+000200d0: 206d 6f64 6522 290a 2020 2020 2020 2020   mode").        
+000200e0: 2020 2020 656c 6966 2073 656c 662e 5f72      elif self._r
+000200f0: 6561 643a 0a20 2020 2020 2020 2020 2020  ead:.           
+00020100: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00020110: 2e77 6172 6e69 6e67 2866 224f 7665 7277  .warning(f"Overw
+00020120: 7269 7469 6e67 2074 6162 6c65 3a20 7b6e  riting table: {n
+00020130: 616d 657d 2229 0a20 2020 2020 2020 2073  ame}").        s
+00020140: 656c 662e 5f74 6162 6c65 735b 6e61 6d65  elf._tables[name
+00020150: 5d20 3d20 6466 0a0a 2020 2020 6465 6620  ] = df..    def 
+00020160: 5f63 6f6e 6669 6772 6561 6428 7365 6c66  _configread(self
+00020170: 2c20 666e 293a 0a20 2020 2020 2020 2077  , fn):.        w
+00020180: 6974 6820 636f 6465 6373 2e6f 7065 6e28  ith codecs.open(
+00020190: 666e 2c20 2272 222c 2065 6e63 6f64 696e  fn, "r", encodin
+000201a0: 673d 2275 7466 2d38 2229 2061 7320 663a  g="utf-8") as f:
+000201b0: 0a20 2020 2020 2020 2020 2020 2066 6469  .            fdi
+000201c0: 6374 203d 2074 6f6d 6c2e 6c6f 6164 2866  ct = toml.load(f
+000201d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000201e0: 2066 6469 6374 0a0a 2020 2020 6465 6620   fdict..    def 
+000201f0: 5f63 6f6e 6669 6777 7269 7465 2873 656c  _configwrite(sel
+00020200: 662c 2066 6e29 3a0a 2020 2020 2020 2020  f, fn):.        
+00020210: 7769 7468 2063 6f64 6563 732e 6f70 656e  with codecs.open
+00020220: 2866 6e2c 2022 7722 2c20 656e 636f 6469  (fn, "w", encodi
+00020230: 6e67 3d22 7574 662d 3822 2920 6173 2066  ng="utf-8") as f
+00020240: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
+00020250: 6d6c 2e64 756d 7028 7365 6c66 2e63 6f6e  ml.dump(self.con
+00020260: 6669 672c 2066 290a 0a20 2020 2023 2320  fig, f)..    ## 
+00020270: 5746 4c4f 5720 7370 6563 6966 6963 2064  WFLOW specific d
+00020280: 6174 6120 616e 6420 6d65 7468 6f64 730a  ata and methods.
+00020290: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+000202a0: 2020 2064 6566 2069 6e74 626c 2873 656c     def intbl(sel
+000202b0: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
+000202c0: 6574 7572 6e73 2061 2064 6963 7469 6f6e  eturns a diction
+000202d0: 6172 7920 6f66 2070 616e 6461 732e 4461  ary of pandas.Da
+000202e0: 7461 4672 616d 6573 2072 6570 7265 7365  taFrames represe
+000202f0: 6e74 696e 6720 7468 6520 7766 6c6f 7720  nting the wflow 
+00020300: 696e 7462 6c20 6669 6c65 732e 2222 220a  intbl files.""".
+00020310: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00020320: 656c 662e 5f69 6e74 626c 3a0a 2020 2020  elf._intbl:.    
+00020330: 2020 2020 2020 2020 7365 6c66 2e72 6561          self.rea
+00020340: 645f 696e 7462 6c28 290a 2020 2020 2020  d_intbl().      
+00020350: 2020 7265 7475 726e 2073 656c 662e 5f69    return self._i
+00020360: 6e74 626c 0a0a 2020 2020 4070 726f 7065  ntbl..    @prope
+00020370: 7274 790a 2020 2020 2320 4d6f 7665 2074  rty.    # Move t
+00020380: 6f20 636f 7265 204d 6f64 656c 2041 5049  o core Model API
+00020390: 203f 0a20 2020 2064 6566 2074 6162 6c65   ?.    def table
+000203a0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+000203b0: 2022 2222 5265 7475 726e 7320 6120 6469   """Returns a di
+000203c0: 6374 696f 6e61 7279 206f 6620 7061 6e64  ctionary of pand
+000203d0: 6173 2e44 6174 6146 7261 6d65 7320 7265  as.DataFrames re
+000203e0: 7072 6573 656e 7469 6e67 2074 6865 2077  presenting the w
+000203f0: 666c 6f77 2069 6e74 626c 2066 696c 6573  flow intbl files
+00020400: 2e22 2222 0a20 2020 2020 2020 2069 6620  .""".        if 
+00020410: 6e6f 7420 7365 6c66 2e5f 7461 626c 6573  not self._tables
+00020420: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00020430: 6c66 2e72 6561 645f 7461 626c 6573 2829  lf.read_tables()
+00020440: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00020450: 7365 6c66 2e5f 7461 626c 6573 0a0a 2020  self._tables..  
+00020460: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00020470: 6465 6620 666c 7764 6972 2873 656c 6629  def flwdir(self)
+00020480: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00020490: 7572 6e73 2074 6865 2070 7966 6c77 6469  urns the pyflwdi
+000204a0: 722e 466c 7764 6972 5261 7374 6572 206f  r.FlwdirRaster o
+000204b0: 626a 6563 7420 7061 7273 6564 2066 726f  bject parsed fro
+000204c0: 6d20 7468 6520 7766 6c6f 7720 6c64 642e  m the wflow ldd.
+000204d0: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+000204e0: 656c 662e 5f66 6c77 6469 7220 6973 204e  elf._flwdir is N
+000204f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00020500: 2073 656c 662e 7365 745f 666c 7764 6972   self.set_flwdir
+00020510: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+00020520: 6e20 7365 6c66 2e5f 666c 7764 6972 0a0a  n self._flwdir..
+00020530: 2020 2020 6465 6620 7365 745f 666c 7764      def set_flwd
+00020540: 6972 2873 656c 662c 2066 7479 7065 3d22  ir(self, ftype="
+00020550: 696e 6665 7222 293a 0a20 2020 2020 2020  infer"):.       
+00020560: 2022 2222 5061 7273 6520 7079 666c 7764   """Parse pyflwd
+00020570: 6972 2e46 6c77 6469 7252 6173 7465 7220  ir.FlwdirRaster 
+00020580: 6f62 6a65 6374 2070 6172 7365 6420 6672  object parsed fr
+00020590: 6f6d 2074 6865 2077 666c 6f77 206c 6464  om the wflow ldd
+000205a0: 2222 220a 2020 2020 2020 2020 666c 7764  """.        flwd
+000205b0: 6972 5f6e 616d 6520 3d20 666c 7764 6972  ir_name = flwdir
+000205c0: 5f6e 616d 6520 3d20 7365 6c66 2e5f 4d41  _name = self._MA
+000205d0: 5053 5b22 666c 7764 6972 225d 0a20 2020  PS["flwdir"].   
+000205e0: 2020 2020 2073 656c 662e 5f66 6c77 6469       self._flwdi
+000205f0: 7220 3d20 666c 772e 666c 7764 6972 5f66  r = flw.flwdir_f
+00020600: 726f 6d5f 6461 280a 2020 2020 2020 2020  rom_da(.        
+00020610: 2020 2020 7365 6c66 2e73 7461 7469 636d      self.staticm
+00020620: 6170 735b 666c 7764 6972 5f6e 616d 655d  aps[flwdir_name]
+00020630: 2c0a 2020 2020 2020 2020 2020 2020 6674  ,.            ft
+00020640: 7970 653d 6674 7970 652c 0a20 2020 2020  ype=ftype,.     
+00020650: 2020 2020 2020 2063 6865 636b 5f66 7479         check_fty
+00020660: 7065 3d54 7275 652c 0a20 2020 2020 2020  pe=True,.       
+00020670: 2020 2020 206d 6173 6b3d 2873 656c 662e       mask=(self.
+00020680: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
+00020690: 5f4d 4150 535b 2262 6173 696e 7322 5d5d  _MAPS["basins"]]
+000206a0: 203e 2030 292c 0a20 2020 2020 2020 2029   > 0),.        )
+000206b0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+000206c0: 2020 2020 6465 6620 6261 7369 6e73 2873      def basins(s
+000206d0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+000206e0: 2252 6574 7572 6e73 2061 2062 6173 696e  "Returns a basin
+000206f0: 2873 2920 6765 6f6d 6574 7279 2061 7320  (s) geometry as 
+00020700: 6120 6765 6f70 616e 6461 732e 4765 6f44  a geopandas.GeoD
+00020710: 6174 6146 7261 6d65 2e22 2222 0a20 2020  ataFrame.""".   
+00020720: 2020 2020 2069 6620 2262 6173 696e 7322       if "basins"
+00020730: 2069 6e20 7365 6c66 2e73 7461 7469 6367   in self.staticg
+00020740: 656f 6d73 3a0a 2020 2020 2020 2020 2020  eoms:.          
+00020750: 2020 6764 6620 3d20 7365 6c66 2e73 7461    gdf = self.sta
+00020760: 7469 6367 656f 6d73 5b22 6261 7369 6e73  ticgeoms["basins
+00020770: 225d 0a20 2020 2020 2020 2065 6c69 6620  "].        elif 
+00020780: 7365 6c66 2e5f 4d41 5053 5b22 6261 7369  self._MAPS["basi
+00020790: 6e73 225d 2069 6e20 7365 6c66 2e73 7461  ns"] in self.sta
+000207a0: 7469 636d 6170 733a 0a20 2020 2020 2020  ticmaps:.       
+000207b0: 2020 2020 2067 6466 203d 2028 0a20 2020       gdf = (.   
+000207c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000207d0: 662e 7374 6174 6963 6d61 7073 5b73 656c  f.staticmaps[sel
+000207e0: 662e 5f4d 4150 535b 2262 6173 696e 7322  f._MAPS["basins"
+000207f0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+00020800: 2020 202e 7261 7374 6572 2e76 6563 746f     .raster.vecto
+00020810: 7269 7a65 2829 0a20 2020 2020 2020 2020  rize().         
+00020820: 2020 2020 2020 202e 7365 745f 696e 6465         .set_inde
+00020830: 7828 2276 616c 7565 2229 0a20 2020 2020  x("value").     
+00020840: 2020 2020 2020 2020 2020 202e 736f 7274             .sort
+00020850: 5f69 6e64 6578 2829 0a20 2020 2020 2020  _index().       
+00020860: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00020870: 2020 2067 6466 2e69 6e64 6578 2e6e 616d     gdf.index.nam
+00020880: 6520 3d20 7365 6c66 2e5f 4d41 5053 5b22  e = self._MAPS["
+00020890: 6261 7369 6e73 225d 0a20 2020 2020 2020  basins"].       
+000208a0: 2020 2020 2073 656c 662e 7365 745f 7374       self.set_st
+000208b0: 6174 6963 6765 6f6d 7328 6764 662c 206e  aticgeoms(gdf, n
+000208c0: 616d 653d 2262 6173 696e 7322 290a 2020  ame="basins").  
+000208d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000208e0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000208f0: 6765 722e 7761 726e 696e 6728 0a20 2020  ger.warning(.   
+00020900: 2020 2020 2020 2020 2020 2020 2066 2242               f"B
+00020910: 6173 696e 206d 6170 207b 7365 6c66 2e5f  asin map {self._
+00020920: 4d41 5053 5b27 6261 7369 6e73 275d 7d20  MAPS['basins']} 
+00020930: 6e6f 7420 666f 756e 6420 696e 2073 7461  not found in sta
+00020940: 7469 636d 6170 732e 220a 2020 2020 2020  ticmaps.".      
+00020950: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00020960: 2020 2020 6764 6620 3d20 4e6f 6e65 0a20      gdf = None. 
+00020970: 2020 2020 2020 2072 6574 7572 6e20 6764         return gd
+00020980: 660a 0a20 2020 2040 7072 6f70 6572 7479  f..    @property
+00020990: 0a20 2020 2064 6566 2072 6976 6572 7328  .    def rivers(
+000209a0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+000209b0: 2222 5265 7475 726e 7320 6120 7269 7665  ""Returns a rive
+000209c0: 7220 6765 6f6d 6574 7279 2061 7320 6120  r geometry as a 
+000209d0: 6765 6f70 616e 6461 732e 4765 6f44 6174  geopandas.GeoDat
+000209e0: 6146 7261 6d65 2e20 4966 2061 7661 696c  aFrame. If avail
+000209f0: 6162 6c65 2c20 7468 650a 2020 2020 2020  able, the.      
+00020a00: 2020 7374 7265 616d 206f 7264 6572 2061    stream order a
+00020a10: 6e64 2075 7073 7472 6561 6d20 6172 6561  nd upstream area
+00020a20: 2076 616c 7565 7320 6172 6520 6164 6465   values are adde
+00020a30: 6420 746f 2074 6865 2067 656f 6d65 7472  d to the geometr
+00020a40: 7920 7072 6f70 6572 7469 6573 2e0a 2020  y properties..  
+00020a50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00020a60: 2020 6966 2022 7269 7665 7273 2220 696e    if "rivers" in
+00020a70: 2073 656c 662e 7374 6174 6963 6765 6f6d   self.staticgeom
+00020a80: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
+00020a90: 6466 203d 2073 656c 662e 7374 6174 6963  df = self.static
+00020aa0: 6765 6f6d 735b 2272 6976 6572 7322 5d0a  geoms["rivers"].
+00020ab0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00020ac0: 662e 5f4d 4150 535b 2272 6976 6d73 6b22  f._MAPS["rivmsk"
+00020ad0: 5d20 696e 2073 656c 662e 7374 6174 6963  ] in self.static
+00020ae0: 6d61 7073 3a0a 2020 2020 2020 2020 2020  maps:.          
+00020af0: 2020 7269 766d 736b 203d 2073 656c 662e    rivmsk = self.
+00020b00: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
+00020b10: 5f4d 4150 535b 2272 6976 6d73 6b22 5d5d  _MAPS["rivmsk"]]
+00020b20: 2e76 616c 7565 7320 213d 2030 0a20 2020  .values != 0.   
+00020b30: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+00020b40: 2069 6620 7468 6572 6520 6172 6520 7269   if there are ri
+00020b50: 7665 7220 6365 6c6c 7320 696e 2074 6865  ver cells in the
+00020b60: 206d 6f64 656c 2062 6566 6f72 6520 636f   model before co
+00020b70: 6e74 696e 7569 6e67 0a20 2020 2020 2020  ntinuing.       
+00020b80: 2020 2020 2069 6620 6e70 2e61 6e79 2872       if np.any(r
+00020b90: 6976 6d73 6b29 3a0a 2020 2020 2020 2020  ivmsk):.        
+00020ba0: 2020 2020 2020 2020 2320 6164 6420 7374          # add st
+00020bb0: 7265 616d 206f 7264 6572 2027 7374 726f  ream order 'stro
+00020bc0: 7264 2720 636f 6c75 6d6e 0a20 2020 2020  rd' column.     
+00020bd0: 2020 2020 2020 2020 2020 2073 7472 6f72             stror
+00020be0: 6420 3d20 7365 6c66 2e66 6c77 6469 722e  d = self.flwdir.
+00020bf0: 7374 7265 616d 5f6f 7264 6572 286d 6173  stream_order(mas
+00020c00: 6b3d 7269 766d 736b 290a 2020 2020 2020  k=rivmsk).      
+00020c10: 2020 2020 2020 2020 2020 6665 6174 7320            feats 
+00020c20: 3d20 7365 6c66 2e66 6c77 6469 722e 7374  = self.flwdir.st
+00020c30: 7265 616d 7328 6d61 736b 3d72 6976 6d73  reams(mask=rivms
+00020c40: 6b2c 2073 7472 6f72 643d 7374 726f 7264  k, strord=strord
+00020c50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020c60: 2020 6764 6620 3d20 6770 642e 4765 6f44    gdf = gpd.GeoD
+00020c70: 6174 6146 7261 6d65 2e66 726f 6d5f 6665  ataFrame.from_fe
+00020c80: 6174 7572 6573 2866 6561 7473 290a 2020  atures(feats).  
+00020c90: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+00020ca0: 662e 6372 7320 3d20 7079 7072 6f6a 2e43  f.crs = pyproj.C
+00020cb0: 5253 2e66 726f 6d5f 7573 6572 5f69 6e70  RS.from_user_inp
+00020cc0: 7574 2873 656c 662e 6372 7329 0a20 2020  ut(self.crs).   
+00020cd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00020ce0: 662e 7365 745f 7374 6174 6963 6765 6f6d  f.set_staticgeom
+00020cf0: 7328 6764 662c 206e 616d 653d 2272 6976  s(gdf, name="riv
+00020d00: 6572 7322 290a 2020 2020 2020 2020 656c  ers").        el
+00020d10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00020d20: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
+00020d30: 696e 6728 224e 6f20 7269 7665 7220 6365  ing("No river ce
+00020d40: 6c6c 7320 6465 7465 6374 6564 2069 6e20  lls detected in 
+00020d50: 7468 6520 7365 6c65 6374 6564 2062 6173  the selected bas
+00020d60: 696e 2e22 290a 2020 2020 2020 2020 2020  in.").          
+00020d70: 2020 6764 6620 3d20 4e6f 6e65 0a20 2020    gdf = None.   
+00020d80: 2020 2020 2072 6574 7572 6e20 6764 660a       return gdf.
+00020d90: 0a20 2020 2064 6566 2063 6c69 705f 7374  .    def clip_st
+00020da0: 6174 6963 6d61 7073 280a 2020 2020 2020  aticmaps(.      
+00020db0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00020dc0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
+00020dd0: 6275 6666 6572 3d30 2c0a 2020 2020 2020  buffer=0,.      
+00020de0: 2020 616c 6967 6e3d 4e6f 6e65 2c0a 2020    align=None,.  
+00020df0: 2020 2020 2020 6372 733d 3433 3236 2c0a        crs=4326,.
+00020e00: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+00020e10: 2222 436c 6970 2073 7461 7469 636d 6170  ""Clip staticmap
+00020e20: 7320 746f 2073 7562 6261 7369 6e2e 0a0a  s to subbasin...
+00020e30: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00020e40: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00020e50: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7265  -----.        re
+00020e60: 6769 6f6e 203a 2064 6963 740a 2020 2020  gion : dict.    
+00020e70: 2020 2020 2020 2020 5365 6520 3a6d 6574          See :met
+00020e80: 683a 606d 6f64 656c 732e 7766 6c6f 772e  h:`models.wflow.
+00020e90: 5766 6c6f 774d 6f64 656c 2e73 6574 7570  WflowModel.setup
+00020ea0: 5f62 6173 656d 6170 7360 0a20 2020 2020  _basemaps`.     
+00020eb0: 2020 2062 7566 6665 7220 3a20 696e 742c     buffer : int,
+00020ec0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00020ed0: 2020 2020 2020 4275 6666 6572 2061 726f        Buffer aro
+00020ee0: 756e 6420 7375 6262 6173 696e 2069 6e20  und subbasin in 
+00020ef0: 6e75 6d62 6572 206f 6620 7069 7865 6c73  number of pixels
+00020f00: 2c20 6279 2064 6566 6175 6c74 2030 0a20  , by default 0. 
+00020f10: 2020 2020 2020 2061 6c69 676e 203a 2066         align : f
+00020f20: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0a20  loat, optional. 
+00020f30: 2020 2020 2020 2020 2020 2041 6c69 676e             Align
+00020f40: 2062 6f75 6e64 7320 6f66 2072 6567 696f   bounds of regio
+00020f50: 6e20 746f 2072 6173 7465 7220 7769 7468  n to raster with
+00020f60: 2072 6573 6f6c 7574 696f 6e20 3c61 6c69   resolution <ali
+00020f70: 676e 3e2c 2062 7920 6465 6661 756c 7420  gn>, by default 
+00020f80: 4e6f 6e65 0a20 2020 2020 2020 2063 7273  None.        crs
+00020f90: 3a20 696e 742c 206f 7074 696f 6e61 6c0a  : int, optional.
+00020fa0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+00020fb0: 756c 7420 6372 7320 6f66 2074 6865 2073  ult crs of the s
+00020fc0: 7461 7469 636d 6170 7320 746f 2063 6c69  taticmaps to cli
+00020fd0: 702e 0a0a 2020 2020 2020 2020 5265 7475  p...        Retu
+00020fe0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00020ff0: 2d2d 2d0a 2020 2020 2020 2020 7861 7272  ---.        xarr
+00021000: 6179 2e44 6174 6153 6574 0a20 2020 2020  ay.DataSet.     
+00021010: 2020 2020 2020 2043 6c69 7070 6564 2073         Clipped s
+00021020: 7461 7469 636d 6170 732e 0a20 2020 2020  taticmaps..     
+00021030: 2020 2022 2222 0a20 2020 2020 2020 2062     """.        b
+00021040: 6173 696e 735f 6e61 6d65 203d 2073 656c  asins_name = sel
+00021050: 662e 5f4d 4150 535b 2262 6173 696e 7322  f._MAPS["basins"
+00021060: 5d0a 2020 2020 2020 2020 666c 7764 6972  ].        flwdir
+00021070: 5f6e 616d 6520 3d20 7365 6c66 2e5f 4d41  _name = self._MA
+00021080: 5053 5b22 666c 7764 6972 225d 0a0a 2020  PS["flwdir"]..  
+00021090: 2020 2020 2020 6b69 6e64 2c20 7265 6769        kind, regi
+000210a0: 6f6e 203d 2068 7964 726f 6d74 2e77 6f72  on = hydromt.wor
+000210b0: 6b66 6c6f 7773 2e70 6172 7365 5f72 6567  kflows.parse_reg
+000210c0: 696f 6e28 7265 6769 6f6e 2c20 6c6f 6767  ion(region, logg
+000210d0: 6572 3d73 656c 662e 6c6f 6767 6572 290a  er=self.logger).
+000210e0: 2020 2020 2020 2020 2320 7472 616e 736c          # transl
+000210f0: 6174 6520 6261 7369 6e20 616e 6420 6f75  ate basin and ou
+00021100: 746c 6574 206b 696e 6473 2074 6f20 6765  tlet kinds to ge
+00021110: 6f6d 0a20 2020 2020 2020 2067 656f 6d20  om.        geom 
+00021120: 3d20 7265 6769 6f6e 2e67 6574 2822 6765  = region.get("ge
+00021130: 6f6d 222c 204e 6f6e 6529 0a20 2020 2020  om", None).     
+00021140: 2020 2062 626f 7820 3d20 7265 6769 6f6e     bbox = region
+00021150: 2e67 6574 2822 6262 6f78 222c 204e 6f6e  .get("bbox", Non
+00021160: 6529 0a20 2020 2020 2020 2069 6620 6b69  e).        if ki
+00021170: 6e64 2069 6e20 5b22 6261 7369 6e22 2c20  nd in ["basin", 
+00021180: 226f 7574 6c65 7422 2c20 2273 7562 6261  "outlet", "subba
+00021190: 7369 6e22 5d3a 0a20 2020 2020 2020 2020  sin"]:.         
+000211a0: 2020 2023 2073 7570 706c 7920 6262 6f78     # supply bbox
+000211b0: 2074 6f20 6176 6f69 6420 6765 7474 696e   to avoid gettin
+000211c0: 6720 6261 7369 6e20 626f 756e 6473 2066  g basin bounds f
+000211d0: 6972 7374 2077 6865 6e20 636c 6970 7069  irst when clippi
+000211e0: 6e67 2073 7562 6261 7369 6e73 0a20 2020  ng subbasins.   
+000211f0: 2020 2020 2020 2020 2069 6620 6b69 6e64           if kind
+00021200: 203d 3d20 2273 7562 6261 7369 6e22 2061   == "subbasin" a
+00021210: 6e64 2062 626f 7820 6973 204e 6f6e 653a  nd bbox is None:
+00021220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021230: 2072 6567 696f 6e2e 7570 6461 7465 2862   region.update(b
+00021240: 626f 783d 7365 6c66 2e62 6f75 6e64 7329  box=self.bounds)
+00021250: 0a20 2020 2020 2020 2020 2020 2067 656f  .            geo
+00021260: 6d2c 205f 203d 2068 7964 726f 6d74 2e77  m, _ = hydromt.w
+00021270: 6f72 6b66 6c6f 7773 2e67 6574 5f62 6173  orkflows.get_bas
+00021280: 696e 5f67 656f 6d65 7472 7928 0a20 2020  in_geometry(.   
+00021290: 2020 2020 2020 2020 2020 2020 2064 733d               ds=
+000212a0: 7365 6c66 2e73 7461 7469 636d 6170 732c  self.staticmaps,
+000212b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000212c0: 206c 6f67 6765 723d 7365 6c66 2e6c 6f67   logger=self.log
+000212d0: 6765 722c 0a20 2020 2020 2020 2020 2020  ger,.           
+000212e0: 2020 2020 206b 696e 643d 6b69 6e64 2c0a       kind=kind,.
+000212f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021300: 6261 7369 6e73 5f6e 616d 653d 6261 7369  basins_name=basi
+00021310: 6e73 5f6e 616d 652c 0a20 2020 2020 2020  ns_name,.       
+00021320: 2020 2020 2020 2020 2066 6c77 6469 725f           flwdir_
+00021330: 6e61 6d65 3d66 6c77 6469 725f 6e61 6d65  name=flwdir_name
+00021340: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00021350: 2020 2a2a 7265 6769 6f6e 2c0a 2020 2020    **region,.    
+00021360: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00021370: 2020 2320 636c 6970 2062 6173 6564 206f    # clip based o
+00021380: 6e20 7375 6262 6173 696e 2061 7267 732c  n subbasin args,
+00021390: 2067 656f 6d20 6f72 2062 626f 780a 2020   geom or bbox.  
+000213a0: 2020 2020 2020 6966 2067 656f 6d20 6973        if geom is
+000213b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000213c0: 2020 2020 2020 2064 735f 7374 6174 6963         ds_static
+000213d0: 6d61 7073 203d 2073 656c 662e 7374 6174  maps = self.stat
+000213e0: 6963 6d61 7073 2e72 6173 7465 722e 636c  icmaps.raster.cl
+000213f0: 6970 5f67 656f 6d28 0a20 2020 2020 2020  ip_geom(.       
+00021400: 2020 2020 2020 2020 2067 656f 6d2c 2061           geom, a
+00021410: 6c69 676e 3d61 6c69 676e 2c20 6275 6666  lign=align, buff
+00021420: 6572 3d62 7566 6665 720a 2020 2020 2020  er=buffer.      
+00021430: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00021440: 2020 2020 6473 5f73 7461 7469 636d 6170      ds_staticmap
+00021450: 732e 636f 6f72 6473 5b22 6d61 736b 225d  s.coords["mask"]
+00021460: 203d 2064 735f 7374 6174 6963 6d61 7073   = ds_staticmaps
+00021470: 2e72 6173 7465 722e 6765 6f6d 6574 7279  .raster.geometry
+00021480: 5f6d 6173 6b28 6765 6f6d 290a 2020 2020  _mask(geom).    
+00021490: 2020 2020 2020 2020 6473 5f73 7461 7469          ds_stati
+000214a0: 636d 6170 735b 6261 7369 6e73 5f6e 616d  cmaps[basins_nam
+000214b0: 655d 203d 2064 735f 7374 6174 6963 6d61  e] = ds_staticma
+000214c0: 7073 5b62 6173 696e 735f 6e61 6d65 5d2e  ps[basins_name].
+000214d0: 7768 6572 6528 0a20 2020 2020 2020 2020  where(.         
+000214e0: 2020 2020 2020 2064 735f 7374 6174 6963         ds_static
+000214f0: 6d61 7073 2e63 6f6f 7264 735b 226d 6173  maps.coords["mas
+00021500: 6b22 5d2c 2073 656c 662e 7374 6174 6963  k"], self.static
+00021510: 6d61 7073 5b62 6173 696e 735f 6e61 6d65  maps[basins_name
+00021520: 5d2e 7261 7374 6572 2e6e 6f64 6174 610a  ].raster.nodata.
+00021530: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00021540: 2020 2020 2020 2020 2020 6473 5f73 7461            ds_sta
+00021550: 7469 636d 6170 735b 6261 7369 6e73 5f6e  ticmaps[basins_n
+00021560: 616d 655d 2e61 7474 7273 2e75 7064 6174  ame].attrs.updat
+00021570: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00021580: 2020 205f 4669 6c6c 5661 6c75 653d 7365     _FillValue=se
+00021590: 6c66 2e73 7461 7469 636d 6170 735b 6261  lf.staticmaps[ba
+000215a0: 7369 6e73 5f6e 616d 655d 2e72 6173 7465  sins_name].raste
+000215b0: 722e 6e6f 6461 7461 0a20 2020 2020 2020  r.nodata.       
+000215c0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+000215d0: 6c69 6620 6262 6f78 2069 7320 6e6f 7420  lif bbox is not 
+000215e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000215f0: 2020 6473 5f73 7461 7469 636d 6170 7320    ds_staticmaps 
+00021600: 3d20 7365 6c66 2e73 7461 7469 636d 6170  = self.staticmap
+00021610: 732e 7261 7374 6572 2e63 6c69 705f 6262  s.raster.clip_bb
+00021620: 6f78 280a 2020 2020 2020 2020 2020 2020  ox(.            
+00021630: 2020 2020 6262 6f78 2c20 616c 6967 6e3d      bbox, align=
+00021640: 616c 6967 6e2c 2062 7566 6665 723d 6275  align, buffer=bu
+00021650: 6666 6572 0a20 2020 2020 2020 2020 2020  ffer.           
+00021660: 2029 0a0a 2020 2020 2020 2020 2320 5570   )..        # Up
+00021670: 6461 7465 2066 6c77 6469 7220 7374 6174  date flwdir stat
+00021680: 6963 6d61 7073 2061 6e64 2073 7461 7469  icmaps and stati
+00021690: 6367 656f 6d73 0a20 2020 2020 2020 2069  cgeoms.        i
+000216a0: 6620 7365 6c66 2e63 7273 2069 7320 4e6f  f self.crs is No
+000216b0: 6e65 2061 6e64 2063 7273 2069 7320 6e6f  ne and crs is no
+000216c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000216d0: 2020 2020 7365 6c66 2e73 6574 5f63 7273      self.set_crs
+000216e0: 2863 7273 290a 0a20 2020 2020 2020 2073  (crs)..        s
+000216f0: 656c 662e 5f73 7461 7469 636d 6170 7320  elf._staticmaps 
+00021700: 3d20 7872 2e44 6174 6173 6574 2829 0a20  = xr.Dataset(). 
+00021710: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+00021720: 7374 6174 6963 6d61 7073 2864 735f 7374  staticmaps(ds_st
+00021730: 6174 6963 6d61 7073 290a 0a20 2020 2020  aticmaps)..     
+00021740: 2020 2023 2061 6464 2070 6974 7320 6174     # add pits at
+00021750: 2065 6467 6573 2061 6674 6572 2063 6c69   edges after cli
+00021760: 7070 696e 670a 2020 2020 2020 2020 7365  pping.        se
+00021770: 6c66 2e5f 666c 7764 6972 203d 204e 6f6e  lf._flwdir = Non
+00021780: 6520 2023 206d 616b 6520 7375 7265 206f  e  # make sure o
+00021790: 6c64 2066 6c77 6469 7220 6f62 6a65 6374  ld flwdir object
+000217a0: 2069 7320 7265 6d6f 7665 640a 2020 2020   is removed.    
+000217b0: 2020 2020 7365 6c66 2e73 7461 7469 636d      self.staticm
+000217c0: 6170 735b 7365 6c66 2e5f 4d41 5053 5b22  aps[self._MAPS["
+000217d0: 666c 7764 6972 225d 5d2e 6461 7461 203d  flwdir"]].data =
+000217e0: 2073 656c 662e 666c 7764 6972 2e74 6f5f   self.flwdir.to_
+000217f0: 6172 7261 7928 226c 6464 2229 0a0a 2020  array("ldd")..  
+00021800: 2020 2020 2020 2320 5265 696e 6974 696c        # Reinitil
+00021810: 6961 7365 2073 7461 7469 6367 656f 6d73  iase staticgeoms
+00021820: 2061 6e64 2072 652d 6372 6561 7465 2062   and re-create b
+00021830: 6173 696e 732f 7269 7665 7273 0a20 2020  asins/rivers.   
+00021840: 2020 2020 2073 656c 662e 5f73 7461 7469       self._stati
+00021850: 6367 656f 6d73 203d 2064 6963 7428 290a  cgeoms = dict().
+00021860: 2020 2020 2020 2020 2320 7365 6c66 2e62          # self.b
+00021870: 6173 696e 730a 2020 2020 2020 2020 2320  asins.        # 
+00021880: 7365 6c66 2e72 6976 6572 730a 2020 2020  self.rivers.    
+00021890: 2020 2020 2320 6e6f 7720 7374 6174 6963      # now static
+000218a0: 6765 6f6d 7320 6c69 6e6b 7320 746f 2067  geoms links to g
+000218b0: 656f 6d73 2077 6869 6368 2064 6f65 7320  eoms which does 
+000218c0: 6e6f 7420 6578 6973 7420 696e 2065 7665  not exist in eve
+000218d0: 7279 2068 7964 726f 6d74 2076 6572 7369  ry hydromt versi
+000218e0: 6f6e 0a20 2020 2020 2020 2023 2072 656d  on.        # rem
+000218f0: 6f76 6520 7768 656e 2075 7064 6174 696e  ove when updatin
+00021900: 6720 7766 6c6f 7720 746f 206e 6577 206f  g wflow to new o
+00021910: 626a 6563 7473 0a20 2020 2020 2020 2023  bjects.        #
+00021920: 2042 6173 696e 2073 6861 7065 0a20 2020   Basin shape.   
+00021930: 2020 2020 2062 6173 696e 7320 3d20 280a       basins = (.
+00021940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00021950: 2e73 7461 7469 636d 6170 735b 6261 7369  .staticmaps[basi
+00021960: 6e73 5f6e 616d 655d 0a20 2020 2020 2020  ns_name].       
+00021970: 2020 2020 202e 7261 7374 6572 2e76 6563       .raster.vec
+00021980: 746f 7269 7a65 2829 0a20 2020 2020 2020  torize().       
+00021990: 2020 2020 202e 7365 745f 696e 6465 7828       .set_index(
+000219a0: 2276 616c 7565 2229 0a20 2020 2020 2020  "value").       
+000219b0: 2020 2020 202e 736f 7274 5f69 6e64 6578       .sort_index
+000219c0: 2829 0a20 2020 2020 2020 2029 0a20 2020  ().        ).   
+000219d0: 2020 2020 2062 6173 696e 732e 696e 6465       basins.inde
+000219e0: 782e 6e61 6d65 203d 2062 6173 696e 735f  x.name = basins_
+000219f0: 6e61 6d65 0a20 2020 2020 2020 2073 656c  name.        sel
+00021a00: 662e 7365 745f 7374 6174 6963 6765 6f6d  f.set_staticgeom
+00021a10: 7328 6261 7369 6e73 2c20 6e61 6d65 3d22  s(basins, name="
+00021a20: 6261 7369 6e73 2229 0a0a 2020 2020 2020  basins")..      
+00021a30: 2020 7269 766d 736b 203d 2073 656c 662e    rivmsk = self.
+00021a40: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
+00021a50: 5f4d 4150 535b 2272 6976 6d73 6b22 5d5d  _MAPS["rivmsk"]]
+00021a60: 2e76 616c 7565 7320 213d 2030 0a20 2020  .values != 0.   
+00021a70: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+00021a80: 7468 6572 6520 6172 6520 7269 7665 7220  there are river 
+00021a90: 6365 6c6c 7320 696e 2074 6865 206d 6f64  cells in the mod
+00021aa0: 656c 2062 6566 6f72 6520 636f 6e74 696e  el before contin
+00021ab0: 7569 6e67 0a20 2020 2020 2020 2069 6620  uing.        if 
+00021ac0: 6e70 2e61 6e79 2872 6976 6d73 6b29 3a0a  np.any(rivmsk):.
+00021ad0: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
+00021ae0: 6420 7374 7265 616d 206f 7264 6572 2027  d stream order '
+00021af0: 7374 726f 7264 2720 636f 6c75 6d6e 0a20  strord' column. 
+00021b00: 2020 2020 2020 2020 2020 2073 7472 6f72             stror
+00021b10: 6420 3d20 7365 6c66 2e66 6c77 6469 722e  d = self.flwdir.
+00021b20: 7374 7265 616d 5f6f 7264 6572 286d 6173  stream_order(mas
+00021b30: 6b3d 7269 766d 736b 290a 2020 2020 2020  k=rivmsk).      
+00021b40: 2020 2020 2020 6665 6174 7320 3d20 7365        feats = se
+00021b50: 6c66 2e66 6c77 6469 722e 7374 7265 616d  lf.flwdir.stream
+00021b60: 7328 6d61 736b 3d72 6976 6d73 6b2c 2073  s(mask=rivmsk, s
+00021b70: 7472 6f72 643d 7374 726f 7264 290a 2020  trord=strord).  
+00021b80: 2020 2020 2020 2020 2020 6764 6620 3d20            gdf = 
+00021b90: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
+00021ba0: 2e66 726f 6d5f 6665 6174 7572 6573 2866  .from_features(f
+00021bb0: 6561 7473 290a 2020 2020 2020 2020 2020  eats).          
+00021bc0: 2020 6764 662e 6372 7320 3d20 7079 7072    gdf.crs = pypr
+00021bd0: 6f6a 2e43 5253 2e66 726f 6d5f 7573 6572  oj.CRS.from_user
+00021be0: 5f69 6e70 7574 2873 656c 662e 6372 7329  _input(self.crs)
+00021bf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00021c00: 662e 7365 745f 7374 6174 6963 6765 6f6d  f.set_staticgeom
+00021c10: 7328 6764 662c 206e 616d 653d 2272 6976  s(gdf, name="riv
+00021c20: 6572 7322 290a 0a20 2020 2020 2020 2023  ers")..        #
+00021c30: 2055 7064 6174 6520 7265 7365 7276 6f69   Update reservoi
+00021c40: 7220 616e 6420 6c61 6b65 730a 2020 2020  r and lakes.    
+00021c50: 2020 2020 7265 6d6f 7665 5f72 6573 6572      remove_reser
+00021c60: 766f 6972 203d 2046 616c 7365 0a20 2020  voir = False.   
+00021c70: 2020 2020 2069 6620 7365 6c66 2e5f 4d41       if self._MA
+00021c80: 5053 5b22 7265 7361 7265 6173 225d 2069  PS["resareas"] i
+00021c90: 6e20 7365 6c66 2e73 7461 7469 636d 6170  n self.staticmap
+00021ca0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00021cb0: 6573 6572 766f 6972 203d 2073 656c 662e  eservoir = self.
+00021cc0: 7374 6174 6963 6d61 7073 5b73 656c 662e  staticmaps[self.
+00021cd0: 5f4d 4150 535b 2272 6573 6172 6561 7322  _MAPS["resareas"
+00021ce0: 5d5d 0a20 2020 2020 2020 2020 2020 2069  ]].            i
+00021cf0: 6620 6e6f 7420 6e70 2e61 6e79 2872 6573  f not np.any(res
+00021d00: 6572 766f 6972 203e 2030 293a 0a20 2020  ervoir > 0):.   
+00021d10: 2020 2020 2020 2020 2020 2020 2072 656d               rem
+00021d20: 6f76 655f 7265 7365 7276 6f69 7220 3d20  ove_reservoir = 
+00021d30: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00021d40: 2020 2020 2072 656d 6f76 655f 6d61 7073       remove_maps
+00021d50: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00021d60: 2020 2020 2020 2020 2073 656c 662e 5f4d           self._M
+00021d70: 4150 535b 2272 6573 6172 6561 7322 5d2c  APS["resareas"],
+00021d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021d90: 2020 2020 2073 656c 662e 5f4d 4150 535b       self._MAPS[
+00021da0: 2272 6573 6c6f 6373 225d 2c0a 2020 2020  "reslocs"],.    
+00021db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021dc0: 2252 6573 5369 6d70 6c65 4172 6561 222c  "ResSimpleArea",
+00021dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021de0: 2020 2020 2022 5265 7344 656d 616e 6422       "ResDemand"
+00021df0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00021e00: 2020 2020 2020 2252 6573 5461 7267 6574        "ResTarget
+00021e10: 4675 6c6c 4672 6163 222c 0a20 2020 2020  FullFrac",.     
+00021e20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00021e30: 5265 7354 6172 6765 744d 696e 4672 6163  ResTargetMinFrac
+00021e40: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00021e50: 2020 2020 2020 2022 5265 734d 6178 5265         "ResMaxRe
+00021e60: 6c65 6173 6522 2c0a 2020 2020 2020 2020  lease",.        
+00021e70: 2020 2020 2020 2020 2020 2020 2252 6573              "Res
+00021e80: 4d61 7856 6f6c 756d 6522 2c0a 2020 2020  MaxVolume",.    
+00021e90: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+00021ea0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00021eb0: 6c66 2e5f 7374 6174 6963 6d61 7073 203d  lf._staticmaps =
+00021ec0: 2073 656c 662e 7374 6174 6963 6d61 7073   self.staticmaps
+00021ed0: 2e64 726f 705f 7661 7273 2872 656d 6f76  .drop_vars(remov
+00021ee0: 655f 6d61 7073 290a 0a20 2020 2020 2020  e_maps)..       
+00021ef0: 2072 656d 6f76 655f 6c61 6b65 203d 2046   remove_lake = F
+00021f00: 616c 7365 0a20 2020 2020 2020 2069 6620  alse.        if 
+00021f10: 7365 6c66 2e5f 4d41 5053 5b22 6c61 6b65  self._MAPS["lake
+00021f20: 6172 6561 7322 5d20 696e 2073 656c 662e  areas"] in self.
+00021f30: 7374 6174 6963 6d61 7073 3a0a 2020 2020  staticmaps:.    
+00021f40: 2020 2020 2020 2020 6c61 6b65 203d 2073          lake = s
+00021f50: 656c 662e 7374 6174 6963 6d61 7073 5b73  elf.staticmaps[s
+00021f60: 656c 662e 5f4d 4150 535b 226c 616b 6561  elf._MAPS["lakea
+00021f70: 7265 6173 225d 5d0a 2020 2020 2020 2020  reas"]].        
+00021f80: 2020 2020 6966 206e 6f74 206e 702e 616e      if not np.an
+00021f90: 7928 6c61 6b65 203e 2030 293a 0a20 2020  y(lake > 0):.   
+00021fa0: 2020 2020 2020 2020 2020 2020 2072 656d               rem
+00021fb0: 6f76 655f 6c61 6b65 203d 2054 7275 650a  ove_lake = True.
+00021fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021fd0: 7265 6d6f 7665 5f6d 6170 7320 3d20 5b0a  remove_maps = [.
+00021fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ff0: 2020 2020 7365 6c66 2e5f 4d41 5053 5b22      self._MAPS["
+00022000: 6c61 6b65 6172 6561 7322 5d2c 0a20 2020  lakeareas"],.   
+00022010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022020: 2073 656c 662e 5f4d 4150 535b 226c 616b   self._MAPS["lak
+00022030: 656c 6f63 7322 5d2c 0a20 2020 2020 2020  elocs"],.       
+00022040: 2020 2020 2020 2020 2020 2020 2022 4c69               "Li
+00022050: 6e6b 6564 4c61 6b65 4c6f 6373 222c 0a20  nkedLakeLocs",. 
+00022060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022070: 2020 2022 4c61 6b65 5374 6f72 4675 6e63     "LakeStorFunc
+00022080: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00022090: 2020 2020 2020 2022 4c61 6b65 4f75 7466         "LakeOutf
+000220a0: 6c6f 7746 756e 6322 2c0a 2020 2020 2020  lowFunc",.      
+000220b0: 2020 2020 2020 2020 2020 2020 2020 224c                "L
+000220c0: 616b 6541 7265 6122 2c0a 2020 2020 2020  akeArea",.      
+000220d0: 2020 2020 2020 2020 2020 2020 2020 224c                "L
+000220e0: 616b 6541 7667 4c65 7665 6c22 2c0a 2020  akeAvgLevel",.  
+000220f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022100: 2020 224c 616b 6541 7667 4f75 7422 2c0a    "LakeAvgOut",.
+00022110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022120: 2020 2020 224c 616b 6554 6872 6573 686f      "LakeThresho
+00022130: 6c64 222c 0a20 2020 2020 2020 2020 2020  ld",.           
+00022140: 2020 2020 2020 2020 2022 4c61 6b65 5f62           "Lake_b
+00022150: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00022160: 2020 2020 2020 2022 4c61 6b65 5f65 222c         "Lake_e",
+00022170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022180: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
+00022190: 2020 2073 656c 662e 5f73 7461 7469 636d     self._staticm
+000221a0: 6170 7320 3d20 7365 6c66 2e73 7461 7469  aps = self.stati
+000221b0: 636d 6170 732e 6472 6f70 5f76 6172 7328  cmaps.drop_vars(
+000221c0: 7265 6d6f 7665 5f6d 6170 7329 0a0a 2020  remove_maps)..  
+000221d0: 2020 2020 2020 2020 2020 2320 5570 6461            # Upda
+000221e0: 7465 2074 6162 6c65 730a 2020 2020 2020  te tables.      
+000221f0: 2020 2020 2020 6964 7320 3d20 6e70 2e75        ids = np.u
+00022200: 6e69 7175 6528 6c61 6b65 290a 2020 2020  nique(lake).    
+00022210: 2020 2020 2020 2020 7365 6c66 2e5f 7461          self._ta
+00022220: 626c 6573 203d 207b 0a20 2020 2020 2020  bles = {.       
+00022230: 2020 2020 2020 2020 206b 3a20 760a 2020           k: v.  
+00022240: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00022250: 7220 6b2c 2076 2069 6e20 7365 6c66 2e74  r k, v in self.t
+00022260: 6162 6c65 732e 6974 656d 7328 290a 2020  ables.items().  
+00022270: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00022280: 206e 6f74 2061 6e79 285b 7374 7228 7829   not any([str(x)
+00022290: 2069 6e20 6b20 666f 7220 7820 696e 2069   in k for x in i
+000222a0: 6473 5d29 0a20 2020 2020 2020 2020 2020  ds]).           
+000222b0: 207d 0a0a 2020 2020 2020 2020 2320 5570   }..        # Up
+000222c0: 6461 7465 2063 6f6e 6669 670a 2020 2020  date config.    
+000222d0: 2020 2020 2320 5265 6d6f 7665 2074 6865      # Remove the
+000222e0: 2061 6273 6f6c 7574 6520 7061 7468 2061   absolute path a
+000222f0: 6e64 2069 6620 6e65 6564 6564 2072 656d  nd if needed rem
+00022300: 6f76 6520 6c61 6b65 7320 616e 6420 7265  ove lakes and re
+00022310: 7365 7276 6f69 7273 0a20 2020 2020 2020  servoirs.       
+00022320: 2069 6620 7265 6d6f 7665 5f72 6573 6572   if remove_reser
+00022330: 766f 6972 3a0a 2020 2020 2020 2020 2020  voir:.          
+00022340: 2020 2320 6368 616e 6765 2072 6573 6572    # change reser
+00022350: 766f 6972 7320 3d20 7472 7565 2074 6f20  voirs = true to 
+00022360: 6661 6c73 650a 2020 2020 2020 2020 2020  false.          
+00022370: 2020 7365 6c66 2e73 6574 5f63 6f6e 6669    self.set_confi
+00022380: 6728 226d 6f64 656c 2e72 6573 6572 766f  g("model.reservo
+00022390: 6972 7322 2c20 4661 6c73 6529 0a20 2020  irs", False).   
+000223a0: 2020 2020 2020 2020 2023 2072 656d 6f76           # remov
+000223b0: 6520 7374 6174 6573 0a20 2020 2020 2020  e states.       
+000223c0: 2020 2020 2069 6620 7365 6c66 2e67 6574       if self.get
+000223d0: 5f63 6f6e 6669 6728 2273 7461 7465 2e6c  _config("state.l
+000223e0: 6174 6572 616c 2e72 6976 6572 2e72 6573  ateral.river.res
+000223f0: 6572 766f 6972 2229 2069 7320 6e6f 7420  ervoir") is not 
+00022400: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00022410: 2020 2020 2020 6465 6c20 7365 6c66 2e63        del self.c
+00022420: 6f6e 6669 675b 2273 7461 7465 225d 5b22  onfig["state"]["
+00022430: 6c61 7465 7261 6c22 5d5b 2272 6976 6572  lateral"]["river
+00022440: 225d 5b22 7265 7365 7276 6f69 7222 5d0a  "]["reservoir"].
+00022450: 0a20 2020 2020 2020 2069 6620 7265 6d6f  .        if remo
+00022460: 7665 5f6c 616b 653a 0a20 2020 2020 2020  ve_lake:.       
+00022470: 2020 2020 2023 2063 6861 6e67 6520 6c61       # change la
+00022480: 6b65 7320 3d20 7472 7565 2074 6f20 6661  kes = true to fa
+00022490: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+000224a0: 7365 6c66 2e73 6574 5f63 6f6e 6669 6728  self.set_config(
+000224b0: 226d 6f64 656c 2e6c 616b 6573 222c 2046  "model.lakes", F
+000224c0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+000224d0: 2020 2320 7265 6d6f 7665 2073 7461 7465    # remove state
+000224e0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
+000224f0: 2073 656c 662e 6765 745f 636f 6e66 6967   self.get_config
+00022500: 2822 7374 6174 652e 6c61 7465 7261 6c2e  ("state.lateral.
+00022510: 7269 7665 722e 6c61 6b65 2229 2069 7320  river.lake") is 
+00022520: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00022530: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
+00022540: 6c66 2e63 6f6e 6669 675b 2273 7461 7465  lf.config["state
+00022550: 225d 5b22 6c61 7465 7261 6c22 5d5b 2272  "]["lateral"]["r
+00022560: 6976 6572 225d 5b22 6c61 6b65 225d 0a0a  iver"]["lake"]..
+00022570: 2020 2020 6465 6620 636c 6970 5f66 6f72      def clip_for
+00022580: 6369 6e67 2873 656c 662c 2063 7273 3d34  cing(self, crs=4
+00022590: 3332 362c 202a 2a6b 7761 7267 7329 3a0a  326, **kwargs):.
+000225a0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+000225b0: 6e20 636c 6970 7070 6564 2066 6f72 6369  n clippped forci
+000225c0: 6e67 2066 6f72 2073 7562 6261 7369 6e2e  ng for subbasin.
+000225d0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000225e0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+000225f0: 2d0a 2020 2020 2020 2020 7861 7272 6179  -.        xarray
+00022600: 2e44 6174 6153 6574 0a20 2020 2020 2020  .DataSet.       
+00022610: 2020 2020 2043 6c69 7070 6564 2066 6f72       Clipped for
+00022620: 6369 6e67 2e0a 0a20 2020 2020 2020 2022  cing...        "
+00022630: 2222 0a20 2020 2020 2020 2069 6620 6c65  "".        if le
+00022640: 6e28 7365 6c66 2e66 6f72 6369 6e67 2920  n(self.forcing) 
+00022650: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00022660: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
+00022670: 6f28 2243 6c69 7070 696e 6720 4e65 7443  o("Clipping NetC
+00022680: 4446 2066 6f72 6369 6e67 2e2e 2229 0a20  DF forcing.."). 
+00022690: 2020 2020 2020 2020 2020 2064 735f 666f             ds_fo
+000226a0: 7263 696e 6720 3d20 7872 2e6d 6572 6765  rcing = xr.merge
+000226b0: 2873 656c 662e 666f 7263 696e 672e 7661  (self.forcing.va
+000226c0: 6c75 6573 2829 292e 7261 7374 6572 2e63  lues()).raster.c
+000226d0: 6c69 705f 6262 6f78 280a 2020 2020 2020  lip_bbox(.      
+000226e0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000226f0: 7461 7469 636d 6170 732e 7261 7374 6572  taticmaps.raster
+00022700: 2e62 6f75 6e64 730a 2020 2020 2020 2020  .bounds.        
+00022710: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00022720: 2020 7365 6c66 2e73 6574 5f66 6f72 6369    self.set_forci
+00022730: 6e67 2864 735f 666f 7263 696e 6729 0a    ng(ds_forcing).
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/wflow_sediment.py` & `hydromt_wflow-0.3.0/hydromt_wflow/wflow_sediment.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 # -*- coding: utf-8 -*-
 
 import os
-from os.path import join
+from os.path import join, isfile
 import numpy as np
 import pandas as pd
 import xarray as xr
 
 from hydromt_wflow.wflow import WflowModel, PCR_VS_MAP
 from .workflows import landuse, soilgrids_sediment
 from . import DATADIR
@@ -47,14 +47,26 @@
             mode=mode,
             config_fn=config_fn,
             data_libs=data_libs,
             deltares_data=deltares_data,
             logger=logger,
         )
 
+    def setup_rivers(self, *args, **kwargs):
+        """This components copies the functionality of WflowModel, but removes the
+        river_routing key from the config
+
+        See Also
+        --------
+        WflowModel.setup_rivers
+        """
+        super().setup_rivers(*args, **kwargs)
+
+        self.config["model"].pop("river_routing", None)
+
     def setup_lakes(self, lakes_fn="hydro_lakes", min_area=1.0):
         """This component generates maps of lake areas and outlets as well as parameters
         with average lake area, depth a discharge values.
 
         The data is generated from features with ``min_area`` [km2] from a database with
         lake geometry, IDs and metadata. Currently, "hydro_lakes" (hydroLakes) is the only
         supported ``lakes_fn`` data source and we use a default minimum area of 1 km2.
@@ -90,28 +102,42 @@
             if self.get_config("state.lateral.river.lake") is not None:
                 del self.config["state"]["lateral"]["river"]["lake"]
             if self.get_config("input.lateral.river.lake") is not None:
                 del self.config["input"]["lateral"]["river"]["lake"]
 
     def setup_reservoirs(
         self,
-        reservoirs_fn="hydro_reservoirs",
-        min_area=1.0,
-        priority_jrc=True,
+        reservoirs_fn: str,
+        timeseries_fn: str = None,
+        min_area: float = 1.0,
         **kwargs,
     ):
         """This component generates maps of lake areas and outlets as well as parameters
         with average reservoir area, demand, min and max target storage capacities and
         discharge capacity values.
 
-        The data is generated from features with ``min_area`` [km2]
+        The data is generated from features with ``min_area`` [km2] (default is 1 km2)
         from a database with reservoir geometry, IDs and metadata.
-        Currently, "hydro_reservoirs" (based on GRAND) is the only supported ``reservoirs_fn``
-        data source and we use a default minimum area of 1 km2.
 
+        Data requirements for direct use (ie wflow parameters are data already present in reservoirs_fn)
+        are reservoir ID 'waterbody_id', area 'ResSimpleArea' [m2], maximum volume 'ResMaxVolume' [m3],
+        the targeted minimum and maximum fraction of water volume in the reservoir 'ResTargetMinFrac'
+        and 'ResTargetMaxFrac' [-], the average water demand ResDemand [m3/s] and the maximum release of
+        the reservoir before spilling 'ResMaxRelease' [m3/s].
+
+        In case the wflow parameters are not directly available they can be computed by HydroMT based on time series of reservoir surface water area.
+        These time series can be retreived from either the hydroengine or the gwwapi, based on the Hylak_id the reservoir, found in the GrandD database.
+
+        The required variables for computation of the parameters with time series data are reservoir ID 'waterbody_id',
+        reservoir ID in the HydroLAKES database 'Hylak_id', average volume 'Vol_avg' [m3], average depth 'Depth_avg'
+        [m], average discharge 'Dis_avg' [m3/s] and dam height 'Dam_height' [m].
+        To compute parameters without using time series data, the required varibales in reservoirs_fn are reservoir ID 'waterbody_id',
+        average area 'Area_avg' [m2], average volume 'Vol_avg' [m3], average depth 'Depth_avg' [m], average discharge 'Dis_avg'
+        [m3/s] and dam height 'Dam_height' [m] and minimum / normal / maximum storage capacity of the dam 'Capacity_min',
+        'Capacity_norm', 'Capacity_max' [m3].
 
         Adds model layers:
 
         * **wflow_reservoirareas** map: reservoir IDs [-]
         * **wflow_reservoirlocs** map: reservoir IDs at outlet locations [-]
         * **ResSimpleArea** map: reservoir area [m2]
         * **ResMaxVolume** map: reservoir max volume [m3]
@@ -119,30 +145,32 @@
         * **ResTargetFullFrac** map: reservoir target full frac [m3/m3]
         * **ResDemand** map: reservoir demand flow [m3/s]
         * **ResMaxRelease** map: reservoir max release flow [m3/s]
         * **reservoirs** geom: polygon with reservoirs and wflow reservoir parameters
 
         Parameters
         ----------
-        reservoirs_fn : {'hydro_reservoirs'}
+        reservoirs_fn : str
             Name of data source for reservoir parameters, see data/data_sources.yml.
 
-            * Required variables with hydroengine: ['waterbody_id', 'Hylak_id', 'Vol_avg', 'Depth_avg', 'Dis_avg', 'Dam_height']
+            * Required variables for direct use: ['waterbody_id', 'ResSimpleArea', 'ResMaxVolume', 'ResTargetMinFrac', 'ResTargetFullFrac', 'ResDemand', 'ResMaxRelease']
+
+            * Required variables for computation with timeseries_fn: ['waterbody_id', 'Hylak_id', 'Vol_avg', 'Depth_avg', 'Dis_avg', 'Dam_height']
 
-            * Required variables without hydroengine: ['waterbody_id', 'Area_avg', 'Vol_avg', 'Depth_avg', 'Dis_avg', 'Capacity_max', 'Capacity_norm', 'Capacity_min', 'Dam_height']
+            * Required variables for computation without timeseries_fn: ['waterbody_id', 'Area_avg', 'Vol_avg', 'Depth_avg', 'Dis_avg', 'Capacity_max', 'Capacity_norm', 'Capacity_min', 'Dam_height']
+        timeseries_fn : str {'gww', 'hydroengine', 'none'}, optional
+            Download and use time series of reservoir surface water area to calculate and overwrite the reservoir volume/areas of the data source. Timeseries are
+            either downloaded from Global Water Watch 'gww' (using gwwapi package) or JRC 'jrc' (using hydroengine package). By default None.
         min_area : float, optional
             Minimum reservoir area threshold [km2], by default 1.0 km2.
-        priority_jrc : boolean, optional
-            If True, use JRC water occurence (Pekel,2016) data from GEE to calculate
-            and overwrite the reservoir volume/areas of the data source.
         """
         super().setup_reservoirs(
             reservoirs_fn=reservoirs_fn,
+            timeseries_fn=timeseries_fn,
             min_area=min_area,
-            priority_jrc=priority_jrc,
             **kwargs,
         )
         # Update the toml to match wflow_sediment and not wflow_sbm
         res_toml_add = {
             "model.doreservoir": True,
             "model.reservoirs": False,
         }
@@ -150,45 +178,75 @@
             for option in res_toml_add:
                 self.set_config(option, res_toml_add[option])
             if self.get_config("state.lateral.river.reservoir") is not None:
                 del self.config["state"]["lateral"]["river"]["reservoir"]
             if self.get_config("input.lateral.river.reservoir") is not None:
                 del self.config["input"]["lateral"]["river"]["reservoir"]
 
+    def setup_outlets(
+        self,
+        river_only=True,
+        toml_output="csv",
+        gauge_toml_header=["TSS"],
+        gauge_toml_param=["lateral.river.SSconc"],
+    ):
+        """This components sets the default gauge map based on basin outlets.
+
+        Adds model layers:
+
+        * **wflow_gauges** map: gauge IDs map from catchment outlets [-]
+        * **gauges** geom: polygon of catchment outlets
+
+        Parameters
+        ----------
+        river_only : bool, optional
+            Only derive outlet locations if they are located on a river instead of locations for all catchments, by default True.
+        toml_output : str, optional
+            One of ['csv', 'netcdf', None] to update [csv] or [netcdf] section of wflow toml file or do nothing. By default, 'csv'.
+        gauge_toml_header : list, optional
+            Save specific model parameters in csv section. This option defines the header of the csv file./
+            By default saves TSS (for lateral.river.SSconc).
+        gauge_toml_param: list, optional
+            Save specific model parameters in csv section. This option defines the wflow variable corresponding to the/
+            names in gauge_toml_header. By default saves lateral.river.SSconc (for TSS).
+        """
+        super().setup_outlets(
+            river_only=river_only,
+            toml_output=toml_output,
+            gauge_toml_header=gauge_toml_header,
+            gauge_toml_param=gauge_toml_param,
+        )
+
     def setup_gauges(
         self,
         gauges_fn=None,
         source_gdf=None,
         snap_to_river=True,
         mask=None,
         derive_subcatch=False,
-        derive_outlet=True,
         basename=None,
-        update_toml=True,
-        gauge_toml_header=None,
-        gauge_toml_param=None,
+        toml_output="csv",
+        gauge_toml_header=["Q", "TSS"],
+        gauge_toml_param=["lateral.river.q_riv", "lateral.river.SSconc"],
         **kwargs,
     ):
-        """This components sets the default gauge map based on basin outlets and additional
-        gauge maps based on ``gauges_fn`` data.
+        """This components sets a gauge map based on ``gauges_fn`` data.
 
         Supported gauge datasets include "grdc"
         or "<path_to_source>" for user supplied csv or geometry files with gauge locations.
         If a csv file is provided, a "x" or "lon" and "y" or "lat" column is required
         and the first column will be used as IDs in the map. If ``snap_to_river`` is set
         to True, the gauge location will be snapped to the boolean river mask. If
         ``derive_subcatch`` is set to True, an additonal subcatch map is derived from
         the gauge locations.
 
         Adds model layers:
 
-        * **wflow_gauges** map: gauge IDs map from catchment outlets [-]
         * **wflow_gauges_source** map: gauge IDs map from source [-] (if gauges_fn)
         * **wflow_subcatch_source** map: subcatchment based on gauge locations [-] (if derive_subcatch)
-        * **gauges** geom: polygon of catchment outlets
         * **gauges_source** geom: polygon of gauges from source
         * **subcatch_source** geom: polygon of subcatchment based on gauge locations [-] (if derive_subcatch)
 
         Parameters
         ----------
         gauges_fn : str, {"grdc"}, optional
             Known source name or path to gauges file geometry file, by default None.
@@ -200,36 +258,32 @@
             If provided snaps to the mask, else snaps to the river (default).
         derive_subcatch : bool, optional
             Derive subcatch map for gauges, by default False
         derive_outlet : bool, optional
             Derive gaugemap based on catchment outlets, by default True
         basename : str, optional
             Map name in staticmaps (wflow_gauges_basename), if None use the gauges_fn basename.
-        update_toml : boolean, optional
-            Update [outputcsv] section of wflow toml file.
+        toml_output : str, optional
+            One of ['csv', 'netcdf', None] to update [csv] or [netcdf] section of wflow toml file or do nothing. By default, 'csv'.
         gauge_toml_header : list, optional
             Save specific model parameters in csv section. This option defines the header of the csv file./
             By default saves Q (for lateral.river.q_riv) and TSS (for lateral.river.SSconc).
         gauge_toml_param: list, optional
             Save specific model parameters in csv section. This option defines the wflow variable corresponding to the/
             names in gauge_toml_header. By default saves lateral.river.q_riv (for Q) and lateral.river.SSconc (for TSS).
         """
         # # Add new outputcsv section in the config
-        if gauge_toml_param is None and update_toml:
-            gauge_toml_header = ["Q", "TSS"]
-            gauge_toml_param = ["lateral.river.q_riv", "lateral.river.SSconc"]
         super().setup_gauges(
             gauges_fn=gauges_fn,
             source_gdf=source_gdf,
             snap_to_river=snap_to_river,
             mask=mask,
             derive_subcatch=derive_subcatch,
-            derive_outlet=derive_outlet,
             basename=basename,
-            update_toml=update_toml,
+            toml_output=toml_output,
             gauge_toml_header=gauge_toml_header,
             gauge_toml_param=gauge_toml_param,
         )
 
     def setup_lulcmaps(
         self,
         lulc_fn="globcover",
@@ -243,26 +297,26 @@
             "Sl",
             "Swood",
             "USLE_C",
             "WaterFrac",
         ],
     ):
         """This component derives several wflow maps are derived based on landuse-
-        landcover (LULC) data. 
-        
+        landcover (LULC) data.
+
         Currently, ``lulc_fn`` can be set to the "vito", "globcover"
         or "corine", fo which lookup tables are constructed to convert lulc classses to
         model parameters based on literature. The data is remapped at its original
         resolution and then resampled to the model resolution using the average
         value, unless noted differently.
 
         Adds model layers:
 
         * **landuse** map: Landuse class [-]
-            Original source dependent LULC class, resampled using nearest neighbour.       
+            Original source dependent LULC class, resampled using nearest neighbour.
         * **Cov_river** map: vegetation coefficent reducing stream bank erosion [-].
         * **Kext** map: Extinction coefficient in the canopy gap fraction equation [-]
         * **Sl** map: Specific leaf storage [mm]
         * **Swood** map: Fraction of wood in the vegetation/plant [-]
         * **USLE_C** map: Cover managment factor from the USLE equation [-]
         * **PathFrac** map: The fraction of compacted or urban area per grid cell [-]
         * **WaterFrac** map: The fraction of open water per grid cell [-]
@@ -278,18 +332,15 @@
             List of landuse parameters to keep.\
             By default ["landuse","Cov_river","Kext","N","PathFrac","USLE_C","Sl","Swood","WaterFrac"]
         """
         super().setup_lulcmaps(
             lulc_fn=lulc_fn, lulc_mapping_fn=lulc_mapping_fn, lulc_vars=lulc_vars
         )
 
-    def setup_riverbedsed(
-        self,
-        bedsed_mapping_fn=None,
-    ):
+    def setup_riverbedsed(self, bedsed_mapping_fn=None, **kwargs):
         """Setup sediments based river bed characteristics maps.
 
         Adds model layers:
 
         * **D50_River** map: median sediment diameter of the river bed [mm]
         * **ClayF_River** map: fraction of clay material in the river bed [-]
         * **SiltF_River** map: fraction of silt material in the river bed [-]
@@ -303,31 +354,35 @@
 
             * Required variable: ['strord','D50_River', 'ClayF_River', 'SiltF_River', 'SandF_River', 'GravelF_River']
 
         """
         self.logger.info(f"Preparing riverbedsed parameter maps.")
         # Make D50_River map from csv file with mapping between streamorder and D50_River value
         if bedsed_mapping_fn is None:
-            fn_map = join(DATADIR, "wflow_sediment", "riverbedsed_mapping.csv")
+            fn_map = "riverbedsed_mapping_default"
         else:
             fn_map = bedsed_mapping_fn
+
+        if not isfile(fn_map) and fn_map not in self.data_catalog:
+            raise ValueError(f"Riverbed sediment mapping file not found: {fn_map}")
+        df = self.data_catalog.get_dataframe(fn_map, **kwargs)
+
         strord = self.staticmaps[self._MAPS["strord"]].copy()
-        df = pd.read_csv(fn_map, index_col=0, sep=",|;", engine="python")
         # max streamorder value above which values get the same N_River value
         max_str = df.index[-2]
         # if streamroder value larger than max_str, assign last value
         strord = strord.where(strord <= max_str, max_str)
         # handle missing value (last row of csv is mapping of nan values)
         strord = strord.where(strord != strord.raster.nodata, -999)
         strord.raster.set_nodata(-999)
 
         ds_riversed = landuse(
             da=strord,
             ds_like=self.staticmaps,
-            fn_map=fn_map,
+            df=df,
             logger=self.logger,
         )
 
         self.set_staticmaps(ds_riversed)
 
     def setup_canopymaps(
         self,
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/workflows/basemaps.py` & `hydromt_wflow-0.3.0/hydromt_wflow/workflows/basemaps.py`

 * *Files 2% similar despite different names*

```diff
@@ -142,23 +142,22 @@
             idxs_pit = idxs_pit0[outbas_pit != 0]
             basins = flwdir_out.basins(idxs=idxs_pit).astype(np.int32)
             ds_out.coords["mask"] = xr.Variable(
                 dims=ds_out.raster.dims, data=basins != 0, attrs=dict(_FillValue=0)
             )
         else:
             # This is a patch for basins which are clipped based on bbox or wrong geom
-            ds_out.coords["mask"] = (
-                ds["mask"]
-                .astype(np.int8)
-                .raster.reproject_like(da_flw, method="nearest")
-                .astype(np.bool)
-            )
+            mask_int = ds["mask"].astype(np.int8)
+            mask_int.raster.set_nodata(-1)  # change nodata value
+            ds_out.coords["mask"] = mask_int.raster.reproject_like(
+                da_flw, method="nearest"
+            ).astype(np.bool)
             basins = ds_out["mask"].values.astype(np.int32)
             logger.warning(
-                "The basin delination might be wrong as no original resolution outlets "
+                "The basin delineation might be wrong as no original resolution outlets "
                 "are found in the upscaled map."
             )
         ds_out[basins_name] = xr.Variable(dims, basins, attrs=dict(_FillValue=0))
         # calculate upstream area using subgrid ucat cell areas
         outidx = np.where(
             ds_out["mask"], da_flw.coords["idx_out"].values, flwdir_out._mv
         )
@@ -226,21 +225,22 @@
         ds_out["subare"] = xr.Variable(dims, subare, attrs=attrs).astype(np.float32)
     # logging
     npits = flwdir_out.idxs_pit.size
     xy_pit = flwdir_out.xy(flwdir_out.idxs_pit[:5])
     xy_pit_str = ", ".join([f"({x:.5f},{y:.5f})" for x, y in zip(*xy_pit)])
     # stream order
     if strord_name not in ds_out.data_vars:
-        logger.debug(f"Derive stream order.")
+        logger.debug("Derive stream order.")
         strord = flwdir_out.stream_order()
         ds_out[strord_name] = xr.Variable(dims, strord)
         ds_out[strord_name].raster.set_nodata(255)
 
     # clip to basin extent
-    ds_out = ds_out.raster.clip_mask(mask=ds_out[basins_name])
+    ds_out = ds_out.raster.clip_mask(da_mask=ds_out[basins_name])
+
     ds_out.raster.set_crs(ds.raster.crs)
     logger.debug(
         f"Map shape: {ds_out.raster.shape}; active cells: {flwdir_out.ncells}."
     )
     logger.debug(f"Outlet coordinates ({len(xy_pit[0])}/{npits}): {xy_pit_str}.")
     if np.any(np.asarray(ds_out.raster.shape) == 1):
         raise ValueError(
@@ -255,21 +255,22 @@
     ds: xr.Dataset,
     ds_like: xr.Dataset,
     elevtn_name: str = "elevtn",
     lndslp_name: str = "lndslp",
     method: str = "average",
     logger=logger,
 ):
-    """Returns topography maps (see list below) at model resolution based on gridded 
-    elevation data input. 
+    """Returns topography maps (see list below) at model resolution based on gridded
+    elevation data input.
+
+    The following topography maps are calculated:
+
+    - elevtn : average elevation [m]
+    - lndslp : average land surface slope [m/m]
 
-    The following topography maps are calculated:\
-    - elevtn : average elevation [m]\
-    - lndslp : average land surface slope [m/m]\
-    
     Parameters
     ----------
     ds : xarray.DataArray
         Dataset containing gridded flow direction and elevation data.
     ds_like : xarray.DataArray
         Dataset at model resolution.
     elevtn_name, lndslp_name : str, optional
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/workflows/glaciers.py` & `hydromt_wflow-0.3.0/hydromt_wflow/workflows/glaciers.py`

 * *Files 1% similar despite different names*

```diff
@@ -16,19 +16,20 @@
     ds_like,
     id_column="simple_id",
     elevtn_name="elevtn",
     logger=logger,
 ):
     """Returns glacier maps (see list below) at model resolution.
 
-    The following glacier maps are calculated:\
-    - wflow_glacierareas: glacier IDs [ID]\
-    - wflow_glacierfrac: area fraction of glacier per cell [-]\
-    - wflow_glacierstore: storage (volume) of glacier per cell [mm]\
-    
+    The following glacier maps are calculated:
+
+    - wflow_glacierareas: glacier IDs [ID]
+    - wflow_glacierfrac: area fraction of glacier per cell [-]
+    - wflow_glacierstore: storage (volume) of glacier per cell [mm]
+
     Parameters
     ----------
     gdf : geopandas.GeoDataFrame
         GeoDataFrame containing glacier geometries and attributes.
     ds_like : xarray.DataArray
         Dataset at model resolution.
     id_column : str, optional, one of "simple_id", "C3S_id", "RGI_id", or "GLIMS_id"
@@ -138,18 +139,19 @@
     Cfmax=5.3,
     SIfrac=0.002,
     id_column="simple_id",
     logger=logger,
 ):
     """Returns glacier intbls (see list below).
 
-    The following glacier intbls are calculated:\
-    - glacTempThresh: glacier temperature threshold [°C]\
-    - glacCfmax: glacier melting factor [mm/(°C*day)]\
-    - glacSIfrac: fraction of snowpack converted into ice and added to glacier storage [-]\
+    The following glacier intbls are calculated:
+
+    - glacTempThresh: glacier temperature threshold [°C]
+    - glacCfmax: glacier melting factor [mm/(°C*day)]
+    - glacSIfrac: fraction of snowpack converted into ice and added to glacier storage [-]
 
     Parameters
     ----------
     gdf : geopandas.GeoDataFrame
         GeoDataFrame containing glacier geometries and attributes.
     TT : float, optional
         Default value for glacier temperature threshold.
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/workflows/landuse.py` & `hydromt_wflow-0.3.0/hydromt_wflow/workflows/landuse.py`

 * *Files 10% similar despite different names*

```diff
@@ -12,48 +12,45 @@
 __all__ = ["landuse", "lai"]
 
 
 RESAMPLING = {"landuse": "nearest", "lai": "average"}
 DTYPES = {"landuse": np.int16}
 
 
-def landuse(da, ds_like, fn_map, logger=logger, params=None):
+# def landuse(da, ds_like, data_catalog, fn_map, logger=logger, params=None):
+def landuse(da, ds_like, df, logger=logger, params=None):
     """Returns landuse map and related parameter maps.
     The parameter maps are prepared based on landuse map and
     mapping table as provided in the generic data folder of hydromt.
 
-    The following topography maps are calculated:\
+    The following topography maps are calculated:
+
     - TODO
-    
+
     Parameters
     ----------
     da : xarray.DataArray
         DataArray containing LULC classes.
     ds_like : xarray.DataArray
         Dataset at model resolution.
 
     Returns
     -------
     ds_out : xarray.Dataset
         Dataset containing gridded landuse based maps
     """
-    # read csv with remapping values
-    df = pd.read_csv(fn_map, index_col=0, sep=",|;", engine="python", dtype=DTYPES)
-    # limit dtypes to avoid gdal errors downstream
-    ddict = {"float64": np.float32, "int64": np.int32}
-    dtypes = {c: ddict.get(str(df[c].dtype), df[c].dtype) for c in df.columns}
-    df = pd.read_csv(fn_map, index_col=0, sep=",|;", engine="python", dtype=dtypes)
     keys = df.index.values
     if params is None:
         params = [p for p in df.columns if p != "description"]
     elif not np.all(np.isin(params, df.columns)):
         missing = [p for p in params if p not in df.columns]
         raise ValueError(f"Parameter(s) missing in mapping file: {missing}")
     # setup ds out
     ds_out = xr.Dataset(coords=ds_like.raster.coords)
+
     # setup reclass method
     def reclass(x):
         return np.vectorize(d.get)(x, nodata)
 
     da = da.raster.interpolate_na(method="nearest")
     # apply for each parameter
     for param in params:
@@ -74,15 +71,15 @@
 
 
 def lai(da, ds_like, logger=logger):
     """Returns climatology of Leaf Area Index (LAI).
 
     The following topography maps are calculated:\
     - LAI\
-    
+
     Parameters
     ----------
     da : xarray.DataArray or xarray.Dataset
         DataArray or Dataset with LAI array containing LAI values.
     ds_like : xarray.DataArray
         Dataset at model resolution.
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/workflows/ptf.py` & `hydromt_wflow-0.3.0/hydromt_wflow/workflows/ptf.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,15 +1,14 @@
 # -*- coding: utf-8 -*-
 
 import numpy as np
 import math
 
 
 def kv_brakensiek(thetas, clay, sand):
-
     """
     Determine saturated hydraulic conductivity kv [mm/day] based on:
     Brakensiek, D.L., Rawls, W.J.,and Stephenson, G.R.: Modifying scs hydrologic soil groups
     and curve numbers for range land soils, ASAE Paper no. PNR-84-203, St. Joseph, Michigan,
     USA, 1984.
 
     Parameters
@@ -50,15 +49,14 @@
         * 24
     )
 
     return kv
 
 
 def kv_cosby(sand, clay):
-
     """
     Determine saturated hydraulic conductivity kv [mm/day] based on:
     Cosby, B.J., Hornberger, G.M., Clapp, R.B., Ginn, T.R., 1984. A statistical exploration
     of the relationship of soil moisture characteristics to the physical properties of soils.
     Water Resour. Res. 20(6) 682-690.
 
     Parameters
@@ -77,15 +75,14 @@
 
     kv = 60.96 * 10.0 ** (-0.6 + 0.0126 * sand - 0.0064 * clay) * 10.0
 
     return kv
 
 
 def pore_size_index_brakensiek(sand, thetas, clay):
-
     """
     Determine Brooks-Corey pore size distribution index [-] based on:
     Rawls,W. J., and Brakensiek, D. L.: Estimation of SoilWater Retention and Hydraulic
     Properties, In H. J. Morel-Seytoux (Ed.), Unsaturated flow in hydrologic modelling -
     Theory and practice, NATO ASI Series 9, 275–300, Dordrecht, The Netherlands: Kluwer Academic
     Publishing, 1989.
 
@@ -120,15 +117,14 @@
         - 0.00674491 * (thetas**2) * clay
     )
 
     return poresizeindex
 
 
 def thetas_toth(ph, bd, clay, silt):
-
     """
     Determine saturated water content [m3/m3] based on:
     Tóth, B., Weynants, M., Nemes, A., Makó, A., Bilas, G., and Tóth, G.: New generation
     of hydraulic pedotransfer functions for Europe, Eur. J. Soil Sci., 66, 226–238. doi: 10.1111/ejss.121921211, 2015.
 
     Parameters
     ----------
@@ -165,15 +161,14 @@
         - 0.0003152 * ph**2
     )
 
     return thetas
 
 
 def thetar_toth(oc, clay, silt):
-
     """
     Determine residual water content [m3/m3] based on:
     Tóth, B., Weynants, M., Nemes, A., Makó, A., Bilas, G., and Tóth, G.: New generation
     of hydraulic pedotransfer functions for Europe, Eur. J. Soil Sci., 66, 226–238. doi: 10.1111/ejss.121921211, 2015.
 
     Parameters
     ----------
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/workflows/river.py` & `hydromt_wflow-0.3.0/hydromt_wflow/workflows/river.py`

 * *Files 19% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 import pyflwdir
 
 from hydromt import gis_utils, stats, flw, workflows
 from hydromt_wflow import DATADIR  # global var
 
 logger = logging.getLogger(__name__)
 
-__all__ = ["river", "river_bathymetry", "river_width"]
+__all__ = ["river", "river_bathymetry", "river_width", "river_floodplain_volume"]
 
 RESAMPLING = {"climate": "nearest", "precip": "average"}
 NODATA = {"discharge": -9999}
 
 
 def power_law(x, a, b):
     return a * np.power(x, b)
@@ -32,53 +32,54 @@
     slope_len=2e3,
     min_rivlen_ratio=0.0,
     channel_dir="up",
     logger=logger,
 ):
     """Returns river maps
 
-    The output maps are:\
-    - rivmsk : river mask based on upstream area threshold on upstream area\
-    - rivlen : river length [m]\
-    - rivslp : smoothed river slope [m/m]\
-    - rivzs : elevation of the river bankfull height based on pixel outlet 
+    The output maps are:
+
+    - rivmsk : river mask based on upstream area threshold on upstream area
+    - rivlen : river length [m]
+    - rivslp : smoothed river slope [m/m]
+    - rivzs : elevation of the river bankfull height based on pixel outlet
     - rivwth : river width at pixel outlet (if in ds)
     - qbankfull : bankfull discharge at pixel outlet (if in ds)
 
     Parameters
     ----------
     ds: xr.Dataset
-        hydrography dataset containing "flwdir", "uparea", "elevtn" variables; 
+        hydrography dataset containing "flwdir", "uparea", "elevtn" variables;
         and optional "rivwth" and "qbankfull" variable
     ds_model: xr.Dataset, optional
         model dataset with output grid, must contain "uparea", for subgrid rivlen/slp
         must contain "x_out", "y_out". If None, ds is assumed to be the model grid
     river_upa: float
         minimum threshold to define river cell & pixels, by default 30 [km2]
     slope_len: float
         minimum length over which to calculate the river slope, by default 1000 [m]
     min_rivlen_ratio: float
-        minimum global river length to avg. Cell resolution ratio used as threshold 
-        in window based smoothing of river length, by default 0.0. 
+        minimum global river length to avg. Cell resolution ratio used as threshold
+        in window based smoothing of river length, by default 0.0.
         The smoothing is skipped if min_riverlen_ratio = 0.
     channel_dir: {"up", "down"}
-        flow direcition in which to calculate (subgrid) river length and width
-    
+        flow direction in which to calculate (subgrid) river length and width
+
     Returns:
     ds_out: xr.Dataset
         Dataset with output river attributes
     """
     # check data variables.
     dvars = ["flwdir", "uparea", "elevtn"]
     dvars_model = ["flwdir", "uparea"]
     if not np.all([v in ds for v in dvars]):
         raise ValueError(f"One or more variables missing from ds: {dvars}.")
     if ds_model is not None and not np.all([v in ds_model for v in dvars_model]):
         raise ValueError(f"One or more variables missing from ds_model: {dvars_model}")
-    # sort sugrid
+    # sort subgrid
     subgrid = True
     if ds_model is None or not np.all([v in ds_model for v in ["x_out", "y_out"]]):
         subgrid = False
         ds_model = ds
         logger.info("River length and slope are calculated at model resolution.")
 
     ## river mask and flow directions at model grid
@@ -124,15 +125,15 @@
         res = np.mean(np.abs([xres, yres]))
         min_len = res * min_rivlen_ratio
         flwdir_model = flw.flwdir_from_da(ds_model["flwdir"], mask=riv_mask)
         rivlen2 = flwdir_model.smooth_rivlen(rivlen, min_len, nodata=-9999)
         min_len2 = rivlen2[riv_mask].min()
         pmod = (rivlen != rivlen2).sum() / riv_mask.sum() * 100
         logger.debug(
-            f"River length smoothed (min length: {min_len:.0f} m; cells modified: {pmod:.1f})%."
+            f"River length smoothed (min length: {min_len2:.0f} m; cells modified: {pmod:.1f})%."
         )
         rivlen = rivlen2
     elif min_rivlen_ratio > 0:
         logger.warning(
             "River length smoothing skipped as it requires newer version of pyflwdir."
         )
 
@@ -146,17 +147,16 @@
     )
     rivslp = np.where(riv_mask.values, rivslp, -9999)
 
     # create xarray dataset for all river variables
     ds_out = xr.Dataset(coords=ds_model.raster.coords)
     dims = ds_model.raster.dims
     # save as uint8 as bool is not supported in nc and tif files
-    riv_mask = riv_mask.astype(np.uint8)
-    riv_mask.raster.set_nodata(0)
-    ds_out["rivmsk"] = riv_mask
+    ds_out["rivmsk"] = riv_mask.astype(np.uint8)
+    ds_out["rivmsk"].raster.set_nodata(0)
     attrs = dict(_FillValue=-9999, unit="m")
     ds_out["rivlen"] = xr.Variable(dims, rivlen, attrs=attrs)
     attrs = dict(_FillValue=-9999, unit="m.m-1")
     ds_out["rivslp"] = xr.Variable(dims, rivslp, attrs=attrs)
 
     for name in ["rivwth", "qbankfull"]:
         if name in ds:
@@ -301,14 +301,109 @@
     ds_model["rivdph"] = np.maximum(min_rivdph, ds_model["rivdph"]).where(
         riv_mask, -9999
     )
 
     return ds_model[["rivwth", "rivdph"]]
 
 
+def river_floodplain_volume(
+    ds,
+    ds_model,
+    river_upa=30,
+    flood_depths=[0.5, 1.0, 1.5, 2.0, 2.5],
+    dtype=np.float64,
+    logger=logger,
+):
+    """Calculate the floodplain volume at given flood depths based on a (subgrid) HAND map.
+
+    Parameters
+    ----------
+    ds: xr.Dataset
+        hydrography dataset containing "flwdir", "uparea", "elevtn" variables;
+    ds_model: xr.Dataset, optional
+        Model dataset with output grid, must contain "rivmsk", "rivwth", "rivlen"
+        for subgrid must contain "x_out", "y_out".
+    river_upa: float
+        minimum threshold to define the river when calculating HAND, by default 30 [km2]
+    flood_depths : list of float, optional
+        flood depths at which a volume is derived, by default [0.5,1.0,1.5,2.0,2.5]
+    dtype: numpy.dtype, optional
+        output dtype
+
+    Returns
+    -------
+    da_out : xr.DataArray with dims (flood_depth, y, x)
+        Floodplain volume [m3]
+    """
+    if not ds.raster.crs == ds_model.raster.crs:
+        raise ValueError("Hydrography dataset CRS does not match model CRS")
+
+    # check data variables.
+    dvars = ["flwdir", "elevtn", "uparea"]
+    dvars_model = ["rivmsk", "rivwth", "rivlen"]
+    if not np.all([v in ds for v in dvars]):
+        raise ValueError(f"One or more variables missing from ds: {dvars}.")
+    if not np.all([v in ds_model for v in dvars_model]):
+        raise ValueError(f"One or more variables missing from ds_model: {dvars_model}")
+
+    # initialize flood directions
+    flwdir = flw.flwdir_from_da(ds["flwdir"], mask=None)
+
+    # get river cell coordinates
+    riv_mask = ds_model["rivmsk"].values > 0
+    if "x_out" in ds_model and "y_out" in ds_model:  # use subgrid
+        idxs_out = ds.raster.xy_to_idx(
+            xs=ds_model["x_out"].values,
+            ys=ds_model["y_out"].values,
+            mask=riv_mask,
+            nodata=flwdir._mv,
+        )
+    else:
+        # get cell index of river cells
+        idxs_out = np.arange(ds_model.raster.size).reshape(ds_model.raster.shape)
+        idxs_out = np.where(riv_mask, idxs_out, flwdir._mv)
+
+    # calculate hand
+    hand = flwdir.hand(
+        drain=ds["uparea"].values >= river_upa, elevtn=ds["elevtn"].values
+    )
+
+    # calculate volume at user defined flood depths
+    # note that the ucat_map is not save currently but is required if
+    # we want to create a flood map by postprocessing
+    flood_depths = np.atleast_1d(flood_depths).ravel().astype(dtype)  # force 1D
+    _, ucat_vol = flwdir.ucat_volume(idxs_out=idxs_out, hand=hand, depths=flood_depths)
+    # force minimum volume based on river width * length
+    rivlen = np.maximum(ds_model["rivlen"].values, 1)  # avoid zero division errors
+    min_vol = ds_model["rivwth"].values * rivlen * flood_depths[0]
+    ucat_vol[0, :, :] = np.maximum(ucat_vol[0, :, :], min_vol)
+    fldwth = ucat_vol[0, :, :] / rivlen / flood_depths[0]
+    for i in range(1, ucat_vol.shape[0]):
+        dh = flood_depths[i] - flood_depths[i - 1]
+        min_vol = ucat_vol[i - 1, ...] + (fldwth * rivlen * dh)
+        ucat_vol[i, :, :] = np.maximum(ucat_vol[i, :, :], min_vol)
+        fldwth = (ucat_vol[i, :, :] - ucat_vol[i - 1, :, :]) / rivlen / dh
+
+    # return xarray DataArray
+    da_out = (
+        xr.DataArray(
+            coords={"flood_depth": flood_depths, **ds_model.raster.coords},
+            dims=("flood_depth", *ds_model.raster.dims),
+            data=ucat_vol,
+        )
+        .reset_coords(drop=True)
+        .where(ds_model["rivmsk"] > 0, -9999.0)
+    )
+    da_out.raster.set_nodata(-9999.0)
+    da_out.raster.set_crs(ds_model.raster.crs)
+
+    # TODO return a second dataset with hand and ucat_map variables for postprocessing
+    return da_out
+
+
 # TODO: methods below are redundant after version v0.1.4 and will be removed in
 # future versions
 
 
 def river_width(
     ds_like,
     flwdir,
@@ -325,17 +420,15 @@
     a=None,
     b=None,
     logger=logger,
     **kwargs,
 ):
     nopars = a is None or b is None  # no manual a, b parameters
     fit = fit or (nopars and predictor not in ["discharge"])  # fit power-law on the fly
-    nowth = (
-        f"{rivwth_name}{obs_postfix}" not in ds_like
-    )  # no obseved with in staticmaps
+    nowth = f"{rivwth_name}{obs_postfix}" not in ds_like  # no observed width
     fill = fill and nowth == False  # fill datagaps and masked areas (lakes/res) in obs
 
     if nowth and fit:
         raise ValueError(
             f'Observed rivwth "{rivwth_name}{obs_postfix}" required to fit riverwidths.'
         )
     elif nowth:
```

### Comparing `hydromt_wflow-0.2.1/hydromt_wflow/workflows/soilgrids.py` & `hydromt_wflow-0.3.0/hydromt_wflow/workflows/soilgrids.py`

 * *Files 3% similar despite different names*

```diff
@@ -54,15 +54,14 @@
 
     """
     da_sum = soilthickness * 0.0
     # set NaN values to 0.0 (to avoid RuntimeWarning in comparison soildepth)
     d = soilthickness.fillna(0.0)
 
     for i in ds.sl:
-
         da_sum = da_sum + (
             (soildepth_cm[i] - soildepth_cm[i - 1])
             * ds.sel(sl=i)
             * (d >= soildepth_cm[i])
             + (d - soildepth_cm[i - 1])
             * ds.sel(sl=i)
             * ((d < soildepth_cm[i]) & (d > soildepth_cm[i - 1]))
@@ -79,15 +78,14 @@
 
     da_av.raster.set_nodata(np.nan)
 
     return da_av
 
 
 def average_soillayers(ds, soilthickness):
-
     """
     Determine weighted average of soil property at different depths over soil thickness,
     using the trapezoidal rule.
     See also: Hengl, T., Mendes de Jesus, J., Heuvelink, G. B. M., Ruiperez Gonzalez, M., Kilibarda,
     M., Blagotic, A., et al.: SoilGrids250m: Global gridded soil information based on machine learning,
     PLoS ONE, 12, https://doi.org/10.1371/journal.pone.0169748, 2017.
     This function is used for soilgrids (2017).
@@ -98,24 +96,23 @@
         Dataset containing soil property at each soil depth [sl1 - sl7].
     soilthickness : xarray.DataArray
         Dataset containing soil thickness [cm].
 
     Returns
     -------
     da_av : xarray.DataArray
-        Dataset containing weighted average of soil property.
+        Dataset containing the weighted average of the soil property.
 
     """
 
     da_sum = soilthickness * 0.0
     # set NaN values to 0.0 (to avoid RuntimeWarning in comparison soildepth)
     d = soilthickness.fillna(0.0)
 
     for i in range(1, len(ds.sl)):  # range(1, 7):
-
         da_sum = da_sum + (
             (soildepth_cm[i] - soildepth_cm[i - 1])
             * (ds.sel(sl=i) + ds.sel(sl=i + 1))
             * (d >= soildepth_cm[i])
             + (d - soildepth_cm[i - 1])
             * (ds.sel(sl=i) + ds.sel(sl=i + 1))
             * ((d < soildepth_cm[i]) & (d > soildepth_cm[i - 1]))
@@ -132,15 +129,14 @@
 
     da_av.raster.set_nodata(np.nan)
 
     return da_av
 
 
 def pore_size_distrution_index_layers(ds, thetas):
-
     """
     Determine pore size distribution index per soil layer depth based on PTF.
 
     Parameters
     ----------
     ds: xarray.Dataset
         Dataset containing soil properties at each soil depth [sl1 - sl7].
@@ -167,15 +163,14 @@
     ds_out.name = "pore_size"
     ds_out.raster.set_nodata(np.nan)
     # ds_out = ds_out.raster.interpolate_na("nearest")
     return ds_out
 
 
 def kv_layers(ds, thetas, ptf_name):
-
     """
     Determine vertical saturated hydraulic conductivity (KsatVer) per soil layer depth based on PTF.
 
     Parameters
     ----------
     ds: xarray.Dataset
         Dataset containing soil properties at each soil depth [sl1 - sl7].
@@ -284,45 +279,46 @@
     M = xr.where(M < 0, M_minmax, M)
     return M
 
 
 def soilgrids(ds, ds_like, ptfKsatVer, soil_fn, logger=logger):
     """
     Returns soil parameter maps at model resolution based on soil properties from SoilGrids datasets.
-    Both soilgrids 2017 and 2020 are supported. Soilgrids 2017 provides soil properties at 7 specific depths, while soilgrids_2020 provides soil properties averaged over 6 depth intervals. 
-    Ref: Hengl, T., Mendes de Jesus, J., Heuvelink, G. B. M., Ruiperez Gonzalez, M., Kilibarda, 
-    M., Blagotic, A., et al.: SoilGrids250m: Global gridded soil information based on machine learning, 
+    Both soilgrids 2017 and 2020 are supported. Soilgrids 2017 provides soil properties at 7 specific depths, while soilgrids_2020 provides soil properties averaged over 6 depth intervals.
+    Ref: Hengl, T., Mendes de Jesus, J., Heuvelink, G. B. M., Ruiperez Gonzalez, M., Kilibarda,
+    M., Blagotic, A., et al.: SoilGrids250m: Global gridded soil information based on machine learning,
     PLoS ONE, 12, https://doi.org/10.1371/journal.pone.0169748, 2017.
-    Ref: de Sousa, L.M., Poggio, L., Batjes, N.H., Heuvelink, G., Kempen, B., Riberio, E. and Rossiter, D., 2020. 
+    Ref: de Sousa, L.M., Poggio, L., Batjes, N.H., Heuvelink, G., Kempen, B., Riberio, E. and Rossiter, D., 2020.
     SoilGrids 2.0: producing quality-assessed soil information for the globe. SOIL Discussions, pp.1-37.
-    https://doi.org/10.5194/soil-2020-65 
+    https://doi.org/10.5194/soil-2020-65
+
+    The following soil parameter maps are calculated:
+
+    - **thetaS** : average saturated soil water content [m3/m3]
+    - **thetaR** : average residual water content [m3/m3]
+    - **KsatVer** : vertical saturated hydraulic conductivity at soil surface [mm/day]
+    - **SoilThickness** : soil thickness [mm]
+    - **SoilMinThickness** : minimum soil thickness [mm] (equal to SoilThickness)
+    - **M** : model parameter [mm] that controls exponential decline of KsatVer with soil depth
+      (fitted with curve_fit (scipy.optimize)), bounds of **M** are checked
+    - **M\_** : model parameter [mm] that controls exponential decline of KsatVer with soil depth
+      (fitted with numpy linalg regression), bounds of **M_** are checked
+    - **M_original** : **M** without checking bounds
+    - **M_original_** : **M_** without checking bounds
+    - **f** : scaling parameter controlling the decline of KsatVer [mm-1] (fitted with curve_fit (scipy.optimize)), bounds are checked
+    - **f_** : scaling parameter controlling the decline of KsatVer [mm-1] (fitted with numpy linalg regression), bounds are checked
+    - **c_0** : Brooks Corey coefficient [-] based on pore size distribution index at depth 1st
+      soil layer (100 mm) wflow_sbm
+    - **c_1** : idem **c_0** at depth 2nd soil layer (400 mm) wflow_sbm
+    - **c_2** : idem **c_0** at depth 3rd soil layer (1200 mm) wflow_sbm
+    - **c_3** : idem **c_0** at depth 4th soil layer (> 1200 mm) wflow_sbm
+    - **KsatVer_[z]cm** : KsatVer [mm/day] at soil depths [z] of SoilGrids data [0.0, 5.0, 15.0, 30.0, 60.0, 100.0, 200.0]
+    - **wflow_soil** : USDA Soil texture based on percentage clay, silt, sand mapping: [1:Clay, 2:Silty Clay, 3:Silty Clay-Loam, 4:Sandy Clay, 5:Sandy Clay-Loam, 6:Clay-Loam, 7:Silt, 8:Silt-Loam, 9:Loam, 10:Sand, 11: Loamy Sand, 12:Sandy Loam]
+
 
-    The following soil parameter maps are calculated:\
-    - `thetaS`            : average saturated soil water content [m3/m3]\
-    - `thetaR`            : average residual water content [m3/m3]\
-    - `KsatVer`           : vertical saturated hydraulic conductivity at soil surface [mm/day]\
-    - `SoilThickness`     : soil thickness [mm]\
-    - `SoilMinThickness`  : minimum soil thickness [mm] (equal to SoilThickness)\
-    - `M`                 : model parameter [mm] that controls exponential decline of KsatVer with soil depth 
-                            (fitted with curve_fit (scipy.optimize)), bounds of M are checked\
-    - `M_`                : model parameter [mm] that controls exponential decline of KsatVer with soil depth 
-                            (fitted with numpy linalg regression), bounds of `M_`are checked\
-    - `M_original`        : `M` without checking bounds\
-    - `M_original_`       : `M_`without checking bounds\
-    - `f`                 : scaling parameter controlling the decline of KsatVer [mm-1] (fitted with curve_fit (scipy.optimize)), bounds are checked\
-    - `f_`                : scaling parameter controlling the decline of KsatVer [mm-1] (fitted with numpy linalg regression), bounds are checked\
-    - `c_0`               : Brooks Corey coefficient [-] based on pore size distribution index at depth
-                            1st soil layer (100 mm) wflow_sbm\
-    - `c_1`               : idem `c_0` at depth 2nd soil layer (400 mm) wflow_sbm\
-    - `c_2`               : idem `c_0` at depth 3rd soil layer (1200 mm) wflow_sbm\
-    - `c_3`               : idem `c_0` at depth 4th soil layer (> 1200 mm) wflow_sbm\
-    - `KsatVer_[z]cm`     : KsatVer [mm/day] at soil depths [z] of SoilGrids data [0.0, 5.0, 15.0, 30.0, 60.0, 100.0, 200.0]\
-    - `wflow_soil`        : USDA Soil texture based on percentage clay, silt, sand mapping: [1:Clay, 2:Silty Clay, 3:Silty Clay-Loam, 4:Sandy Clay, 5:Sandy Clay-Loam, 6:Clay-Loam, 7:Silt, 8:Silt-Loam, 9:Loam, 10:Sand, 11: Loamy Sand, 12:Sandy Loam]\
-                
-    
     Parameters
     ----------
     ds : xarray.Dataset
         Dataset containing soil properties.
     ds_like : xarray.DataArray
         Dataset at model resolution.
     ptfKsatVer : str
@@ -453,15 +449,15 @@
         ds_c.loc[dict(layer=2)] = (
             c_sl.sel(sl=4) * 200 + c_sl.sel(sl=5) * 400 + c_sl.sel(sl=6) * 200
         ) / 800  # average over layer 400-1200
         ds_c.loc[dict(layer=3)] = c_sl.sel(sl=6)  # layer >1200
     else:
         # for soilgrids 2017, keep the direct mapping calculation.
         da_c = []
-        for (i, sl_ind) in enumerate(c_sl_index):
+        for i, sl_ind in enumerate(c_sl_index):
             da_c.append(3.0 + (2.0 / lambda_sl.sel(sl=sl_ind)))
         ds_c = xr.concat(
             da_c, pd.Index(np.arange(len(c_sl_index), dtype=int), name="layer")
         ).transpose("layer", ...)
         ds_c.name = "c"
     ds_out["c"] = ds_c
 
@@ -548,26 +544,26 @@
         ds_out[var] = ds_out[var].fillna(nodata).astype(dtype)
         ds_out[var].raster.set_nodata(np.dtype(dtype).type(nodata))
 
     return ds_out
 
 
 def soilgrids_sediment(ds, ds_like, usleK_method, logger=logger):
-
     """
-    Returns soil parameter maps for sediment modelling at model resolution based on soil 
+    Returns soil parameter maps for sediment modelling at model resolution based on soil
     properties from SoilGrids dataset.
 
-    The following soil parameter maps are calculated:\
-        - PercentClay: clay content of the topsoil [%]\
-        - PercentSilt: silt content of the topsoil [%]\
-        - PercentOC: organic carbon in the topsoil [%]\
-        - ErosK: mean detachability of the soil (Morgan et al., 1998) [g/J]\
-        - USLE_K: soil erodibility factor from the USLE equation [-]\
-    
+    The following soil parameter maps are calculated:
+
+    * PercentClay: clay content of the topsoil [%]
+    * PercentSilt: silt content of the topsoil [%]
+    * PercentOC: organic carbon in the topsoil [%]
+    * ErosK: mean detachability of the soil (Morgan et al., 1998) [g/J]
+    * USLE_K: soil erodibility factor from the USLE equation [-]
+
     Parameters
     ----------
     ds : xarray.Dataset
         Dataset containing soil properties.
     ds_like : xarray.DataArray
         Dataset at model resolution.
     usleK_method : str
```

### Comparing `hydromt_wflow-0.2.1/pyproject.toml` & `hydromt_wflow-0.3.0/pyproject.toml`

 * *Files 10% similar despite different names*

```diff
@@ -1,26 +1,25 @@
 [build-system]
 requires = ["flit_core >=3.4.0,<4"]
 build-backend = "flit_core.buildapi"
 
 [project]
 name = "hydromt_wflow"
 authors = [
-    {name = "Dirk Eilander", email = "dirk.eilander@deltares.nl"},
-    {name = "Hélène Boisgontier", email = "helene.boisgontier@deltares.nl"},
+    { name = "Dirk Eilander", email = "dirk.eilander@deltares.nl" },
+    { name = "Hélène Boisgontier", email = "helene.boisgontier@deltares.nl" },
 ]
 dependencies = [
-    "hydromt >=0.5.0",
+    "hydromt >=0.8,<0.9",
     "dask",
     "geopandas >=0.10",
     "netcdf4",
     "numpy",
     "pandas",
-    "pyflwdir>=0.5.6",
-    "pygeos",
+    "pyflwdir>=0.5.7",
     "rasterio",
     "rioxarray",
     "scipy",
     "toml",
     "xarray",
 ]
 requires-python = ">=3.8" # fix tests to support older versions
@@ -33,19 +32,15 @@
     "Topic :: Scientific/Engineering :: Hydrology",
     "License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)",
     "Programming Language :: Python :: 3",
 ]
 dynamic = ['version', 'description']
 
 [project.optional-dependencies]
-test = [
-    "pytest>=2.7.3",
-    "pytest-cov",
-    "black",
-]
+test = ["pytest>=2.7.3", "pytest-cov", "black"]
 doc = [
     "nbsphinx",
     "sphinx",
     "sphinx_design",
     "pydata-sphinx-theme",
     "sphinx_autosummary_accessors",
 ]
@@ -65,8 +60,10 @@
 [tool.flit.sdist]
 include = ["hydromt_wflow"]
 exclude = ["docs", "examples", "envs", "tests", "binder", ".github"]
 
 [tool.pytest.ini_options]
 filterwarnings = [
     "ignore:distutils Version classes are deprecated:DeprecationWarning",
-]
+    "ignore:The staticmaps property:DeprecationWarning",
+    "ignore:The staticgeoms property:DeprecationWarning",
+]
```

### Comparing `hydromt_wflow-0.2.1/PKG-INFO` & `hydromt_wflow-0.3.0/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,27 @@
 Metadata-Version: 2.1
 Name: hydromt_wflow
-Version: 0.2.1
+Version: 0.3.0
 Summary: hydroMT plugin for wflow models.
 Author-email: Dirk Eilander <dirk.eilander@deltares.nl>, Hélène Boisgontier <helene.boisgontier@deltares.nl>
 Requires-Python: >=3.8
 Description-Content-Type: text/x-rst
 Classifier: Development Status :: 4 - Beta
 Classifier: Intended Audience :: Developers
 Classifier: Intended Audience :: Science/Research
 Classifier: Topic :: Scientific/Engineering :: Hydrology
 Classifier: License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)
 Classifier: Programming Language :: Python :: 3
-Requires-Dist: hydromt >=0.5.0
+Requires-Dist: hydromt >=0.8,<0.9
 Requires-Dist: dask
 Requires-Dist: geopandas >=0.10
 Requires-Dist: netcdf4
 Requires-Dist: numpy
 Requires-Dist: pandas
-Requires-Dist: pyflwdir>=0.5.6
-Requires-Dist: pygeos
+Requires-Dist: pyflwdir>=0.5.7
 Requires-Dist: rasterio
 Requires-Dist: rioxarray
 Requires-Dist: scipy
 Requires-Dist: toml
 Requires-Dist: xarray
 Requires-Dist: nbsphinx ; extra == "doc"
 Requires-Dist: sphinx ; extra == "doc"
```

