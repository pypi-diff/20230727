# Comparing `tmp/NEMO_stockroom-1.0.4-py3-none-any.whl.zip` & `tmp/NEMO_stockroom-1.1.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,28 +1,31 @@
-Zip file size: 23549 bytes, number of entries: 26
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-15 18:01 NEMO_stockroom/__init__.py
--rw-r--r--  2.0 unx      599 b- defN 23-Jun-15 18:01 NEMO_stockroom/admin.py
--rw-r--r--  2.0 unx     1556 b- defN 23-Jun-15 18:01 NEMO_stockroom/forms.py
--rw-r--r--  2.0 unx     2401 b- defN 23-Jun-15 18:01 NEMO_stockroom/models.py
--rw-r--r--  2.0 unx       60 b- defN 23-Jun-15 18:01 NEMO_stockroom/tests.py
--rw-r--r--  2.0 unx     1738 b- defN 23-Jun-15 18:01 NEMO_stockroom/urls.py
--rw-r--r--  2.0 unx    12958 b- defN 23-Jun-15 18:01 NEMO_stockroom/views.py
--rw-r--r--  2.0 unx     3708 b- defN 23-Jun-15 18:01 NEMO_stockroom/migrations/0001_initial.py
--rw-r--r--  2.0 unx      488 b- defN 23-Jun-15 18:01 NEMO_stockroom/migrations/0002_alter_consumablerequest_date_deleted.py
--rw-r--r--  2.0 unx      516 b- defN 23-Jun-15 18:01 NEMO_stockroom/migrations/0003_alter_consumablerequest_date_deleted.py
--rw-r--r--  2.0 unx      528 b- defN 23-Jun-15 18:01 NEMO_stockroom/migrations/0004_alter_consumablerequest_date_deleted.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-15 18:01 NEMO_stockroom/migrations/__init__.py
--rw-rw-rw-  2.0 unx     3582 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/NEMO_stockroom/order_history.html
--rw-rw-rw-  2.0 unx     9855 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/NEMO_stockroom/stockroom.html
--rw-rw-rw-  2.0 unx     4464 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/NEMO_stockroom/stockroom_items.html
--rw-rw-rw-  2.0 unx     2524 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/NEMO_stockroom/stockroom_order.html
--rw-rw-rw-  2.0 unx     5624 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/NEMO_stockroom/stockroom_requests.html
--rw-rw-rw-  2.0 unx     5526 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/NEMO_stockroom/stockroom_withdraws.html
--rw-rw-rw-  2.0 unx      448 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/base/navbar.html
--rw-rw-rw-  2.0 unx      615 b- defN 23-Jun-15 18:01 NEMO_stockroom/templates/base/navbar_stockroom.html
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-15 18:01 NEMO_stockroom/templatetags/__init__.py
--rw-r--r--  2.0 unx      431 b- defN 23-Jun-15 18:01 NEMO_stockroom/templatetags/stockroom_custom_tags_and_filters.py
--rw-r--r--  2.0 unx      262 b- defN 23-Jun-15 18:01 NEMO_stockroom-1.0.4.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-15 18:01 NEMO_stockroom-1.0.4.dist-info/WHEEL
--rw-r--r--  2.0 unx       15 b- defN 23-Jun-15 18:01 NEMO_stockroom-1.0.4.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2568 b- defN 23-Jun-15 18:01 NEMO_stockroom-1.0.4.dist-info/RECORD
-26 files, 60558 bytes uncompressed, 19227 bytes compressed:  68.3%
+Zip file size: 26047 bytes, number of entries: 29
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-27 20:07 NEMO_stockroom/__init__.py
+-rw-r--r--  2.0 unx      599 b- defN 23-Jul-27 20:07 NEMO_stockroom/admin.py
+-rw-r--r--  2.0 unx     1556 b- defN 23-Jul-27 20:07 NEMO_stockroom/forms.py
+-rw-r--r--  2.0 unx     2401 b- defN 23-Jul-27 20:07 NEMO_stockroom/models.py
+-rw-r--r--  2.0 unx       60 b- defN 23-Jul-27 20:07 NEMO_stockroom/tests.py
+-rw-r--r--  2.0 unx     2020 b- defN 23-Jul-27 20:07 NEMO_stockroom/urls.py
+-rw-r--r--  2.0 unx    15548 b- defN 23-Jul-27 20:07 NEMO_stockroom/views.py
+-rw-r--r--  2.0 unx     3708 b- defN 23-Jul-27 20:07 NEMO_stockroom/migrations/0001_initial.py
+-rw-r--r--  2.0 unx      488 b- defN 23-Jul-27 20:07 NEMO_stockroom/migrations/0002_alter_consumablerequest_date_deleted.py
+-rw-r--r--  2.0 unx      516 b- defN 23-Jul-27 20:07 NEMO_stockroom/migrations/0003_alter_consumablerequest_date_deleted.py
+-rw-r--r--  2.0 unx      528 b- defN 23-Jul-27 20:07 NEMO_stockroom/migrations/0004_alter_consumablerequest_date_deleted.py
+-rw-r--r--  2.0 unx      664 b- defN 23-Jul-27 20:07 NEMO_stockroom/migrations/0005_alter_consumablerequest_withdraw.py
+-rw-r--r--  2.0 unx      631 b- defN 23-Jul-27 20:07 NEMO_stockroom/migrations/0006_alter_consumablerequest_withdraw.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-27 20:07 NEMO_stockroom/migrations/__init__.py
+-rw-rw-rw-  2.0 unx     3582 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/NEMO_stockroom/order_history.html
+-rw-rw-rw-  2.0 unx       46 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/NEMO_stockroom/scratch
+-rw-rw-rw-  2.0 unx     9807 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/NEMO_stockroom/stockroom.html
+-rw-rw-rw-  2.0 unx     4493 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/NEMO_stockroom/stockroom_items.html
+-rw-rw-rw-  2.0 unx     2524 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/NEMO_stockroom/stockroom_order.html
+-rw-rw-rw-  2.0 unx     6301 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/NEMO_stockroom/stockroom_requests.html
+-rw-rw-rw-  2.0 unx     5892 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/NEMO_stockroom/stockroom_withdraws.html
+-rw-rw-rw-  2.0 unx      448 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/base/navbar.html
+-rw-rw-rw-  2.0 unx      616 b- defN 23-Jul-27 20:07 NEMO_stockroom/templates/base/navbar_stockroom.html
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-27 20:07 NEMO_stockroom/templatetags/__init__.py
+-rw-r--r--  2.0 unx      626 b- defN 23-Jul-27 20:07 NEMO_stockroom/templatetags/stockroom_custom_tags_and_filters.py
+-rw-r--r--  2.0 unx      262 b- defN 23-Jul-27 20:07 NEMO_stockroom-1.1.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-27 20:07 NEMO_stockroom-1.1.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       15 b- defN 23-Jul-27 20:07 NEMO_stockroom-1.1.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2914 b- defN 23-Jul-27 20:07 NEMO_stockroom-1.1.0.dist-info/RECORD
+29 files, 66337 bytes uncompressed, 21139 bytes compressed:  68.1%
```

## zipnote {}

```diff
@@ -27,20 +27,29 @@
 
 Filename: NEMO_stockroom/migrations/0003_alter_consumablerequest_date_deleted.py
 Comment: 
 
 Filename: NEMO_stockroom/migrations/0004_alter_consumablerequest_date_deleted.py
 Comment: 
 
+Filename: NEMO_stockroom/migrations/0005_alter_consumablerequest_withdraw.py
+Comment: 
+
+Filename: NEMO_stockroom/migrations/0006_alter_consumablerequest_withdraw.py
+Comment: 
+
 Filename: NEMO_stockroom/migrations/__init__.py
 Comment: 
 
 Filename: NEMO_stockroom/templates/NEMO_stockroom/order_history.html
 Comment: 
 
+Filename: NEMO_stockroom/templates/NEMO_stockroom/scratch
+Comment: 
+
 Filename: NEMO_stockroom/templates/NEMO_stockroom/stockroom.html
 Comment: 
 
 Filename: NEMO_stockroom/templates/NEMO_stockroom/stockroom_items.html
 Comment: 
 
 Filename: NEMO_stockroom/templates/NEMO_stockroom/stockroom_order.html
@@ -60,20 +69,20 @@
 
 Filename: NEMO_stockroom/templatetags/__init__.py
 Comment: 
 
 Filename: NEMO_stockroom/templatetags/stockroom_custom_tags_and_filters.py
 Comment: 
 
-Filename: NEMO_stockroom-1.0.4.dist-info/METADATA
+Filename: NEMO_stockroom-1.1.0.dist-info/METADATA
 Comment: 
 
-Filename: NEMO_stockroom-1.0.4.dist-info/WHEEL
+Filename: NEMO_stockroom-1.1.0.dist-info/WHEEL
 Comment: 
 
-Filename: NEMO_stockroom-1.0.4.dist-info/top_level.txt
+Filename: NEMO_stockroom-1.1.0.dist-info/top_level.txt
 Comment: 
 
-Filename: NEMO_stockroom-1.0.4.dist-info/RECORD
+Filename: NEMO_stockroom-1.1.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## NEMO_stockroom/urls.py

```diff
@@ -1,11 +1,12 @@
-from django.urls import path
+from django.urls import path, include
 
 import settings
 from NEMO_stockroom import views
+from NEMO_stockroom.templatetags import stockroom_custom_tags_and_filters
 from django.conf.urls.static import static
 
 urlpatterns = [
 
 	# Requesting for users
 	path("stockroom/", views.stockroom, name="stockroom"),
 	path("stockroom/<int:index>/remove/", views.remove_order_at_index, name="remove_order"),
@@ -25,15 +26,18 @@
 	# Display, and allow staff to update, quantities of items in the stockroom
 	path("stockroom/items", views.items_page, name="items_page"),
 
 	# For users to update quantity of their request before it's fulfilled
 	path("stockroom/update_qty_in_session/", views.update_qty_in_session, name="update_qty_in_session"),
 	path("stockroom/update_qty_in_pending_order/", views.update_qty_in_pending_order, name="update_qty_in_pending_order"),
 
+	# Fetch specific data from the database
+	#path("stockroom/requests/get_consumable_qty/<ind:consumable_request_id>", stockroom_custom_tags_and_filters.get_consumable_qty, name="get_consumable_qty"),
+
 
 	# If using this Django debugger, enable this
 	# Django debugger:  https://django-debug-toolbar.readthedocs.io/en/latest/
-	# path('__debug__/', include('debug_toolbar.urls')),
+	#path('__debug__/', include('debug_toolbar.urls')),
 
 ]
 
 urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

## NEMO_stockroom/views.py

```diff
@@ -2,14 +2,16 @@
 from typing import List
 
 from NEMO.decorators import staff_member_required
 from NEMO.exceptions import ProjectChargeException
 from NEMO.models import Consumable, ConsumableWithdraw, User
 from NEMO.policy import policy_class as policy
 from NEMO.utilities import (
+	BasicDisplayTable,
+	export_format_datetime,
 	EmailCategory,
 	extract_optional_beginning_and_end_dates,
 	get_month_timeframe,
 	month_list,
 	send_mail,
 )
 from NEMO.views.customization import ApplicationCustomization, EmailsCustomization
@@ -19,14 +21,15 @@
 from django.shortcuts import redirect, render
 from django.urls import reverse
 from django.utils import timezone
 from django.views.decorators.http import require_GET, require_POST, require_http_methods
 
 from NEMO_stockroom.forms import ConsumableRequestForm
 from NEMO_stockroom.models import ConsumableRequest, QuantityModification
+from NEMO_stockroom.templatetags.stockroom_custom_tags_and_filters import get_request_date
 
 consumables_logger = getLogger(__name__)
 
 
 @login_required
 @require_http_methods(["GET", "POST"])
 def stockroom(request):
@@ -56,14 +59,16 @@
 			return HttpResponseBadRequest(form.errors.as_ul())
 		return render(request, "NEMO_stockroom/stockroom_order.html")
 
 
 @staff_member_required
 @require_http_methods(["GET", "POST"])
 def stockroom_requests(request):
+	from NEMO.rates import rate_class
+	rate_dict = rate_class.get_consumable_rates(Consumable.objects.all())
 	consumable_requests = ConsumableRequest.objects.filter(withdraw__isnull=True)
 	user_set = set()
 	for cr in consumable_requests:
 		user_set.add(cr.customer)
 	if request.method == "GET":
 		if request.GET.get("start") or request.GET.get("end"):
 			start_date, end_date = extract_optional_beginning_and_end_dates(request.GET, date_only=True)
@@ -80,14 +85,15 @@
 		consumable_requests = consumable_requests.filter(date__gte=start_date, date__lte=end_date)
 	dictionary = {
 		"start_date": start_date,
 		"end_date": end_date,
 		"month_list": month_list(),
 		"consumable_requests": consumable_requests,
 		"user_set": user_set,
+		"rates": rate_dict,
 	}
 	return render(request, "NEMO_stockroom/stockroom_requests.html", dictionary)
 
 @staff_member_required
 @require_POST
 def reset_stockroom_requests(request):
 	return
@@ -210,14 +216,21 @@
 	return HttpResponseRedirect(reverse('order_history'))
 
 
 @login_required
 @staff_member_required
 def fulfill_order(request, consumable_request_id):
 	c = ConsumableRequest.objects.get(id=consumable_request_id)
+	c.quantity = int(request.POST.get("request_qty"))
+	if c.quantity > c.consumable.quantity:
+		message = f"ERROR:  There aren't enough {c.consumable}'s to fulfill this order.  "
+		message += f"There are {c.consumable.quantity} in the system, but {c.quantity} were requested.  "
+		message += f"Please add more {c.consumable}'s to the system before fulfilling this order."
+		messages.error(request, message, extra_tags="data-speed=9000")
+		return HttpResponseRedirect(reverse('stockroom_requests'))
 	withdrawal = ConsumableWithdraw.objects.create(
 		consumable_id=c.consumable_id,
 		quantity=c.quantity,
 		merchant=request.user,
 		customer_id=c.customer_id,
 		project_id=c.project_id,
 	)
@@ -233,14 +246,17 @@
 	qm.save()
 	consumable_to_update = Consumable.objects.get(id=withdrawal.consumable_id)
 	consumable_to_update.quantity -= withdrawal.quantity
 	consumable_to_update.save()
 	c.withdraw.merchant_id = request.session['_auth_user_id']
 	c.save()
 	send_stockroom_order_confirmation_email(c.withdraw)
+	message = f"Order of {c.quantity} {c.consumable}'s for {c.customer.first_name} {c.customer.last_name} "
+	message += f"fulfilled successfully."
+	messages.success(request, message, extra_tags="data-speed=9000")
 	return HttpResponseRedirect(reverse('stockroom_requests'))
 
 
 def send_stockroom_order_confirmation_email(cw):
 	"""
 	cw:  ConsumableWithdraw associated w/ this order
 	Adapted from chemical request email (line 96, at time of writing):  https://gitlab.com/mnfc-princeton/NEMO/-/blob/master/NEMO/views/user_chemicals.py
@@ -283,38 +299,43 @@
 	return render(request, "NEMO_stockroom/order_history.html", dictionary)
 
 
 @login_required
 @staff_member_required
 @require_http_methods(["GET", "POST"])
 def display_withdraws(request):
-	consumable_requests = ConsumableRequest.objects.filter(withdraw__isnull=False)
+	from NEMO.rates import rate_class
+	rate_dict = rate_class.get_consumable_rates(Consumable.objects.all())
+	consumable_withdraws = ConsumableWithdraw.objects.all()
 	user_set = set()
-	for cr in consumable_requests:
-		user_set.add(cr.customer)
+	for cw in consumable_withdraws:
+		user_set.add(cw.customer)
 	if request.method == "GET":
 		if request.GET.get("start") or request.GET.get("end"):
 			start_date, end_date = extract_optional_beginning_and_end_dates(request.GET, date_only=True)
 		else:
 			start_date, end_date = get_month_timeframe()
 	elif request.method == "POST":
 		if request.POST.get("start") or request.POST.get("end"):
 			start_date, end_date = extract_optional_beginning_and_end_dates(request.POST, date_only=True)
 		else:
 			start_date, end_date = get_month_timeframe()
 		if request.POST.get("stockroom_withdrawals_user_id"):
 			user_id = request.POST["stockroom_withdrawals_user_id"]
-			consumable_requests = consumable_requests.filter(customer_id=user_id)
-		consumable_requests = consumable_requests.filter(date__gte=start_date, date__lte=end_date)
+			consumable_withdraws = consumable_withdraws.filter(customer_id=user_id)
+	consumable_withdraws = consumable_withdraws.filter(date__gte=start_date, date__lte=end_date).order_by("-date").prefetch_related("consumablerequest_set")
+	if bool(request.GET.get("csv", False)):
+		return csv_export_withdraws(consumable_withdraws, rate_dict)
 	dictionary = {
 		"start_date": start_date,
 		"end_date": end_date,
 		"month_list": month_list(),
-		"consumable_requests": consumable_requests,
+		"consumable_withdraws": consumable_withdraws,
 		"user_set": user_set,
+		"rates": rate_dict,
 	}
 	return render(request, "NEMO_stockroom/stockroom_withdraws.html", dictionary)
 
 
 @login_required
 @staff_member_required
 @require_http_methods(["GET", "POST"])
@@ -357,7 +378,41 @@
 		"consumables": consumables,
 		"consumables_set": set(consumables),
 		"consumable_list_collapse": False,
 		"rates": rate_dict,
 		"search_item": search_item
 	}
 	return render(request, "NEMO_stockroom/stockroom_items.html", dictionary)
+
+
+def csv_export_withdraws(consumable_withdraws, rate_dict):
+	table_result = BasicDisplayTable()
+	table_result.add_header(("name", "Name"))
+	table_result.add_header(("username", "Username"))
+	table_result.add_header(("item", "Item"))
+	table_result.add_header(("price", "Price"))
+	table_result.add_header(("qty", "Quantity"))
+	table_result.add_header(("project", "Project"))
+	table_result.add_header(("account", "Account"))
+	table_result.add_header(("date_fulfilled", "Date Fulfilled"))
+	table_result.add_header(("date_requested", "Date of Request"))
+	table_result.add_header(("merchant", "Order Fulfilled By"))
+	cw_list = list(consumable_withdraws)
+	for cw in cw_list:
+		row = {
+			'name': cw.customer.first_name + " " + cw.customer.last_name,
+			'username': cw.customer.username,
+			'item': cw.consumable.name,
+			'price': rate_dict.get(cw.consumable.name).strip('<b>').strip('</b>'),
+			'qty': cw.quantity,
+			'project': cw.project,
+			'account': cw.project.account.name,
+			'date_fulfilled': cw.date,
+			'date_requested': get_request_date(cw),
+			'merchant': cw.merchant.first_name + " " + cw.merchant.last_name,
+		}
+		table_result.add_row(row)
+	response = table_result.to_csv()
+	filename = f"consumable_withdraws_export_{export_format_datetime()}.csv"
+	response["Content-Disposition"] = f'attachment; filename="{filename}"'
+	return response
+
```

## NEMO_stockroom/templates/NEMO_stockroom/stockroom.html

```diff
@@ -3,15 +3,15 @@
 {% load stockroom_custom_tags_and_filters %}
 {% load static %}
 {% block title %}Stockroom{% endblock %}
 {% block content %}
     <h1>Stockroom</h1>
     <div style="height: 15px"></div>
     <div class="col-md-5">
-        <p>Use this form to charge users for consumable items & supplies.</p>
+        <p>Use this form to submit orders for consumable items & supplies.</p>
         <form id="withdrawal_form_order" action="{% url 'stockroom' %}" class="form-horizontal" method="post">
             {% csrf_token %}
 
             <div class="form-group">
                 <label class="control-label col-md-3" for="project">Project</label>
                 <div class="col-md-9">
                     <select id="project" name="project" class="form-control" {% if not projects %}disabled{% endif %} required>
@@ -47,30 +47,31 @@
                 <div class="col-md-9 control-label" style="text-align: left">
                 </div>
             </div>
 
             <div class="form-group">
                 <div class="col-sm-12">
                     <table class="table">
-                        <!-- explanation of regrouping in Django: https://www.w3schools.com/django/ref_tags_regroup.php -->
+                        <th>Item</th>
+                        <th>Price</th>
                         {% regroup consumables by category as categories %}
                         {% for category in categories %}
                             {% if categories|length > 1 or category.grouper %}
                                 <tr>
                                     <td id="chevron_{{ category.grouper }}" data-toggle="collapse" data-target=".consumables_{{ category.grouper }}" onclick="toggle_details($('#chevron_{{ category.grouper }}'))" style="font-weight: bold">{{ category.grouper|default_if_none:"Uncategorized" }}
                                     <span class="glyphicon glyphicon-chevron-{% if consumable_list_collapse %}right{% else %}down{% endif %} pull-left chevron"></span>
                                 </td></tr>
                             {% endif %}
                             {% for item in category.list %}
                                 <tr class="collapse {% if not consumable_list_collapse %}in{% endif %} consumables_{{ category.grouper }}">
                                     <td  {% if categories|length > 1 or category.grouper %}style="padding-left: 15px;"{% endif %}>
                                         <span class="consumable_trigger" data-item-id="{{ item.id }}">
                                             <img src="{{ item.id|get_thumbnail_url }}" width="75">
                                             {{ item.name }}
-                                            {% if rates and rates|get_item:item.name %} ({{ rates|get_item:item.name|safe }}){% endif %}
+                                            {% if rates and rates|get_item:item.name %} {{ rates|get_item:item.name|safe }}{% endif %}
                                             <span class="glyphicon glyphicon-plus-sign success-highlight" style="vertical-align: text-top"></span>
                                         </span>
                                     </td>
                                 </tr>
                             {% endfor %}
                         {% endfor %}
                     </table>
```

### html2text {}

```diff
@@ -1,12 +1,12 @@
 {% extends 'base.html' %} {% load custom_tags_and_filters %} {% load
 stockroom_custom_tags_and_filters %} {% load static %} {% block title
 %}Stockroom{% endblock %} {% block content %}
 ****** Stockroom ******
-Use this form to charge users for consumable items & supplies.
+Use this form to submit orders for consumable items & supplies.
 {% csrf_token %}
 Project
 % if not projects %}disabled{% endif %} required> {% if projects|length == 0 %}
 {% elif projects|length == 1 %}
 {{ projects.0 }}
 {% elif projects %}
 Choose a project to bill
```

## NEMO_stockroom/templates/NEMO_stockroom/stockroom_items.html

```diff
@@ -44,15 +44,14 @@
                 <th>Price</th>
             </tr>
 
             {% if consumables|length == 0 %}
                 <tr><td>"{{ search_item }}" doesn't exist in the database.  Please click the "Reset" button above, and try again.</td></tr>
             {% endif %}
 
-            <!-- explanation of regrouping in Django: https://www.w3schools.com/django/ref_tags_regroup.php -->
             {% regroup consumables by category as categories %}
             {% for category in categories %}
                 {% if categories|length > 1 or category.grouper %}
                     <tr>
                         <td id="chevron_{{ category.grouper }}" data-toggle="collapse" data-target=".consumables_{{ category.grouper }}" onclick="toggle_details($('#chevron_{{ category.grouper }}'))" style="font-weight: bold">{{ category.grouper|default_if_none:"Uncategorized" }}
                         <span class="glyphicon glyphicon-chevron-{% if consumable_list_collapse %}right{% else %}down{% endif %} pull-left chevron"></span>
                     </td></tr>
@@ -60,15 +59,17 @@
                 {% for item in category.list %}
                     <tr class="collapse {% if not consumable_list_collapse %}in{% endif %} consumables_{{ category.grouper }}">
 
                         <td  {% if categories|length > 1 or category.grouper %}style="padding-left: 15px;"{% endif %}>{{ item.name }}</td>
                         <td {% if categories|length > 1 or category.grouper %}style="padding-left: 15px;"{% endif %}>
                             <input id="stockroom_qty_input__{{ item.id }}" name="stockroom_qty_input__{{ item.id }}" value="{{ item.quantity }}" class="form-control sidebar-item">
                         </td>
-                        <td  {% if categories|length > 1 or category.grouper %}style="padding-left: 15px;"{% endif %}>TBD</td>
+                        <td  {% if categories|length > 1 or category.grouper %}style="padding-left: 15px;"{% endif %}>
+                            {% if rates and rates|get_item:item.name %} {{ rates|get_item:item.name|safe }}{% endif %}
+                        </td>
 
                     </tr>
                 {% endfor %}
             {% endfor %}
         </table>
     </form>
```

## NEMO_stockroom/templates/NEMO_stockroom/stockroom_requests.html

```diff
@@ -5,17 +5,19 @@
 {% block extrahead %}
 	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
 	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}"/>
 {% endblock %}
 {% block content %}
 	<h1>Stockroom Requests</h1>
 
-	<form id="stockroom_request_form" action="{% url 'stockroom_requests' %}" class="form-horizontal" role="form" style="margin-top: 20px" method="post">
+	<!-- <form id="stockroom_request_form" action="{% url 'stockroom_requests' %}" class="form-horizontal" role="form" style="margin-top: 20px" method="post"> -->
+	<form id="stockroom_request_form" name="stockroom_request_form" action="" class="form-horizontal" role="form" style="margin-top: 20px" method="post">
 		{% csrf_token %}
 		<input type="hidden" name="csv" id="hidden_data_csv"/>
+		<input type="hidden" name="request_qty" id="request_qty" value=""/>
 		<div class="form-group">
 			<label class="control-label col-md-2" for="month_list">View charges during</label>
 
 			<div class="col-md-2">
 				<select id="month_list" class="form-control" style="margin-right: 5px;" onchange="set_dates_from_month(this.value)">
 					<option selected></option>
 					{% for month in month_list %}
@@ -66,48 +68,51 @@
 		<thead>
 		<tr>
 			<th>Date</th>
 			<th>User</th>
 			<th>Project</th>
 			<th>Qty</th>
 			<th>Item</th>
-			<th>Project</th>
+			<th>Account</th>
 			<th></th>
 			<th></th>
 		</tr>
 		</thead>
 		<tbody>
 		{% for c in consumable_requests %}
 			{% if c.deleted == False %}
 			<tr class="consumable_request_row_{{ c.id }}">
 				<td>{{ c.date }}</td>
 				<td>{{ c.customer }}</td>
 				<td>{{ c.project }}</td>
-				<td>{{ c.quantity }}</td>
+				<td><input id="{{ c.id }}_qty" name="{{ c.id }}_qty" value="{{ c.quantity }}" class="form-control sidebar-item"></td>
 				<td>{{ c.consumable }}</td>
-				<td>{{ c.project }}</td>
+				<td>{{ c.project.account.name }}</td>
 				<td>
-					<a href="{% url 'fulfill_order' c.id %}" class="btn btn-success" type="save">Fulfill</a>
+					{% url 'fulfill_order' c.id as fulfill_order_url %}
+					<button id="{{ c.id }}_fulfill_button" onclick="fulfill_order({{ c.id }}, '{{ fulfill_order_url }}')" class="btn btn-success" type="save">Fulfill</button>
 				</td>
 				<td>
 					<a href="{% url 'delete_order' c.id %}" class="btn btn-danger" type="delete">Delete</a>
 				</td>
 			</tr>
 			{% endif %}
-        	{% empty %}
-            <tr><td colspan="7">
-                {% if start_date or end_date %}
-                    No requests for stockroom items exist {% if start_date and end_date %}between {{ start_date }} and {{ end_date }}{% elif start_date %}after {{ start_date }}{% else %}before {{ end_date }}{% endif %}.
-                {% endif %}
-            </td></tr>
+			{% empty %}
+			<tr><td colspan="7">
+				{% if start_date or end_date %}
+					No requests for stockroom items exist {% if start_date and end_date %}between {{ start_date }} and {{ end_date }}{% elif start_date %}after {{ start_date }}{% else %}before {{ end_date }}{% endif %}.
+				{% endif %}
+			</td></tr>
 		{% endfor %}
 		</tbody>
 	</table>
 
 
+
+
 	<script>
 
 		// Search button
         $('#user_search_submit').prop("disabled", true);
         $('#user_search_box').autocomplete('user_set', enable_button_from_search, {% json_search_base_with_extra_fields user_set %}).focus();
         function enable_button_from_search(jquery_event, search_selection)
 		{
@@ -150,11 +155,19 @@
 				{
 					let month = start.format("MMMM, YYYY");
 					$('#month_list').val(month)
 				}
 			}
 		}
 
+		function fulfill_order(id, url)
+		{
+			request_qty = document.getElementById(id + '_qty').value;
+			document.getElementById('request_qty').value = request_qty;
+			document.getElementById('stockroom_request_form').action = url;
+			document.stockroom_request_form.submit();
+		}
+
         window.addEventListener("load", set_dropdown_selected)
 	</script>
 
-{% endblock %}
+{% endblock %}
```

### html2text {}

```diff
@@ -17,17 +17,17 @@
 [                    ]
 Search
 Reset
 
 
 
 **** Pending Requests ****
-Date      User       Project   Qty        Item         Project
-          {          {         {          {            {
-{{ c.date {          {         {          {            {         Fulfill Delete
-}}        c.customer c.project c.quantity c.consumable c.project
-          }}         }}        }}         }}           }}
-{% if start_date or end_date %} No requests for stockroom items exist {%
-if start_date and end_date %}between {{ start_date }} and {{ end_date }}
-{% elif start_date %}after {{ start_date }}{% else %}before {{ end_date
-}}{% endif %}. {% endif %}
+Date   User       Project   Qty        Item         Account
+{      {          {         [{         {            {                      {% url
+{      {          {         {          {            {                      'fulfill_order'
+c.date c.customer c.project c.quantity c.consumable c.project.account.name c.id as           Delete
+}}     }}         }}        }}    ]    }}           }}                     fulfill_order_url
+                                                                           %} Fulfill
+{% if start_date or end_date %} No requests for stockroom items exist {% if start_date and
+end_date %}between {{ start_date }} and {{ end_date }}{% elif start_date %}after {
+{ start_date }}{% else %}before {{ end_date }}{% endif %}. {% endif %}
  {% endblock %}
```

## NEMO_stockroom/templates/NEMO_stockroom/stockroom_withdraws.html

```diff
@@ -1,21 +1,22 @@
 {% extends 'base.html' %}
 {% load static %}
 {% load custom_tags_and_filters %}
+{% load stockroom_custom_tags_and_filters %}
 {% block title %}Stockroom Withdrawals{% endblock %}
 {% block extrahead %}
 	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
 	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}"/>
 {% endblock %}
 {% block content %}
 	<h1>Stockroom Withdrawals</h1>
 
-	<form id="stockroom_withdrawal_form" action="{% url 'display_withdraws' %}" class="form-horizontal" role="form" style="margin-top: 20px" method="post">
+	<form id="stockroom_withdrawal_form" action="{% url 'display_withdraws' %}" class="form-horizontal" role="form" style="margin-top: 20px" method="get">
 		{% csrf_token %}
-		<input type="hidden" name="csv" id="hidden_data_csv"/>
+		<input type="hidden" name="csv" id="csv_export" value=""/>
 		<div class="form-group">
 			<label class="control-label col-md-2" for="month_list">View charges during</label>
 
 			<div class="col-md-2">
 				<select id="month_list" class="form-control" style="margin-right: 5px;" onchange="set_dates_from_month(this.value)">
 					<option selected></option>
 					{% for month in month_list %}
@@ -49,50 +50,56 @@
 				<input id="stockroom_withdrawals_user_id" name="stockroom_withdrawals_user_id" type="hidden"/>
 			</div>
 			<div class="col-md-1">
 				<button id="user_search_submit" type="submit" class="btn btn-success">Search</button>
 			</div>
 
 			<div class="col-md-1">
-				<button id="user_reset_button" type="button" onclick="location.href='{% url 'display_withdraws' %}'" class="btn btn-primary">Reset</button>
+				<button id="user_reset_button" type="button" onclick="location.href='{% url 'display_withdraws' %}'" class="btn btn-info">Reset</button>
+			</div>
+
+			<div class="col-md-1">
+				{% button style="margin-left: 15px" type="export" onclick="$('#csv_export').val('true');this.form.submit();" value="Export" %}
 			</div>
 		</div>
 	</form><br>
 
 
 
 
 <br><br>
 <h3>Withdrawals</h3>
 	<table class="table">
 		<thead>
 		<tr>
 			<th>User</th>
 			<th>Item</th>
+			<th>Price</th>
 			<th>Qty</th>
 			<th>Project</th>
+			<th>Account</th>
 			<th>Date Fulfilled</th>
 			<th>Date of Request</th>
 			<th>Order Fulfilled By</th>
 
 		</tr>
 		</thead>
 		<tbody>
-		{% for c in consumable_requests %}
-			{% if c.deleted == False %}
-			<tr class="consumable_request_row_{{ c.id }}">
-				<td>{{ c.customer }}</td>
-				<td>{{ c.consumable }}</td>
-				<td>{{ c.quantity }}</td>
-				<td>{{ c.project }}</td>
-				<td>{{ c.withdraw.date }}</td>
-				<td>{{ c.date }}</td>
-				<td>{{ c.withdraw.merchant.first_name}} {{ c.withdraw.merchant.last_name }}</td>
+		{% for cw in consumable_withdraws %}
+			<tr class="consumable_withdraw_row_{{ cw.id }}">
+				<td>{{ cw.customer }}</td>
+				<td>{{ cw.consumable }}</td>
+				<td>{% if rates and rates|get_item:cw.consumable.name %}{{ rates|get_item:cw.consumable.name|safe }}{% endif %}</td>
+				<td>{{ cw.quantity }}</td>
+				<td>{{ cw.project }}</td>
+				<td>{{ cw.project.account.name }}</td>
+				<td>{{ cw.date }}</td>
+				<td>{{ cw|get_request_date }}</td>
+				<td>{{ cw.merchant.first_name}} {{ cw.merchant.last_name }}</td>
 			</tr>
-			{% endif %}
         	{% empty %}
             <tr><td colspan="7">
                 {% if start_date or end_date %}
                     No requests for stockroom items exist {% if start_date and end_date %}between {{ start_date }} and {{ end_date }}{% elif start_date %}after {{ start_date }}{% else %}before {{ end_date }}{% endif %}.
                 {% endif %}
             </td></tr>
 		{% endfor %}
```

### html2text {}

```diff
@@ -1,9 +1,10 @@
 {% extends 'base.html' %} {% load static %} {% load custom_tags_and_filters %}
-{% block title %}Stockroom Withdrawals{% endblock %} {% block extrahead %}
+{% load stockroom_custom_tags_and_filters %} {% block title %}Stockroom
+Withdrawals{% endblock %} {% block extrahead %}
 ootstrap-datetimepicker.js" %}">
 ootstrap-datetimepicker.css" %}"/> {% endblock %} {% block content %}
 ****** Stockroom Withdrawals ******
 {% csrf_token %}
 View charges during
 {% for month in month_list %}
 {{ month|date:"F, Y" }}
@@ -13,22 +14,25 @@
 and
 [{{ end_date.date|input_date_format }}]
 Filter Dates
 User:
 [                    ]
 Search
 Reset
+{% button style="margin-left: 15px" type="export" onclick="$('#csv_export').val
+('true');this.form.submit();" value="Export" %}
 
 
 
 **** Withdrawals ****
-User       Item         Qty        Project   Date Fulfilled  Date of Order Fulfilled By
-                                                             Request
-{          {            {          {         {               {       {
-{          {            {          {         {               {       {
-c.customer c.consumable c.quantity c.project c.withdraw.date c.date  c.withdraw.merchant.first_name}}
-}}         }}           }}         }}        }}              }}      {{ c.withdraw.merchant.last_name
-                                                                     }}
+User        Item          Price                   Qty         Project    Account                 Date      Date of Request     Order Fulfilled By
+                                                                                                 Fulfilled
+                          {% if rates and                                                                                      {
+{           {             rates|get_item:         {           {          {                       {         {                   {
+{           {             cw.consumable.name %}{  {           {          {                       { cw.date {                   cw.merchant.first_name}}
+cw.customer cw.consumable { rates|get_item:       cw.quantity cw.project cw.project.account.name }}        cw|get_request_date {{ cw.merchant.last_name
+}}          }}            cw.consumable.name|safe }}          }}         }}                                }}                  }}
+                          }}{% endif %}
 {% if start_date or end_date %} No requests for stockroom items exist {% if start_date and end_date
-%}between {{ start_date }} and {{ end_date }}{% elif start_date %}after {{ start_date }}{% else
-%}before {{ end_date }}{% endif %}. {% endif %}
+%}between {{ start_date }} and {{ end_date }}{% elif start_date %}after {{ start_date }}{% else %}before {
+{ end_date }}{% endif %}. {% endif %}
  {% endblock %}
```

## NEMO_stockroom/templates/base/navbar_stockroom.html

```diff
@@ -1,11 +1,11 @@
 {% load custom_tags_and_filters %}
 
 <li class="dropdown">
-    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Stockroom<b class="caret"></b></a>
+    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Stockroom <b class="caret"></b></a>
     <ul id="stockroom-nav" class="dropdown-menu">
         {% navigation_url 'stockroom' 'Place Order' %}
         {% navigation_url 'order_history' 'Order Status & History' %}
         {% if user.is_any_part_of_staff %}
             {% navigation_url 'stockroom_requests' 'Fulfill Orders' %}
             {% navigation_url 'items_page' 'Edit Quantities' %}
             {% navigation_url 'display_withdraws' 'View Withdraws' %}
```

## NEMO_stockroom/templatetags/stockroom_custom_tags_and_filters.py

```diff
@@ -1,10 +1,11 @@
 from django import template
 
-from NEMO_stockroom.models import ConsumableThumbnail
+from NEMO_stockroom.models import ConsumableThumbnail, ConsumableRequest
+from NEMO.models import ConsumableWithdraw
 
 register = template.Library()
 
 @register.filter
 def get_thumbnail_url(consumable_id):
 	try:
 		t = ConsumableThumbnail.objects.get(consumable_id=consumable_id)
@@ -14,7 +15,15 @@
 	return t.image.url
 
 @register.filter
 def get_total_price(unit_price, qty):
 	unit_price = float(unit_price)
 	qty = float(qty)
 	return str(round(unit_price / qty, 2))
+
+@register.filter
+def get_request_date(cw):
+	try:
+		return cw.consumablerequest_set.all()[0].date
+	except Exception:
+		return "N/A"
+
```

## Comparing `NEMO_stockroom-1.0.4.dist-info/RECORD` & `NEMO_stockroom-1.1.0.dist-info/RECORD`

 * *Files 13% similar despite different names*

```diff
@@ -1,26 +1,29 @@
 NEMO_stockroom/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_stockroom/admin.py,sha256=zqLECEcWIbZeTNiIj_44ZIK4O2-JqKv27D_rB_zfbVU,599
 NEMO_stockroom/forms.py,sha256=oCR6r5HXKcveY8lx1gDQ5sGpgbHmc6GQeQPShLiWuy8,1556
 NEMO_stockroom/models.py,sha256=sIMjTaEW9gqtp2P_F9ZExFDltEEmiyosfRgjGy2CcRM,2401
 NEMO_stockroom/tests.py,sha256=mrbGGRNg5jwbTJtWWa7zSKdDyeB4vmgZCRc2nk6VY-g,60
-NEMO_stockroom/urls.py,sha256=13s4AgeEIrlpDuoQ7WAyTAc18nMiv-Xfj8hAK4QWn7c,1738
-NEMO_stockroom/views.py,sha256=XvV9VGSVlxlgMZVwDG79iQ-GhH8VWzuhHzvsu6nWfzg,12958
+NEMO_stockroom/urls.py,sha256=TY9-5DO8UD3YPrItXr3Jh_ne58PBV_QlsacBL_7OuOw,2020
+NEMO_stockroom/views.py,sha256=5XalAp2jUmREstX2tmWShSCeTmbyVixrhKQ51l1xURc,15548
 NEMO_stockroom/migrations/0001_initial.py,sha256=MXTKnw47BxcAQJK9KwKe8xreaAJXKtHPkbbxdf1iKnI,3708
 NEMO_stockroom/migrations/0002_alter_consumablerequest_date_deleted.py,sha256=zFb88OSQD8ae9VmnaC0iNrzVT_eTVJhVGVMePGu7ZNc,488
 NEMO_stockroom/migrations/0003_alter_consumablerequest_date_deleted.py,sha256=4aZK7aD-8teGjpOxqMHkRz35jw6hjz8mUwumJ196si8,516
 NEMO_stockroom/migrations/0004_alter_consumablerequest_date_deleted.py,sha256=yzl5QzIvKAlJYJdBYQySxa69BLTJWywquIY1L6xbfyU,528
+NEMO_stockroom/migrations/0005_alter_consumablerequest_withdraw.py,sha256=ddxqh-KjFoBFHZk19lfKBOh7PFG5QlRZ_Es7-quhhbo,664
+NEMO_stockroom/migrations/0006_alter_consumablerequest_withdraw.py,sha256=xatWnQZzFDO2ZK2heVQhBW-AMJwicx49W7CIqpk8OD0,631
 NEMO_stockroom/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_stockroom/templates/NEMO_stockroom/order_history.html,sha256=nyGL28x1RpsFXv4n-50Jtrr9hsX7kQ2keixzZkYcCRg,3582
-NEMO_stockroom/templates/NEMO_stockroom/stockroom.html,sha256=JC8KvMJqfXtmgOrxOxVMRd2DMXdf4_wSzhZoFgjAphM,9855
-NEMO_stockroom/templates/NEMO_stockroom/stockroom_items.html,sha256=9pQ1vHAlN_fvaselFgUB2mgAwcGtTjf2CPSQ3VwJ1hQ,4464
+NEMO_stockroom/templates/NEMO_stockroom/scratch,sha256=lQvR1szs10Czxj_-JWrPWuOyg00gUWjhiq7hbJcphKk,46
+NEMO_stockroom/templates/NEMO_stockroom/stockroom.html,sha256=SHcjK9OoyWcDCjXkSD7AmfyQpZB0dv1332HSU2tn7Hc,9807
+NEMO_stockroom/templates/NEMO_stockroom/stockroom_items.html,sha256=5rXJCQNyppyz3kId1nkUPRliltwZYuOIyf-ymUp8sog,4493
 NEMO_stockroom/templates/NEMO_stockroom/stockroom_order.html,sha256=q2wEru1kgQfqSB0PophYcq-Unt9HUh4FM5xcY3z3BGg,2524
-NEMO_stockroom/templates/NEMO_stockroom/stockroom_requests.html,sha256=mgC0nWI-0nN6sys7FmkbeepFzTqbN_2eEHBUsYeui-8,5624
-NEMO_stockroom/templates/NEMO_stockroom/stockroom_withdraws.html,sha256=2HJxUghn5W55am4PsFjON_0oPPrhlk2yqywKqtVzoTg,5526
+NEMO_stockroom/templates/NEMO_stockroom/stockroom_requests.html,sha256=5CJeGB2f6SHKOELf410FyYoVVwgBCm9lkqEEGLT-pPg,6301
+NEMO_stockroom/templates/NEMO_stockroom/stockroom_withdraws.html,sha256=1Hl-M74o4DfFysKFCUSZBXLUePf8Z4KMIn2JDa_3KRM,5892
 NEMO_stockroom/templates/base/navbar.html,sha256=z2XAv1IJ5jeEXEYZ6GB9cFOrlOB63A-lr8oHgewZACY,448
-NEMO_stockroom/templates/base/navbar_stockroom.html,sha256=5zXGu42PDhI8CLGYTSIU4qUV70rrE_Q5zJsyus_U9mA,615
+NEMO_stockroom/templates/base/navbar_stockroom.html,sha256=-U179MUO-hB2VVS5vW8y6UZWeKssYOLeXlR9RWV8GEM,616
 NEMO_stockroom/templatetags/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_stockroom/templatetags/stockroom_custom_tags_and_filters.py,sha256=kWxLN2_QLqcGA4qJJN4oHe7lki-dtpLWzAEI7xo67dI,431
-NEMO_stockroom-1.0.4.dist-info/METADATA,sha256=Do0lG0F3yrxCSspOMI5QIV3jgFVrUkNMaFgL7vjBkVo,262
-NEMO_stockroom-1.0.4.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-NEMO_stockroom-1.0.4.dist-info/top_level.txt,sha256=ACHTTHUS-JJ3iT_9u-vZy71jaYqYHsdIUQN5fIW1UCI,15
-NEMO_stockroom-1.0.4.dist-info/RECORD,,
+NEMO_stockroom/templatetags/stockroom_custom_tags_and_filters.py,sha256=Hxoo2Z8vxGqzT_AYCdNlc5sqSvjADoS4WCQtrD_-4-o,626
+NEMO_stockroom-1.1.0.dist-info/METADATA,sha256=YnipjhvGfn3mBOGJKMNaZtKO6_PuzDCfEfpnCAjQibc,262
+NEMO_stockroom-1.1.0.dist-info/WHEEL,sha256=AtBG6SXL3KF_v0NxLf0ehyVOh0cold-JbJYXNGorC6Q,92
+NEMO_stockroom-1.1.0.dist-info/top_level.txt,sha256=ACHTTHUS-JJ3iT_9u-vZy71jaYqYHsdIUQN5fIW1UCI,15
+NEMO_stockroom-1.1.0.dist-info/RECORD,,
```

